;/*FB_PKG_DELIM*/

__d("Cache",["TimeSlice"],(function(t,n,r,o,a,i,l){"use strict";var e=6e4,s=(function(){function t(){this.$1=new Map}var n=t.prototype;return n.has=function(t){return this.$1.has(t)},n.get=function(t,n){var e=this.__getRaw(t);return e?e.$2:n},n.getAll=function(t,n){var e=this,r=new Map;return t.forEach(function(t){return r.set(t,e.get(t,n))}),r},n.delete=function(t){var e=this.__getRaw(t);return e&&e.$3&&clearTimeout(e.$3),this.$1.delete(t)},n.clear=function(){this.$1.forEach(function(e){e&&e.$3&&clearTimeout(e.$3)}),this.$1.clear()},n.set=function(n,o,a,i){if(!this.shouldUpdate(n,a))return!1;var t=this.__getRaw(n);return t||(t=this.__getNewRawObject()),delete t.$2,delete t.$4,t.$3&&clearTimeout(t.$3),delete t.$3,t.$2=o,a!=null&&(t.$4=a),i!=null&&i>=0&&(t.$3=setTimeout(r("TimeSlice").guard(this.delete.bind(this,n),"Cache expiration timeout"),i*e)),this.__setRaw(n,t),!0},n.shouldUpdate=function(t,n){var e=this.__getRaw(t);return e==null||e.$4==null||n==null||n>e.$4},n.size=function(){return this.$1.size},n.__getRaw=function(t){return this.$1.get(t)},n.__setRaw=function(t,n){this.$1.set(t,n)},n.__getNewRawObject=function(){return{$2:null,$3:null,$4:null,$5:null,$6:null}},n.__keys=function(){return this.$1.keys()},t})();l.default=s}),98);
__d("CoalescingLoader",["Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";var e;function l(){return new(e||(e=n("Promise")))(function(e){return globalThis.setTimeout(e,0)})}var s=(function(){function e(e,t){t===void 0&&(t=l),this.$1=e,this.$2=[],this.$3=null,this.$4=t}var t=e.prototype;return t.gen=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){this.$2.push(e);var t=this.$2.length-1,n=yield this.$5();return n[t]});function t(t){return e.apply(this,arguments)}return t})(),t.$5=function(){return this.$3!=null?this.$3:(this.$3=this.$6(),this.$3)},t.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield this.$4();var e=this.$2;return this.$2=[],this.$3=null,this.$1([].concat(e))});function t(){return e.apply(this,arguments)}return t})(),e})();i.CoalescingLoader=s}),66);
__d("EBDBConsistencyApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReQL","asyncToGeneratorRuntime","getErrorSafe","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],u=null;function c(){return u}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var a=yield o("EBDB").getEBDB(),l=BigInt((e||(e=o("I64"))).to_string(n));yield a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:l,env:t}])},"EBDB - AddDevice",i.id+":54"),u=l}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on EBDB - AddDevice")}}),m.apply(this,arguments)}function p(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)).then(function(e){return e==null?void 0:e.deviceId})}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(n!=null)return d(t,n);try{var o=yield p(e);return o==null?void 0:d(t,o)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on fetching secure_encrypted_backups_client_state")}}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){r("QPLUserFlow").addPoint(t,"track_overprompting_start");try{var a=yield o("EBDB").getEBDB(),l=!1;yield a.runInTransaction(["device_state"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t.stores.device_state.get(e);(n==null?void 0:n.deviceId)!=null&&(l=!0)});return function(e){return t.apply(this,arguments)}})(),"EBDB - AddDevice",i.id+":107"),r("QPLUserFlow").addAnnotations(t,{bool:{overprompting:l}}),r("QPLUserFlow").addPoint(t,"track_overprompting_end")}catch(e){r("QPLUserFlow").addPoint(t,"track_overprompting_fail"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on track overpropting")}}),h.apply(this,arguments)}var y=n("$InternalEnum")({Disabled:0,EbsmInconsistent:1,EbdbInconsistent:2,Enabled:3,Inconsistent:4});function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield p(t),r=n!=null?BigInt((e||(e=o("I64"))).to_string(n)):null;return r==null&&u==null?y.Disabled:r==null&&u!=null?y.EbsmInconsistent:r!=null&&u==null?y.EbdbInconsistent:r===u?y.Enabled:y.Inconsistent}),b.apply(this,arguments)}function v(e,t,n,r){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,o){var a=1/r("justknobx")._("3914");if(!(Math.random()>=a)){var i=r("qpl")._(521471316,"2831");try{r("QPLUserFlow").start(i);var l=yield C(e);o!=null&&r("QPLUserFlow").addAnnotations(i,o()),r("QPLUserFlow").endSuccess(i,{annotations:{int:{consistency:l,env:t,operation:n}}})}catch(e){r("QPLUserFlow").endFailure(i,"error"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on trackConsistency in %s",t)}}}),S.apply(this,arguments)}function R(){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("EBDB").clearDeviceState(),u=null}),L.apply(this,arguments)}var E;function k(e,t){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){E!=null&&E(),yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(e){e!=null&&((e==null?void 0:e.backupId)==null||(e==null?void 0:e.isUserOptedOut)===!0)&&R()}).catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDBApi: EBLS error on fetching data from encrypted_backups")}),E=t.tables.encrypted_backups.subscribe(function(e,t){t.operation!=="delete"&&(t.value.backupId==null||t.value.isUserOptedOut===!0)&&R()});var a=yield o("EBDB").getEBDB(),l=yield a.runInTransaction(["device_state"],"readonly",function(e){return e.stores.device_state.get(n)},"EBDB - readDeviceState",i.id+":250").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: fetching device_state")});if(u=T(l==null?void 0:l.deviceId),u==null){var s=yield p(t);if(s==null)return;var c=BigInt((e||(e=o("I64"))).to_string(s));u=c,yield a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:c,env:n}])},"EBDB - writeDeviceState",i.id+":272").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: write device_state")})}}),I.apply(this,arguments)}function T(t){if(t!=null){if(typeof t=="bigint")return t;if(typeof t=="number")return BigInt(t);if(typeof t=="string")try{return BigInt(t)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing string as BigInt"),R();return}if(Array.isArray(t))try{return BigInt((e||(e=o("I64"))).to_string(t))}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing I64 as BigInt"),R();return}r("FBLogger")("wmi_eb").mustfix("EBDBApi: Parsing unknown as BigInt %s",String(t)),R()}}l.EB_STORES=s,l.getDeviceId=c,l.addNewDevice=_,l.trackOverprompting=g,l.EBConsistencyResult=y,l.checkRegistrationConsistency=C,l.trackConsistency=v,l.clearDeviceState=R,l.startListeningDeviceRegistrations=k}),98);
__d("EBDBMetricsConsistencyOperationEnum",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({Upload:0});i.EBConsistencyOperation=e}),66);
__d("LSQplAnnotateInt.nop",["EBMarkerIdToQPLEvent","I64","Promise","QPLUserFlow","WAHashStringToNumber","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l,u,c,d){try{var t,m=r("nullthrows")(o("EBMarkerIdToQPLEvent").markerIdToQPLEvent(l)),p=o("WAHashStringToNumber").hashStringToNumber(u);return r("QPLUserFlow").addAnnotations(m,{int:(t={},t[c]=(s||(s=o("I64"))).to_int32(d),t)},{instanceKey:p}),(e||(e=n("Promise"))).resolve()}catch(t){return(e||(e=n("Promise"))).resolve()}};u.__nop_name__="LSQplAnnotateInt",l.default=u}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","WALogger","WAResolvable","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("EBLS").genLSClient();try{yield o("EBDBConsistencyApi").startListeningDeviceRegistrations(t.db,o("EBDB").EBDBEnvironment.Worker)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""])),t)}finally{s.resolve(t.db)}}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("EBDBConsistencyApi").trackOverprompting(o("EBDB").EBDBEnvironment.Worker,e)}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s.promise;yield o("EBDBConsistencyApi").addNewDevice(t,o("EBDB").EBDBEnvironment.Worker,e)}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s.promise;return o("EBDBConsistencyApi").trackConsistency(t,o("EBDB").EBDBEnvironment.Worker,e),o("EBDBConsistencyApi").getDeviceId()}),g.apply(this,arguments)}function h(){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBDB").getEBDB(),t=yield e.store("secure_encrypted_backups_client_state").readAll();return t[0]}),y.apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBDB").getEBDB(),t=yield e.store("secure_encrypted_backups_client_state").readAll();if((t==null?void 0:t.length)===0)return!1;var n=t[0],a=n.authorityLevel,i=n.backupTenancy;if(a==null)return!1;var l=i!=null?i:r("LSEncryptedBackupsBackupTenancy").PRODUCTION;return Number(l)===r("LSEncryptedBackupsBackupTenancy").PRODUCTION&&Number(a)===r("LSAuthorityLevel").AUTHORITATIVE}),b.apply(this,arguments)}l.startListeningEBDeviceRegistrations=u,l.trackOverprompting=d,l.addNewDevice=p,l.trackConsistency=f,l.getSecureEBClientState=h,l.isEBEnabledEBDB=C}),98);
__d("WADbDeviceRegistration",["gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=25,s=6,u=s,c="https://reg-e2ee.facebook.com",d=r("gkx")("13108")?"https://reg-e2ee.messenger.com":c,m="https://v.whatsapp.net",p="https://reg-e2ee.instagram.com",_="/v2/fb_icdc_fetch",f="/v2/fb_register_v2",g="Device has already been registered to WA servers",h="Device registration finished successfully",y="Device registration retries failed "+s+" times. No longer attempting registration.",C="Device registration response was null",b="Current user id is zero",v="CryptoAuthToken is empty",S="CryptoAuthToken is expired",R={failed:"failed",finished:"finished"};l.MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE=e,l.MAX_DEVICE_REGISTRATION_RETRIES=s,l.MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES=u,l.REG_FB_DOMAIN=c,l.REG_MSGR_DOMAIN=d,l.REG_WA_DOMAIN=m,l.REG_IGD_DOMAIN=p,l.ICDC_ENDPOINT=_,l.REGISTRATION_ENDPOINT=f,l.DEVICE_ALREADY_REGISTERED=g,l.DEVICE_SUCCESSFULLY_REGISTERED=h,l.FAILED_REGISTRATION_RETRIES=y,l.NULL_RESPONSE_FROM_SERVER=C,l.DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID=b,l.DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN=v,l.DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN=S,l.RegistrationStatesEnum=R}),98);
__d("getOrchestratorVersion",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e;return(e=r("qex")._("263"))!=null?e:"default"}l.default=e}),98);
__d("MAWMainWebWorkerConfig",["MAWGK","MAWParseXMAFBConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=1,u={S508658PreventOldSessionLookupAndPromote:function(){return!0},armadilloWebProcessFutureproof:function(){return r("MAWGK").armadillo_web_process_futureproof},getSignalFutureMessagesMax:function(){return r("justknobx")._("847")},icdcAlertTriggerFailureCounter:function(){return r("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return r("justknobx")._("1971")},icdcIntervalInMinutes:function(){return r("justknobx")._("1972")},isDocumentReceiveEnabled:function(){return!r("gkx")("23924")},isFrankingDropOnInvalid:function(){return r("gkx")("23973")},isFrankingDropOnMissing:function(){return r("gkx")("23974")},isICDCErrorEnabled:function(){return r("gkx")("23975")},isMetaAiInvocationMessageRenderEnabled:function(){return r("gkx")("12661")},isPollsEnabled:function(){return!1},isProgressiveJpegSendEnabled:function(){return!0},isSharedWorkerContext:function(){return(e||(e=o("WorkerUtils"))).isSharedWorkerContext()},jpegThumbnailTargetByteSizeKB:function(){return r("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return o("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},newClockSkewCalculation:function(){return r("gkx")("18494")},offlineQueueStuckTimeoutMs:function(){return r("justknobx")._("3264")},orchestratorVersion:function(){return r("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return!0},sessionDropIfTooOld:function(){return r("justknobx")._("2240")},skipProcessingGroupInvite:function(){return!0},waDanglingQueue:function(){return!0}},c={productTypeForEBAttachments:"msgr",shouldFallbackToPreviewForFailedProgressiveJpeg:function(){return r("gkx")("2909")},supportedTypesVersion:function(){return r("MAWGK").armadillo_web_process_futureproof?s+1:s},supportedXMATargetTypes:function(){return o("MAWParseXMAFBConfig").FB_FULLY_SUPPORTED_TARGET_TYPES}};l.waConfig=u,l.mawConfig=c}),98);
__d("MAWConfig",["MAWMainWebWorkerConfig"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWMainWebWorkerConfig").mawConfig;function s(){return e}function u(t){e=t}l.getConfig=s,l.setConfig=u}),98);
__d("EncryptedBackupsResignCdnUrl",["MAWBridge","MAWConfig","MAWLoggerUtils","WAJids","WAPromiseDelays","WAResolvable","WAResultOrError","asyncToGeneratorRuntime","cr:10071","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map;function u(e){return s.get(e)}function c(t){var n=t.deliveryObjectId,r=t.logger,a=t.mediaDownloadFlow,i=t.mediaKey,l=t.mediaType,s=t.msgId,u=t.protocolMsgId,c=t.sortOrderMs;return a.addPoint("resign_cdn_url_start"),d({deliveryObjectId:n,mediaDownloadFlow:{addAnnotations:function(t){a==null||a.addAnnotations(babelHelpers.extends({},t))},addPoint:function(t,n){a==null||a.addPoint(t,babelHelpers.extends({},n))}},mediaKey:i,mediaType:l,msgId:s,protocolMsgId:u,sortOrderMs:c}).then(function(e){return e.success?(a==null||a.addPoint("resign_cdn_url_end"),e):(a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:e.error}}),e)}).catch(function(t){return r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["resignCdnUrl runtime-error: ",""])),t),a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),o("WAResultOrError").makeError("resign-cdn-url-runtime-error")})}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.deliveryObjectId,r=e.mediaDownloadFlow,a=e.mediaKey,i=e.mediaType,l=e.msgId,u=e.protocolMsgId,c=e.sortOrderMs;if(n("cr:10071")!==null){var d=yield n("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:u.chat,deliveryObjectId:t,externalId:u.externalId,mediaDownloadFlow:r,mediaKey:a,mediaType:i,sortOrderMs:c});return d.success?o("WAResultOrError").makeResult(d.value):d}else{var m=o("MAWLoggerUtils").getInstanceKey(),p=new(o("WAResolvable")).Resolvable;return s.set(m,p),o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ResignAttachmentCDNUrl",value:{deliveryObjectId:t,mediaType:i,messageId:u.externalId,msgId:l,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,skipLegacyMediaDownloadFlow:!0,sortOrder:c,threadId:o("WAJids").threadIdForChatJid(u.chat),threadJid:u.chat,traceId:m}}]}),o("WAPromiseDelays").withTimeout(p.promise,900*1e3,function(){return o("WAResultOrError").makeError("resign-cdn-url-timeout")}).finally(function(){s.delete(m)})}}),m.apply(this,arguments)}l.getRestoredCdnUrlResolvable=u,l.resignCdnUrl=c}),98);
__d("LFUCache",["Cache","ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e,s=15,u=1,c=6e4,d=(function(t){function n(n,o){var a;return a=t.call(this)||this,a.$LFUCache2=n&&n>0?n:s,a.$LFUCache3=o&&o>0?o:u,((e||(e=r("ExecutionEnvironment"))).canUseDOM||(e||(e=r("ExecutionEnvironment"))).isInWorker)&&a.$LFUCache4(),a}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.$LFUCache4=function(){clearTimeout(this.$LFUCache1),this.$LFUCache1=setTimeout(this.purge.bind(this),this.$LFUCache2*c)},o.destroy=function(){clearTimeout(this.$LFUCache1)},o.get=function(n,r){return this.has(n)&&this.$LFUCache5(n),t.prototype.get.call(this,n,r)},o.set=function(n,r,o,a){var e=this.has(n),i=t.prototype.set.call(this,n,r,o,a);return i&&(e?this.$LFUCache5(n):this.$LFUCache6(n,this.$LFUCache3)),i},o.purge=function(){var e=this,t=Array.from(this.__keys());t.forEach(function(t){e.$LFUCache7(t)<e.$LFUCache3?e.delete(t):e.$LFUCache6(t,0)}),this.$LFUCache4()},o.$LFUCache5=function(t){var e=this.$LFUCache7(t)+1;return this.$LFUCache6(t,e),e},o.$LFUCache7=function(t){var e=this.__getRaw(t);return e&&e.$LFUCache8?e.$LFUCache8:0},o.$LFUCache6=function(t,n){var e=this.__getRaw(t);return e||(e=this.__getNewRawObject()),e.$LFUCache8=n,this.__setRaw(t,e),!0},n})(r("Cache"));l.default=d}),98);
__d("LSContactUserBlockAction",[],(function(t,n,r,o,a,i){var e=Object.freeze({MN_UNBLOCK:0,MN_BLOCK:1,FB_UNBLOCK:2,FB_BLOCK:3});i.default=e}),66);
__d("LSDataTraceTag",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=1,s=2,u=3,c=4,d=5,m=6,p=7,_=20,f=21,g=22,h=23,y=24,C=25,b=26,v=27,S=28,R=29,L=30,E=31,k=32,I=33,T=34,D=35,x=36,$=37,P=38,N=39,M=40,w=41,A=42;i.none=e,i.sticker=l,i.image=s,i.animatedImage=u,i.video=c,i.audio=d,i.file=m,i.xma=p,i.messageTypeNone=_,i.messageTypeText=f,i.messageTypeFutureproof=g,i.messageTypeCiphertext=h,i.messageTypeUnavailable=y,i.messageTypeImage=C,i.messageTypeVideo=b,i.messageTypePtt=v,i.messageTypeAdmin=S,i.messageTypeRevoked=R,i.messageTypeGif=L,i.messageTypeSticker=E,i.messageTypeExpiredEphemeral=k,i.messageTypeEphemeralSettingAdmin=I,i.messageTypeEphemeralSyncResponse=T,i.messageTypeEphemeralScreenshotAction=D,i.messageTypeDeleteForMe=x,i.messageTypeEphemeralSettingChangeFromCurrentDevice=$,i.messageTypeAlertICDC=P,i.messageTypeGroupInvite=N,i.messageTypeXMA=M,i.messageTypeReaction=w,i.messageTypeSenderKeyDistribution=A}),66);
__d("LSGroupParticipantJoinState",[],(function(t,n,r,o,a,i){var e=Object.freeze({MEMBER:0,PENDING:1,INVITED:2});i.default=e}),66);
__d("MAWDbParticipant",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e+"_"+t}i.craftParticipantId=e}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+t}l.craftThreadOrder=e}),98);
__d("MAWFolderTypes",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=1,s=2,u=3,c=10,d=15,m={ARCHIVED:c,INBOX:e,OTHER:s,PENDING:l,RESTRICTED:d,SPAM:u};i.INBOX=e,i.PENDING=l,i.OTHER=s,i.SPAM=u,i.ARCHIVED=c,i.RESTRICTED=d,i.FOLDER_ID=m}),66);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t){var e=function(t){var e,n=(e=t.quote)==null?void 0:e.content;return t.quoteExternalId!=null&&(n==null?void 0:n.media)!=null};return t.messages.where("quoteExternalId").between(o("WAStanzaUtils").toStanzaId("0"),o("WAStanzaUtils").toStanzaId("["),!0,!0).filter(e).toArray().catch(function(){return t.messages.filter(e).toArray()}).then(function(e){var n=new Set(e.map(function(e){var t,n,r=(t=e.quote)==null?void 0:t.content;return r==null||(n=r.media)==null?void 0:n.plaintextHash}).filter(Boolean)),r=e.map(function(e){var t=e.msgId;return t});return t.media.filter(function(e){var t=e.plaintextHash;return n.has(t)}).toArray().then(function(e){var n=new Map(e.map(function(e){var t=e.mediaId,n=e.plaintextHash;return[n,t]}));return t.messages.where("msgId").anyOf(r).modify(function(e){var t,r=(t=e.quote)==null?void 0:t.content;e.quote.content.mediaId=n.get(r.media.plaintextHash),delete e.quote.content.media})})})},c=function(t){return t.groupInfo.toCollection().modify(function(e){typeof e.inviter=="number"&&delete e.inviter})},d=function(){return o("MAWDexieTable").dexieResolve()},m=function(t){return t.threads.filter(function(e){return o("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return!1},user:function(){return e.oldestMsg!=null}})}).toArray().then(function(e){var n=[];return e.forEach(function(e){n.push(e.oldestMsg),n.push(o("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(e.newestMsg))}),t.messages.where("msgId").anyOf(n.filter(Boolean)).toArray().then(function(n){var r=new Map,a=[],i=[];n.forEach(function(e){r.set(e.msgId,e)}),e.forEach(function(e){var n=r.get(e.oldestMsg),l=r.get(e.newestMsg);return(n==null?void 0:n.type)==="Admin"&&(l==null?void 0:l.type)==="Admin"&&(n.msgId===l.msgId?i.push(e.chatId):a.push(e)),o("MAWDexieTable").dexieAll(a.map(function(e){return t.messages.where("thread").equals(e.chatId).toArray()})).then(function(e){return e.forEach(function(e){if(e.length!==0){var t=e[0].thread,n=e.filter(function(e){return e.type!=="Admin"});n.length>0||i.push(t)}}),o("MAWDexieTable").dexieAll([t.threads.bulkDelete(i),t.messages.where("thread").anyOf(i).delete()])})})})})},p=function(t){return t.unrenderedMessages.toCollection().modify(function(e){if(e.type===o("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var t=e.messageDeleteForMeTs;e.messageDeleteForMeTs=t}})},_=function(t){var e=0,n=0,a=r("MAWDexie").currentTransaction;if(a==null)throw r("FBLogger")("maw_db").mustfixThrow("transaction does not exist");return a.on("complete",function(){e>0&&o("MAWODSProxy").odsBumpEntityKey({amount:e,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),n>0&&o("MAWODSProxy").odsBumpEntityKey({amount:n,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})}),t.threads.toArray().then(function(r){var a=r.reduce(function(e,t){return t!=null&&e.set(t.chatId,t),e},new Map);return o("MAWDexieTable").dexieAll([t.messages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1}),t.unrenderedMessages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1})])})},f=function(t){return t.isDualSend.toCollection().modify(function(e){e.version==null&&(e.version=1)})},g=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(e.altIndex=o("MAWDbMsg").craftE2eeAdminMsgAltIndex(e.thread))})},h=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},y=function(t){return t.threads.toCollection().modify(function(e){e.folder==null&&(e.folder=o("MAWFolderTypes").FOLDER_ID.INBOX)})},C=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},b=function(t){return t.personalSenderKeyStatuses.toCollection().modify(function(e){e.rotateSenderKey=!0,e.hasSenderKey=new Set})},v=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&e.sortOrderMs!=null&&e.sortOrderMs>0&&(e.sortOrderMs=0)})},S=function(t){return t.messages.toCollection().modify(function(e){!(e.type===o("WAMsgType").MSG_TYPE.ADMIN&&(e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&e.sortOrderMs!=null&&e.sortOrderMs<1661204086&&(e.sortOrderMs=o("MAWDbMsg").getCanonicalTsFromMsg(e)*1e3)})},R=function(t){return t.threads.filter(function(e){return e.isMigratedLocally===!0&&e.newestMsg!=null}).toArray().then(function(e){var n=e.map(function(e){return e.chatId}),r=new Map;return o("MAWDexieTable").dexieAll(e.map(function(e){return t.messages.where(["thread","sortOrderMs"]).between([e.chatId,0],[e.chatId,Number.MAX_VALUE]).last().then(function(e){e!=null&&r.set(e.thread,e.msgId)})})).then(function(){return t.threads.where("chatId").anyOf(n)})})},L=function(){return o("MAWDexieTable").dexieResolve()},E=function(t){return t.threads.toCollection().modify(function(e){if(e.lastReadMsgTs!=null&&e.lastReadMsgTs<o("WATimeUtils").MAX_INT&&(e.lastReadMsgTs=o("MAWTimeUtils").ensureValidMillisTime(e.lastReadMsgTs)),e.newestMsgTs!=null&&e.newestMsgTs<o("WATimeUtils").MAX_INT){var t=o("MAWTimeUtils").ensureValidMillisTime(e.newestMsgTs);e.newestMsgTs=t,t!=null&&(e.threadOrder=o("MAWDbThread").craftThreadOrder(t,e.jid))}})},k=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(e.altIndex=o("MAWDbMsg").craftCutoverAdminMsgAltIndex(e.thread))})},I=function(){return o("MAWDexieTable").dexieResolve()},T=function(){return o("MAWDexieTable").dexieResolve()},D=function(){return o("MAWDexieTable").dexieResolve()},x=function(t){return t.participants.toCollection().modify(function(e){var t;e==null||((t=e.userJid)==null?void 0:t.indexOf("@msgr@msgr"))===!1||(e.id=e.id.replace("@msgr@msgr","@msgr"),e.userJid=e.userJid.replace("@msgr@msgr","@msgr"))}).then(r("emptyFunction"))},$=function(t){var e=t.threads.filter(function(e){return e.snippetMsg!=null&&e.snippetMsgTs==null});return e.toArray().then(function(n){var r=n.reduce(function(e,t){return t!=null&&t.snippetMsg!=null&&e.set(t.jid,t.snippetMsg),e},new Map),a=Array.from(r.values());return t.messages.where("msgId").anyOf(a).toArray().then(function(t){var n=t.reduce(function(e,t){return t!=null&&t.serverTs!=null&&e.set(t.msgId,t.serverTs),e},new Map);e.modify(function(e){var t=r.get(e.jid);if(t!=null){var a=n.get(t);a!=null&&(e.snippetMsgTs=o("WATimeUtils").castUnixTimeToMillisTime(a))}})})})},P=function(t){return t.threads.toArray().then(function(e){return o("MAWDexieTable").dexieAll(e.map(function(e){return t.participants.where("threadId").equals(e.chatId).modify(function(t){var n;t.threadJid=(n=t.threadJid)!=null?n:e.jid})}))})},N=P,M=function(t){var e=[];return t.groupInvites.toArray().then(function(n){var r=n.map(function(e){return e.invitedParticipantId});return t.participants.bulkGet(r).then(function(r){r.forEach(function(t,r){if(t==null){var o=n[r];e.push(o)}});var o=r.filter(Boolean);return t.groupInvites.bulkPut(n.map(function(t){var n=o.find(function(e){return e.id===t.invitedParticipantId});return n!=null?(t.inviteeJid=n.userJid,t.threadJid=n.threadJid,babelHelpers.extends({},t,{inviteeJid:n.userJid,threadJid:n.threadJid})):(e.push(t),t)}))})}).then(function(){return t.groupInvites.bulkDelete(e.map(function(e){return[e.invitedParticipantId,e.inviterJid]}))})},w=function(n){var t=new Map;return n.receipts.toArray().then(function(a){return o("MAWDexieTable").dexieAll(a.map(function(a){return n.messages.get({msgId:a.msgId}).then(function(i){if(i==null)return n.receipts.delete(a.msgId).then(r("emptyFunction"));var l=o("WAMsg").craftWAMsgIdString({author:i.author,chat:i.threadJid,externalId:i.externalId});if(t.has(l)){var s,u=(s=t.get(l))!=null?s:1;return t.set(l,u),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),u),n.receipts.delete(a.msgId).then(r("emptyFunction"))}else return t.set(l,1),n.receipts.where("msgId").equals(i.msgId).modify(function(e){e.waMsgId=l}).then(r("emptyFunction"))})}))})},A=function(){return o("MAWDexieTable").dexieResolve()},F=function(t){return t.participants.toArray().then(function(e){var n=e.map(function(e){return babelHelpers.extends({},e,{id:o("MAWDbParticipant").craftParticipantId(e.threadJid,e.userJid)})}),r=e.map(function(e){return e.id});return t.participants.bulkDelete(r).then(function(){t.participants.bulkPut(n)})})},O=function(t){return t.reactions.toCollection().modify(function(e){e.ts=e.ts})},B=new Map([[(s=o("MAWDbVersionList")).VERSION.V26,u],[s.VERSION.V27,c],[s.VERSION.V28,d],[s.VERSION.V29,m],[s.VERSION.V30,p],[s.VERSION.V31,_],[s.VERSION.V43,f],[s.VERSION.V44,g],[s.VERSION.V45,h],[s.VERSION.V46,y],[s.VERSION.V47,C],[s.VERSION.V53,b],[s.VERSION.V54,v],[s.VERSION.V55,S],[s.VERSION.V56,R],[s.VERSION.V57,L],[s.VERSION.V58,E],[s.VERSION.V60,k],[s.VERSION.V66,I],[s.VERSION.V68,T],[s.VERSION.V71,D],[s.VERSION.V72,x],[s.VERSION.V82,$],[s.VERSION.V85,P],[s.VERSION.V87,N],[s.VERSION.V90,M],[s.VERSION.V91,w],[s.VERSION.V101,A],[s.VERSION.V104,F],[s.VERSION.V116,O]]);l.dbUpgrades=B}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(t,n,r,o,a,i,l){"use strict";var e=r("sortBy")(Array.from(new Set([].concat(Array.from(o("MAWDbSchema").dbSchema.keys()),Array.from(o("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(e){return{schema:o("MAWDbSchema").dbSchema.get(e),upgrade:o("MAWDbSchema.dexie").dbUpgrades.get(e),version:e}}),function(e){var t=e.version;return t}),s=function(t,n){return Array.from(t.filter(function(e){return e.version<=n&&e.schema!=null}).reduce(function(e,t){var n;return(n=t.schema)==null||n.forEach(function(t){e.set(t.name,t)}),e},new Map).values())},u=function(t,n){return s(t,n).reduce(function(e,t){var n=t.autoIncrement,o=t.dexieOnly_primaryKeyUnique,a=t.name,i=t.primaryKey,l=t.removed,s=a.replace(/^e2ee_/,"");if(l===!0)return e[s]=null,e;if(n&&o===!0)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(t));var u=n?"++":"",c=o===!0?"&":"",d=(i.length>1?"[":"")+i.join("+")+(i.length>1?"]":""),m=Object.values(t.indexes).map(function(e){var t=e.columns,n=e.unique!==!1,r=t.length>1,o=e.multiEntry_DO_NOT_USE===!0,a=n&&!o?"&":"",i=o?"*":"",l=""+a+i;return""+l+(r?"[":"")+t.join("+")+(r?"]":"")}).join(",");return e[s]=[""+u+c+d,m].filter(Boolean).join(","),e},{})},c=function(n){return u(e,n)};l.MAW_DB_VERSION_CHANGES=e,l.getDexieSchemaForVersion=u,l.getCompleteDexieSchemaForVersion=c}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=o("MWFBLogger").MWLogger().tags(["db","getDexieDbVersion"]),y=o("MAWGetDbVersion").getArmadilloDbVersion(),C=o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,y>0?y:1/0));function b(e,t){var n=t.schema,r=t.upgrade,o=t.version;return n!=null&&r!=null?e.version(o).stores(n).upgrade(r):n!=null?e.version(o).stores(n):r!=null?e.version(o).upgrade(r):e.version(o),o}function v(t){return new(g||(g=n("Promise")))(function(n){if(!indexedDB){n();return}var r=indexedDB.open(t);r.onupgradeneeded=function(r){r.target.transaction.abort();var o=r.target.result;h.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),t),o==null||o.close(),n()},r.onsuccess=function(e){var r=e.target.result,a=r==null?void 0:r.version;h.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),t,a!=null?a:"null"),r==null||r.close(),a!=null?(a%10>=1&&o("MAWODSProxy").odsBumpEntityKey({amount:1,entity:o("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+a%10}),n(o("MAWDbVersionList").toVersion(a/10))):n()},r.onerror=function(e){var r;h.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),t,e==null||(r=e.target)==null||(r=r.error)==null?void 0:r.message),n()},r.onblocked=function(e){var n=e.target.result,r=n==null?void 0:n.version;h.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),t,r!=null?r:"null"),n==null||n.close()}})}function S(){var e=o("MAWCurrentUser").getID();return v(o("MAWIndexedDbMetadata").dbName(e))}function R(e,t){if(e.upgrade!=null||t.upgrade!=null)return!0;var n=Object.keys((e==null?void 0:e.schema)||{}),r=Object.keys((t==null?void 0:t.schema)||{}),o=[].concat(n,r),a=new Set(o);return a.size!==o.length}function L(e){return e.reduce(function(e,t,n){if(n===0)return[babelHelpers.extends({},t,{schema:o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(t.version)})];var r=e[e.length-1],a=babelHelpers.extends({},t,{schema:t.schema!=null?o("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([t],t.version):null});return R(r,a)?(e.push(a),e):(e.splice(e.length-1,1,babelHelpers.extends({},r,a,{schema:babelHelpers.extends({},r==null?void 0:r.schema,a==null?void 0:a.schema)})),e)},[])}function E(e,t,n,r){var a=r!=null?r:o("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:o("MAWGetDbVersion").getArmadilloDbVersion();h.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),n,a),a==null&&h.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"]))),n!=null&&n>a&&(h.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),a=n);var i=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return n==null||t>n}).filter(function(e){var t=e.version;return a==null||a>=t}),l=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return a==null||a>=t});if(i.length===0||i.length===l.length){h.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"]))),t.addAnnotations({bool:{isUpgradeNeeded:!1}});var s=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,u=Math.min(a!=null&&a>0?a:s,s);return e.version(u).stores(o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(u)),u}var c=L(i);h.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),c.length,i[0].version,i[i.length-1].version);var g=c.filter(function(e){return!!e.upgrade}).map(function(e){return e.version.toString()}),y=c.filter(function(e){return!!e.schema}).map(function(e){return e.version.toString()});g.length&&t.addAnnotations({string_array:{dataMigrationVersions:g}}),y.length&&t.addAnnotations({string_array:{schemaUpgradeVersions:y}}),t.addAnnotations({bool:{isUpgradeNeeded:!0}});var C=0;return c.forEach(function(t){var n;C=Math.max((n=b(e,t))!=null?n:0,C!=null?C:0)}),C}l.CURRENT_MAW_STORES=C,l.getDexieDbVersion=v,l.getDBVersion=S,l.updateDB=E}),98);
__d("MAWDexieError",[],(function(t,n,r,o,a,i){"use strict";var e="ModifyError",l="BulkError",s="OpenFailedError",u="VersionChangeError",c="SchemaError",d="UpgradeError",m="InvalidTableError",p="MissingAPIError",_="NoSuchDatabaseError",f="InvalidArgumentError",g="SubTransactionError",h="UnsupportedError",y="InternalError",C="DatabaseClosedError",b="PrematureCommitError",v="ForeignAwaitError",S="UnknownError",R="ConstraintError",L="DataError",E="TransactionInactiveError",k="ReadOnlyError",I="VersionError",T="NotFoundError",D="InvalidStateError",x="InvalidAccessError",$="AbortError",P="TimeoutError",N="QuotaExceededError",M="SyntaxError",w="DataCloneError",A={AbortError:$,BulkError:l,ConstraintError:R,DatabaseClosedError:C,DataCloneError:w,DataError:L,ForeignAwaitError:v,InternalError:y,InvalidAccessError:x,InvalidArgumentError:f,InvalidStateError:D,InvalidTableError:m,MissingAPIError:p,ModifyError:e,NoSuchDatabaseError:_,NotFoundError:T,OpenFailedError:s,PrematureCommitError:b,QuotaExceededError:N,ReadOnlyError:k,SchemaError:c,SubTransactionError:g,SyntaxError:M,TimeoutError:P,TransactionInactiveError:E,UnknownError:S,UnsupportedError:h,UpgradeError:d,VersionChangeError:u,VersionError:I};i.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null;function u(t){var n=new Set(Object.keys(o("MAWDexieError").DEXIE_ERROR));n.has(t.reason)&&e!=null&&(e.endFail(t.reason),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"database_setup_failed"),s!=null&&(s(),s=null))}var c=function(r,o){return e=r,s=o,t.addEventListener("unhandledrejection",u),function(){return t.removeEventListener("unhandledrejection",u)}};l.trackDbSetupFailure=c}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"},l={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"},s=n("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});i.WRITE_GROUP_INVITE_ERROR=e,i.GET_GROUP_INVITE_ERROR=l,i.DatabaseState=s}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","Promise","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=["backendInitPromise","middleware","onDbPopulate"],h;function y(t,a){var i=null,l=o("MWFBLogger").MWLogger().tags(["db",t,a]),y=new(r("Deferred")),C=!1,b=!1,v,S=!1,R=null,L=a!=="worker"?null:o("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+t+"_"+a,function(){return{extra:{isMakingDB:String(C),willBeSetup:String(b)},reason:String(R),state:(function(){if(R==null)return o("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(R){case o("MAWLowLevelApiTypes").DatabaseState.Initializing:case o("MAWLowLevelApiTypes").DatabaseState.Upgrading:return o("MAWReliabilityMonitor").HealthReportState.PENDING;case o("MAWLowLevelApiTypes").DatabaseState.Open:return o("MAWReliabilityMonitor").HealthReportState.OK;case o("MAWLowLevelApiTypes").DatabaseState.Closed:case o("MAWLowLevelApiTypes").DatabaseState.Error:return o("MAWReliabilityMonitor").HealthReportState.ERROR}})()}});function E(){y=new(r("Deferred")),v==null||v(),C=!1,b=!1}function k(){return b}function I(){return y.getPromise().then(function(){return S})}function T(e,t,n){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n,h,k){var I=h.backendInitPromise,T=h.middleware,D=h.onDbPopulate,x=babelHelpers.objectWithoutPropertiesLoose(h,g),$=o("MAWCurrentUser").getID(),P=o("MAWIndexedDbMetadata").dbName($),N=r("qpl")._(25310776,"6155");function M(e){R=e,L==null||L.updateState()}if(i!=null){l.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DB exists"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_exsists");return}var w=o("MAWQplProxy").startQplUserFlow(r("qpl")._(1056836116,"905"),{string:{db:t,name:P}});if(b=!0,C)return o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_in_progress"),y.getPromise();l.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]))),C=!0,o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_started"),v=o("MAWIDbSetupQplEventListener").trackDbSetupFailure(w,function(){M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("DB setup failed"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_setup_failed"),E()}),M(o("MAWLowLevelApiTypes").DatabaseState.Initializing);var A=yield o("MAWDbVersion").getDexieDbVersion(P);A==null&&(S=!0),w.addAnnotations({int:{currentVersion:A}});var F=k!=null?k:o("MAWGetDbVersion").getArmadilloDbVersion();if(w.addAnnotations({int:{targetVersion:F}}),I&&(A||0)<F){w.addPoint("separate_read_waiting_on_worker_upgrade"),l.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{yield I}catch(e){throw l.catching(r("getErrorSafe")(e)).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var O=yield o("MAWDbVersion").getDexieDbVersion(P);if(O!==F)throw l.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",A,F,O);A=O}else a==="worker"&&(o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbVersion",A!=null?A:0),o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"useSentBytesCache",r("gkx")("33008")?1:0));var B=function(n){var e=o("MAWDbVersion").updateDB(n,w,A,k);return!I&&a==="worker"&&o("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbUpgradeNeeded",A!==e),l.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),e,A,k!=null?k:"<latest>"),a==="worker"&&(A!==e?o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgraded"):o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgrade_not_required")),e};return i=new(o("MAWDexieTable")).DexieTable(P,function(e){T.forEach(function(t){e.use(t(n))});var i=B(e);e.on("populate",function(e){if(!e){M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("Missing DB for populate event"),w.endFail("on_populata-missing_txn"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_on_populate_missing_txn");return}l.info("MAWDB populated. HasPopulateEvent: %s",!!D),D==null||D(e)}),e.on("blocked",function(){l.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("DB Open blocked"),w.endFail("db_blocked"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_blocked"),E()}),e.on("ready",function(e){if(l.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"]))),C=!1,e==null){M(o("MAWLowLevelApiTypes").DatabaseState.Error),l.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]))),y.reject("DB is null"),w.endFail("db_null"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_null"),E();return}M(o("MAWLowLevelApiTypes").DatabaseState.Open),v==null||v(),y.resolve(),w.endSuccess({int:{dbVersion:i}}),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_ready")}),e.on("close",function(){M(o("MAWLowLevelApiTypes").DatabaseState.Closed),l.WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_forcibly_closed")}),e.on("versionchange",function(e){l.WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),e==null?void 0:e.oldVersion,e==null?void 0:e.newVersion,String(e==null?void 0:e.version),i,e==null?void 0:e.name),M(o("MAWLowLevelApiTypes").DatabaseState.Upgrading),a!=="worker"&&r("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_versionchange")})},void 0,x),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_requested"),y.getPromise()}),D.apply(this,arguments)}function x(e){if(i==null)throw l.mustfixThrow('IndexDB has not been initialized before executing "'+(e!=null?e:"unnamed")+'"');return i}function $(e){return i!=null&&!C?(h||(h=n("Promise"))).resolve(i):(y=y||new(r("Deferred")),y.getPromise().then(function(){return x(e)}))}function P(){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield $();e!=null&&(e.close(),i=null),E()}),N.apply(this,arguments)}function M(){i=null,E()}function w(e){r("promiseDone")(P());var t=o("MAWIndexedDbMetadata").dbName(e!=null?e:o("MAWCurrentUser").getID());r("promiseDone")(o("MAWIndexedDBDeletion").deleteDB(t,"maw")),L==null||L.stopMonitoring()}return{closeDB:P,deleteDb:w,getDB:$,getDBExn:x,isNewDb:I,makeDB:T,reset_singleton_INTERNAL_ONLY:M,setupPromise:function(){return y.getPromise()},willSetupDB:k}}l.makeIDBFactory=y}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){var e=o("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:e.closeDB,deleteDb:e.deleteDb,getDB:e.getDB,makeDB:function(a,i,l){var t=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];r("gkx")("1760")&&t.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),n("cr:3527")!=null&&t.push(n("cr:3527"));var s=e.makeDB(a,{autoOpen:r("gkx")("6817"),backendInitPromise:i.backendInitPromise,cache:"disabled",middleware:t,onDbPopulate:i.onDbPopulate},l);return s},reset_singleton_INTERNAL_ONLY:e.reset_singleton_INTERNAL_ONLY}}var d=c(),m=d.makeDB,p=d.closeDB,_=d.getDB,f=d.deleteDb,g=d.reset_singleton_INTERNAL_ONLY,h=(s||(s=r("ExecutionEnvironment"))).isInBrowser?_("MawDbInUISingleton_INTERNAL_ONLY").then(function(e){return{openReadonlyTransaction:function(n,a,i){return e.stores.transaction("r",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})},openReadWriteTransaction:function(n,a,i){return e.stores.transaction("rw",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})}}}):new(e||(e=n("Promise")))(function(){});l.makeMsgrTransactor=o("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD,l.afterTransaction=o("MAWIndexedDb").afterTransaction,l.makeMAWIndexedDBFactory=c,l.makeDB=m,l.closeDB=p,l.getDB=_,l.deleteDb=f,l.reset_singleton_INTERNAL_ONLY=g,l.MawDbInUISingleton=h}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(t,n,r,o,a,i,l){"use strict";var e={snippets:o("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function s(){return e}l.getWorkerRegistry=s}),98);
__d("MAWCacheServiceDB",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","Promise","WAHex","Worm","WormDump","WormEAR","WormIDbDriver","asyncToGeneratorRuntime","getErrorSafe","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s={autoIncrement:!0,indexes:{key:{fields:["key"],unique:!0}},primaryKey:"id",secure:!0},u={snippets:s},c=null,d=function(t,n,a){var e="maw_cache_service",i=new(o("WormEAR")).WormEAR(a,e,n),l=new(o("WormIDbDriver")).WormIDbDriver(t,e,a,i,o("MAWWormOdsLogger").wormOdsWorkerLogger,{onTransactionError:p});return new(o("Worm")).WormDatabase(l,r("qpl")._(1056840657,"2716"))};function m(){return c!==null||(c=new(e||(e=n("Promise")))((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){try{var n=d(o("MAWIndexedDbMetadata").MAWcacheServiceDbName(o("MAWCurrentUser").getID()),o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),u);yield n.init(),e(n)}catch(e){var a=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(a).mustfix("Failed to create cache service DB"),c=null,t(a)}});return function(t,n){return e.apply(this,arguments)}})())),c}function p(e){if(e instanceof o("WormEAR").DecryptionError){var t=e;r("FBLogger")("MAWCacheService").mustfix("EAR decryption error in store: %s. Attempting to delete the store:",t.store),r("promiseDone")(m().then(function(e){return e.runInTransaction([t.store],"readwrite",function(e){return e.stores[t.store].clear()},"delete-corrupted-entity")}).then(function(){r("FBLogger")("MAWCacheService").info("Successfully deleted corrupted store %s",t.store)}).catch(function(e){var n=r("getErrorSafe")(e);r("FBLogger")("MAWCacheService").catching(n).mustfix("Failed to delete corrupted store %s, err: %s",t.store,n.message)}))}}function _(e){return e.map(function(e){var t=e[0],n=e[1];return n})}function f(){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield m();return e.dump({snippets:{customFields:{id:o("WormDump").wormNonSensitiveField,key:o("WormDump").wormNonSensitiveField,timestamp:o("WormDump").wormNonSensitiveField,value:function(t){var e;return{snippet:(e=o("WormDump")).wormRedact(t.snippet),snippetMsgAckLevel:e.wormNonSensitiveField(t.snippetMsgAckLevel),snippetMsgId:e.wormNonSensitiveField(t.snippetMsgId),snippetNewestIncomingMsgs:e.wormNonSensitiveField(t.snippetNewestIncomingMsgs),snippetReactionId:e.wormRedact(t.snippetReactionId)}}}}})}),g.apply(this,arguments)}l.getOrSetupMAWCacheDB=m,l.convertCacheValueToDBRawValue=_,l.getDbDump=f}),98);
__d("MAWCacheServiceQPL",["ExecutionEnvironment","MAWCurrentUser","MAWQplProxy","QPLUserFlow","performanceAbsoluteNow","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new Set,c=new Set,d=3e3,m=r("qpl")._(1056836703,"2955");function p(t,n){var a=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(a){if(c.has(t))return;f(t),o("MAWQplProxy").startQplUserFlow(m,{},{callBridgeWithTimestamp:!0,providedInstanceKey:t})}else{if(u.has(t))return;_(t),r("QPLUserFlow").start(m,{annotations:{string:{service:n}},instanceKey:t})}}function _(e){u.add(e)}function f(e){c.add(e)}function g(t,n,a){var i=b(a),l=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(l){if(!c.has(t))return;o("MAWQplProxy").sendQplPointThroughBridge(m,"worker@"+i+n,{instanceKey:t},!0)}else{if(!u.has(t))return;var p=(s||(s=r("performanceAbsoluteNow")))();a==="realtime-update"?window.setTimeout(function(){r("QPLUserFlow").addPoint(m,"ui@"+n,{instanceKey:t,timestamp:p})},d):r("QPLUserFlow").addPoint(m,"ui@"+n,{instanceKey:t})}}function h(t,n){var a=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(a){if(!c.has(t))return;o("MAWQplProxy").sendQPLAnnotationsThroughBridge(m,n,t)}else{if(!u.has(t))return;r("QPLUserFlow").addAnnotations(m,n,{instanceKey:t})}}function y(t){var n=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(n){if(!c.has(t))return;c.delete(t),o("MAWQplProxy").sendQPLSuccessThroughBridge(m,{},t,!0)}else{if(!u.has(t))return;var a=(s||(s=r("performanceAbsoluteNow")))();window.setTimeout(function(){u.delete(t),r("QPLUserFlow").endSuccess(m,{instanceKey:t,timestamp:a})},d)}}function C(t,n,a){var i=b(a),l=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(l){if(!c.has(t))return;o("MAWQplProxy").sendQPLFailThroughBridge(m,"worker@"+i+n,{},t,!0)}else{if(!u.has(t))return;var p=(s||(s=r("performanceAbsoluteNow")))();window.setTimeout(function(){u.delete(t),r("QPLUserFlow").endFailure(m,"ui@"+n,{instanceKey:t,timestamp:p})},d),u.delete(t)}}function b(e){return e?e.replace(/-/g,"_")+"_":""}function v(e){return o("MAWCurrentUser").isEmployee()||o("MAWCurrentUser").isTestUser()?e:void 0}var S={addAnnotationsQPL:h,addPointQPL:g,endFailureQPL:C,endSuccessQPL:y,redactKeysForNonEmployee:v,registerInstanceKeyInUI:_,registerInstanceKeyInWorker:f,startQPL:p};l.default=S}),98);
__d("MAWCacheServiceUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e="maw_cache_service_broadcast",s=typeof window!="undefined"?window:self,u=function(){return s.BroadcastChannel?new s.BroadcastChannel(e):(r("FBLogger")("messenger_e2ee_web").warn("BroadcastChannel is not supported in this browser"),null)},c={concurrency:1,maxTaskLimit:1,maxThrottleMs:500};function d(e){return"maw-cache-service-"+e}function m(e,t){var n=new Set,r=[];return e.forEach(function(e){var o=t(e);if(n.has(o)){r.push(e);return}n.add(o)}),r}l.MAW_CACHE_SERVICE_BROADCAST_CHANNEL=e,l.globalScope=s,l.getMAWCacheServiceBroadcastChannel=u,l.SCHEDULER_CONFIG=c,l.getSchedulerName=d,l.findDuplicates=m}),98);
__d("MAWDbMsgOrReaction",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function l(e,t){return e==null?t.forNull():e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function s(e,t){return e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function u(e,t){return e==null?t.forNull():e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}i.switchOnMsgOrReaction=e,i.switchOnMsgOrReactionNullish=l,i.switchOnMsgOrReactionMaybeUnstored=s,i.switchOnMsgOrReactionMaybeUnstoredNullish=u}),66);
__d("MAWWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWDbMsgOrReaction","MAWLoggerUtils","MAWSnippetsCacheCalculateDelta","MAWWorkerCacheServiceRegistry","Promise","WorkerScheduler","asyncToGeneratorRuntime","cr:2354","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=o("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var e=o("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=e,this.schedulerRegistry=Object.keys(e).reduce(function(e,t){var n;return babelHelpers.extends({},e,(n={},n[t]=o("WorkerScheduler").makeScheduler(o("MAWCacheServiceUtils").getSchedulerName(t),o("MAWCacheServiceUtils").SCHEDULER_CONFIG),n))},{})}var a=t.prototype;return a.$2=function(t,n,r,a){var e={cache:n,instanceKey:a,namespace:t,source:r};this.$1==null?o("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:e},namespace:o("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(e)},a.$3=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i){var l=o("MAWCacheServiceUtils").findDuplicates(t,function(e){var t=e[0],n=e[1];return t});if(l.length>0&&(r("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",l.map(function(e){var t=e[0],n=e[1];return t}).join(", "),t.map(function(e){var t=e[0],n=e[1];return t}).join(", "),e,n),a!=null&&r("MAWCacheServiceQPL").addAnnotationsQPL(a,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:r("MAWCacheServiceQPL").redactKeysForNonEmployee(l.map(function(e){var t=e[0],n=e[1];return t}))}})),t.length===0){a!=null&&(r("MAWCacheServiceQPL").addPointQPL(a,"nothing_to_update_in_cache",n),r("MAWCacheServiceQPL").endSuccessQPL(a));return}a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_start",n);var s=this.registry[e];s.updateInMemoryCacheBulk(t);try{var u=o("MAWCacheServiceDB").convertCacheValueToDBRawValue(t),c=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB();yield c.runInTransaction([e],"readwrite",function(t){var n=u.map(function(e){return{item:e,selector:[e.key]}});return t.stores[e].bulkUpsert("key",n)},"update_cache_"+e),i==null||i(u.map(function(e){var t=e.key;return t})),a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_end",n)}catch(e){var d=r("getErrorSafe")(e);a!=null&&(r("MAWCacheServiceQPL").addAnnotationsQPL(a,{string:{error:d.message}}),r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_failed",n)),r("FBLogger")("MAWCacheService").catching(d).mustfix("Failed to update persisted cache")}a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"broadcasting_to_ui_start",n),this.$2(e,t,n,a)});function t(t,n,r,o,a){return e.apply(this,arguments)}return t})(),a.calculateDelta=function(a){var t=this,i=Object.values(this.registry).map(function(e){var i=e.shouldDropDelta(a);return i.then(function(i){if(!i){var l=t.schedulerRegistry[e.namespace];return l.runTask({fn:function(){return e.calculateDelta(a).then(function(i){var s=i.map(function(e){var t=e[0],n=e[1];return t}),c=o("MAWLoggerUtils").getInstanceKey();i.length!==0&&(r("MAWCacheServiceQPL").startQPL(c,e.namespace),r("MAWCacheServiceQPL").addAnnotationsQPL(c,{bool:{isRealtimeUpdate:!0},int:{instanceKey:c},string_array:{realtimeUpdatedKeys:s}}));var d=u(a);return t.$3(e.namespace,i,"realtime-update",c,function(e){n("cr:2354")==null||n("cr:2354").notifyCacheWrite(e,l,d)})}).catch(function(t){r("FBLogger")("MAWCacheService").catching(t).warn("Failed to calculate delta for: %s",e.namespace)})},name:"maw_calculate_delta",priority:o("WorkerScheduler").REGULAR_PRIORITY})}})});(e||(e=n("Promise"))).all([].concat(i)).catch(function(e){r("FBLogger")("MAWCacheService").catching(e).mustfix("Failed to calculate delta for all services")})},a.computeCachePayloadFromScratch=function(t,n,a,i){var e=this;i!=null&&r("MAWCacheServiceQPL").registerInstanceKeyInWorker(i),r("MAWCacheServiceQPL").addPointQPL(i,"compute_from_scratch_start",a),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string_array:{keysReceivedInWorker:r("MAWCacheServiceQPL").redactKeysForNonEmployee(n)}});var l=this.registry[t],s=this.schedulerRegistry[l.namespace];if(l==null)throw r("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+t);return s.runTask({fn:function(s){var o=s.metric;return l.computeCachePayloadFromScratch(n,o).then(function(n){return r("MAWCacheServiceQPL").addPointQPL(i,"compute_from_scratch_end",a),e.$3(t,n,a,i)}).catch(function(e){r("MAWCacheServiceQPL").endFailureQPL(i,"compute_from_scratch_failed",a),r("FBLogger")("MAWCacheService").catching(e).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:o("WorkerScheduler").REGULAR_PRIORITY})},t})();function u(e){var t=e.filter(function(e){var t=e[0];return["messages","reactions"].includes(t)}),n=o("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(t.map(function(e){var t=e[0],n=e[1];return n})),r=n.values().every(function(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e.value,{forMessage:function(t){return t.source==="eb_restore"},forReaction:function(){return!0}})});return r?"eb_restore":"whatsapp"}var c=null,d=function(){return c==null&&(c=new s),c};l.getMAWWorkerCacheServices=d}),98);
__d("MAWGetBumpTimestampMs",["I64","MAWAckLevel","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){var r=n==null?null:o("MAWExtractMsFromExternalId").extractMsFromExternalId(n);return(e||(e=o("I64"))).add(o("MAWTimeUtils").millisTimeToTimestamp(t),e.of_int32(r!=null?r:0))}function u(t){var n=t.msg,a=t.throwIfNoServerTs,i=a?r("nullthrows")(n.serverTs):n.serverTs;return s(o("WATimeUtils").castUnixTimeToMillisTime(i!=null?i:n.ts),(e||(e=o("I64"))).of_string(n.externalId))}function c(t){return t.senderTimestampMs!=null?(e||(e=o("I64"))).of_string(o("WALongInt").longIntToDecimalString(t.senderTimestampMs)):s(o("WATimeUtils").castUnixTimeToMillisTime(t.ts),(e||(e=o("I64"))).of_string(t.externalId))}function d(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(t,{forMessage:function(n){return o("MAWAckLevel").isMsgAuthoritative(n.ack)&&n.sortOrderMs!=null?(e||(e=o("I64"))).of_float(n.sortOrderMs):u({msg:n,throwIfNoServerTs:!1})},forNull:function(){return(e||(e=o("I64"))).zero},forReaction:c})}l.calculateBumpTimestampMs=s,l.getBumpTimestampMs=d}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWGetBumpTimestampMs"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(t,{forMessage:function(n){return{msgAckLevel:n.ack,msgId:n.msgId,reactionId:void 0,timestamp:n.sortOrderMs!=null?n.sortOrderMs:(e||(e=o("I64"))).to_float(o("MAWGetBumpTimestampMs").getBumpTimestampMs(n))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(n){return{msgAckLevel:void 0,msgId:void 0,reactionId:n.reactionId,timestamp:(e||(e=o("I64"))).to_float(o("MAWGetBumpTimestampMs").getBumpTimestampMs(n))}}})}l.getMsgOrReactionIdAndTimestamp=s}),98);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(e,{forMessage:function(t){return t.altIndex===o("MAWDbMsg").SPAM_ALT_INDEX||t.altIndex===o("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function s(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(e,{forMessage:function(t){return t.ack===o("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function u(e){var t;return e.msgId!=null&&e.type===o("MAWMsgType").MSG_TYPE.XMA&&((t=e.msgContent)==null?void 0:t.content)===""}function c(e){return e.type===o("MAWMsgType").MSG_TYPE.XMA&&o("MAWXMAUtils").isRtcXMA(e==null?void 0:e.xmaMessageType)}l.isSpamMessage=e,l.isOptimisticMessage=s,l.isXMAThreadSnippet=u,l.isRTCXMAMessage=c}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(t,n,r,o,a,i,l){"use strict";var e="[SnippetsCacheService][Worker]";function s(e){var t=new Set(e.map(function(e){var t,n,r=(t=e.decryptedValues)!=null?t:[],o=(n=e.deletedValues)!=null?n:[];return[].concat(r,o)}).flat().map(function(e){return o("MAWUpdateThreadListItemUtils").isOptimisticMessage(e)?null:e.msgId}).filter(Boolean));return e.reduce(function(e,n){var r=n.type==="delete"?n.deletedValues:n.decryptedValues,o=p(r);return o=_(t,o),o.length===0||o.forEach(function(t){var r=t.threadJid,o=e.get(r),a=m({type:n.type,value:t},o);e.set(r,a)}),e},new Map)}function u(e){return e.some(function(e){var t=e.chatJid,n=e.lastComputedCacheValue,r=e.mutateReq;return!c(r)||d(r.value)})}function c(e){return!(e.type==="delete"||e.type==="deleteRange"||o("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(e.value)||h(e.value)||y(e.value))}function d(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return!1},forReaction:function(t){return t.reaction!=null&&o("MAWGetThreadUpdateType").canReactionAffectBump(t)}})}function m(e,t){if(t==null)return e;var n=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(e.value),r=n.timestamp,a=e.value.externalId,i=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t.value),l=i.timestamp,s=t.value.externalId;return r===l?e.type==="delete"||e.type==="deleteRange"?e:t.type==="delete"||t.type==="deleteRange"?t:a.localeCompare(s)>0?e:t:r==null?t:l==null||r>l?e:t}function p(e){return e==null||e.length===0?[]:e.filter(function(e){return f(e)})}function _(e,t){return t.reduce(function(t,n){var r=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(n),a=r.msgId;return a!=null&&o("MAWUpdateThreadListItemUtils").isOptimisticMessage(n)&&e.has(a)?t:[].concat(t,[n])},[])}function f(e){var t=g(e)&&!o("MAWUpdateThreadListItemUtils").isSpamMessage(e);return t||C(e),t}function g(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(n){return o("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(e)},forReaction:function(n){return o("MAWGetThreadUpdateType").canReactionAffectBump(n)&&h(n)||o("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(e)}})}function h(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return!1},forReaction:function(t){return t.reaction==null}})}function y(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return t.ephemeralMsgDisappeared===!0},forReaction:function(t){return!1}})}function C(t){var n=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t),a=n.msgId,i=n.reactionId;r("FBLogger")("MAWCacheService").info(e+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",a,i)}l.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=s,l.isDbTransactionRequiredForSnippetUpdate=u,l.canCalculateSnippetUpdateFromDelta=c,l.isNeededToCheckMessageExistence=d}),98);
__d("MAWUICacheServicesBase",["FBLogger","MAWCacheServiceDB","MAWCacheServiceQPL","MAWMpsGating","Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s;function u(e){return o("MAWMpsGating").isMpsSnippetsCacheServiceEnabled()?e+"_mps_reactive":e}var c=(function(){function t(e){this.$1=new Map,this.QPLMetadata=new Map,this.$2=e}var a=t.prototype;return a.resetInMemoryCache=function(t,n){var e=this.$1.get(t);e!=null&&(n==null||n.length===0||(r("FBLogger")("MAWUICacheServices").info("Reset in memory cache. Namespace: %s",t),n.forEach(function(t){e.delete(t)})))},a.updateInMemoryCacheAndTriggerCallback=function(t,n,o,a,i){this.$3(t,n);var e=this.$2[t];e!=null&&(a!=null&&(r("MAWCacheServiceQPL").addPointQPL(a,"triggering_callback",o),(o==="cache-invalidation"||o==="realtime-update"||o==="from-scratch"&&this.QPLMetadata.get(a)==="all-from-scratch"||o==="in-memory"&&i===!0)&&(r("MAWCacheServiceQPL").endSuccessQPL(a),this.QPLMetadata.delete(a))),e.onCacheChange(n,o))},a.checkInMemoryCacheAndTriggerCallback=function(t,n,o){var e=this,a=[],i=[];n.forEach(function(n){var r=e.$4(t,n);r==null?a.push(n):i.push([n,r])});var l=a.length===0;return l&&o!=null&&r("MAWCacheServiceQPL").addPointQPL(o,"all_in_memory"),i.length>0&&this.updateInMemoryCacheAndTriggerCallback(t,i,"in-memory",o,l),a},a.checkPersistedCacheAndTriggerCallback=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i){var l=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),c=yield l.runInTransaction([t],"readonly",function(e){return(s||(s=n("Promise"))).all(a.map(function(n){return e.stores[t].getByIndex("key",[u(n)])}))},"read_from_persisted_"+t),d=[],m=[];return c.forEach(function(t,n){if(t==null)d.push(a[n]);else{var r=t.id,o=babelHelpers.objectWithoutPropertiesLoose(t,e);m.push([a[n],o])}}),i!=null&&r("MAWCacheServiceQPL").addAnnotationsQPL(i,{int:{numPersistedHit:m.length,numPersistedMiss:d.length}}),d.length===0&&i!=null&&r("MAWCacheServiceQPL").addPointQPL(i,"all_in_persisted"),m.length>0&&this.updateInMemoryCacheAndTriggerCallback(t,m,"persisted",i),d});function a(e,n,r){return t.apply(this,arguments)}return a})(),a.$3=function(t,n){var e,r=(e=this.$1.get(t))!=null?e:new Map;n.forEach(function(e){var t=e[0],n=e[1];r.set(t,n)}),this.$1.set(t,r)},a.$4=function(t,n){var e=this.$1.get(t);if(e==null)return null;var r;return(r=e.get(n))!=null?r:null},t})();l.adjustCacheKey=u,l.MAWUICacheServicesBase=c}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","MAWUICacheServicesBase","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s=(function(){function t(e){this.$1=new Map,this.namespace=e}var r=t.prototype;return r.$2=function(t){var e;return(e=this.$1.get(t))!=null?e:null},r.updateInMemoryCache=function(t,n){this.$1.set(t,n)},r.updateInMemoryCacheBulk=function(t){var e=this;t.forEach(function(t){var n=t[0],r=t[1];e.updateInMemoryCache(n,r)})},r.getValueFromCache=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=this,r=this.$2(t);if(r!=null)return r;var a=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),i=yield a.runInTransaction([this.namespace],"readonly",function(e){return e.stores[n.namespace].getByIndex("key",[o("MAWUICacheServicesBase").adjustCacheKey(t)])},"read_from_persisted_"+this.namespace);if(i==null)return null;var l=i.id,s=babelHelpers.objectWithoutPropertiesLoose(i,e);return this.updateInMemoryCache(t,s),s});function r(e){return t.apply(this,arguments)}return r})(),t})();l.default=s}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","Promise","WAJids","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["messages","reactions"],u="[SnippetsCacheService][Worker]",c=(function(t){function r(){return t.call(this,"snippets")||this}babelHelpers.inheritsLoose(r,t);var a=r.prototype;return a.$MAWSnippetsCacheService$p_1=function(r){var t=this,a=r.filter(function(e){var t=e[0];return s.includes(t)}),i=o("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(e){var t=e[0],n=e[1];return n}));return(e||(e=n("Promise"))).all(Array.from(i.entries()).map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=e[1],o=yield t.getValueFromCache(n);return{chatJid:n,lastComputedCacheValue:o,mutateReq:r}});return function(t){return e.apply(this,arguments)}})()))},a.calculateDelta=function(r){var t=this;return this.$MAWSnippetsCacheService$p_1(r).then(function(r){return r.length===0?(e||(e=n("Promise"))).resolve([]):o("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(r)?o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:calculateDelta",function(e){return(function(n){return t.$MAWSnippetsCacheService$p_2(e,n)})})(r):t.$MAWSnippetsCacheService$p_3(r)})},a.computeCachePayloadFromScratch=function(t,n){var e=this;return o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(t){return function(r){return o("MAWDexieTable").dexieAll(r.map(function(r,a){var i=o("WAJids").unsafeCoerceToChatJid(r);return e.$MAWSnippetsCacheService$p_4(t,i,"from-scratch",a,n)})).then(function(e){return e.filter(Boolean)})}})(t)},a.$MAWSnippetsCacheService$p_5=function(t,n){if(n==null)return"no-value-calculated-from-scratch";if(o("MAWUpdateThreadListItemUtils").isOptimisticMessage(t.value))return null;var e=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t.value),r=e.msgAckLevel,a=e.msgId,i=e.reactionId,l=e.timestamp;return l==null?"missing-timestamp":a!=null&&a===n.value.snippetMsgId||i!=null&&i===n.value.snippetReactionId?null:a!=null&&r!==o("MAWAckLevel").ACK.received&&n.value.snippetMsgAckLevel===o("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":l<n.timestamp?"older-than-last-snippet-value":null},a.shouldDropDelta=function(r){var t=this;return this.$MAWSnippetsCacheService$p_1(r).then(function(r){return r.length===0?(e||(e=n("Promise"))).resolve(!0):(e||(e=n("Promise"))).all(r.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e.chatJid,r=e.lastComputedCacheValue,o=e.mutateReq,a=yield t.$MAWSnippetsCacheService$p_5(o,r);return a!=null?(m({dropReason:a,key:n,msgOrReaction:o.value,operation:o.type}),!0):!1});return function(t){return e.apply(this,arguments)}})())).then(function(e){return!!e.every(function(e){return e===!0})})})},a.$MAWSnippetsCacheService$p_4=function(t,n,r,a,i){var e=this;return o("MAWThreadSnippetUtils").getThreadSnippetFromScratch(t,n,a,i).then(function(t){var a=e.$MAWSnippetsCacheService$p_6(n,t,r);if(a!=null)return o("MAWDexieTable").dexieResolve([n,a])})},a.$MAWSnippetsCacheService$p_3=function(t){var e=this;return t.map(function(t){var n=e.$MAWSnippetsCacheService$p_7(t);if(n!=null)return[t.chatJid,n]}).filter(Boolean)},a.$MAWSnippetsCacheService$p_2=function(t,n){var e=this;return o("MAWDexieTable").dexieAll(n.map(function(n){return o("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(n.mutateReq)?e.$MAWSnippetsCacheService$p_8(t,n.mutateReq.value).then(function(t){if(!t){var r=e.$MAWSnippetsCacheService$p_7(n);if(r!=null)return o("MAWDexieTable").dexieResolve([n.chatJid,r])}}):e.$MAWSnippetsCacheService$p_4(t,n.chatJid,"realtime-from-scratch")})).then(function(e){return e.filter(Boolean)})},a.$MAWSnippetsCacheService$p_7=function(t){var e=o("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(t.chatJid,t.mutateReq.value),n=this.$MAWSnippetsCacheService$p_6(t.chatJid,{snippet:e,snippetMsgOrReaction:t.mutateReq.value},"realtime-calculate-delta");return n},a.$MAWSnippetsCacheService$p_6=function(t,n,r){if(n==null){d({flow:r,key:t,threadSnippetResult:n});return}var e=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(n.snippetMsgOrReaction),a=e.msgAckLevel,i=e.msgId,l=e.reactionId,s=e.timestamp;if(d({flow:r,key:t,msgAckLevel:a,msgId:i,reactionId:l,threadSnippetResult:n,timestamp:s}),s!=null){var u=babelHelpers.extends({},n.snippet.snippetParams,{strings:n.snippet.snippetParams.strings.map(function(e){return o("MAWVault").unvault(e)})});return{key:t,timestamp:s,value:{snippet:babelHelpers.extends({},n.snippet,{snippetParams:u}),snippetMsgAckLevel:a,snippetMsgId:i,snippetReactionId:l}}}},a.$MAWSnippetsCacheService$p_8=function(t,n){if(!o("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(n))return o("MAWDexieTable").dexieResolve(!1);var e=o("MAWDbMsgOrReaction").switchOnMsgOrReaction(n,{forMessage:function(t){return null},forReaction:function(t){return t.reactToMsgId}});return e==null?o("MAWDexieTable").dexieResolve(!0):o("MAWDbMsgTxns").getMsgsByMsgIds(t,[e]).then(function(e){return e.length===0})},r})(r("MAWCacheServiceBase"));function d(e){var t=e.flow,n=e.key,o=e.msgAckLevel,a=e.msgId,i=e.reactionId,l=e.threadSnippetResult,s=e.timestamp;if(l==null){r("FBLogger")("MAWCacheService").warn(u+"["+t+"] Failed to calculate thread snippet, key: %s",n);return}if(s==null){r("FBLogger")("MAWCacheService").warn(u+"["+t+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",n,a,i);return}r("FBLogger")("MAWCacheService").info(u+"["+t+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",n,s,a,i,o)}function m(e){var t=e.dropReason,n=e.key,a=e.msgOrReaction,i=e.operation,l=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a),s=l.msgAckLevel,c=l.msgId,d=l.reactionId,m=l.timestamp;r("FBLogger")("MAWCacheService").info(u+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",t,n,c,d,m,s,i)}var p=new c,_=function(){return p};l.getMAWSnippetsCacheService=_}),98);
__d("MAWDataSyncQueue",["Promise","WALogger","asyncToGeneratorRuntime","getErrorSafe","qex","throttle"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=r("qex")._("853")||1e3,d=r("qex")._("855")||1e3,m=function(){return f=!1,b({isUnloading:!0})},p=[],_=[],f=!1,g=[],h=function(){var e,t=p.splice(0,p.length);(e=_).push.apply(e,t)},y=function(){return _.splice(0,c)},C=function(r){var t=y();if(t.length!==0)return(u||(u=n("Promise"))).all(g.map(function(n,a){return n(t,r).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),a,t)})})).then(function(){return C(r)})},b=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!f){f=!0,h();try{yield C(e)}catch(e){var t,n=r("getErrorSafe")(e);throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(t=n==null?void 0:n.message)!=null?t:n.toString()),e}finally{f=!1,p.length>0&&v()}}});return function(n){return e.apply(this,arguments)}})(),v=r("throttle")(b,d),S=function(t,n){p.push({type:t,value:n}),v()},R=function(t){g.some(function(e){return e===t})||g.push(t)},L=function(){g=[]},E=function(){p=[],_=[]},k=function(){return p};l.forceFlushDataSyncQueue=m,l.addSyncItem=S,l.registerDataSyncCallback=R,l.clearDataSyncCallbacks=L,l.clearDataSyncQueue_FOR_TESTING_ONLY=E,l.getDataSyncQueue_FOR_TESTING_ONLY=k}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function s(t,n){var r=t.table(n);return e.has(n)?babelHelpers.extends({},r,{mutate:function(t){return r.mutate(t).then(function(e){return t.type==="delete"?(t.keys.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n})}),e):(e.results!=null?e.results.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n,values:t.values})}):e.lastResult!=null&&o("MAWDataSyncQueue").addSyncItem(t.type,{key:e.lastResult,tableName:n,values:t.values}),e)})}}):r}function u(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return s(t,n)}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers"),t}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}l.getDataSyncMiddleware=u}),98);
__d("MAWIndexedDb",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWLSDataSyncMiddleware","MAWLoadDbMigrationVersion","MAWMpsGating","MAWTransactor","MWFBLogger","asyncToGeneratorRuntime","cr:10181","cr:10182","cr:3527","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){e===void 0&&(e="idb");var t=o("MAWDbFactory").makeIDBFactory(e,"worker");function a(e){return t.setupPromise().then(function(){return t.getDBExn(e)})}return babelHelpers.extends({},t,{getSignalDB:a,makeDB:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,a,i){var l=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];return o("MAWMpsGating").isMpsMessageRendering()||l.push(o("MAWLSDataSyncMiddleware").getMAWLSDataSyncMiddleware),r("gkx")("1760")&&l.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),l.push(r("MAWCacheServiceMiddleware")),a.enableDataSyncMiddleware&&l.push(o("MAWDataSyncMiddleware").getDataSyncMiddleware),n("cr:3527")!=null&&l.push(n("cr:3527")),r("justknobx")._("4087")&&(yield r("MAWLoadDbMigrationVersion")(e)),t.makeDB(e,{autoOpen:!0,middleware:l,onDbPopulate:a.onDbPopulate},i)});function a(t,n,r){return e.apply(this,arguments)}return a})()})}var c=u(),d="idle",m=c.isNewDb,p=c.willSetupDB,_=function(t,n,r){return c.makeDB(t,n,r).then(function(){d="ready"})},f=c.closeDB,g=c.getDBExn,h=c.getSignalDB,y=c.getDB,C=function(t){return c.reset_singleton_INTERNAL_ONLY()},b=c.deleteDb;function v(){return d}function S(e){var t=d;return d="migrating",e.finally(function(){d=t})}var R=new WeakMap,L=new WeakMap,E=o("MWFBLogger").MWLogger().tags(["db","afterTransaction"]);function k(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof e=="function"){var n=R.get(t)||[];n.push(e),R.set(t,n),n.length===1&&t.on("complete",function(){var e=R.get(t)||[];e.forEach(function(e){e()}),R.delete(t)})}}function I(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var a=L.get(t);if(a!=null)a.push(e);else{var i=[e];L.set(t,i),t.on("complete",function(){L.delete(t),r("gkx")("5675")&&(s||(s=r("ExecutionEnvironment"))).isInMainThread&&n("cr:10182")!==null&&n("cr:10181")!==null?n("cr:10182").handleEvents(n("cr:10181").LSDatabaseSingleton,i):o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:i})})}}var T=new Set(["NewMsg","NewMsgs","MsgUpdated","NewMedia","NewMediaRange","MediaExpired","XMAShareExpired","DeleteMessagesOfThread","UpsertReaction","DeleteReaction","DeleteMessages","NewXMA","EditMsgHistoryAdded","MsgsStartCountdown","MsgClearCountdown","XMAShareTombstoned","NewReceiverFetchInfo","NewXMAs","NewPoll","RavenActionUpdate"]);function D(t,n){if(n!==!0&&o("MAWMpsGating").isMpsMessageRendering()&&T.has(t.tag)){r("FBLogger")("wmi").INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MpsMessageRendering] Ignoring afterTxn event: ",""])),t.tag);return}if(t.tag==="UpdateThreadActivity"&&r("FBLogger")("wmi").mustfix("Thread consistency uses MAW DB mechanism instead of new one"),t.tag==="ThreadUpdated")try{var a=t.value.snippetContactIDs;a!=null&&a.some(function(e){return e==="Facebook User"})&&(E.mustfix('Something is still setting a contact id as "Facebook User"'),t.value=babelHelpers.extends({},t.value,{snippetContactIDs:a.map(function(e){return e==="Facebook User"?"0":e})}))}catch(e){}I(t)}function x(e,t){var n=r("MAWDexie").currentTransaction;if(n==null)throw E.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");n.on("complete",function(){o("MAWBridge").getBridge().fireAndForget("threadEvent",t,e)})}l.TABLES_TO_ENCRYPT=o("MAWDbSchema").TABLES_TO_ENCRYPT,l.makeMsgrTransactor=o("MAWTransactor").makeMsgrTransactor,l.makeMAWIndexedDBFactory=u,l.isNewDb=m,l.willSetupDB=p,l.makeDB=_,l.closeDB=f,l.getDBExn=g,l.getSignalDB=h,l.getDB=y,l.setDB_INTERNAL_USE_ONLY=C,l.deleteDb=b,l.getDbStatus=v,l.updateStatusDuringMigration=S,l.afterTransactionEffect=k,l.afterTransaction=D,l.afterTransactionThreadEvent=x}),98);
__d("MAWDbAppMeta",[],(function(t,n,r,o,a,i){"use strict";var e={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};i.AppMetaKeysEnum=e}),66);
__d("MAWLoadDbMigrationVersion",["ExecutionEnvironment","MAWBridge","MAWCurrentUser","MAWDBMigrationUtils","MAWDbAppMeta","MAWDbObjEncryption","MAWIndexedDbMetadata","MAWUnrecoverableDbErrors","MWFBLogger","Promise","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=o("MWFBLogger").MWLogger().tags(["db","MAWLoadDbMigrationVersion"]);function h(t){var a=o("MAWCurrentUser").getID(),i=o("MAWIndexedDbMetadata").dbName(a);return new(f||(f=n("Promise")))(function(n){if(!indexedDB){n();return}var a=indexedDB.open(i);a.onupgradeneeded=function(t){t.target.transaction.abort();var r=t.target.result;g.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," onupgradeneeded - closing db"])),i),r==null||r.close(),n()},a.onsuccess=function(e){var a=e.target.result;if(a==null){n();return}try{var i=a.transaction("appMeta","readonly");i.onerror=function(e){var t;g.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Transaction error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()};var l=i.objectStore("appMeta"),m=l.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion);m.onerror=function(e){var t;g.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Request error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()},m.onsuccess=function(e){a.close();var i=e.target.result;if(i!=null)try{var l=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},i),"appMeta",t),s=l.value.dbMigrationVersion;s!=null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version=s)}catch(e){var u=r("getErrorSafe")(e);g.catching(u).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Failed to decrypt appMeta row"]))),(_||(_=r("ExecutionEnvironment"))).isInWorker&&o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError})}n()}}catch(e){var p=r("getErrorSafe")(e);g.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Error accessing appMeta: ",""])),p.message),a.close(),n()}},a.onerror=function(e){var t;g.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," error ",""])),i,e==null||(t=e.target)==null||(t=t.error)==null?void 0:t.message),n()},a.onblocked=function(e){var t=e.target.result;g.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," blocked"])),i),t==null||t.close()}})}l.default=h}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("652"),s=Math.max(e,10),u=s*10,c=new Map([["FTS",u]]);function d(e){if(r("gkx")("9340"))return 1;var t=c.get(e);return t!=null?t:s}function m(e,t){t===void 0&&(t={});var n=d(e);return e==="debug"||e==="test"?[]:r("gkx")("23956")&&o("Random").coinflip(n)?[r("qpl")._(1056839327,"560"),babelHelpers.extends({double:{sampleRate:1/n},string:{transactor:e}},t)]:[]}l.getTransactorQPLParam=m}),98);
__d("MAWTransactor",["MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","MWFBLogger","WAExceededStorageQuota","WALogger","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=["MWPTransactor"],d=o("MWFBLogger").MWLogger();function m(t,n,a,i,l,s){return i!=null&&r("MAWDexie").currentTransaction!=null&&i.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:r("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:r("MAWDexie").currentTransaction.storeNames}}),r("MAWDexie").currentTransaction!=null&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),l),t.transact(n,a,s)}function p(e){var t=o("MAWLLAMigrationUtils").getTransactorQPLParam(e),n=t.length===2?t:[null,void 0],r=n[0],a=n[1];return r!=null?o("MAWQplProxy").startQplUserFlow(r,a,{sendThroughBridge:!1}):null}function _(e,t,n,r){return C(e,t,function(e){return o("MAWIndexedDb").getDB(e)},n,r)}function f(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}function g(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}var h=0,y=new Map;function C(e,t,n,a,i){var l=Object.keys(e),_=l.some(function(t){return e[t]===o("MAWTransactionMode").READWRITE})?o("MAWTransactionMode").READWRITE:o("MAWTransactionMode").READONLY;return function(){for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];var C=p(t),S=null,R=function(){return self.clearInterval(S)};if(C!=null&&(C.addAnnotations({string:{mode:_===o("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:l}}),r("gkx")("1006")&&t==="bulkCreateThreadByJid")){var L=1e3,E=Date.now();S=self.setInterval(function(){C.addAnnotations({int:{heartbeatLatestAliveSinceStartMs:Date.now()-E}})},L),self.setTimeout(R,o("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}var k=(u||(u=r("performance"))).now()+u.timeOrigin;return n(t).then(function(e){var n=Array.from(y.values());C==null||C.addPoint("lock_wait_start",{string_array:{maybeLockedOn:n}});var p=(u||(u=r("performance"))).now();return i==null||i.onTxnRequestedCb==null||i.onTxnRequestedCb.apply(i,f),m(e,_,l,C,t,function(){o("MAWDexieTable").setDexiePSDItem("transactionRequested",k),o("MAWDexieTable").setDexiePSDItem("transactorName",t),C==null||C.addPoint("dexie_transaction_start"),h+=1;var m=h;y.set(m,t);var _=C!=null?e.stores[l[0]].get("").then(function(){C==null||C.addPoint("lock_wait_end"),C==null||C.addPoint("transaction_opened"),C==null||C.addPoint("transactor_execution_start")}):o("MAWDexieTable").dexieResolve();return _.then(function(){return a(e.stores).apply(void 0,f)}).then(function(e){if(r("gkx")("6795")&&(i==null?void 0:i.explicitlyCloseTxn)===!0){var a;(a=r("MAWDexie").currentTransaction)==null||(a=a.idbtrans)==null||a.commit==null||a.commit()}y.delete(m),C==null||C.addPoint("transactor_execution_end"),C==null||C.endSuccess(),R();var l=(u||(u=r("performance"))).now()-p;return l>5e3&&(o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),t,l,n.join(", ")),d.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",t,n.join(", "))),e}).catch(function(e){y.delete(m),o("WAExceededStorageQuota").checkQuotaExceededError(e);var n=e.name==="AbortError"?e==null?void 0:e.inner:null,r=b(n);if(C==null||C.markError("transaction_error",null,e),e instanceof Error){var a=e,i=typeof(a==null?void 0:a.stack)=="string"?a.stack:typeof(a==null?void 0:a.stack),l=typeof(a==null?void 0:a.message)=="string"?a.message:typeof(a==null?void 0:a.message);C==null||C.addAnnotations({string:{errMessage:l,errStack:i,innerError:r}})}C==null||C.endFail("transaction_fail"),R();var s=o("MAWErrorObject").getErrorObject(e);throw v(s).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",c.join("|"),t!=null?t:"",r!=null?r:"unknown")})})}).catch(function(e){o("WAExceededStorageQuota").checkQuotaExceededError(e),C==null||C.endFail("transaction_fail"),R();var n=o("MAWErrorObject").getErrorObject(e);throw v(n).mustfixThrow("[%s] Error performing %s transaction",c.join("|"),t!=null?t:"")})}}function b(e){if(typeof e=="string")return e;if(e instanceof Error)return e.name+": "+e.message;if(typeof e=="object")try{return JSON.stringify(e)}catch(e){}return null}function v(e){return e?d.catching(e):d}l.makeMsgrTransactor=_,l.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=f,l.makeMsgrUIWritableTransactor=g}),98);
__d("MAWThreadUpdateType",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=1,s=2,u=3,c=Object.freeze({BUMP_THREAD:s,MARK_THREAD_AS_UNREAD:u,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:e,SNIPPET_ONLY:l});i.THREAD_UPDATE_TYPE=c}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e;return t==null?(r("FBLogger")("messenger_web").mustfix("nullAdminType"),o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE):s(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:u(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:c(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:(d(t)||r("FBLogger")("messenger_web").mustfix("unsupportedAdminMsgType"),o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE)}function s(e){return o("MAWAdminMsgTypesGrouped").otherUserAddRemoveParticipant.includes(e)||o("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(e)||o("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(e)||o("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(e)||o("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(e)||o("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(e)||e===o("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function u(e){return o("MAWAdminMsgTypesGrouped").currentUserAddRemoveParticipant.includes(e)||o("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(e)||o("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(e)||o("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(e)||o("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(e)||o("MAWAdminMsgTypesGrouped").limitSharingUpdate.includes(e)}function c(e){return e===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||o("MAWAdminMsgTypesGrouped").dualThreadCutoverAdminMsgs.includes(e)||o("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(e)||o("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(e)||o("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(e)||o("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(e)}function d(e){return o("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(e)||o("MAWAdminMsgTypesGrouped").deviceChanges.includes(e)||o("MAWAdminMsgTypesGrouped").icdcAlerts.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(e)||e===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||e===o("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||e===o("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||e===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}l.getThreadUpdateTypeForAdminMsg=e}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.reaction==null;return u(e,t)}function s(e){return c(e.reactToAuthor)&&!c(e.author)}function u(e,t){return s(e)&&!t?e.senderTimestampMs==null?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function c(e){return e===o("WAJids").AUTHOR_ME||e===o("MAWUserJidWrapper").getMyUserJid()}function d(e){var t=e.adminType,n=e.author,a=e.msgType,i=e.xmaMessageType,l=function(t){var e=t.me,r=t.other;return o("WAJids").isAuthorMe(n)?e:r};switch(a){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":case"BumpExistingMessage":return l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return o("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(i)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"DeleteForMe":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"EditAction":return l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":{if(a==="Admin")return o("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(t);throw r("FBLogger")("messenger_web").mustfixThrow("Non-admin msg passed in "+(a!=null?a:"UNKNOWN"))}case"SenderKeyDistribution":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWGetThreadUpdateType] Unexpected message type: %s",a!=null?a:"UNKNOWN")}}function m(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(t,{forMessage:function(t){var e;return d({adminType:(e=t.msgContent)==null?void 0:e.adminType,author:t.author,msgType:t.type,xmaMessageType:t.xmaMessageType})},forNull:function(){return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(n){return e(n)}})}function p(e){var t=m(e);switch(t){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][snippet] Unhandled threadUpdateType: "+t)}}function _(e){var t=m(e);switch(t){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][bump] Unhandled threadUpdateType: "+t)}}l.getThreadUpdateTypeForReaction=e,l.canReactionAffectBump=s,l.getReactionThreadUpdateType=u,l.getThreadUpdateTypeForMsg=d,l.getThreadUpdateTypeForMsgOrReaction=m,l.isThreadUpdateTypeEligibleForSnippet=p,l.isThreadUpdateTypeEligibleForBump=_}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","MAWIndexedDb","MAWMpsGating","MAWWorkerCacheServices","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=["messages","reactions"],s=["messages","reactions"];function u(e,t,n){var r,o,a=n.trans,i=(r=(o=a._transactorMeta)==null?void 0:o.mawCacheServiceAccumulatedRequests)!=null?r:[];if(n.type==="delete"&&s.includes(t.name))return p(e,t.name,n).then(function(e){var r=babelHelpers.extends({},n,{deletedValues:e});return i.push([t.name,r]),a._transactorMeta=babelHelpers.extends({},a._transactorMeta,{mawCacheServiceAccumulatedRequests:i}),t.mutate(n)});var l=babelHelpers.extends({},n,{decryptedValues:n.values?n.values:void 0});return i.push([t.name,l]),a._transactorMeta=babelHelpers.extends({},a._transactorMeta,{mawCacheServiceAccumulatedRequests:i}),t.mutate(n)}function c(e){var t,n=e.trans;((t=n._transactorMeta)==null?void 0:t.mawCacheServiceAfterTransactionScheduled)!==!0&&(o("MAWIndexedDb").afterTransactionEffect(function(){var e,t,r=(e=(t=n._transactorMeta)==null?void 0:t.mawCacheServiceAccumulatedRequests)!=null?e:[];r.length!==0&&o("MAWWorkerCacheServices").getMAWWorkerCacheServices().calculateDelta(r)}),n._transactorMeta=babelHelpers.extends({},n._transactorMeta,{mawCacheServiceAfterTransactionScheduled:!0}))}function d(t,n){var r=t.table(n);return!e.includes(n)||o("MAWMpsGating").isMpsSnippetsCacheServiceEnabled()?r:babelHelpers.extends({},r,{mutate:function(n){return c(n),u(t,r,n)}})}function m(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return d(t,n)}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("MAWCacheService").catching(e).mustfix("Error applying MAW Cache Service Middleware"),t}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}function p(e,t,n){var r=n.keys,o=n.trans;return e.table(t).getMany({keys:r,trans:o}).then(function(e){return e.filter(Boolean)})}l.default=m}),98);
__d("isObject",[],(function(t,n,r,o,a,i){function e(e){var t=typeof e;return t==="function"||t==="object"&&!!e}i.default=e}),66);
__d("MAWVaultDb",["FBLogger","MAWQplProxy","MAWVault","getErrorSafe","gkx","isObject","isPlainObject","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=.001,s=new WeakMap;function u(e,t){return t[e]!=null}var c=r("gkx")("23909");function d(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=s.get(t);if(i!=null)return i;var l=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(25301509,"119")):null;try{var d=a[n],m=p(t,d,o("MAWVault").vault);return l==null||l.endSuccess(),s.set(t,m),m}catch(e){l==null||l.endFail("vault_fail");var _=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Failed to vault an entity in the table: %s",_.message,n)}}function m(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(741087294,"2028")):null;try{var l=p(t,a[n],o("MAWVault").unvault);return i==null||i.endSuccess(),l}catch(e){i==null||i.endFail("unvault_fail");var s=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Unvaulting failed for an entity in the table: %s",s.message,n)}}function p(e,t,n){if(e==null)return e;var o=Object.entries(t).filter(function(t){var n=t[0];return e[n]!=null});return o.length===0?e:o.reduce(function(e,t){var o=t[0],a=t[1];return typeof a!="boolean"&&r("isObject")(a)?e[o]=p(e[o],a,n):a===!0&&(e[o]=n(e[o])),e},babelHelpers.extends({},e))}l.vaultDbRow=d,l.unvaultDbRow=m,l.setInPath=p}),98);
__d("MAWVaultDefinitions",[],(function(t,n,r,o,a,i){"use strict";var e={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}},l={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};i.ARMADILLO_IDB_VAULT_DEFINITIONS=e,i.PERSISTED_DB_VAULT_DEFINITIONS=l}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("507")===!0?!0:r("isInstamadillo")()}l.default=e}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(t,n,r,o,a,i,l){"use strict";var e=r("gkx")("23909");function s(t,n,a){if(!e&&!(r("isEncryptionAtRestEnabled")()||r("gkx")("23910")))return t;var i=babelHelpers.extends({},t);return i=o("MAWVaultDb").unvaultDbRow(i,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS),i=o("MAWDbObjEncryption").encryptDbObj(i,n,a),i}function u(t,n){return e?o("MAWVaultDb").unvaultDbRow(babelHelpers.extends({},t),n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}function c(t,n,r){var a=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},t),n,r);return e?o("MAWVaultDb").vaultDbRow(a,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):a}function d(t,n){if(t!=null)return e?o("MAWVaultDb").vaultDbRow(t,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}l.mutateValue=s,l.mutateVaultedValue=u,l.getValue=c,l.getVaultedValue=d}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("3300");function s(t){return babelHelpers.extends({},t,{get:function(n){return t.get(n).then(function(e){return d(e,"get"),e})},getMany:function(n){return t.getMany(n).then(function(e){return e==null?void 0:e.map(function(e){return d(e,"getMany"),e})})},mutate:function(r){return r.type==="add"?r.values.map(function(e){return u(e)}):r.type==="put"&&r.values.map(function(t){t.protocolMsgId==null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)))}),t.mutate(r)},query:function(n){return t.query(n).then(function(e){var t;return e==null||(t=e.result)==null||t.map(function(e){d(e,"query")}),e})}})}function u(e){e.protocolMsgId=o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(e)}function c(e){return(e==null?void 0:e.rowId)==null&&(e==null?void 0:e.externalId)==null}function d(t,n){try{if(c(t)){n!=="get"&&o("Random").coinflip(e)&&r("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",t==null,n);return}(t==null?void 0:t.protocolMsgId)==null&&o("Random").coinflip(e)&&(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)}),o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&r("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",t==null?void 0:t.type,t==null?void 0:t.rowId,t==null?void 0:t.externalId)),t!=null&&t.protocolMsgId!=null&&t.protocolMsgId!==o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(t)&&o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(t==null?void 0:t.type)+".migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)})}catch(e){var a=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function m(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return n!=="messages"?t.table(n):s(t.table(n))}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying Protocol MsgId Middleware"),t}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}l.appendProtocolMsgId=u,l.isCorruptedMsgRow=c,l.MAWDbProtocolMsgIdMiddleware=m}),98);
__d("MAWLSDataSyncMiddleware",["FBLogger","MAWBridge","MAWLSEditMsgHistoryAddedDataSyncHandler","MAWLSMsgsDataSync","MAWLSReactionsDataSyncHandler","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(){var t=new Set;t.add(o("MAWLSReactionsDataSyncHandler").mawLSReactionsDataSyncHandler),t.add(o("MAWLSEditMsgHistoryAddedDataSyncHandler").mawLSEditHistoryDataSyncHandler),t.add(o("MAWLSMsgsDataSync").mawLSMsgsDataSyncHandler),t.forEach(function(t){e.set(t.tableName,t)})}function u(t){return babelHelpers.extends({},t,{mutate:function(r){var n=e.get(t.name);return n!=null?n.performAndSyncMutation(r,t):t.mutate(r)}})}function c(){return s(),{create:function(n){try{return babelHelpers.extends({},n,{table:function(r){return e.has(r)?u(n.table(r)):n.table(r)}})}catch(e){var t=r("getErrorSafe")(e);return r("FBLogger")("maw_db").catching(t).mustfix("Error applying MAW to LS data sync middleware"),n}},name:"MAWLSDataSyncMiddleware",stack:"dbcore"}}function d(e){o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[e]})}l.getMAWLSDataSyncMiddleware=c,l.syncToLS=d}),98);
__d("MAWLSEditMsgHistoryAddedDataSyncHandler",["MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.map(function(e){return babelHelpers.extends({},e)});o("MAWLSDataSyncMiddleware").syncToLS({tag:"EditMsgHistoryAdded",value:t})}var s={performAndSyncMutation:function(n,r){switch(n.type){case"put":case"add":{var t=[].concat(n.values);o("MAWIndexedDb").afterTransactionEffect(function(){return e(t)})}break}return r.mutate(n)},tableName:"editMsgHistory"};l.mawLSEditHistoryDataSyncHandler=s}),98);
__d("MAWBridgeTypesCreators",["FBLogger","MAWAudioUtils","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{threadJid:e}}function s(e){var t,n=e.ts;switch(e.type){case o("MAWMsgType").MSG_TYPE.REVOKED:n=(t=e.originalTs)!=null?t:e.ts;break;default:n=o("MAWDbMsg").getCanonicalTsFromMsg(e)}return{msgId:e.msgId,ts:n}}function u(e,t){var n=t.map(s);return{messages:n,threadJid:e}}function c(e){return{ravenMsgId:e.msgId,threadJid:e.threadJid}}function d(e,t){return e.filter(function(e){return t===e.threadJid}).map(function(e){return e.msgId})}function m(e){var t,n,a,i,l,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R=e.chatJid,L=e.filteredMsgIds,E=e.hasMediaForUI,k=e.hdTypes,I=e.media,T=e.offlineAttachmentId,D=e.ravenSettings,x=e.sortOrderMs,$=e.transportKey;switch(I.mediaType){case"Image":return{duration:null,ephemeralMediaState:D==null?void 0:D.ephemeralMediaState,ephemeralMediaViewMode:D==null?void 0:D.ephemeralMediaViewMode,filesize:I.size,hasMedia:E,hasPreviewMedia:((t=I.validatedImageInfo)==null?void 0:t.jpegThumbnail)!=null,hdTypes:k,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(n=I.validatedImageInfo)==null?void 0:n.jpegThumbnailHeight,previewHeightLarge:(a=I.validatedImageInfo)==null?void 0:a.height,previewWidth:(i=I.validatedImageInfo)==null?void 0:i.jpegThumbnailWidth,previewWidthLarge:(l=I.validatedImageInfo)==null?void 0:l.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Video":return{duration:((s=I.validatedVideoInfo)==null?void 0:s.duration)!=null?((u=I.validatedVideoInfo)==null?void 0:u.duration)*1e3:0,ephemeralMediaState:D==null?void 0:D.ephemeralMediaState,ephemeralMediaViewMode:D==null?void 0:D.ephemeralMediaViewMode,filesize:I.size,gifPlayback:((c=I.validatedVideoInfo)==null?void 0:c.gifPlayback)===!0||I.isVideoGif===!0,hasMedia:E,hasPreviewMedia:((d=I.validatedVideoInfo)==null?void 0:d.jpegThumbnail)!=null,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(m=I.validatedVideoInfo)==null?void 0:m.jpegThumbnailHeight,previewHeightLarge:(p=I.validatedVideoInfo)==null?void 0:p.height,previewWidth:(_=I.validatedVideoInfo)==null?void 0:_.jpegThumbnailWidth,previewWidthLarge:(f=I.validatedVideoInfo)==null?void 0:f.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Ptt":return{duration:(g=I.validatedAudioInfo)!=null&&g.duration?I.validatedAudioInfo.duration*1e3:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts),waveformData:((h=I.validatedAudioInfo)==null?void 0:h.waveform)!=null?o("MAWAudioUtils").serializeWaveform(I.validatedAudioInfo.waveform):void 0};case"Gif":return{accessibilitySummaryText:(y=I.accessibilitySummaryText)!=null?y:void 0,duration:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:I.msgIds,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(C=I.validatedImageInfo)==null?void 0:C.jpegThumbnailHeight,previewHeightLarge:(b=I.validatedImageInfo)==null?void 0:b.height,previewWidth:(v=I.validatedImageInfo)==null?void 0:v.jpegThumbnailWidth,previewWidthLarge:(S=I.validatedImageInfo)==null?void 0:S.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Sticker":{var P,N,M,w=o("MAWImageUtils").boundHeightWidth((P=I.validatedImageInfo)==null?void 0:P.jpegThumbnailHeight,(N=I.validatedImageInfo)==null?void 0:N.jpegThumbnailWidth,o("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE),A=w.height,F=w.width;return{accessibilitySummaryText:(M=I.accessibilitySummaryText)!=null?M:void 0,duration:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:I.msgIds,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:A,previewHeightLarge:A,previewWidth:F,previewWidthLarge:F,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)}}case"DocumentFile":{var O,B={};for(var W of I.mediaEntries){var q=W[0],U=W[1],V=o("WAMediaUtils").mediaEntryDataToRawData(I.plaintextHash,U),H=V.filename;H!=null&&(B[q]=H)}return{defaultFilename:(O=I.validatedDocumentFileInfo)==null?void 0:O.filename,duration:null,filenames:B,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)}}default:throw I.mediaType,r("FBLogger")("messenger_web").mustfixThrow("[createBridgeMedia] Unsupported media type: "+I.mediaType)}}function p(e,t,n){return{chatJid:e,deliveredWatermarkTs:n!=null?n:o("WATimeUtils").castToUnixTime(0),fbid:t,lastReadActionTs:o("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:o("WATimeUtils").castToUnixTime(0)}}function _(e){var t=e.cannotReplyReason,n=e.folder,r=e.snippetParams,o=e.snippetSenderContactId,a=e.snippetType,i=e.threadJid;return{cannotReplyReason:t,folder:n,snippetContactIDs:r==null?void 0:r.contactIDs,snippetMentionJIDs:r==null?void 0:r.mentionJIDs,snippetParams:r==null?void 0:r.strings,snippetSenderContactId:o,snippetType:a,threadJid:i}}function f(e){return{chatJid:e.groupJid,memberAddMode:e.memberAddMode,threadName:e.name}}var g={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function h(e){var t,n=e.bumpTimestampMs,r=e.description,o=e.isMessageAuthorMe,a=e.isUnbump,i=e.skipBumpTimestampValidation,l=e.skipServerThreadBump,s=e.snippetData,u=e.threadJid,c=s==null?g:{snippetContactIDs:s.params.contactIDs,snippetMentionJIDs:(t=s.params.mentionJIDs)!=null?t:[],snippetParams:s.params.strings,snippetSenderContactId:s.senderContactId,snippetType:s.type};return babelHelpers.extends({},c,{bumpTimestampMs:n,description:r,isMessageAuthorMe:o,isUnbump:a,skipBumpTimestampValidation:i!=null?i:!1,skipServerThreadBump:l!=null?l:!1,threadJid:u})}function y(e){var t=e.author,n=e.chatJid,r=e.reaction,a=e.reactToMsgId,i=e.ts;return{actorId:o("WAJids").authorToUserId(t,o("WAJids").extractUserId(o("MAWUserJidWrapper").getMyUserJid())),chatJid:n,messageId:a,reaction:r,ts:i}}function C(e){var t=o("WAJids").extractUserId(o("MAWUserJidWrapper").getMyUserJid()),n=e.author,r=e.chatJid,a=e.reactToMsgId;return{actorId:o("WAJids").authorToUserId(n,t),chatJid:r,messageId:a}}function b(e){return{creationTs:e.creationTs,creator:e.creator,groupJid:e.groupJid,msgExpiration:e.msgExpiration,name:e.name,nameOwner:e.nameOwner,nameTs:e.nameTs,participantVersion:e.participantVersion}}function v(e){var t=e.threadJid,n=e.inviteeJid;return{caption:e.caption,inviteCode:e.inviteCode,inviteeId:n,inviteExpireTs:e.inviteExpirationTs,inviterId:o("WAJids").extractUserId(e.inviterJid),threadJid:t}}function S(e){return{threadJid:e}}function R(e,t,n){return{senderId:o("WAJids").extractUserId(t),state:n,threadJid:e}}l.createBridgeUpdateE2EEMetadataParticipants=e,l.createBridgeDeletedMessage=s,l.createBridgeDeleteMessages=u,l.createBridgeRavenAction=c,l.getMsgIdsFilteredByJid=d,l.createBridgeMedia=m,l.createBridgeReceivedReceipt=p,l.createBridgeUpdatedThread=_,l.createBridgeUpdatedGroupInfo=f,l.createBridgeBumpedThreadV2=h,l.createBridgeUpsertReaction=y,l.createBridgeDeleteReaction=C,l.createBridgeGroupInfo=b,l.createBridgeGroupInvite=v,l.createBridgeDeleteGroupInvite=S,l.createBridgeReceivedChatState=R}),98);
__d("MAWLSMsgsDataSync",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=t.keys,r=t.trans;return e.getMany({keys:n,trans:r}).then(function(e){return e.filter(Boolean)})}function s(e){var t=e.reduce(function(e,t){var n,r=o("MAWBridgeTypesCreators").createBridgeDeletedMessage(t);return e.has(t.threadJid)||e.set(t.threadJid,[]),(n=e.get(t.threadJid))==null||n.push(r),e},new Map);t.entries().forEach(function(e){var t=e[0],n=e[1],r={messages:n,threadJid:t};o("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteMessages",value:r})})}var u={performAndSyncMutation:function(n,r){switch(n.type){case"delete":return e(r,n).then(function(e){return o("MAWIndexedDb").afterTransactionEffect(function(){return s(e)}),r.mutate(n)});default:return r.mutate(n)}},tableName:"messages"};l.mawLSMsgsDataSyncHandler=u}),98);
__d("MAWLSReactionsDataSyncHandler",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.reaction,r=e.reactToMsgId,a=e.threadJid,i=e.ts;r!=null&&o("MAWLSDataSyncMiddleware").syncToLS({tag:"UpsertReaction",value:o("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:t,chatJid:a,reaction:n||"",reactToMsgId:r,ts:i})})}function s(e){var t=e.author,n=e.reactToMsgId,r=e.threadJid;n!=null&&o("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:r,reactToMsgId:n})})}function u(t){t.forEach(function(t){t.reaction==null?s(t):e(t)})}var c={performAndSyncMutation:function(t,n){switch(t.type){case"put":case"add":{var e=[].concat(t.values);o("MAWIndexedDb").afterTransactionEffect(function(){return u(e)})}break}return n.mutate(t)},tableName:"reactions"};l.mawLSReactionsDataSyncHandler=c}),98);
__d("MAWDbReaction",["FBLogger","I64","MAWAckLevel","MAWGetBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=e.author,n=e.reaction,r=e.reactToAuthor,a=o("MAWUserJidWrapper").getMyUserJid();return!(n==null||n===""||r!=="@me"&&r!==a||t==="@me"||t==="@system"||t===a)}function u(e){var t=o("MAWUserJidWrapper").getMyUserJid();if(e.reactToAuthor!=="@me"&&e.reactToAuthor!==t||e.reaction==null)return null;var n=e.author==="@me"||e.author==="@system"?null:e.author;return n==null?null:babelHelpers.extends({},e,{author:n,reaction:e.reaction,reactToAuthor:"@me"})}function c(e){var t=u(e);if(t==null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot cast reaction to incomingDbReaction");return t}function d(e,t,n){var r=o("MAWUserJidWrapper").getMyUserJid();return e.find(function(e){return e.threadJid===t&&o("WAJids").authorToUserId(e.author,r)===o("WAJids").authorToUserId(n,r)})}function m(e){return e}function p(e,t,n,r,a,i,l,s,u,c,d,m,p){m===void 0&&(m=o("MAWAckLevel").ACK.clock);var _={ack:m,author:c,externalId:t,groupingKey:i,reaction:a,reactionId:n,reactToAuthor:l,reactToExternalId:r,reactToMsgId:s,senderTimestampMs:p,threadJid:e,ts:u};return d!=null?babelHelpers.extends({},_,{rowId:d}):_}function _(t){var n=o("MAWGetBumpTimestampMs").getBumpTimestampMs(t);return o("WATimeUtils").castToMillisTime((e||(e=o("I64"))).to_float(n))}l.isIncomingReaction=s,l.maybeCastToIncomingDbReaction=u,l.castToIncomingDbReaction=c,l.findMatchingReaction=d,l.reactionIdToMsgId=m,l.formatReactionForDb=p,l.getReactionTimeMs=_}),98);
__d("last",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=null;if(Array.isArray(e)||typeof e=="string")e.length&&(t={value:e[e.length-1]});else for(var n of e)t=t||{},t.value=n;return t?t.value:null}i.default=e}),66);
__d("MAWThreadNewestMsgOrReactionUtils",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","first","last"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return _(e,t,u)}function u(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+e)}}function c(e,t){return _(e,t,m)}function d(e){var t=e.db,n=e.jid,r=e.limit;return o("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(t,n,null,!0,r,function(e){var t;return p(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:(t=e.msgContent)==null?void 0:t.adminType,author:e.author,msgType:e.type,xmaMessageType:e.xmaMessageType}),e.ephemeralMsgDisappeared===!0)},"before")}function m(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : %s",e)}}function p(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCacheService] Unhandled threadUpdateType to create filter function : %s",e)}}function _(t,n,r){var a=function(a){return a==null?o("MAWDexieTable").dexieResolve(null):g(t,n,r,a)};return f(t,n,r).then(function(t){return a(t).then(function(r){if(t==null&&r==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"])),n),null;if(r==null)return t;if(t==null)return r;var a=o("WATimeUtils").castToMillisTime(o("MAWDbMsg").getSortOrderWithFallback(t)),i=o("MAWDbReaction").getReactionTimeMs(r);return a>=i?t:r})})}function f(e,t,n){return o("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(e,t,null,!0,1,function(e){var t;return n(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:(t=e.msgContent)==null?void 0:t.adminType,author:e.author,msgType:e.type,xmaMessageType:e.xmaMessageType}),e.ephemeralMsgDisappeared===!0)},"before").then(r("first"))}function g(e,t,n,a){var i=o("MAWDbMsg").getSortOrderWithFallback(a),l=function(a,l){return o("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(e,t,o("WATimeUtils").castToMillisTime(i),l,l==null,a,function(e){return n(o("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(e),!1)&&o("MAWDbReaction").getReactionTimeMs(e)>i})},s=[1,10],u=100,c=new Set,d=function(n,a){var t;return l((t=s[n])!=null?t:u,a).then(function(t){var a=t.filter(function(e){return!c.has(C(e))});return a.length===0?(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+n}),null):h(e,a).then(function(e){var a=e.newestReaction,i=e.nullMsgIds;return a!=null?(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+n}),a):(i.forEach(function(e){return c.add(e)}),d(n+1,r("last")(t)))})})};return d(0,null)}function h(e,t){return o("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(e,t.map(y)).then(function(e){var n=new Set(e.map(b)),r=new Set,o=null;return t.forEach(function(e){var t=C(e);n.has(t)?o=v(o,e):r.add(t)}),{newestReaction:o,nullMsgIds:r}})}function y(e){return{author:e.reactToAuthor,chat:e.threadJid,externalId:e.reactToExternalId}}function C(e){return o("WAMsg").craftWAMsgIdString(y(e))}function b(e){return o("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId})}function v(e,t){return e==null?t:t==null||o("MAWDbReaction").getReactionTimeMs(e)>o("MAWDbReaction").getReactionTimeMs(t)?e:t}l.getNewestMsgOrReactionForBump=s,l.filterForBump=u,l.getNewestMsgOrReactionForSnippet=c,l.getNewestIncomingMsgsForSnippet=d,l.filterForSnippet=m,l.filterForSnippetNewestIncomingMessages=p,l.getNewestReactionToNonNullMsg=h}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Set([(e=o("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,e.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,e.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,e.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function u(e,t,n,r,a,i){return{ack:o("MAWAckLevel").ACK.sent,altIndex:a!=null?a:void 0,author:o("WAJids").AUTHOR_SYSTEM,externalId:n,msgContent:e,sortOrderMs:i,threadJid:t,ts:r!=null?r:o("WATimeUtils").unixTime(),type:o("MAWMsgType").MSG_TYPE.ADMIN}}function c(e){if(s.has(e))return!0;switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_OTHER_USER_NAME_UNKNOWN:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_SELF_THREAD:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_WITH_OTHER_USER_NAME:return!0}return!1}function d(e){switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function m(e){switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}l.POLL_ADMIN_MSG_TYPES=s,l.buildUnstoredDbAdminMsg=u,l.isAdminMsgNormalized=c,l.isDeviceChangeAdminMsg=d,l.isParticipantChangeAdminMsg=m}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.adminMsgContent,n=e.adminType,a=e.snippetSenderContactId,i=n;if(i==null||t==null)return r("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null"),{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET};var l=o("MAWLocalizationUtils").isAdminMsgNormalized(i)?o("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(i,t):{contactIds:[],contents:t},s=l.contactIds,u=l.contents;return{snippetParams:{contactIDs:[].concat(s.map(function(e){return e==="Facebook User"?"0":e})),strings:[].concat(u)},snippetSenderContactId:a,snippetType:i}}l.default=e}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAGlobals","WAJids","WALogger","WAMsgType"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e,t,n){return{snippetParams:{contactIDs:n!=null?n:[],strings:[]},snippetSenderContactId:e,snippetType:t}}var m=function(t){return d(t,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function p(t){var n=t.author,r=t.replyAuthor,a=t.replyType,i=t.snippetSenderContactId;if(o("WAJids").isAuthorSystem(n))return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"]))),m(i);var l=a;if(l===o("WAMsgType").UNAVAILABLE)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"]))),m(i);var p=r;return p==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"]))),m(i)):o("WAJids").isAuthorMe(n)||n===o("WAGlobals").getMyUserJid()?o("WAJids").isAuthorMe(p)||p===o("WAGlobals").getMyUserJid()?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[o("WAJids").userIdFromJid(p)]):i==null?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"]))),m(i)):o("WAJids").isAuthorMe(p)||p===o("WAGlobals").getMyUserJid()?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[i]):p===n?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[i]):d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[i,o("WAJids").userIdFromJid(p)])}l.default=p}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}l.default=e}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return{snippetParams:{contactIDs:n!=null?n:[],strings:[]},snippetSenderContactId:e,snippetType:t}}function s(t){var n=t.author,r=t.snippetSenderContactId,a=t.unsupportedType;if(o("WAJids").isAuthorMe(n))switch(a){case"liveLocationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}l.default=s}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.ravenMediaType,i=t.snippetSenderContactId,l=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,s={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?l=a===o("MAWMsg").MAWRavenMsgMediaType.IMAGE?o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:o("WAJids").isAuthorSystem(n)||i==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(l=a===o("MAWMsg").MAWRavenMsgMediaType.IMAGE?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,s.contactIDs.push(i)),{snippetParams:s,snippetSenderContactId:i,snippetType:l}}l.default=s}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,r){var a=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,i={contactIDs:[],mentionJIDs:n!=null?n:[],strings:[]};return o("WAJids").isAuthorMe(t)?a=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:o("WAJids").isAuthorSystem(t)||r==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]))):(a=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,i.contactIDs.push(r)),{snippetParams:i,snippetSenderContactId:r,snippetType:a}}l.getMAWThreadSnippetForStickerMsg=s}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.mentionedJids,r=e.snippetSenderContactId;return o("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(t,n,r)}l.default=e}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.mentionedJids,r=e.snippetSenderContactId;return o("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(t,n,r)}l.default=e}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.content,a=t.isGroup,i=t.mentionedJids,l=t.snippetSenderContactId,s=t.specialTextSize,u=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,c={contactIDs:[],mentionJIDs:i,strings:[]};if(o("WAJids").isAuthorMe(n)?u=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]))):(u=a?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,c.contactIDs.push(l)),r!=null)if(s===1||s===2||s===3){var d=o("MAWVault").unvault(r);c.strings.push(d==="\uD83D\uDC4D"?"(Y)":r)}else c.strings.push(r);return{snippetParams:c,snippetSenderContactId:l,snippetType:u}}l.default=s}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.gifPlayback,a=t.mentionedJids,i=t.snippetSenderContactId,l=r===!0,s=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,u={contactIDs:[],mentionJIDs:a,strings:[]};return o("WAJids").isAuthorMe(n)?s=l?o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:o("WAJids").isAuthorSystem(n)||i==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]))):(s=l?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,u.contactIDs.push(i)),{snippetParams:u,snippetSenderContactId:i,snippetType:s}}l.default=s}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P;function N(t){var n=t.author,r=t.chatJid,a=t.content,i=t.mentionedJids,l=t.snippetSenderContactId,N=t.xmaMessageType,w=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,A={contactIDs:[],mentionJIDs:i,strings:[]};switch(N==null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"]))),N){case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_REACTION_REPLY:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:if(o("WAJids").isAuthorMe(n))if(a!=null){var F=a;w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT,F!=null&&A.strings.push(F)}else w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT;else if(o("WAJids").isAuthorSystem(n)||l==null)o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"])));else{w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,A.contactIDs.push(l);var O=a;O!=null&&A.strings.push(O)}break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(o("WAJids").isAuthorMe(n)){w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;var B;if(r!=null&&(B=o("WAJids").interpretAsUserJid(r)),B!=null){var W=o("WAJids").userIdFromJid(B);A.contactIDs.push(W)}else o("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)?o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:if(o("WAJids").isAuthorMe(n)){w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED;var q=M(r);q!=null?A.contactIDs.push(q):o("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(S||(S=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:if(o("WAJids").isAuthorMe(n)&&l!=null){w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED;var U=M(r);U!=null?A.contactIDs.push(U):o("WALogger").ERROR(R||(R=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(L||(L=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:if(o("WAJids").isAuthorMe(n)){w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL;var V=M(r);V!=null?A.contactIDs.push(V):o("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:if(o("WAJids").isAuthorMe(n)){w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL;var H=M(r);H!=null?A.contactIDs.push(H):o("WALogger").ERROR(I||(I=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(T||(T=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:o("WAJids").isAuthorMe(n)&&l!=null?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:o("WAJids").isAuthorMe(n)&&l!=null?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,A.contactIDs.push(l));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:o("WAJids").isAuthorMe(n)?w=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR($||($=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(w=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,A.contactIDs.push(l));break;default:o("WALogger").ERROR(P||(P=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),N)}return{snippetParams:A,snippetSenderContactId:l,snippetType:w}}function M(e){var t=e!=null?o("WAJids").interpretAsUserJid(e):null;return t!=null?o("WAJids").userIdFromJid(t):null}l.default=N}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return/^\d+$/.test(e)}function s(t){if(!o("WAJids").isAuthorSystem(t)){var n=o("WAJids").isAuthorMe(t)?o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid()):o("WAJids").userIdFromJid(t);if(!e(n)){r("FBLogger")("messenger_web").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return n}}function u(e){var t=e.adminMsgContent,n=e.adminType,a=e.author,i=e.chatJid,l=e.content,u=e.gifPlayback,c=e.mentionedJids,d=e.msgType,m=e.ravenMediaType,p=e.replyAuthor,_=e.replyType,f=e.specialTextSize,g=e.unsupportedType,h=e.xmaMessageType,y=o("WAJids").switchOnMsgrChatJidType(i,{group:function(t){return!0},user:function(t){return!1}}),C=s(a);switch(d){case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:return r("MAWThreadSnippetForCiphertextMsg")(C);case o("MAWMsgType").MSG_TYPE.TEXT:return r("MAWThreadSnippetForTextMsg")({author:a,content:l,isGroup:y,mentionedJids:c,snippetSenderContactId:C,specialTextSize:f});case o("MAWMsgType").MSG_TYPE.IMAGE:return r("MAWThreadSnippetForImageMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.VIDEO:return r("MAWThreadSnippetForVideoMsg")({author:a,gifPlayback:u,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.PTT:return r("MAWThreadSnippetForPttMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return r("MAWThreadSnippetForAdminOrEphemeralMsg")({adminMsgContent:t,adminType:n,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.GIF:return r("MAWThreadSnippetForGifMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.STICKER:return r("MAWThreadSnippetForStickerMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return r("MAWThreadSnippetForDocumentFileMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.REVOKED:return r("MAWThreadSnippetForRevokedMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.XMA:return r("MAWThreadSnippetForXMAMsg")({author:a,chatJid:i,content:l,mentionedJids:c,snippetSenderContactId:C,xmaMessageType:h});case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return r("MAWThreadSnippetForBumpExistingMessageMsg")({author:a,replyAuthor:p,replyType:_,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:return r("MAWThreadSnippetForFallbackMessageMsg")({author:a,snippetSenderContactId:C,unsupportedType:g});case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return r("MAWThreadSnippetForReceiverFetchMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.RAVEN:return r("MAWThreadSnippetForRavenMsg")({author:a,mentionedJids:c,ravenMediaType:m,snippetSenderContactId:C});default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:C,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}l.getSnippetContactId=s,l.buildThreadSnippet=u}),98);
__d("WAProtocolMsgId",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.externalId===t.externalId&&e.author===t.author&&e.chat===t.chat}i.equals=e}),66);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDbMsgOrReaction","MAWDbReaction","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("WAJids").switchOnMsgrChatJidType(n,{group:function(r){return u(e,t,!0)},user:function(r){return u(e,t,!1)}})}function s(t,n){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(n,{forMessage:function(n){var e,r,a,i,l,s,u;return o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(e=n.msgContent)==null?void 0:e.adminMsgContent,adminType:(r=n.msgContent)==null?void 0:r.adminType,author:n.author,chatJid:t,content:(a=n.msgContent)==null?void 0:a.content,mentionedJids:(i=n.msgContent)==null?void 0:i.mentionedJids,msgType:n.type,ravenMediaType:n.ravenMediaType,replyAuthor:(l=n.quote)==null?void 0:l.content.author,replyType:(s=n.quote)==null?void 0:s.content.type,specialTextSize:n.specialTextSize,unsupportedType:(u=n.msgContent)==null?void 0:u.subtype,xmaMessageType:n.xmaMessageType})},forReaction:function(n){var t=o("MAWDbReaction").castToIncomingDbReaction(n);return e(t.author,t.reaction,t.threadJid)}})}function u(e,t,n){var a;o("WAJids").isAuthorMe(e)?(r("FBLogger")("messenger_web").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),a=o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid())):a=o("WAJids").userIdFromJid(e);var i={contactIDs:[],strings:[]},l=n?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;return i.contactIDs.push(a),i.strings.push(t),{snippetParams:i,snippetSenderContactId:a,snippetType:l}}function c(e,t,n,r){var a,i=n.newestReaction,l=n.reactionsToClear;if(i!=null&&o("WATimeUtils").castUnixTimeToMillisTime(i.ts)>((a=t.snippetMsgTs)!=null?a:0))return o("MAWDexieTable").dexieResolve({newestReaction:i,thread:d(t,i,r)});var s=l!=null&&l.length>0;return s&&t.snippetMsg!=null?e.reactions.get({reactionId:t.snippetMsg}).then(function(n){var r=!1;if(n==null)r=!0;else{var a=o("MAWJidUtils").maybeToProtocolMsgId(n.author,n.threadJid,n.reactToExternalId);a!=null&&(r=l.some(function(e){var t=o("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.reactToExternalId);return t!=null&&o("WAProtocolMsgId").equals(t,a)}))}return r?m(e,t).then(function(e){return{newestReaction:null,thread:e}}):o("MAWDexieTable").dexieResolve({newestReaction:null,thread:t})}):o("MAWDexieTable").dexieResolve({newestReaction:null,thread:t})}function d(e,t,n){return babelHelpers.extends({},e,{snippetMsg:t.reactionId,snippetMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(t.ts)})}function m(e,t){return o("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(e,t).then(function(e){if(e==null)return r("FBLogger")("messenger_web").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled"),babelHelpers.extends({},t,{snippetMsg:void 0,snippetMsgTs:void 0});var n=o("WATimeUtils").castUnixTimeToMillisTime(o("MAWDbMsg").getCanonicalTsFromMsg(e));return babelHelpers.extends({},t,{snippetMsg:e.msgId,snippetMsgTs:n})})}function p(e,t){return m(e,t).then(function(t){return e.threads.put(t).then(r("emptyFunction"))})}l.buildReactionThreadSnippet=e,l.buildThreadSnippetForMsgOrIncomingReaction=s,l.getReactionSnippetParams=u,l.getThreadChangesetForReactionChanges=c,l.getThreadChangesetForNewReaction=d,l.refreshThreadSnippet=p}),98);
__d("MAWEphemeralMsgUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return function(t){return!e.has(t.msgId)&&t.ephemeralMsgDisappeared!==!0}}i.filterNonExpiredMsg=e}),66);
__d("MAWThreadSnippetUtils",["MAWDbReaction","MAWEphemeralMsgUtils","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWXMAUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;if(d(e.xmaMessageType))return!0;var n=((t=e.msgContent)==null?void 0:t.adminType)!=null?o("MAWLocalizationUtils").isDeviceChangeAdminMsg(e.msgContent.adminType):!1;if(e.type!==o("MAWMsgType").MSG_TYPE.ADMIN)return!1;var r=e.msgContent.adminType;return r===o("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:n}function s(t,n,r){return t.messages.where("[threadJid+sortOrderMs]").between([n.jid,Number.MIN_SAFE_INTEGER],[n.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(t){return(r==null||o("MAWEphemeralMsgUtils").filterNonExpiredMsg(r)(t))&&!e(t)}).reverse().first()}var u={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function c(e,t,n,r){return r==null||r.addPoint("fetching_from_db_from_scratch_"+(n!=null?n:0)+"_start"),o("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(e,t).then(function(e){return r==null||r.addPoint("fetching_from_db_from_scratch_"+(n!=null?n:0)+"_end"),e==null?{snippet:u}:m(t,e)})}function d(e){return o("MAWXMAUtils").isXMAStoryReply(e)||o("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(e)}function m(e,t){var n,r,a,i,l,s,c;if(t.reactionId!=null){var d=o("MAWDbReaction").maybeCastToIncomingDbReaction(t);return d==null?{snippet:u}:{snippet:o("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(d.author,d.reaction,e),snippetMsgOrReaction:t}}switch(t.type){case o("MAWMsgType").MSG_TYPE.XMA:{var m,p,_,f,g,h,y,C=o("MAWJidUtils").toProtocolMsgId(t);return C==null?{snippet:u}:{snippet:o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(m=t.msgContent)==null?void 0:m.adminMsgContent,adminType:(p=t.msgContent)==null?void 0:p.adminType,author:t.author,chatJid:t.threadJid,content:(_=t.msgContent)==null?void 0:_.content,mentionedJids:(f=t.msgContent)==null?void 0:f.mentionedJids,msgType:t.type,ravenMediaType:t.ravenMediaType,replyAuthor:(g=t.quote)==null?void 0:g.content.author,replyType:(h=t.quote)==null?void 0:h.content.type,specialTextSize:t.specialTextSize,unsupportedType:(y=t.msgContent)==null?void 0:y.subtype,xmaMessageType:t.xmaMessageType}),snippetMsgOrReaction:t}}default:return{snippet:o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(n=t.msgContent)==null?void 0:n.adminMsgContent,adminType:(r=t.msgContent)==null?void 0:r.adminType,author:t.author,chatJid:t.threadJid,content:(a=t.msgContent)==null?void 0:a.content,mentionedJids:(i=t.msgContent)==null?void 0:i.mentionedJids,msgType:t.type,ravenMediaType:t.ravenMediaType,replyAuthor:(l=t.quote)==null?void 0:l.content.author,replyType:(s=t.quote)==null?void 0:s.content.type,specialTextSize:t.specialTextSize,unsupportedType:(c=t.msgContent)==null?void 0:c.subtype,xmaMessageType:t.xmaMessageType}),snippetMsgOrReaction:t}}}l.isDbMsgDisabledForThreadSnippet=e,l.recalculateSnippetFromScratch_EXPENSIVE=s,l.EMPTY_SNIPPET_DATA=u,l.getThreadSnippetFromScratch=c,l.shouldIgnoreXMAMsgForSnippet=d}),98);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e={batchSize:0,cursorValue:0,isRunning:!1},s={version:0},u=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"getMigrationVersion",function(e){return function(){return e.appMeta.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(e){var t,n=(t=e==null?void 0:e.value.dbMigrationVersion)!=null?t:0;return s.version=n,n})}}),c=6;l.mawDbDedupeMsgsMigrationStatus=e,l.mawDbMigrationVersion=s,l.getMigrationVersion=u,l.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n,r,o){var a=o.accessibilitySummaryText,i=o.mimetype,l=o.previewHeight,s=o.previewUrl,u=o.previewUrlExpirationTimestampMs,m=o.previewWidth,p=o.receiverFetchId,_=o.type;return{accessibilitySummaryText:a,mimetype:i,msgId:t,previewHeight:l,previewUrl:s,previewUrlExpirationTimestampMs:d(u),previewWidth:m,receiverFetchId:p,sortOrderMs:c(n,r),threadJid:e,type:_}}function u(e,t,n,r,o){var a=o.mimetype,i=o.previewHeight,l=o.previewWidth,s=o.receiverFetchId,u=o.type;return{mimetype:a,msgId:t,previewHeight:i,previewWidth:l,receiverFetchId:s,sortOrderMs:c(n,r),threadJid:e,type:u}}function c(e,t){return o("WATimeUtils").castToMillisTime(e!=null?e:t*1e3)}function d(t){if(t!=null)try{return o("WATimeUtils").castLongIntToMillisTime(t)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""])),t);return}}l.createBridgeReceiverFetchInfoPayloadFromDbInfo=s,l.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=u}),98);
__d("MAWLoadReplyMediaTxns",["MAWBridgeReceiverFetchInfo","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;function f(e,t,n){if(r("gkx")("2419")&&n!=null){var a=o("MAWMediaUtils").genHMACPlaintextHash(n);return e.media.where("hashedPlaintextHash").equals(a).first()}else return e.media.get(t)}var g=new Set([(_=o("MAWDbMedia")).MEDIA_TYPE.IMAGE,_.MEDIA_TYPE.GIF,_.MEDIA_TYPE.PTT,_.MEDIA_TYPE.STICKER,_.MEDIA_TYPE.VIDEO,_.MEDIA_TYPE.DOCUMENT_FILE]);function h(e){var t;switch(e.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.STICKER:t=e.validatedImageInfo;break;case o("MAWDbMedia").MEDIA_TYPE.VIDEO:t=e.validatedVideoInfo;break}var n=t||{},r=n.height,a=n.jpegThumbnailHeight,i=n.jpegThumbnailWidth,l=n.width;return{replyMediaPreviewHeight:a!=null?a:r,replyMediaPreviewWidth:i!=null?i:l}}function y(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case o("MAWMsgType").MSG_TYPE.XMA:return r("gkx")("9921")?!0:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(e.xmaMessageType)||o("MAWXMAUtils").isXMAStoryReply(e.xmaMessageType);case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("WAMsgType").NOTE_REPLY:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return r("WAAssertUnreachable")(e.type)}}function C(t,n,r){if(n==null)return o("MAWDexieTable").dexieResolve();var a=f(t,n,r).then(function(e){if(e==null)return o("WAResultOrError").makeError("reply_media_not_found");if(!g.has(e.mediaType))return o("WAResultOrError").makeError("reply_media_type_unknown");var t=h(e),r=t.replyMediaPreviewHeight,a=t.replyMediaPreviewWidth;return n!=null&&e.plaintextHash==null&&o("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_'unknown'}"),o("WAResultOrError").makeResult({replyMediaId:n,replyMediaPreviewHeight:r,replyMediaPreviewWidth:a,replyPlaintextHash:e.plaintextHash})});return a.then(function(t){if(t.success!==!0){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""])),n,t.error);return}return t.value})}function b(e,t){var n=t.defaultPreviewMediaId;if(n==null)return o("MAWDexieTable").dexieResolve({replyXMAId:t.xmaId});var r=f(e,n).then(function(e){if(e==null)return o("WAResultOrError").makeError("reply_xma_media_not_found - "+t.targetType);if(!g.has(e.mediaType))return o("WAResultOrError").makeError("reply_xma_media_type_unknown");var n=h(e),r=n.replyMediaPreviewHeight,a=n.replyMediaPreviewWidth;return o("WAResultOrError").makeResult({replyMediaPreviewHeight:r,replyMediaPreviewWidth:a,replyPlaintextHash:e.plaintextHash,replyXMAId:t.xmaId})});return r.then(function(e){if(e.success!==!0){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""])),t.xmaId,e.error);return}return e.value})}function v(e,t,n){var a,i,l;n===void 0&&(n=!1);var s=((a=t.quote)==null?void 0:a.content)||{},u=s.author,c=s.externalId,d=s.mediaId,m=s.msgId,p=s.plaintextHash,_=s.type,f=s.xmaMessageType;if(((i=t.quote)==null?void 0:i.content)==null||!y((l=t.quote)==null?void 0:l.content))return o("MAWDexieTable").dexieResolve();var g=t.threadJid,h=u===o("MAWUserJidWrapper").getMyUserJid(),b=h?o("WAJids").AUTHOR_ME:u;return(r("gkx")("9921")?_===o("MAWMsgType").MSG_TYPE.XMA:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))?S(e,o("MAWJidUtils").maybeToProtocolMsgId(b,g,c)):_===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?E(e,m):C(e,d,n?null:p)}function S(e,t){return t==null?o("MAWDexieTable").dexieResolve():o("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(e,t).then(function(t){if(!(t==null||o("MAWXMAUtils").isXMAExpired(t.isTombstoned,t.targetExpiringAtSec)))return b(e,t)})}function R(e,t){var n=t.author,a=t.externalId,i=t.mediaId,l=t.plaintextHash,s=t.threadJid,u=t.type,c=t.xmaMessageType,d=r("gkx")("9921")?u===o("MAWMsgType").MSG_TYPE.XMA:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(c),m=u===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;return!o("MAWDbMsg").isMediaMsg(t)&&!d&&!m?o("MAWDexieTable").dexieResolve():d?S(e,o("MAWJidUtils").maybeToProtocolMsgId(n,s,a)):m?L(e,t.receiverFetchId):C(e,i,l)}function L(e,t,n){return t==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"]))),o("MAWDexieTable").dexieResolve()):e.receiverFetchInfo.get({receiverFetchId:t}).then(function(e){if(e==null){o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return}try{var t=o("MAWDbMedia").convertNumberToMediaId(parseInt(e.receiverFetchId,10));return n!=null&&o("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:o("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(n.threadJid,n.msgId,n.sortOrderMs,n.ts,e)}),{replyMediaId:t,replyMediaPreviewHeight:e.previewHeight,replyMediaPreviewWidth:e.previewWidth}}catch(e){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""])),e);return}})}function E(e,t){return t==null?(o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"]))),o("MAWDexieTable").dexieResolve()):e.messages.get({msgId:t}).then(function(t){if(t==null||t.type!==o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||t.receiverFetchId==null){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""])),t==null?void 0:t.type);return}return L(e,t.receiverFetchId,t)})}l.getMedia=f,l.MSG_MEDIA_TYPE=g,l.getImageAttributes=h,l.isMediaReplyContent=y,l.getReplyMediaForMsgQuote=v,l.getReplyMediaForMsg=R}),98);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","MWFBLogger","WAErrorMessage","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("MWFBLogger").MWLogger().tags(["maw_db","txn","MAWDbChunkTxns"]),m=function(t,n,r,a,i,l){l===void 0&&(l=0);var e=o("MAWMediaUtils").genHMACPlaintextHash(n);return p(t,n,e,r,a,i,l)},p=function(n,r,a,i,l,m,_){return _===void 0&&(_=0),n.chunk.where("hashedPlaintextHash").equals(a).first().then(function(t){var f={blobData:i,hashedPlaintextHash:a,isProgressivePreview:m!=null?m:void 0,mimetype:l,plaintextHash:r};if(t){_>0&&d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""])),a);var g=m!==!0&&t.isProgressivePreview===!0;if(g){var h=babelHelpers.extends({},f,{chunkId:t.chunkId});return n.chunk.put(h).then(function(){return h})}else return t}return n.chunk.add(f).then(function(e){return babelHelpers.extends({},f,{chunkId:e})}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);if(_>0)throw d.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""])),a,t),d.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""])),t),e;return d.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""])),a,t),o("MAWODSProxy").odsBumpEntityKey({amount:1,entity:o("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"}),p(n,r,a,i,l,m,_+1)})})},_=function(t,n){return t.chunk.where("hashedPlaintextHash").equals(n)},f=function(t,n){return _(t,n).count().then(function(e){return e>0})},g=function(t,n){return o("MAWDexieTable").dexieAll(n.map(function(e){return f(t,e).then(function(t){return[e,t]})})).then(function(e){return new Map(e)})},h=function(t,n){return _(t,n).first()},y=function(t,n){return t.chunk.where("hashedPlaintextHash").anyOf(n).toArray().then(function(e){return new Map(e.map(function(e){return[e.hashedPlaintextHash,e]}))})},C=function(t,n){var e=n.map(o("MAWMediaUtils").genHMACPlaintextHash);return t.chunk.where("hashedPlaintextHash").anyOf(e).toArray().then(function(e){return new Map(e.map(function(e){return[e.plaintextHash,e]}))})};function b(e,t){return e.chunk.bulkGet(t)}var v=function(t,n){var e=o("MAWMediaUtils").genHMACPlaintextHash(n);return t.chunk.get({hashedPlaintextHash:e})};l.getOrCreateMediaChunkWithPlaintextHash=m,l.getOrCreateMediaChunkWithHashedPlaintextHash=p,l.hasMediaChunk=f,l.hasMediaChunks=g,l.maybeGetChunkFromHash=h,l.maybeBulkGetChunksFromHash=y,l.maybeBulkGetChunksFromPlaintextHash=C,l.bulkGetChunks=b,l.maybeGetChunkByPlaintextHash=v}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","MAWODSProxy","WAHashUtils","WALogger","WAOdsEnums","WAResultOrError","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.media.get({mediaId:t})}function m(e,t){return t.length===0?o("MAWDexieTable").dexieResolve(new Map):e.media.bulkGet(t).then(function(e){return new Map(e.filter(Boolean).map(function(e){return[e.mediaId,e]}))})}function p(e,t){return e.media.where("hashedPlaintextHash").equals(t).first()}function _(e,t){var n=o("MAWMediaUtils").genHMACPlaintextHash(t);return p(e,n)}function f(e,t){var n=t.map(function(e){return o("MAWMediaUtils").genHMACPlaintextHash(e)});return g(e,n)}function g(e,t){return e.media.where("hashedPlaintextHash").anyOf(t).toArray()}function h(e,t){return t==null?o("MAWDexieTable").dexieResolve():y(e,t).then(function(n){var r=n==null?void 0:n.mediaId;return r!=null?e.media.get({mediaId:r}):e.media.get({objectId:t})})}function y(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.mediaBackup.get({objectId:t})}function C(e,t){if(t==null)return o("MAWDexieTable").dexieResolve();var n=e.mediaBackup.where("msgId").equals(t).toArray();return n}function b(t,n){var a=n.filter(o("MAWDbMsg").isMediaMsg);if(a.length===0)return o("MAWDexieTable").dexieResolve([]);o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""])),a.map(function(e){return""+e.msgId}));var i=a.reduce(function(e,t){return t.mediaId==null?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""])),t.msgId,t.type),e):e.set(t.mediaId,t)},new Map),l=Array.from(i.keys());return R(t,l).then(function(e){var t=[];return e.forEach(function(e){if(e==null)throw r("err")("Error missing media");var n=i.get(e.mediaId);if(n==null)throw r("err")("Error missing media");var a=o("MAWMediaUtils").genHMACPlaintextHash(e.plaintextHash);a!==e.hashedPlaintextHash&&(o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] encountered mismatched hashedPlaintextHash for media. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(e.plaintextHash)),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MEDIA_MISMATCH_HASHED_PLAINTEXT_HASH,key:"mismatch."+n.type})),t.push([n,e])}),t})}function v(e,t){if(t.length===0)return o("MAWDexieTable").dexieResolve([]);var n=t.filter(o("MAWDbMsg").isMediaMsg).map(function(e){var t=e.mediaId;if(t==null)throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""])),e.msgId),r("err")("mediaId is missing");return t});return R(e,n).then(function(e){var t=[];return e.forEach(function(e){e!=null&&t.push(e)}),t})}function S(e,t){if(t.type===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||o("MAWDbMsg").isMediaMsg(t)){var n=t.mediaId;return n==null?t.type===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeResult()):o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeError("missing")):e.media.get(n).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}else return o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeResult())}function R(e,t){return e.media.bulkGet(t)}function L(e,t){var n=t.previewMediaIds!=null?R(e,t.previewMediaIds):o("MAWDexieTable").dexieResolve(),r=t.headerMediaId!=null?e.media.get(t.headerMediaId):o("MAWDexieTable").dexieResolve(),a=t.faviconMediaId!=null?e.media.get(t.faviconMediaId):o("MAWDexieTable").dexieResolve(),i=t.defaultPreviewMediaId!=null?e.media.get(t.defaultPreviewMediaId):o("MAWDexieTable").dexieResolve();return o("MAWDexieTable").dexieAll([n,r,a,i]).then(function(e){var n=e[0],r=e[1],a=e[2],i=e[3];if(t.headerMediaId!=null&&r==null||t.faviconMediaId!=null&&a==null||n==null)return o("WAResultOrError").makeError("missing");var l=[];for(var s of n){if(s==null)return o("WAResultOrError").makeError("missing");l.push(s)}return o("WAResultOrError").makeResult({defaultPreview:i,favicon:a,header:r,previews:l})})}function E(e,t,n){var r=babelHelpers.extends({},t,n);return e.media.put(r)}l.maybeGetMediaFromMediaId=d,l.maybeBulkGetMediaFromMediaId=m,l.maybeGetMediaFromHashedPlaintextHash=p,l.maybeGetMediaFromPlaintextHash=_,l.maybeBulkGetMediaFromPlaintextHash=f,l.maybeBulkGetMediaFromHashedPlaintextHash=g,l.maybeGetMediaFromObjectId=h,l.maybeGetMediaBackupRowFromObjectId=y,l.maybeGetMediaBackupRowFromMsgId=C,l.getMsgMediaPairFromMsgs=b,l.getMediaFromMsgs=v,l.getAndCheckMediaFromMsg=S,l.bulkGetMedias=R,l.getMediaForXMA=L,l.updateMedia=E}),98);
__d("WAMsgMap",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){var t=this;this.$1=new Map,e==null||e.forEach(function(e){var n=e[0],r=e[1];t.set(n,r)})}var t=e.prototype;return t.clear=function(){this.$1.clear()},t.delete=function(t){var e;(e=this.$1.get(t.externalId))==null||(e=e.get(t.author))==null||e.delete(t.chat)},t.get=function(t){var e;return(e=this.$1.get(t.externalId))==null||(e=e.get(t.author))==null?void 0:e.get(t.chat)},t.has=function(t){var e,n;return(e=(n=this.$1.get(t.externalId))==null||(n=n.get(t.author))==null?void 0:n.has(t.chat))!=null?e:!1},t.set=function(t,n){var e,r,o=(e=this.$1.get(t.externalId))!=null?e:new Map;this.$1.has(t.externalId)||this.$1.set(t.externalId,o);var a=(r=o.get(t.author))!=null?r:new Map;return o.has(t.author)||o.set(t.author,a),a.set(t.chat,n),this},t.keys=function(){var e=[],t=this.$1;for(var n of t.keys()){var r,o=(r=t.get(n))!=null?r:new Map;for(var a of o.keys()){var i,l=(i=o.get(a))!=null?i:new Map;for(var s of l.keys())e.push({externalId:n,author:a,chat:s})}}return e},t.entries=function(){var e=[],t=this.$1;for(var n of t.keys()){var r,o=(r=t.get(n))!=null?r:new Map;for(var a of o.keys()){var i,l=(i=o.get(a))!=null?i:new Map;for(var s of l.keys()){var u=l.get(s);u!=null&&e.push([{externalId:n,author:a,chat:s},u])}}}return e},t.values=function(){return this.entries().map(function(e){return e[1]})},e})();i.MsgMap=e}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return t.reduce(function(t,n){var r=n.threadJid;return r==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"]))),t):n.author==="@system"?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"]))),t):(t.set({author:n.author,chat:r,externalId:n.externalId},n),t)},new(o("WAMsgMap")).MsgMap)}function c(e){return o("WAJids").isAuthorSystem(e.author)||e.threadJid==null?null:{author:e.author,chat:e.threadJid,externalId:e.externalId}}l.convertMsgArrayToMap=u,l.getProtocolMsgIdFromDbMsg=c}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n=t.author,r=t.chat,a=t.externalId;return e.threads.get({jid:r}).then(function(t){return t==null?o("WAResultOrError").makeError("missing_thread_unrendered_msg"):m(e,a,r,n).then(function(e){return e==null?o("WAResultOrError").makeError("missing_unrendered_msg"):o("WAResultOrError").makeResult(e)})})}function d(e,t){var n=t.map(function(e){var t=e.externalId;return t});return e.unrenderedMessages.where("externalId").anyOf(n).toArray().then(function(e){var n=o("MAWDbMsgUtil").convertMsgArrayToMap(e),r=new(o("WAMsgMap")).MsgMap;return t.forEach(function(e){var t=n.get(e);t!=null&&r.set(e,t)}),r})}function m(e,t,n,r){return e.unrenderedMessages.where("externalId").equals(t).filter(function(e){return e.author===r&&e.threadJid===n}).first()}function p(e,t){return e+"_"+t}function _(e,t){var n=t.map(function(e){var t=e.externalId;return t}),r=Array.from(new Set(t.map(function(e){return e.chat})));return o("MAWDexieTable").dexieAll([e.threads.where("jid").anyOf(r).toArray(),e.unrenderedMessages.where("externalId").anyOf(n).toArray()]).then(function(e){var n=e[0],r=e[1];if(r.length===0||n.length===0)return[];var o=new Map;return t.forEach(function(e){var t=e.author,n=e.chat,r=e.externalId,a=o.get(r)||new Set;a.add(p(t,n)),o.set(r,a)}),r.filter(function(e){var t=e.author,n=e.externalId,r=e.threadJid,a=o.get(n);return a!=null&&r!=null&&a.has(p(t,r))})})}function f(t,n,r){return g(t,[{ack:r,msgId:n}]).then(function(t){var n=t[0];return n==null?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"]))),null):n})}function g(e,t){var n=t.map(function(e){return e.msgId}),r=new Map;return t.forEach(function(e){return r.set(e.msgId,{ack:e.ack})}),e.unrenderedMessages.where("msgId").anyOf(n).toArray().then(function(t){if(t.length===0)return t;var n=[],a=[];return t.forEach(function(e){var t;if(e.author!==o("WAJids").AUTHOR_ME){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]))),n.push(e);return}if(e.ack>o("MAWAckLevel").ACK.clock){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]))),n.push(e);return}var i=(t=r.get(e.msgId))==null?void 0:t.ack;if(i==null)return null;var l=babelHelpers.extends({},e,{ack:i});i===o("MAWAckLevel").ACK.sent&&delete l.resendCount,a.push(l)}),e.unrenderedMessages.bulkPut(a).then(function(){return[].concat(a,n)})})}function h(e,t){var n=t.map(function(t){return e.unrenderedMessages.get({msgId:t})});return o("MAWDexieTable").dexieAll(n)}function y(e,t){return e.unrenderedMessages.where("msgId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.msgId);return t+1})}l.maybeGetUnrenderedMsgByProtocolMsgId=c,l.getUnrenderedMsgMapByProtocolMsgId=d,l.maybeGetUnrenderedMsgByExternalId=m,l.getUnrenderedMsgsByProtocolMsgId=_,l.updateSystemAckForUnrenderedMsg=f,l.bulkUpdateSystemAckForUnrenderedMsgs=g,l.getUnrenderedMsgsByMsgIds=h,l.getNextUnrenderedMsgIdNumberForThread=y}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(t){var n=t.revokedExternalId!=null?t.revokedExternalId:t.externalId;n==null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"])));var r=(d||(d=o("I64"))).of_string_opt(n);if(t.serverTs==null){var a;if(t.sortOrderMs!=null)return t.sortOrderMs;r==null&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"])));var i=r==null?null:o("MAWExtractMsFromExternalId").extractMsFromExternalId(r);return Math.floor((a=t.originalTs)!=null?a:o("MAWDbMsg").getCanonicalTsFromMsg(t))*1e3+(i!=null?i:0)}if(r!=null){var l=o("MAWExtractMsFromExternalId").extractMsFromExternalId(r);if(l!=null){var m=t.originalTs!=null?t.originalTs:t.serverTs;return Number(m)*1e3+l}else o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"])))}else o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"])));return o("MAWDbMsg").getSortOrderWithFallback(t)}l.generateAuthoritativeMessageSortOrder=m}),98);
__d("WAArrayGroupBy",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=new Map,r=0;r<e.length;r++){var o=t(e[r]),a=n.get(o);a==null?n.set(o,[e[r]]):a.push(e[r])}return Array.from(n.entries())}i.groupBy=e}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMsgType","MAWODSProxy","MAWTransactionMode","MAWTransactor","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g;function h(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.messages.get({msgId:t})}function y(e,t){return e.messages.where("threadJid").equals(t).count().then(function(e){return e===0})}function C(e,t,n){return e.messages.where("threadJid").equals(t).filter(n).first().then(function(e){return e!=null})}function b(e,t,n,r){return e.messages.where(["threadJid","sortOrderMs"]).between([t,Number.MIN_SAFE_INTEGER],[t,Number.MAX_SAFE_INTEGER],n,r)}function v(e,t){return b(e,t,!1,!1).last()}function S(e,t){return v(e,t).then(function(e){return e==null?void 0:e.msgId})}function R(e,t){return v(e,t).then(function(e){return(e==null?void 0:e.sortOrderMs)==null?null:o("WATimeUtils").castToMillisTime(e.sortOrderMs)})}function L(e,t,n){return r("vulture")("ST6o7qk-BKGl46ZXS71LYr_2y6I="),b(e,t,!1,!1).reverse().limit(n).toArray()}function E(e,t){return b(e,t,!1,!1).first()}function k(e,t){return E(e,t).then(function(e){return e==null?void 0:e.msgId})}function I(e,t){return e.messages.where("externalId").equals(t.externalId).filter(function(e){return e.author===t.author&&e.threadJid===t.chat}).toArray().then(D)}function T(e,t){var n=new Set(t.map(function(e){var t=e.author,n=e.chat,r=e.externalId;return o("WAMsg").craftWAMsgIdString({author:t,chat:n,externalId:r})}));return e.messages.where("externalId").anyOf(t.map(function(e){var t=e.externalId;return t})).filter(function(e){var t=e.author,r=e.externalId,a=e.threadJid;return n.has(o("WAMsg").craftWAMsgIdString({author:t,chat:a,externalId:r}))}).toArray().then(function(e){return o("WAArrayGroupBy").groupBy(e,function(e){return o("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId})}).map(function(e){var t=e[0],n=e[1];return D(n)}).filter(Boolean)})}function D(t){if(t.length>1){var n=t.map(function(e){var t,n;return e.type+":"+((t=e.serverTs)!=null?t:0).toString()+":"+((n=e.ts)!=null?n:0).toString()}),a=new Set(n).size===1;a?o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"]))):o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"])),t.length),(r("gkx")("5039")||o("Random").coinflip(r("justknobx")._("3594")))&&x(t)}return t[0]}function x(e){var t=e.length;if(!(t<=1)){var n=t-1,a=e[n],i={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};e.slice(0,n).forEach(function(e){var t=[];if((e==null?void 0:e.editCount)!==(a==null?void 0:a.editCount)){var n,l;i.editCount++,t.push("editCount, reference: "+((n=a==null?void 0:a.editCount)!=null?n:"")+", duplicate: "+((l=e==null?void 0:e.editCount)!=null?l:"")+". ")}if((e==null?void 0:e.mediaId)!==(a==null?void 0:a.mediaId)&&(i.mediaId++,t.push("mediaId, reference: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+", duplicate: "+((e==null?void 0:e.mediaId)!=null?String(e.mediaId):"")+". ")),e.sortOrderMs!==a.sortOrderMs&&(i.sortOrderMs++,t.push("sortOrderMs, reference: "+String(a.sortOrderMs)+", duplicate: "+String(e.sortOrderMs)+". ")),e.serverTs!==a.serverTs&&(i.serverTs++,t.push("serverTs, reference: "+String(a.serverTs)+", duplicate: "+String(e.serverTs)+". ")),e.ts!==a.ts&&(i.ts++,t.push("ts, reference: "+String(a.ts)+", duplicate: "+String(e.ts)+". ")),e.type!==a.type){var s,u;(e.type===o("MAWMsgType").MSG_TYPE.REVOKED||a.type===o("MAWMsgType").MSG_TYPE.REVOKED)&&(i.revokedStatus++,r("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",e.msgId,e.type,e.externalId,e.revokedExternalId,e.sortOrderMs,e.serverTs,e.ts,e.rowId,a.msgId,a.type,a.externalId,a.revokedExternalId,e.sortOrderMs,e.serverTs,e.ts,e.rowId)),i.type++,t.push("type, reference: "+((s=a.type)!=null?s:"")+", duplicate: "+((u=e.type)!=null?u:"")+". ")}var c=t.join("");c.length>0?r("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",e.msgId,a.msgId,c):r("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",e.msgId,a.msgId)}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"}),Object.keys(i).forEach(function(e){var t=i[e];t>0&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+e+"_field_differences"})}),o("MAWODSProxy").odsBumpEntityKey({amount:t-1,entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"}),Object.keys(i).forEach(function(e){var t=i[e];t>0&&o("MAWODSProxy").odsBumpEntityKey({amount:t,entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+e+"_field_differences"})})}}function $(e,t,n,r){var o={author:r,chat:n,externalId:t};return I(e,o)}function P(e,t){return e.messages.where("msgId").equals(t).toArray()}function N(e,t){return A(e,t).then(function(e){return e.success,e})}function M(e,t){var n=t.map(function(e){var t=e.externalId;return t});return e.messages.where("externalId").anyOf(n).toArray().then(function(e){var n=o("MAWDbMsgUtil").convertMsgArrayToMap(e),r=new(o("WAMsgMap")).MsgMap;return t.forEach(function(e){var t=n.get(e);t!=null&&r.set(e,t)}),r})}function w(e,t){return e.messages.where("msgId").equals(t).first().then(function(e){return e==null?void 0:e.sortOrderMs})}function A(e,t){var n=t.author,r=t.chat,a=t.externalId;return e.threads.get({jid:r}).then(function(t){return t==null?o("WAResultOrError").makeError("missing_thread_msg"):$(e,a,t.jid,n).then(function(e){return e==null?o("WAResultOrError").makeError("missing_msg"):o("WAResultOrError").makeResult(e)})})}function F(e,t){var n=t.author,r=t.chat,o=t.externalId;return e.threads.get({jid:r}).then(function(t){if(t!=null)return e.messages.where("revokedExternalId").equals(o).filter(function(e){return e.author===n&&e.threadJid===t.jid&&e.type==="Revoked"}).first()})}function O(e,t,n,r){var a=e.messages.where("revokedExternalId").equals(t).filter(function(e){return e.author===r&&e.threadJid===n&&e.type===o("MAWMsgType").MSG_TYPE.REVOKED}).first(),i=o("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(e,t,n,r).then(function(e){if((e==null?void 0:e.type)===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return e});return o("MAWDexieTable").dexieAll([a,i]).then(function(e){var t=e[0],n=e[1];return t!=null||n!=null})}function B(e,t){var n=new Array(t.length),r=new Set;return t.forEach(function(e){n.push(e.externalId),r.add(o("EncryptedBackupsUtils").convertWAMsgIdToStringId(e))}),e.messages.where("externalId").anyOf(n).filter(function(e){return r.has(o("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:e.author,chat:e.threadJid,externalId:e.externalId}))}).toArray()}function W(e,t,n,r,a,i){return q(e,[{ack:n,applicationErrorCode:i,msgId:t,reportingMeta:a,serverTs:r}]).then(function(e){var n=e.find(function(e){return e.msgId===t});return n==null?(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"]))),null):n})}function q(e,t){var n=t.map(function(e){return e.msgId});return o("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(e,n).then(function(r){var a=new Map;t.forEach(function(e){a.set(e.msgId,{ack:e.ack,applicationErrorCode:e.applicationErrorCode,reportingMeta:e.reportingMeta,serverTs:e.serverTs});var t=r.get(e.msgId);t!=null&&a.set(t,{ack:e.ack,applicationErrorCode:e.applicationErrorCode,reportingMeta:e.reportingMeta,serverTs:e.serverTs})});var i=Array.from(new Set(n.concat(Array.from(r.values()))));return e.messages.where("msgId").anyOf(i).toArray().then(function(t){if(t.length===0)return t;var n=[],r=[];return t.forEach(function(e){var t,i,l;if(e.author!==o("WAJids").AUTHOR_ME||e.ack>o("MAWAckLevel").ACK.clock){n.push(e);return}var s=(t=a.get(e.msgId))==null?void 0:t.ack,u=(i=a.get(e.msgId))==null?void 0:i.serverTs;if(s==null)return null;var c=babelHelpers.extends({},e,{ack:s});U(c,u);var d=(l=a.get(e.msgId))==null?void 0:l.reportingMeta;d!=null&&(c.reportingMeta=d),s===o("MAWAckLevel").ACK.sent&&delete c.resendCount,r.push(c)}),n.length>0&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""])),n.map(function(e){return e.msgId}).toString()),e.messages.bulkPut(r).then(function(){return o("MAWDexieTable").dexieAll(r.map(function(t){return o("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,t)}))}).then(function(e){return r.forEach(function(t,n){o("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:o("MAWBridgeMsg").createBridgeMsg(t,e[n])})}),[].concat(r,n)})})})}function U(e,t){if(t!=null){e.serverTs=t;var n=e.sortOrderMs;e.type!==o("MAWMsgType").MSG_TYPE.REVOKED&&(e.sortOrderMs=o("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(e),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""])),t,n,e.sortOrderMs))}}function V(e,t,n,a){return o("MAWDbThreadTxns").getThread(e,t).then(function(t){if(!(!t.success||a==null)){var i=t.value,l=[e.messages.where(["threadJid","sortOrderMs"]).above([i.jid,a]).first(),e.messages.where(["threadJid","sortOrderMs"]).below([i.jid,a]).last()];return o("MAWDexieTable").dexieAll(l).then(function(t){var a=t[0],l=t[1];return o("MAWDbThreadTxns").updateThread(e,babelHelpers.extends({},i,{newestMsgTs:(l==null?void 0:l.ts)==null?i.newestMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(l.ts),oldestMsg:i.oldestMsg===n?a==null?void 0:a.msgId:i.oldestMsg})).then(r("emptyFunction"))})}})}function H(e){return e.messages.where("altIndex").equals(o("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(e){var t=[];return e.forEach(function(e){if(e.type!==o("MAWMsgType").MSG_TYPE.FUTUREPROOF){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""])),e.msgId,e.type);return}t.push(e)}),t})}function G(e){return e.toString()}function z(e,t,n,a){var i=t.mediaId;if(i===n)return o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),t.msgId,n),o("MAWDexieTable").dexieResolve();var l=i!=null?e.media.get(i):o("MAWDexieTable").dexieResolve();return l.then(function(i){i&&o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""])),t.type);var l=a!=null?a:void 0,s=babelHelpers.extends({},t,{mediaId:n,plaintextHash:l});return e.messages.put(s).then(r("emptyFunction"))})}function j(e,t){var n=Array.from(t.keys());return e.messages.where("msgId").anyOf(n).toArray().then(function(n){var a=[];return n.map(function(e){var n=t.get(e.msgId),i=e.mediaId;if(i!=null&&i!==n){if(n!=null)throw r("FBLogger")("messenger_web").mustfixThrow("mediaId "+G(i)+" in message "+e.msgId+" is different with the "+G(n)+" in bulkUpdateMediaId");o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),e.msgId,n);return}var l=babelHelpers.extends({},e,{mediaId:n,plaintextHash:e.plaintextHash});a.push(l)}),e.messages.bulkPut(a).then(r("emptyFunction"))})}function K(e,t){return Q(e,[t]).then(r("emptyFunction"))}function Q(e,t){return e.messages.where("msgId").anyOf(t).toArray().then(function(t){var n=t.map(function(e){return babelHelpers.extends({},e,{isExpiredXmaMsg:!0})});return e.messages.bulkPut(n).then(function(){return n})})}function X(e,t,n,r){if(r!=null&&r<=0)return o("MAWDexieTable").dexieResolve([]);var a=e.messages.where("altIndex").equals(o("MAWDbMsg").craftToBeReadAltIndex(t)).filter(function(e){return o("MAWDbMsg").getSortOrderWithFallback(e)<=n});return r!=null&&(a=a.limit(r)),a.toArray()}function Y(e,t,n){return X(e,t,n).then(function(t){var n=t.map(function(e){return babelHelpers.extends({altIndex:null},e)});return e.messages.bulkPut(n).then(function(){return n})})}function J(e,t){return e.messages.delete(t)}function Z(e,t){return e.messages.bulkDelete(t)}function ee(e,t,n){var r=t.map(function(e){return e.rowId}),a=n!=null?t.map(function(e){var t=o("MAWJidUtils").toProtocolMsgId(e);if(t)return babelHelpers.extends({},t,{reason:n})}).filter(Boolean):[];return o("MAWDexieTable").dexieAll([e.deletedMessages.bulkAdd(a),e.messages.bulkDelete(r)]).then(function(e){var t=e[0],n=e[1];o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"])),n)})}function te(e,t){return e.messages.where("msgId").anyOf(t).toArray()}function ne(e){return e.messages.where("altIndex").anyOf([o("MAWDbMsg").SPAM_ALT_INDEX,o("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function re(e,t,n,r,a,i,l,s){l===void 0&&(l="before"),s===void 0&&(s=null);var u=n==null?null:o("MAWDbMsg").getSortOrderWithFallback(n);return l==="before"?e.messages.where(["threadJid","sortOrderMs"]).between([t,s!=null?s:Number.MIN_SAFE_INTEGER],[t,u!=null?u:Number.MAX_SAFE_INTEGER],!0,r).reverse().filter(i).limit(a).toArray():e.messages.where(["threadJid","sortOrderMs"]).between([t,u!=null?u:Number.MIN_SAFE_INTEGER],[t,s!=null?s:Number.MAX_SAFE_INTEGER],r,!0).filter(i).limit(a).toArray().then(function(e){return e.sort(function(e,t){return t.ts-e.ts})})}function oe(e,t,n,r){var o=n.msgId;if(r==null){var a;return{oldestMsg:(a=e==null?void 0:e.msgId)!=null?a:o}}var i=[e,t,n].filter(Boolean);return{oldestMsg:i.reduce(function(e,t){return ae(e,o,r)<ae(t,o,r)?e:t}).msgId}}function ae(e,t,n){return e.msgId===t?n:o("MAWDbMsg").getSortOrderWithFallback(e)}function ie(e,t){return e.messages.where("msgId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.msgId);return t+1})}function le(e){return o("MAWTransactor").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"checkMessagesExistenceByProtocolMsgIds",function(t){return function(){return o("MAWDexieTable").dexieAll(e.map(function(e){return t.messages.get({protocolMsgId:e.chat+"."+e.externalId})}))}})()}function se(e,t){return e.messages.where("externalId").anyOf(t).toArray()}l.maybeGetMsg=h,l.getIsThreadEmpty=y,l.doesThreadHaveMsgsMatchCriteria=C,l.getThreadMessagesBySortOrder=b,l.getThreadNewestMessageBySortOrder=v,l.getThreadNewestMessageId=S,l.getThreadNewestMessageMs=R,l.getThreadNewestNumMessagesBySortOrder=L,l.getThreadOldestMessageBySortOrder=E,l.getThreadOldestMessageId=k,l.maybeGetMsgByProtocolMsgId=I,l.getUniqueMsgsByProtocolMsgIds=T,l.maybeGetMsgByExternalId=$,l.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=P,l.maybeGetMsgResultByProtocolMsgId=N,l.getMsgMapByProtocolMsgId=M,l.getSortOrderFromMsgId=w,l.maybeGetRevokedMsgByProtocolMsgId=F,l.checkIfMsgIsDeletedForMeOrRevoked=O,l.getMsgsByProtocolMsgId=B,l.updateSystemAck=W,l.bulkUpdateSystemAck=q,l.maybeUpdateThreadMsgsForDeleteForMe=V,l.getFutureProofMsgs=H,l.updateMediaId=z,l.bulkUpdateMediaId=j,l.updateDbMsgXMAExpiration=K,l.bulkUpdateDbMsgXMAExpired=Q,l.getMsgsNeedingRetroactiveReadReceiptsUpTo=X,l.clearRetroactiveReadReceiptStatusFromMsgsUpTo=Y,l.deleteDbMsg=J,l.bulkDeleteDbMsg=Z,l.deleteMessages=ee,l.getMsgsByMsgIds=te,l.getSpamMsgs=ne,l.fetchMessagesFromDbWithSortOrderMs=re,l.calculateOldestMsg=oe,l.getNextMsgIdNumberForThread=ie,l.checkMessagesExistenceByProtocolMsgIds=le,l.UNSAFE_getMultipleMsgsByExternalId=se}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","MAWTransactionMode","MAWTransactor","MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return e.appMeta.get({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(e){return e==null?void 0:e.value.msgTypeVersion})}function u(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:t}})}function c(e,t){return e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:t}})}function d(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:t}})}function m(e){return e.appMeta.get({key:o("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(e){return e==null?void 0:e.value.hmacKey})}function p(e,t){return e.appMeta.get({key:t})}function _(e,t){return o("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor").setCachedShouldSaveSecurityAlert(t),e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:t}}).then(r("emptyFunction"))}function f(e,t){return e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:t}}).then(r("emptyFunction"))}function g(){return o("MAWTransactor").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"handleInstructions",function(e){return function(){return h(e)}})()}function h(e){return p(e,o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(e){var t;return(t=e==null?void 0:e.value.allowSecurityAlert)!=null?t:!1})}function y(e){return p(e,o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(e){var t;return(t=e==null?void 0:e.value.allowSecurityAlertForSelf)!=null?t:!0})}function C(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:t}})}function b(e){return o("MAWDexieTable").dexieAll([y(e),h(e)]).then(function(e){var t=e[0],n=e[1];return{allowSecurityAlertForContact:n,allowSecurityAlertForSelf:t}})}l.MSG_TYPE_VERSION=(e=o("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion,l.ALLOW_SECURITY_ALERT_FOR_CONTACT=e.AppMetaKeysEnum.allowSecurityAlert,l.ALLOW_SECURITY_ALERT_FOR_SELF=e.AppMetaKeysEnum.allowSecurityAlertForSelf,l.HOT_LIKE=e.AppMetaKeysEnum.hotlikeSticker,l.getMsgTypeVersion=s,l.addMsgTypeVersion=u,l.updateMsgTypeVersion=c,l.addHMACKey=d,l.getHMACKey=m,l.getAppMetaValue=p,l.updateSecurityAlertValueForContact=_,l.updateSecurityAlertValueForSelf=f,l.getSecuritySettingForContactTxn=g,l.getSecuritySettingForContact=h,l.getSecuritySettingForSelf=y,l.addHotLike=C,l.maybeBulkGetSecuritySetting=b}),98);
__d("MAWAuthor",["MAWUserJidWrapper","WAJids","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){if(t==null||t===o("WAJids").AUTHOR_SYSTEM)return null;if(o("WAJids").isAuthorMe(t))return o("MAWUserJidWrapper").getMyUserJid();var e=o("WAJids").authorAsUserJid(t);return e==null||r("isStringNullOrEmpty")(o("WAJids").userIdFromJid(e))?null:o("WAJids").authorAsUserJid(t)};l.getAuthorUserJid=e}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDexieTable","MAWIndexedDb","WALogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=function(t){return t};function d(e,t){return e.reactions.put(c(t))}function m(t,n){return t.reactions.delete(n.rowId).then(function(){var t=n.author,r=n.reactionId,a=n.reactToMsgId,i=n.threadJid;a!=null&&(o("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:i,reactToMsgId:a})}),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."])),r))})}function p(e,t){var n=o("MAWAuthor").getAuthorUserJid(t.author);return e.reactions.where("reactToExternalId").equals(t.externalId).filter(function(e){return(e.reactToAuthor===n||e.reactToAuthor===t.author)&&e.threadJid===t.chat}).toArray()}function _(e,t){var n=t.reduce(function(e,t){return e.set(t.msgId,t),e},new Map);return e.reactions.where("reactToMsgId").anyOf(t.map(function(e){return e.msgId})).toArray().then(function(e){var t=e.filter(function(e){var t,r=e.reactToExternalId,o=e.reactToMsgId;return o!=null&&r===((t=n.get(o))==null?void 0:t.externalId)});return t.length<e.length&&r("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId"),t})}function f(e,t){return e.reactions.where("reactToMsgId").equals(t.msgId).toArray().then(function(e){var n=e.filter(function(e){var n=e.reactToExternalId;return n===t.externalId});return n.length<e.length&&r("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId"),n})}function g(e,t){return _(e,[t])}function h(e,t){var n=t.author,r=t.chat,o=t.externalId;return e.reactions.where("externalId").equals(o).filter(function(e){return e.author===n&&e.threadJid===r}).first()}function y(e,t){return o("MAWDexieTable").dexieAll(t.map(function(t){var n=t.author,r=t.externalId,a=o("MAWAuthor").getAuthorUserJid(n);return e.reactions.where("reactToExternalId").equals(r).filter(function(e){return o("MAWAuthor").getAuthorUserJid(e.reactToAuthor)===a}).toArray()})).then(function(t){var n=t.flat();if(n.forEach(function(e){var t=e.author,n=e.reactToMsgId,r=e.threadJid;n!=null&&o("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:r,reactToMsgId:n})})}),n.length!==0)return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."])),n.length),e.reactions.bulkDelete(n.map(function(e){return e.rowId}))})}function C(e,t){return e.reactions.where("reactToMsgId").anyOf(t.map(function(e){return e.msgId})).delete().then(function(e){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"])),e)})}function b(e,t){return e.reactions.where("reactionId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.reactionId);return t+1})}function v(e,t,n,r,a,i,l){var s,u,c=(s=r==null?void 0:r.ts)!=null?s:o("WATimeUtils").unixTime();return e.reactions.where(["threadJid","ts"]).between([t,(u=o("WATimeUtils").castMillisTimeToUnixTime(n))!=null?u:o("WATimeUtils").castToUnixTime(0)],[t,c],!0,a).reverse().filter(l).limit(i).toArray()}l.coerceToReaction=c,l.putReaction=d,l.deleteReaction=m,l.getReactionForEcho=p,l.getReactionsFromMessages=_,l.getReactionsForMessage=f,l.getReactionsFromMessage=g,l.maybeGetReactionByProtocolMsgId=h,l.deleteReactionsByUniqueMsgIdentifiers=y,l.deleteAllReactionsForMessages=C,l.getNextReactionIdNumberForThread=b,l.fetchReactionsFromDbWithTimestamp=v}),98);
__d("MAWAuthoritativeThreadsCache",[],(function(t,n,r,o,a,i){"use strict";var e=new Set;i.AuthoritativeThreadsCache=e}),66);
__d("MaybeCreateOrUpdateThreadResultCache",[],(function(t,n,r,o,a,i){"use strict";var e=new Map;function l(t){e.delete(t)}i.cache__I_KNOW_WHAT_I_AM_DOING=e,i.deleteCachedThreadResult=l}),66);
__d("MAWDbThreadTxns",["MAWAuthoritativeThreadsCache","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MaybeCreateOrUpdateThreadResultCache","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return e.threads.get({deduplicationKey:t}).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function d(e,t){return e.threads.get({jid:t}).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function m(e,t){return e.threads.where("jid").anyOf(t).toArray()}function p(e,t){return e.threads.where("jid").startsWith(t+"@").first().then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function _(e){o("MaybeCreateOrUpdateThreadResultCache").deleteCachedThreadResult(e),o("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache.delete(e)}function f(e,t){return e.threads.where("jid").equals(t).delete().then(function(){return _(t)})}function g(e,t){return e.participants.where("userJid").equals(t).toArray().then(function(t){var n=t.map(function(e){return e.threadJid});return m(e,n)})}function h(e,t){return e.participants.where("userJid").anyOf(t).toArray().then(function(t){var n=new Map,r=new Set;return t.forEach(function(e){var t,o=e.userJid,a=(t=n.get(o))!=null?t:[];a.push(e.threadJid),n.set(o,a),r.add(e.threadJid)}),m(e,Array.from(r)).then(function(e){var t=e.reduce(function(e,t){return e.set(t.jid,t),e},new Map);return new Map(Array.from(n.entries()).map(function(e){var n=e[0],r=e[1];return[n,r.map(function(e){return t.get(e)}).filter(Boolean)]}))})})}function y(e,t,n){return(t==null?void 0:t.lastReadMsgReceiptSent)==null?o("MAWDexieTable").dexieResolve(!1):o("MAWDbMsgTxns").getSortOrderFromMsgId(e,t.lastReadMsgReceiptSent).then(function(e){return n.sortOrderMs==null||e==null?!1:n.sortOrderMs<=e})}function C(e,t){return e.threads.get({jid:t.threadJid}).then(function(n){return y(e,n,t)})}function b(e,t){return e.threads.where("jid").anyOf(t.map(function(e){return e.threadJid})).toArray().then(function(n){return o("MAWDexieTable").dexieAll(o("WAArrayZip").zip(t,n).map(function(t){var n=t[0],r=t[1];return y(e,r,n)}))})}function v(e,t,n){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var r=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{archived:!0,cannotReplyReason:n?"viewer_not_subscribed":e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return e.threads.bulkPut(r).then(function(){r.forEach(function(e){n&&o("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+e.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:e.jid})})})})})}function S(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{cannotReplyReason:null})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){var t={cannotReplyReason:null,threadJid:e.jid};o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread(t)})})})})}function R(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{archived:!1,cannotReplyReason:e.cannotReplyReason==="viewer_not_subscribed"?e.cannotReplyReason:null,folder:o("MAWFolderTypes").FOLDER_ID.INBOX})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:e.jid})})})})})}function L(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{cannotReplyReason:"viewer_not_subscribed"})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){var t={cannotReplyReason:"viewer_not_subscribed",threadJid:e.jid};o("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+e.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread(t)})})})})}function E(t,n){return d(t,n).then(function(n){if(!n.success){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"])));return}var a=n.value;if(a.isMigratedLocally===!0){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"])));return}var i=babelHelpers.extends({},a,{isMigratedLocally:!0});return t.threads.put(i).then(r("emptyFunction"))})}function k(e,t){if(t.isMigratedLocally===!1)return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"]))),o("MAWDexieTable").dexieResolve(t);var n=babelHelpers.extends({},t,{isMigratedLocally:!1});return e.threads.put(n).then(function(){return n})}function I(e,t){return e.threads.put(t).then(r("emptyFunction"))}function T(e,t,n,r,a){return I(e,babelHelpers.extends({},t,{newestMsgTs:(a==null?void 0:a.ts)==null?t.newestMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(a.ts),oldestMsg:r==null?void 0:r.msgId}))}l.getThreadByDeduplicationKey=c,l.getThread=d,l.getThreads=m,l.getThreadPrimaryId=p,l.deleteThread=f,l.getAllThreadsForUser=g,l.getAllThreadsForUsers=h,l.needsRetroactiveReadReceiptInThread=C,l.bulkNeedsRetroactiveReadReceiptInThread=b,l.archiveThreads=v,l.subscribeToThreads=S,l.unarchiveThreads=R,l.unsubscribeFromThreads=L,l.markCutoverThreadAsMigratedLocally=E,l.markCutoverThreadAsNotMigratedLocally=k,l.updateThread=I,l.updateThreadMsgsForUndefinedOldestOrNewestMsgs=T}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return e.xma.bulkGet(t)}function s(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.get({xmaId:t})}function u(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.where("associatedMessageId").equals(t).first()}function c(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.where("externalId").equals(t.externalId).filter(function(e){return e.author===t.author&&e.threadJid===t.chat}).first()}function d(e,t){return c(e,t).then(function(t){return t==null?o("WAResultOrError").makeError("missing"):o("MAWDexieTable").dexieAll([o("MAWDbMediaTxns").getMediaForXMA(e,t),o("MAWDbMsgTxns").maybeGetMsg(e,t.associatedMessageId)]).then(function(e){var n=e[0],r=e[1];if(!n.success)return o("WAResultOrError").makeError("missing");var a=n.value,i=a.defaultPreview,l=a.favicon,s=a.header,u=a.previews;return o("WAResultOrError").makeResult({associatedMessage:r,defaultPreview:i,favicon:l,header:s,previews:u,xma:t})})})}function m(e,t){return u(e,t).then(function(t){if(t!=null)return o("MAWDbMsgTxns").maybeGetMsg(e,t.msgId)})}function p(e,t){if(t.length===0)return o("MAWDexieTable").dexieResolve([]);var n=t.filter(o("MAWDbMsg").isXMAMsg).map(function(e){return o("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.externalId)}).filter(Boolean),r=n.map(function(t){return c(e,t)});return o("MAWDexieTable").dexieAll(r).then(function(e){return e.filter(Boolean)})}function _(e,t){return e.xma.where("associatedMessageId").anyOf(t).toArray().then(function(e){var t=e.filter(function(e){return e.msgId!=null&&r("gkx")("9841")?e.targetType!=null:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(e.targetType)});return t.reduce(function(e,t){return t.associatedMessageId!=null&&t.msgId!=null?e.set(t.associatedMessageId,t.msgId):e},new Map)})}function f(e,t){return e.xma.where("associatedMessageId").equals(t).first()}function g(e,t){return e.xma.where("associatedMessageId").equals(t).first().then(function(t){if(t!=null){var n=o("MAWJidUtils").maybeToProtocolMsgId(t.author,t.threadJid,t.externalId);if(n!=null)return o("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(e,n)}})}function h(e,t){return f(e,t).then(function(t){return t==null?o("WAResultOrError").makeResult():o("MAWDexieTable").dexieAll([o("MAWDbMediaTxns").getMediaForXMA(e,t),o("MAWDbMsgTxns").maybeGetMsg(e,t.associatedMessageId)]).then(function(e){var n=e[0],r=e[1];if(!n.success)return o("WAResultOrError").makeError("missing");var a=n.value,i=a.defaultPreview,l=a.favicon,s=a.header,u=a.previews;return o("WAResultOrError").makeResult({associatedMessage:r,defaultPreview:i,favicon:l,header:s,previews:u,xma:t})})})}function y(e,t,n){return o("MAWDbThreadTxns").getThread(e,n).then(function(n){if(n.success){var r=n.value;if(t==null)return o("MAWDexieTable").dexieResolve();var a={author:t.author,chat:r.jid,externalId:t.externalId};return o("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(e,a)}})}function C(e,t){return c(e,t).then(function(t){if(t==null)return o("MAWDexieTable").dexieResolve();if(!o("MAWXMAUtils").isXMAStoryReply(t.targetType))return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t.defaultPreviewMediaId).then(function(n){return n==null?{hasMedia:!1,xma:t}:o("MAWDexieTable").dexieAll([n,o("MAWDbChunkTxns").hasMediaChunk(e,n.hashedPlaintextHash)]).then(function(e){var n=e[0],r=e[1];return{hasMedia:r,previewMedia:n,xma:t}})})})}function b(e,t){return e.xma.where("externalId").anyOf(t).toArray()}l.bulkGetXMAs=e,l.maybeGetXMAFromXMAId=s,l.maybeGetXMAFromAssociatedMsgId=u,l.maybeGetXMAFromProtocolMsgId=c,l.maybeGetXMAPayloadFromProtocolMsgId=d,l.getDbXMAMsgFromAssociatedMsgId=m,l.getXMAFromMsgs=p,l.getXMAMsgIdsFromAssociatedMsgIds=_,l.maybeGetDbXMAMsgByAssociatedMsgId=g,l.maybeGetXMAPayloadFromAssociatedMsgId=h,l.maybeGetAssociatedXMAMsg=y,l.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=C,l.getMultipleXMAByExternalId=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations","getErrorSafe","vulture"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{create:function(n){return babelHelpers.extends({},n,{table:function(a){var t=n.table(a);try{return babelHelpers.extends({},t,{get:function(r){return t.get(r).then(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})},getMany:function(r){return t.getMany(r).then(function(t){return t.map(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})})},mutate:function(r){var n=null;switch(r.type){case"add":case"put":n=r.values.map(function(t){return o("MAWDbMiddlewareMutations").mutateValue(t,a,e)});break;case"delete":break;case"deleteRange":break}return r.type==="delete"||r.type==="deleteRange"||n==null?t.mutate(r):(r.values=n,t.mutate(r).then(function(e){return e}))},openCursor:function(r){return t.openCursor(r).then(function(t){return t==null||t.value==null?t:u(t,a,e)})},query:function(r){return t.query(r).then(function(t){if(t.result.length===0||typeof t.result[0]!="object")return t;var n=t.result.map(function(t){return o("MAWDbMiddlewareMutations").getValue(t,a,e)});return t.result=n,t})}})}catch(e){var i=r("getErrorSafe")(e);return r("FBLogger")("messenger_web").catching(i).mustfix("Error applying MAWDbMiddleware"),t}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function s(){return{create:function(t){return babelHelpers.extends({},t,{table:function(n){var e=t.table(n);try{return babelHelpers.extends({},e,{get:function(r){return e.get(r).then(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})},getMany:function(a){return e.getMany(a).then(function(e){return r("vulture")("SMxI1wxhqOhNsUbqaKEGeOiO21w="),e.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})},mutate:function(r){return r.type==="delete"||r.type==="deleteRange"||(r.values=r.values.map(function(e){return o("MAWDbMiddlewareMutations").mutateVaultedValue(e,n)})),e.mutate(r)},openCursor:function(r){return e.openCursor(r).then(function(e){return e==null||e.value==null?e:c(e,n)})},query:function(r){return e.query(r).then(function(e){return e.result.length===0||typeof e.result[0]!="object"?e:babelHelpers.extends({},e,{result:e.result.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})})}})}catch(t){var a=r("getErrorSafe")(t);return r("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware"),e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function u(e,t,n){var r;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(i){return e.start(function(){r=o("MAWDbMiddlewareMutations").getValue(e.value,t,n);try{e.value=r}catch(e){}i()})}},value:{get:function(){return r}}})}function c(e,t){var n;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(a){return e.start(function(){n=o("MAWDbMiddlewareMutations").getVaultedValue(e.value,t);try{e.value=n}catch(e){}a()})}},value:{get:function(){return n}}})}l.getMAWDbMutationMiddleware=e,l.getMAWVaultMiddleware=s}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(e,t,n)}l.encryptContent=e}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={},R={},L={};s.name="ProtocolMsgId",s.internalSpec={externalId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],chat:[3,e.TYPES.STRING]},u.name="MetaSyncMessageKeyProto",u.internalSpec={fromMe:[1,e.TYPES.BOOL],id:[2,e.TYPES.STRING]},c.name="MetaSyncMessageProto",c.internalSpec={key:[1,e.TYPES.MESSAGE,u],ts:[2,e.TYPES.INT64]},d.name="MetaSyncMessageRangeProto",d.internalSpec={lastMessageTimestamp:[1,e.TYPES.INT64],lastSystemMessageTimestamp:[2,e.TYPES.INT64],messages:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c]},m.name="MetaSyncChatActionProto",m.internalSpec={type:[1,e.TYPES.STRING],chatJid:[2,e.TYPES.STRING],archived:[3,e.TYPES.BOOL],ts:[4,e.TYPES.INT64],messageRange:[5,e.TYPES.MESSAGE,d],read:[6,e.TYPES.BOOL]},p.name="MetaSyncMessageActionProto",p.internalSpec={type:[1,e.TYPES.STRING],protocolMsgId:[2,e.TYPES.MESSAGE,s]},_.name="MetaSyncActionProto",_.internalSpec={chatAction:[1,e.TYPES.MESSAGE,m],messageAction:[2,e.TYPES.MESSAGE,p],__oneofs__:{action:["chatAction","messageAction"]}},f.name="MetaSyncAppDataProto",f.internalSpec={actions:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_]},g.name="EncryptedBackupsSecretsEpochProto",g.internalSpec={id:[1,e.TYPES.UINT64],anonId:[2,e.TYPES.BYTES],rootKey:[3,e.TYPES.BYTES],status:[4,e.TYPES.INT32]},h.name="EncryptedBackupsSecretsProto",h.internalSpec={backupId:[1,e.TYPES.UINT64],serverDataId:[2,e.TYPES.UINT64],epoch:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,g],tempOcmfClientState:[4,e.TYPES.BYTES],mailboxRootKey:[5,e.TYPES.BYTES],obliviousValidationToken:[6,e.TYPES.BYTES]},y.name="FingerprintProto",y.internalSpec={currentIndex:[1,e.TYPES.UINT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.UINT32],rawId:[3,e.TYPES.UINT32]},C.name="SyncKeyDataProto",C.internalSpec={keyId:[1,e.TYPES.BYTES],keyData:[2,e.TYPES.BYTES],keyEpoch:[3,e.TYPES.UINT32],timestamp:[4,e.TYPES.INT64],fingerprint:[5,e.TYPES.MESSAGE,y]},b.name="SyncKeyShareProto",b.internalSpec={keys:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,C],orphanKeys:[2,e.FLAGS.REPEATED|e.TYPES.BYTES]},v.name="SyncKeyRequestProto",v.internalSpec={keyIds:[1,e.FLAGS.REPEATED|e.TYPES.BYTES]},S.name="AppDataProto",S.internalSpec={type:[1,e.TYPES.STRING],actions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],encryptedBackupsSecrets:[3,e.TYPES.MESSAGE,h],syncKeyShare:[4,e.TYPES.MESSAGE,b],syncKeyRequest:[5,e.TYPES.MESSAGE,v]},R.name="IdentitiesPerDeviceProto",R.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},L.name="AppDataTableSchemaProto",L.internalSpec={externalId:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],contents:[3,e.TYPES.MESSAGE,S],permittedIdentitiesPerDevice:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,R],ack:[5,e.TYPES.INT32],appDataId:[6,e.TYPES.INT32],recipientDevices:[7,e.FLAGS.REPEATED|e.TYPES.STRING],sendPartial:[8,e.TYPES.BOOL]},l.ProtocolMsgIdSpec=s,l.MetaSyncMessageKeyProtoSpec=u,l.MetaSyncMessageProtoSpec=c,l.MetaSyncMessageRangeProtoSpec=d,l.MetaSyncChatActionProtoSpec=m,l.MetaSyncMessageActionProtoSpec=p,l.MetaSyncActionProtoSpec=_,l.MetaSyncAppDataProtoSpec=f,l.EncryptedBackupsSecretsEpochProtoSpec=g,l.EncryptedBackupsSecretsProtoSpec=h,l.FingerprintProtoSpec=y,l.SyncKeyDataProtoSpec=C,l.SyncKeyShareProtoSpec=b,l.SyncKeyRequestProtoSpec=v,l.AppDataProtoSpec=S,l.IdentitiesPerDeviceProtoSpec=R,l.AppDataTableSchemaProtoSpec=L}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DbAppMetaValuesProto",s.internalSpec={msgTypeVersion:[1,(e=o("WAProtoConst")).TYPES.INT32],hmacKey:[2,e.TYPES.BYTES],allowSecurityAlert:[3,e.TYPES.BOOL],hotlikeSticker:[4,e.TYPES.BYTES],isBackfilledForOccamadillo:[5,e.TYPES.BOOL],allowSecurityAlertForSelf:[11,e.TYPES.BOOL],hasMigratedFromDexie:[12,e.TYPES.BOOL],restoreMigrationAttempts:[13,e.TYPES.INT32],deviceJid:[14,e.TYPES.STRING],restoreToDexieMigrationComplete:[15,e.TYPES.BOOL],dbMigrationVersion:[16,e.TYPES.INT32]},u.name="AppMetaTableSchemaProto",u.internalSpec={key:[1,e.TYPES.STRING],value:[2,e.TYPES.MESSAGE,s]},l.DbAppMetaValuesProtoSpec=s,l.AppMetaTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="CollectionVersionsTableSchemaProto",s.internalSpec={collection:[1,(e=o("WAProtoConst")).TYPES.STRING],version:[2,e.TYPES.INT32],state:[3,e.TYPES.STRING],finiteFailureStartTime:[4,e.TYPES.INT64],ltHash:[5,e.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,e.TYPES.BOOL],isCollectionLthashInconsistent:[7,e.TYPES.BOOL]},l.CollectionVersionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeletedMessagesTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],chat:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reason:[4,e.TYPES.STRING]},l.DeletedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeviceChangeAlertsTableSchemaProto",s.internalSpec={action:[1,(e=o("WAProtoConst")).TYPES.STRING],isArchived:[2,e.TYPES.BOOL],deviceChangeAlertsId:[3,e.TYPES.INT64],location:[4,e.TYPES.STRING],model:[5,e.TYPES.STRING],ts:[6,e.TYPES.INT64],loggedOut:[7,e.TYPES.BOOL],deviceJid:[8,e.TYPES.STRING],identity:[9,e.TYPES.BYTES],platform:[10,e.TYPES.STRING],latitude:[11,e.TYPES.STRING],longitude:[12,e.TYPES.STRING],isConfirmed:[13,e.TYPES.BOOL],isNotified:[14,e.TYPES.BOOL]},l.DeviceChangeAlertsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={BACKUP_RESTORE:0,E2E_DYI:1},u={};u.name="DyiBatchTableSchemaProto",u.internalSpec={batchId:[1,(e=o("WAProtoConst")).TYPES.INT32],numMessages:[2,e.TYPES.INT32],oldestTs:[3,e.TYPES.INT64],threadId:[4,e.TYPES.STRING],isThread:[5,e.TYPES.BOOL],numMessagesRestored:[6,e.TYPES.INT32],qplInstanceKeyForThread:[7,e.TYPES.INT64],qplFlowDescriptor:[8,e.TYPES.ENUM,s],qplInstanceKeyE2E:[9,e.TYPES.INT64],numThreadsRestored:[10,e.TYPES.INT64]},l.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=s,l.DyiBatchTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EBMsgRangesTableSchemaProto",s.internalSpec={rangeId:[1,(e=o("WAProtoConst")).TYPES.UINT32],threadJid:[2,e.TYPES.STRING],minMsgExternalId:[3,e.TYPES.STRING],maxMsgExternalId:[4,e.TYPES.STRING],minMsgSortOrderMs:[5,e.TYPES.UINT64],maxMsgSortOrderMs:[6,e.TYPES.UINT64],creationTime:[7,e.TYPES.INT64]},l.EBMsgRangesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="EphemeralSettingProto",s.internalSpec={ephemeralExpirationInSec:[1,(e=o("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,e.TYPES.INT64]},u.name="EphemeralSyncResponseBackoffInfo",u.internalSpec={syncResponseRetries:[1,e.TYPES.INT32],syncResponseSentTs:[2,e.TYPES.INT64]},l.EphemeralSettingProtoSpec=s,l.EphemeralSyncResponseBackoffInfoSpec=u}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={};s.name="MsgContentProto",s.internalSpec={content:[1,(e=o("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,e.FLAGS.REPEATED|e.TYPES.STRING],adminType:[3,e.TYPES.STRING],obsoleteExpiration:[4,e.TYPES.INT32],obsoleteTs:[5,e.TYPES.INT64],subtype:[6,e.TYPES.STRING],protobuf:[7,e.TYPES.BYTES],screenshotActionType:[8,e.TYPES.INT32],authorName:[9,e.TYPES.STRING],version:[10,e.TYPES.INT32],mentionedJids:[11,e.FLAGS.REPEATED|e.TYPES.STRING],commands:[12,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u]},u.name="MsgContentCommandProto",u.internalSpec={commandType:[1,e.TYPES.INT32],offset:[2,e.TYPES.INT32],length:[3,e.TYPES.INT32],validationToken:[4,e.TYPES.STRING]},c.name="ReportingMetaProto",c.internalSpec={frankingTag:[1,e.TYPES.BYTES],frankingVersion:[2,e.TYPES.INT32],reportingContent:[3,e.TYPES.BYTES],reportingTag:[4,e.TYPES.BYTES],frankingKey:[5,e.TYPES.BYTES]},d.name="DbQuotedMsgProto",d.internalSpec={remoteJid:[1,e.TYPES.STRING],content:[2,e.TYPES.MESSAGE,h]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.INT32],width:[2,e.TYPES.INT32],height:[3,e.TYPES.INT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.INT32],jpegThumbnailWidth:[7,e.TYPES.INT32]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.INT32],jpegThumbnailWidth:[5,e.TYPES.INT32]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.INT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="QuotedDbMediaProto",g.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.INT32],ts:[4,e.TYPES.INT64],mediaEntry:[5,e.TYPES.BYTES],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],validatedDocumentFileInfo:[9,e.TYPES.MESSAGE,f]},h.name="DbQuotedMsgContentProto",h.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],msgContent:[5,e.TYPES.MESSAGE,s],obsoleteMedia:[6,e.TYPES.MESSAGE,g],msgId:[7,e.TYPES.STRING],mediaId:[8,e.TYPES.INT32],sourceId:[9,e.TYPES.STRING],xmaMessageType:[10,e.TYPES.INT32],specialTextSize:[11,e.TYPES.INT32],plaintextHash:[12,e.TYPES.STRING],expirationTs:[13,e.TYPES.INT64]},y.name="MessagesTableSchemaProto",y.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],msgContent:[8,e.TYPES.MESSAGE,s],altIndex:[9,e.TYPES.STRING],forwardingScore:[10,e.TYPES.INT32],quote:[11,e.TYPES.MESSAGE,d],messageExpirationTs:[12,e.TYPES.INT64],ephemeralSetting:[13,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,e.TYPES.STRING],isForwarded:[15,e.TYPES.BOOL],originalTs:[17,e.TYPES.INT64],sortOrderMs:[18,e.TYPES.INT64],reportingMeta:[19,e.TYPES.MESSAGE,c],messageDeleteTs:[20,e.TYPES.INT64],ephemeralCounterStarted:[21,e.TYPES.BOOL],quoteExternalId:[22,e.TYPES.STRING],unsendMsgContentDeleteTs:[23,e.TYPES.INT64],rowId:[24,e.TYPES.INT32],thread:[25,e.TYPES.INT32],mediaId:[26,e.TYPES.INT32],ephemeralMsgDisappeared:[27,e.TYPES.BOOL],threadJid:[28,e.TYPES.STRING],xmaId:[29,e.TYPES.INT32],specialTextSize:[30,e.TYPES.INT32],xmaMessageType:[31,e.TYPES.INT32],isExpiredXmaMsg:[32,e.TYPES.BOOL],ravenEphemeralType:[33,e.TYPES.INT32],ravenEphemeralMediaState:[34,e.TYPES.INT32],editCount:[35,e.TYPES.INT32],groupId:[36,e.TYPES.STRING],groupIndex:[37,e.TYPES.INT64],groupSize:[38,e.TYPES.INT64],receiverFetchId:[39,e.TYPES.STRING],source:[40,e.TYPES.STRING],quoteExpirationTs:[41,e.TYPES.INT64],applicationErrorCode:[42,e.TYPES.INT32],hdType:[43,e.TYPES.INT32],pollStanzaId:[44,e.TYPES.STRING],collapsibleId:[45,e.TYPES.STRING],isCollapsed:[46,e.TYPES.BOOL]},l.MsgContentProtoSpec=s,l.MsgContentCommandProtoSpec=u,l.ReportingMetaProtoSpec=c,l.DbQuotedMsgProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.QuotedDbMediaProtoSpec=g,l.DbQuotedMsgContentProtoSpec=h,l.MessagesTableSchemaProtoSpec=y}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EditMsgHistoryTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,e.TYPES.INT32],editTs:[3,e.TYPES.INT64],msgContent:[4,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,e.TYPES.STRING],specialTextSize:[6,e.TYPES.INT32],threadJid:[7,e.TYPES.STRING],editExternalId:[8,e.TYPES.STRING],sendStatus:[9,e.TYPES.INT32]},l.EditMsgHistoryTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInfoSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadId:[2,e.TYPES.INT32],creator:[3,e.TYPES.STRING],creationTs:[4,e.TYPES.INT64],name:[5,e.TYPES.STRING],nameOwner:[6,e.TYPES.STRING],nameTs:[7,e.TYPES.INT64],msgExpiration:[8,e.TYPES.INT32],participantVersion:[9,e.TYPES.STRING],inviter:[10,e.TYPES.STRING],memberAddMode:[11,e.TYPES.STRING]},l.GroupInfoSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInvitesTableSchemaProto",s.internalSpec={inviterJid:[1,(e=o("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,e.TYPES.STRING],inviteCode:[3,e.TYPES.STRING],inviteExpirationTs:[4,e.TYPES.INT64],caption:[5,e.TYPES.STRING]},l.GroupInvitesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={NONE:0,LQ_4K:1,HQ_4K:2},u={},c={},d={},m={},p={},_={},f={},g={},h={};u.name="ChunkTableSchemaProto",u.internalSpec={plaintextHash:[1,(e=o("WAProtoConst")).TYPES.STRING],blobData:[2,e.TYPES.BYTES],mimetype:[3,e.TYPES.STRING],hashedPlaintextHash:[4,e.TYPES.STRING],chunkId:[5,e.TYPES.INT32]},c.name="MediaBackupSchemaProto",c.internalSpec={mediaBackupId:[1,e.TYPES.INT32],mediaId:[2,e.TYPES.INT32],objectId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],fbid:[5,e.TYPES.STRING]},d.name="MediaEntriesProto",d.internalSpec={msgId:[1,e.TYPES.STRING],mediaEntryData:[2,e.TYPES.BYTES]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.UINT32],width:[2,e.TYPES.UINT32],height:[3,e.TYPES.UINT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.UINT32],jpegThumbnailWidth:[7,e.TYPES.UINT32],thumbnailPlaintextHash:[8,e.TYPES.STRING],gifPlayback:[9,e.TYPES.BOOL]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.UINT32],jpegThumbnailWidth:[5,e.TYPES.UINT32],thumbnailPlaintextHash:[6,e.TYPES.STRING],hdType:[7,e.TYPES.ENUM,s]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.UINT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="ValidatedResult",g.internalSpec={validatedMimeType:[1,e.TYPES.STRING],videoStreamType:[2,e.TYPES.STRING],videoCalculatedFps:[3,e.TYPES.UINT32],videoNominalFps:[4,e.TYPES.UINT32],videoWidth:[5,e.TYPES.UINT32],videoHeight:[6,e.TYPES.UINT32],videoDuration:[7,e.TYPES.UINT32],videoAvgBitsPerSecond:[8,e.TYPES.UINT32],audioStreamType:[9,e.TYPES.STRING],audioSamplingRate:[10,e.TYPES.UINT32],audioNumberOfChannels:[11,e.TYPES.UINT32],audioAvgBitsPerSecond:[12,e.TYPES.UINT32]},h.name="MediaTableSchemaProto",h.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.UINT64],mediaEntries:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],ts:[5,e.TYPES.INT64],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],hashedPlaintextHash:[9,e.TYPES.STRING],mediaId:[10,e.TYPES.INT32],msgIds:[11,e.FLAGS.REPEATED|e.TYPES.STRING],objectId:[12,e.TYPES.STRING],fbid:[13,e.TYPES.STRING],validatedDocumentFileInfo:[14,e.TYPES.MESSAGE,f],validatedResult:[15,e.TYPES.MESSAGE,g],accessibilitySummaryText:[16,e.TYPES.STRING],isVideoGif:[17,e.TYPES.BOOL]},l.HD_TYPE=s,l.ChunkTableSchemaProtoSpec=u,l.MediaBackupSchemaProtoSpec=c,l.MediaEntriesProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.ValidatedResultSpec=g,l.MediaTableSchemaProtoSpec=h}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DeviceResponse",s.internalSpec={deviceId:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceResponse:[2,e.TYPES.BOOL]},u.name="MissingKeysTableSchemaProto",u.internalSpec={keyHex:[1,e.TYPES.STRING],keyId:[2,e.TYPES.BYTES],timestamp:[3,e.TYPES.INT64],deviceResponses:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},l.DeviceResponseSpec=s,l.MissingKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ParticipantsTableSchemaProto",s.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.STRING],userJid:[2,e.TYPES.STRING],deliveredWatermarkTs:[3,e.TYPES.INT64],lastReadWatermarkTs:[4,e.TYPES.INT64],type:[5,e.TYPES.STRING],addressable:[6,e.TYPES.BOOL],lastReadActionTs:[7,e.TYPES.INT64],threadId:[9,e.TYPES.INT32],threadJid:[10,e.TYPES.STRING]},l.ParticipantsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={SET:0,REMOVE:1},u={};u.name="PendingMutationsTableSchemaProto",u.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.INT32],collection:[2,e.TYPES.STRING],index:[3,e.TYPES.STRING],binarySyncAction:[4,e.TYPES.BYTES],version:[5,e.TYPES.INT32],operation:[6,e.TYPES.ENUM,s],timestamp:[7,e.TYPES.INT64],action:[8,e.TYPES.STRING]},l.SYNCD_MUTATION_SYNCD_OPERATION=s,l.PendingMutationsTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="PersonalSenderKeyStatusTableSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],senderKeyId:[2,e.TYPES.INT32],rotateSenderKey:[4,e.TYPES.BOOL],senderKeyTs:[5,e.TYPES.INT64],hasSenderKey:[6,e.FLAGS.REPEATED|e.TYPES.STRING]},l.PersonalSenderKeyStatusTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={OPEN:0,FROZEN:1},u={},c={},d={},m={};u.name="PollOptionProto",u.internalSpec={optionText:[1,(e=o("WAProtoConst")).TYPES.STRING],voteAuthors:[2,e.FLAGS.REPEATED|e.TYPES.STRING]},c.name="PollOptionsProto",c.internalSpec={pollOptionHash:[1,e.TYPES.STRING],pollOption:[2,e.TYPES.MESSAGE,u]},d.name="LatestSenderTimestampsMsProto",d.internalSpec={author:[1,e.TYPES.STRING],latestSenderTimestampMs:[2,e.TYPES.INT64]},m.name="PollTableSchemaProto",m.internalSpec={chatJid:[1,e.TYPES.STRING],encKey:[2,e.TYPES.BYTES],pollAuthor:[3,e.TYPES.STRING],pollStanzaId:[4,e.TYPES.STRING],pollOptions:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],pollParticipantCount:[6,e.TYPES.UINT32],pollState:[7,e.TYPES.ENUM,s],selectableOptionsCount:[8,e.TYPES.UINT32],title:[9,e.TYPES.STRING],latestSenderTimestampsMs:[10,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d]},l.POLL_STATE=s,l.PollOptionProtoSpec=u,l.PollOptionsProtoSpec=c,l.LatestSenderTimestampsMsProtoSpec=d,l.PollTableSchemaProtoSpec=m}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReactionsTableSchemaProto",s.internalSpec={ack:[1,(e=o("WAProtoConst")).TYPES.INT32],author:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reactionId:[4,e.TYPES.STRING],reactToExternalId:[5,e.TYPES.STRING],reactToAuthor:[6,e.TYPES.STRING],reactToMsgId:[7,e.TYPES.STRING],threadJid:[8,e.TYPES.STRING],reaction:[9,e.TYPES.STRING],groupingKey:[10,e.TYPES.STRING],ts:[11,e.TYPES.INT64],rowId:[12,e.TYPES.INT32],senderTimestampMs:[13,e.TYPES.INT64]},l.ReactionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={};s.name="DbUserStatusTsProto",s.internalSpec={deliveredTs:[1,(e=o("WAProtoConst")).TYPES.INT64],readTs:[2,e.TYPES.INT64]},u.name="StatusTsPerUserProto",u.internalSpec={userJid:[1,e.TYPES.STRING],dbUserStatusTs:[2,e.TYPES.MESSAGE,s]},c.name="IdentitiesPerDeviceProto",c.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},d.name="RetryCountPerDeviceProto",d.internalSpec={deviceJid:[1,e.TYPES.STRING],count:[2,e.TYPES.INT32]},m.name="ReceiptsTableSchemaProto",m.internalSpec={msgId:[1,e.TYPES.STRING],statusTsPerUser:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],permittedIdentitiesPerDevice:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],recipientDevices:[4,e.FLAGS.REPEATED|e.TYPES.STRING],retryCountsPerDevice:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],waMsgId:[6,e.TYPES.STRING]},p.name="Receipts",p.internalSpec={device:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64]},_.name="PendingReceiptsTableSchemaProto",_.internalSpec={pendingReceiptId:[1,e.TYPES.STRING],thread:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],deliveryReceipts:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p],readReceipts:[6,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p]},l.DbUserStatusTsProtoSpec=s,l.StatusTsPerUserProtoSpec=u,l.IdentitiesPerDeviceProtoSpec=c,l.RetryCountPerDeviceProtoSpec=d,l.ReceiptsTableSchemaProtoSpec=m,l.ReceiptsSpec=p,l.PendingReceiptsTableSchemaProtoSpec=_}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReceiverFetchInfoTableSchemaProto",s.internalSpec={mimetype:[1,(e=o("WAProtoConst")).TYPES.STRING],previewHeight:[2,e.TYPES.UINT32],previewWidth:[3,e.TYPES.UINT32],receiverFetchId:[4,e.TYPES.STRING],type:[5,e.TYPES.STRING],previewUrl:[6,e.TYPES.STRING],previewUrlExpirationTimestampMs:[7,e.TYPES.UINT64],accessibilitySummaryText:[8,e.TYPES.STRING]},l.ReceiverFetchInfoTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="SyncActionsTableSchemaProto",s.internalSpec={index:[1,(e=o("WAProtoConst")).TYPES.STRING],binarySyncData:[2,e.TYPES.BYTES],actionState:[3,e.TYPES.STRING],version:[4,e.TYPES.INT32],keyId:[5,e.TYPES.BYTES],modelId:[6,e.TYPES.STRING],modelType:[7,e.TYPES.STRING],indexMac:[8,e.TYPES.BYTES],valueMac:[9,e.TYPES.BYTES],collection:[10,e.TYPES.STRING],timestamp:[11,e.TYPES.INT64],action:[12,e.TYPES.STRING]},l.SyncActionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="SyncKeyFingerprint",s.internalSpec={currentIndex:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.INT32],rawId:[3,e.TYPES.INT64]},u.name="SyncKeysTableSchemaProto",u.internalSpec={id:[1,e.TYPES.BYTES],keyId:[2,e.TYPES.BYTES],keyData:[3,e.TYPES.BYTES],keyEpoch:[4,e.TYPES.INT64],timestamp:[5,e.TYPES.INT64],fingerprint:[6,e.TYPES.MESSAGE,s]},l.SyncKeyFingerprintSpec=s,l.SyncKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e={};e.name="TasksTableSchemaProto",e.internalSpec={taskName:[1,o("WAProtoConst").TYPES.STRING],scheduledTime:[2,o("WAProtoConst").TYPES.INT64]},l.TasksTableSchemaProtoSpec=e}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ThreadsTableSchemaProto",s.internalSpec={jid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadOrder:[2,e.TYPES.STRING],folder:[4,e.TYPES.INT32],newestMsg:[5,e.TYPES.STRING],oldestMsg:[6,e.TYPES.STRING],lastReadMsg:[7,e.TYPES.STRING],lastReadMsgReceiptSent:[8,e.TYPES.STRING],lastReadMsgTs:[9,e.TYPES.INT64],newestMsgTs:[10,e.TYPES.INT64],muteExpireTimeMs:[11,e.TYPES.INT64],muteCallsExpireTimeMs:[12,e.TYPES.INT64],archived:[13,e.TYPES.BOOL],cannotReplyReason:[14,e.TYPES.STRING],chatId:[15,e.TYPES.INT32],optimisticThreadKey:[16,e.TYPES.STRING],isMigratedLocally:[17,e.TYPES.BOOL],snippetMsg:[18,e.TYPES.STRING],deduplicationKey:[19,e.TYPES.STRING],authoritativeThreadKey:[20,e.TYPES.STRING],snippetMsgTs:[21,e.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,e.TYPES.BOOL],unbumpFromTs:[23,e.TYPES.INT64],unbumpToTs:[24,e.TYPES.INT64]},l.ThreadsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="UnrenderedMessagesTableSchemaProto",s.internalSpec={type:[1,(e=o("WAProtoConst")).TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],ephemeralSetting:[8,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,e.TYPES.INT64],rowId:[10,e.TYPES.INT32],thread:[11,e.TYPES.INT32],mediaId:[12,e.TYPES.INT32],msgContent:[13,e.TYPES.STRING],threadJid:[14,e.TYPES.STRING],reportingMeta:[15,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,e.TYPES.STRING],groupName:[17,e.TYPES.STRING],quote:[18,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,e.TYPES.INT32],sortOrderMs:[20,e.TYPES.INT64]},l.UnrenderedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="XMATableSchemaProto",s.internalSpec={associatedMessageId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],ctas:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],defaultCTA:[4,e.TYPES.MESSAGE,u],defaultPreviewMediaId:[5,e.TYPES.INT32],externalId:[6,e.TYPES.STRING],faviconMediaId:[7,e.TYPES.INT32],headerMediaId:[8,e.TYPES.INT32],headerTitle:[9,e.TYPES.STRING],isTombstoned:[10,e.TYPES.BOOL],maxSubtitleNumOfLines:[11,e.TYPES.INT32],maxTitleNumOfLines:[12,e.TYPES.INT32],msgId:[13,e.TYPES.STRING],overlayDescription:[14,e.TYPES.STRING],overlayIconGlyph:[15,e.TYPES.INT32],overlayTitle:[16,e.TYPES.STRING],previewMediaIds:[17,e.FLAGS.REPEATED|e.TYPES.INT32],subtitleText:[18,e.TYPES.STRING],targetExpiringAtSec:[19,e.TYPES.INT64],targetId:[20,e.TYPES.STRING],targetType:[21,e.TYPES.INT32],targetUsername:[22,e.TYPES.STRING],threadJid:[23,e.TYPES.STRING],titleText:[24,e.TYPES.STRING],xmaId:[25,e.TYPES.INT32],xmaLayoutType:[26,e.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,e.TYPES.STRING],faviconPlaintextHash:[28,e.TYPES.STRING],headerMediaPlaintextHash:[29,e.TYPES.STRING]},u.name="CTAProto",u.internalSpec={buttonType:[1,e.TYPES.INT32],title:[2,e.TYPES.STRING],actionUrl:[3,e.TYPES.STRING],nativeUrl:[4,e.TYPES.STRING],ctaType:[5,e.TYPES.STRING]},l.XMATableSchemaProtoSpec=s,l.CTAProtoSpec=u}),98);
__d("MAWXMACTAUtil",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}function l(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}i.toMAWCTAEncode=e,i.fromMAWCTAEncode=l}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum")({SET:0,REMOVE:1}),u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={};u.name="SyncdVersion",u.internalSpec={version:[1,(e=o("WAProtoConst")).TYPES.UINT64]},c.name="ExitCode",c.internalSpec={code:[1,e.TYPES.UINT64],text:[2,e.TYPES.STRING]},d.name="SyncdIndex",d.internalSpec={blob:[1,e.TYPES.BYTES]},m.name="SyncdValue",m.internalSpec={blob:[1,e.TYPES.BYTES]},p.name="KeyId",p.internalSpec={id:[1,e.TYPES.BYTES]},_.name="SyncdRecord",_.internalSpec={index:[1,e.TYPES.MESSAGE,d],value:[2,e.TYPES.MESSAGE,m],keyId:[3,e.TYPES.MESSAGE,p]},f.name="ExternalBlobReference",f.internalSpec={mediaKey:[1,e.TYPES.BYTES],directPath:[2,e.TYPES.STRING],handle:[3,e.TYPES.STRING],fileSizeBytes:[4,e.TYPES.UINT64],fileSha256:[5,e.TYPES.BYTES],fileEncSha256:[6,e.TYPES.BYTES]},g.name="SyncdSnapshot",g.internalSpec={version:[1,e.TYPES.MESSAGE,u],records:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],mac:[3,e.TYPES.BYTES],keyId:[4,e.TYPES.MESSAGE,p]},h.name="SyncdMutations",h.internalSpec={mutations:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},y.name="SyncdMutation",y.internalSpec={operation:[1,e.TYPES.ENUM,s],record:[2,e.TYPES.MESSAGE,_]},C.name="SyncdPatch",C.internalSpec={version:[1,e.TYPES.MESSAGE,u],mutations:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y],externalMutations:[3,e.TYPES.MESSAGE,f],snapshotMac:[4,e.TYPES.BYTES],patchMac:[5,e.TYPES.BYTES],keyId:[6,e.TYPES.MESSAGE,p],exitCode:[7,e.TYPES.MESSAGE,c],deviceIndex:[8,e.TYPES.UINT32],clientDebugData:[9,e.TYPES.BYTES]},l.SyncdMutation$SyncdOperation=s,l.SyncdVersionSpec=u,l.ExitCodeSpec=c,l.SyncdIndexSpec=d,l.SyncdValueSpec=m,l.KeyIdSpec=p,l.SyncdRecordSpec=_,l.ExternalBlobReferenceSpec=f,l.SyncdSnapshotSpec=g,l.SyncdMutationsSpec=h,l.SyncdMutationSpec=y,l.SyncdPatchSpec=C}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e={appData:function(t){return I(t)},appMeta:function(t){return T(t)},chunk:function(t){return D(t)},collectionVersions:function(t){return O(t)},deletedMessages:function(t){return _(t)},deviceChangeAlerts:function(t){return u(t)},dualSendMedia:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(t){return N(t)},ebMessageRestoreTasks:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(t){return M(t)},ebRestoreQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(t){return q(t)},encryptionMetaV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(t){return h(t)},groupInvites:function(t){return L(t)},historySyncQRCodeData:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(t){return $(t)},mediaBackup:function(t){return x(t)},mediaKeys:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(t){return p(t)},missingKeys:function(t){return A(t)},participants:function(t){return R(t)},pendingMessageStanzaQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(t){return F(t)},pendingReceipts:function(t){return v(t)},pendingStanzas:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(t){return k(t)},poll:function(t){return V(t)},reactions:function(t){return P(t)},receipts:function(t){return b(t)},receiverFetchInfo:function(t){return U(t)},sentBytesCache:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(t){return w(t)},syncKeys:function(t){return B(t)},tasks:function(t){return E(t)},threads:function(t){return S(t)},unrenderedMessages:function(t){return f(t)},xma:function(t){return W(t)}};function s(t,n){var o=null;if(Object.prototype.hasOwnProperty.call(e,n))o=e[n](t);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return o}function u(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,e);return{action:t.action,deviceJid:t.deviceJid,identity:t.identity,isArchived:t.isArchived,latitude:t.latitude,location:t.location,loggedOut:t.loggedOut,longitude:t.longitude,model:t.model,platform:t.platform,ts:t.ts}}function c(e){var t=e.quote,n;if(t!=null){if(t.content==null)throw r("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var o=t.content,a=o.author,i=o.expirationTs,l=o.externalId,s=o.mediaId,u=o.msgContent,c=o.msgId,d=o.plaintextHash,m=o.sourceId,p=o.specialTextSize,_=o.ts,f=o.type,g=o.xmaMessageType;n={content:babelHelpers.extends({},t.content,{author:a,expirationTs:i,externalId:l,mediaId:s,msgContent:u,msgId:c,plaintextHash:d,sourceId:m,specialTextSize:p,ts:_,type:f,xmaMessageType:g}),remoteJid:t.remoteJid}}return n}function d(e){return e==null?e:new Uint8Array(e)}function m(e){return e==null||e.length===0?new Set:new Set(e)}function p(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,e),n=t.msgContent;if(t.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");n.subtype=n.subtype}var a=c(t),i=g(t.reportingMeta);return babelHelpers.extends({},t,{msgContent:n,quote:a,reportingMeta:i})}function _(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,e);return babelHelpers.extends({},t)}function f(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,e),n=c(t),r=g(t.reportingMeta);return babelHelpers.extends({},t,{quote:n,reportingMeta:r})}function g(e){if(e!=null)return{frankingKey:e.frankingKey!=null?new Uint8Array(e.frankingKey):e.frankingKey,frankingTag:e.frankingTag!=null?new Uint8Array(e.frankingTag):e.frankingTag,frankingVersion:e.frankingVersion,reportingContent:e.reportingContent,reportingTag:e.reportingTag!=null?new Uint8Array(e.reportingTag):e.reportingTag}}function h(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,e);return{creationTs:t.creationTs,creator:t.creator,inviter:t.inviter,memberAddMode:t.memberAddMode,msgExpiration:t.msgExpiration,name:t.name,nameOwner:t.nameOwner,nameTs:t.nameTs,participantVersion:t.participantVersion}}function y(e){return e.length===0?null:new Map(e.map(function(e){var t=e.deviceJid;if(t==null||e.serializedPubKey==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var n=new Uint8Array(e.serializedPubKey),o=d(e.baseKey),a={baseKey:o,pubKey:n};return[t,a]}))}function C(e){return e==null?null:new Map(e.map(function(e){var t;if(e.deviceJid==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[e.deviceJid,(t=e.count)!=null?t:0]}))}function b(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,e),n=t.recipientDevices,r=m(n);return{permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:r,retryCountsPerDevice:C(t.retryCountsPerDevice)}}function v(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,e)}function S(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,e);return{archived:t.archived,cannotReplyReason:t.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:t.didInsertDualThreadCutoverAdminMsg,folder:t.folder,isMigratedLocally:t.isMigratedLocally,lastReadMsg:t.lastReadMsg,lastReadMsgReceiptSent:t.lastReadMsgReceiptSent,muteCallsExpireTimeMs:t.muteCallsExpireTimeMs,muteExpireTimeMs:t.muteExpireTimeMs,newestMsg:t.newestMsg,newestMsgTs:t.newestMsgTs,oldestMsg:t.oldestMsg,optimisticThreadKey:t.optimisticThreadKey,snippetMsg:t.snippetMsg,snippetMsgTs:t.snippetMsgTs}}function R(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,e)}function L(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,e)}function E(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,e)}function k(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,e),n=t.hasSenderKey,r=m(n);return{hasSenderKey:r,rotateSenderKey:t.rotateSenderKey,senderKeyId:t.senderKeyId,senderKeyTs:t.senderKeyTs}}function I(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e);return{ack:t.ack,contents:t.contents,permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:new Set(t.recipientDevices),sendPartial:t.sendPartial,ts:t.ts}}function T(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,e)}function D(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,e)}function x(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,e)}function $(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,e),n,a=t.mediaEntries;return a==null?n=new Map:n=new Map(a.map(function(e){if(e.msgId==null||e.mediaEntryData==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[e.msgId,new Uint8Array(e.mediaEntryData)]})),{accessibilitySummaryText:t.accessibilitySummaryText,isVideoGif:t.isVideoGif,mediaEntries:n,mediaType:t.mediaType,plaintextHash:t.plaintextHash,size:t.size,ts:t.ts,validatedAudioInfo:t.validatedAudioInfo,validatedDocumentFileInfo:t.validatedDocumentFileInfo,validatedImageInfo:t.validatedImageInfo,validatedResult:t.validatedResult,validatedVideoInfo:t.validatedVideoInfo}}function P(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,e);return t.ts!=null&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"}),babelHelpers.extends({ack:t.ack,author:t.author,groupingKey:t.groupingKey,reaction:t.reaction,reactToAuthor:t.reactToAuthor,senderTimestampMs:t.senderTimestampMs},t.ts!=null?{ts:t.ts}:{})}function N(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,e);return{isThread:t.isThread,numMessages:t.numMessages,numMessagesRestored:t.numMessagesRestored,numThreadsRestored:t.numThreadsRestored,oldestTs:t.oldestTs,qplFlowDescriptor:t.qplFlowDescriptor,qplInstanceKeyE2E:t.qplInstanceKeyE2E,qplInstanceKeyForThread:t.qplInstanceKeyForThread,threadId:t.threadId}}function M(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,e);return{creationTime:t.creationTime,maxMsgExternalId:t.maxMsgExternalId,maxMsgSortOrderMs:t.maxMsgSortOrderMs,minMsgExternalId:t.minMsgExternalId,minMsgSortOrderMs:t.minMsgSortOrderMs}}function w(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,e);return{binarySyncData:t.binarySyncData,keyId:t.keyId,timestamp:t.timestamp,valueMac:t.valueMac,version:t.version}}function A(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,e),n;return t.deviceResponses==null?n=new Map:n=new Map(t.deviceResponses.map(function(e){if(e.deviceId==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");return[e.deviceId,e.deviceResponse]})),{deviceResponses:n,keyId:t.keyId,timestamp:t.timestamp}}function F(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,e),n;switch(t.operation){case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw r("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:t.binarySyncAction,operation:n,timestamp:t.timestamp,version:t.version}}function O(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,e);return{finiteFailureStartTime:t.finiteFailureStartTime,isCollectionInMacMismatchFatal:t.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:t.isCollectionLthashInconsistent,ltHash:t.ltHash,state:t.state,version:t.version}}function B(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,e);return{fingerprint:t.fingerprint,keyData:t.keyData,timestamp:t.timestamp}}function W(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,e);return{author:t.author,ctas:t.ctas.map(function(e){return o("MAWXMACTAUtil").fromMAWCTAEncode(e)}),defaultCTA:t.defaultCTA==null?t.defaultCTA:o("MAWXMACTAUtil").fromMAWCTAEncode(t.defaultCTA),defaultPreviewMediaPlaintextHash:t.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:t.faviconPlaintextHash,headerMediaPlaintextHash:t.headerMediaPlaintextHash,headerTitle:t.headerTitle,isTombstoned:t.isTombstoned,maxSubtitleNumOfLines:t.maxSubtitleNumOfLines,maxTitleNumOfLines:t.maxTitleNumOfLines,msgId:t.msgId,overlayDescription:t.overlayDescription,overlayIconGlyph:t.overlayIconGlyph,overlayTitle:t.overlayTitle,previewMediaIds:t.previewMediaIds,subtitleText:t.subtitleText,targetId:t.targetId,targetType:t.targetType,targetUsername:t.targetUsername,threadJid:t.threadJid,titleText:t.titleText,xmaLayoutType:t.xmaLayoutType}}function q(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,e);return{author:t.author,editExternalId:t.editExternalId,editTs:t.editTs,msgContent:t.msgContent,sendStatus:t.sendStatus,specialTextSize:t.specialTextSize}}function U(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,e);return{accessibilitySummaryText:t.accessibilitySummaryText,mimetype:t.mimetype,previewHeight:t.previewHeight,previewUrl:t.previewUrl,previewUrlExpirationTimestampMs:t.previewUrlExpirationTimestampMs,previewWidth:t.previewWidth,type:t.type}}function V(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,e),n=new Map(t.pollOptions.map(function(e){var t=e.pollOptionHash;if(t==null||e.pollOption==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[t,{optionText:e.pollOption.optionText,voteAuthors:new Set(e.pollOption.voteAuthors)}]}).filter(Boolean)),a=new Map(t.latestSenderTimestampsMs.map(function(e){if(e.author==null||e.latestSenderTimestampMs==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[e.author,e.latestSenderTimestampMs]}));return{encKey:t.encKey,latestSenderTimestampsMs:a,pollAuthor:t.pollAuthor,pollOptions:n,pollParticipantCount:t.pollParticipantCount,pollState:t.pollState,selectableOptionsCount:t.selectableOptionsCount,title:t.title}}l.decodeDbObj=s}),98);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],s=["author","chat","externalId","rowId"],u={appData:k,appMeta:I,chunk:T,deletedMessages:_,deviceChangeAlerts:c,dualSendMedia:d,dyiBatch:P,ebMessageRestoreTasks:d,ebMsgRanges:N,ebRestoreQueue:d,ebUploadQueue:d,editMsgHistory:w,encryptionMetaV3:d,ephemeralSettings:d,existingUsers:d,ftsBackloggedMessages:d,ftsEncryptionMeta:d,ftsIndexV3:d,ftsPurgeBacklog:d,ftsPurgeThreadBacklog:d,groupInfo:g,groupInvites:R,historySyncQRCodeData:d,historySyncQRCodeSecretKey:d,igMessageAuxiliaryInfo:d,isDualSend:d,media:x,mediaBackup:D,mediaKeys:d,messages:p,participants:S,pendingMessageStanzaQueue:d,pendingReceipts:b,pendingStanzas:d,personalSenderKeyStatuses:E,poll:F,reactions:$,receipts:C,receiverFetchInfo:A,sentBytesCache:d,staleQueue:d,tasks:L,threads:v,unrenderedMessages:f,xma:M};function c(e){var t={action:e.action,deviceJid:e.deviceJid,identity:e.identity,isArchived:e.isArchived,latitude:e.latitude,location:e.location,loggedOut:e.loggedOut,longitude:e.longitude,model:e.model,platform:e.platform,ts:e.ts};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,t).readByteArrayView()}}function d(e){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function m(e,t){var n=null;if(Object.prototype.hasOwnProperty.call(u,t))n=u[t](e);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return n}function p(t){var n=t.ack,r=t.altIndex,a=t.collapsibleId,i=t.externalId,l=t.messageDeleteTs,s=t.messageExpirationTs,u=t.msgId,c=t.pollStanzaId,d=t.protocolMsgId,m=t.quoteExpirationTs,p=t.quoteExternalId,_=t.revokedExternalId,f=t.rowId,g=t.serverTs,h=t.sortOrderMs,y=t.threadJid,C=t.unsendMsgContentDeleteTs,b=babelHelpers.objectWithoutPropertiesLoose(t,e),v=b,S;if(v.quote==null)S=v.quote;else{var R,L={author:v.quote.content.author,expirationTs:v.quote.content.expirationTs,externalId:(R=v.quote)==null?void 0:R.content.externalId,mediaId:v.quote.content.mediaId,msgContent:v.quote.content.msgContent,msgId:v.quote.content.msgId,plaintextHash:v.quote.content.plaintextHash,sourceId:v.quote.content.sourceId,specialTextSize:v.quote.content.specialTextSize,ts:v.quote.content.ts,type:v.quote.content.type,xmaMessageType:v.quote.content.xmaMessageType},E={content:L,remoteJid:v.quote.remoteJid};S=E}var k=v.msgContent;v.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(k={protobuf:v.msgContent.protobuf,subtype:v.msgContent.subtype});var I=v.ravenEphemeralType,T=v.ravenEphemeralMediaState,D=I!=null?I:null,x=T!=null?T:null,$={applicationErrorCode:v.applicationErrorCode,author:v.author,editCount:v.editCount,ephemeralCounterStarted:v.ephemeralCounterStarted,ephemeralMsgDisappeared:v.ephemeralMsgDisappeared,ephemeralSetting:v.ephemeralSetting,forwardingScore:v.forwardingScore,groupId:v.groupId,groupIndex:v.groupIndex,groupSize:v.groupSize,hdType:v.hdType,isCollapsed:v.isCollapsed,isExpiredXmaMsg:v.isExpiredXmaMsg,isForwarded:v.isForwarded,mediaId:v.mediaId,msgContent:k,originalTs:v.originalTs,quote:S,ravenEphemeralMediaState:x,ravenEphemeralType:D,receiverFetchId:v.receiverFetchId,reportingMeta:v.reportingMeta,resendCount:v.resendCount,source:v.source,specialTextSize:v.specialTextSize,ts:v.ts,type:v.type,xmaMessageType:v.xmaMessageType};return{encodedFields:$,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,$).readByteArrayView()}}function _(e){var t=e.author,n=e.chat,r=e.externalId,a=e.rowId,i=babelHelpers.objectWithoutPropertiesLoose(e,s),l={reason:String(i.reason)};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,l).readByteArrayView()}}function f(e){var t;if(e.quote==null)t=e.quote;else{var n,r={author:e.quote.content.author,expirationTs:e.quote.content.expirationTs,externalId:(n=e.quote)==null?void 0:n.content.externalId,mediaId:e.quote.content.mediaId,msgContent:e.quote.content.msgContent,msgId:e.quote.content.msgId,plaintextHash:e.quote.content.plaintextHash,sourceId:e.quote.content.sourceId,ts:e.quote.content.ts,type:e.quote.content.type,xmaMessageType:e.quote.content.xmaMessageType},a={content:r,remoteJid:e.quote.remoteJid};t=a}var i={ack:e.ack,author:e.author,ephemeralSetting:e.ephemeralSetting,groupName:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,mediaId:e.mediaId,msgContent:e.msgContent,quote:t,reportingMeta:e.reportingMeta,resendCount:e.resendCount,ts:e.ts,type:e.type,xmaMessageType:e.xmaMessageType};return{encodedFields:i,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,i).readByteArrayView()}}function g(e){var t={creationTs:e.creationTs,creator:e.creator,inviter:e.inviter,memberAddMode:e.memberAddMode,msgExpiration:e.msgExpiration,name:e.name,nameOwner:e.nameOwner,nameTs:e.nameTs,participantVersion:e.participantVersion};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,t).readByteArrayView()}}function h(e){return e==null?e:Array.from(e,function(e){var t=e[0],n=e[1];return{baseKey:n.baseKey,deviceJid:t,serializedPubKey:n.pubKey}})}function y(e){return e==null?null:Array.from(e,function(e){var t=e[0],n=e[1];return{count:n,deviceJid:t}})}function C(e){var t=Array.from(e.recipientDevices),n={permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:t,retryCountsPerDevice:y(e.retryCountsPerDevice)};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,n).readByteArrayView()}}function b(e){var t={author:e.author,deliveryReceipts:e.deliveryReceipts,externalId:e.externalId,readReceipts:e.readReceipts,thread:e.thread};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,t).readByteArrayView()}}function v(e){var t={archived:e.archived,cannotReplyReason:e.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:e.didInsertDualThreadCutoverAdminMsg,folder:e.folder,isMigratedLocally:e.isMigratedLocally,lastReadMsg:e.lastReadMsg,lastReadMsgReceiptSent:e.lastReadMsgReceiptSent,newestMsgTs:e.newestMsgTs,oldestMsg:e.oldestMsg,optimisticThreadKey:e.optimisticThreadKey,snippetMsg:e.snippetMsg,snippetMsgTs:e.snippetMsgTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,t).readByteArrayView()}}function S(e){var t={addressable:e.addressable,deliveredWatermarkTs:e.deliveredWatermarkTs,lastReadActionTs:e.lastReadActionTs,lastReadWatermarkTs:e.lastReadWatermarkTs,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,t).readByteArrayView()}}function R(e){var t={caption:e.caption,inviteCode:e.inviteCode,inviteExpirationTs:e.inviteExpirationTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,t).readByteArrayView()}}function L(e){var t={scheduledTime:e.scheduledTime};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,t).readByteArrayView()}}function E(e){var t=Array.from(e.hasSenderKey),n={hasSenderKey:t,rotateSenderKey:e.rotateSenderKey,senderKeyId:e.senderKeyId,senderKeyTs:e.senderKeyTs};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,n).readByteArrayView()}}function k(e){var t;switch(e.contents.type){case"meta_sync":{var n=[];for(var a of e.contents.actions)a.chatAction?n.push({chatAction:a.chatAction}):a.messageAction&&n.push({messageAction:a.messageAction});t={actions:n,type:"meta_sync"};break}case"backups_secrets":{t={encryptedBackupsSecrets:e.contents.encryptedBackupsSecrets,type:"backups_secrets"};break}case"sync_key_share":{var i;t={syncKeyShare:{keys:e.contents.syncKeyShare.keys,orphanKeys:(i=e.contents.syncKeyShare)==null||(i=i.orphanKeys)==null?void 0:i.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break}case"sync_key_request":{t={syncKeyRequest:{keyIds:e.contents.syncKeyRequest.keyIds.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break}default:throw e.contents.type,r("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+e.contents.type)}var l={ack:e.ack,contents:t,permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:Array.from(e.recipientDevices),sendPartial:e.sendPartial,ts:e.ts};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,l).readByteArrayView()}}function I(e){var t={value:e.value};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,t).readByteArrayView()}}function T(e){var t={blobData:e.blobData,mimetype:e.mimetype,plaintextHash:e.plaintextHash};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,t).readByteArrayView()}}function D(e){var t={fbid:e.fbid};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,t).readByteArrayView()}}function x(e){var t=Array.from(e.mediaEntries,function(e){var t=e[0],n=e[1];return{mediaEntryData:n,msgId:t}}),n={accessibilitySummaryText:e.accessibilitySummaryText,isVideoGif:e.isVideoGif,mediaEntries:t,mediaType:e.mediaType,plaintextHash:e.plaintextHash,size:e.size,ts:e.ts,validatedAudioInfo:e.validatedAudioInfo,validatedDocumentFileInfo:e.validatedDocumentFileInfo,validatedImageInfo:e.validatedImageInfo,validatedResult:e.validatedResult,validatedVideoInfo:e.validatedVideoInfo};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,n).readByteArrayView()}}function $(e){var t={ack:e.ack,author:e.author,groupingKey:e.groupingKey,reaction:e.reaction,reactToAuthor:e.reactToAuthor,senderTimestampMs:e.senderTimestampMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,t).readByteArrayView()}}function P(e){var t={isThread:e.isThread,numMessages:e.numMessages,numMessagesRestored:e.numMessagesRestored,numThreadsRestored:e.numThreadsRestored,oldestTs:e.oldestTs,qplFlowDescriptor:e.qplFlowDescriptor,qplInstanceKeyE2E:e.qplInstanceKeyE2E,qplInstanceKeyForThread:e.qplInstanceKeyForThread,threadId:e.threadId};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,t).readByteArrayView()}}function N(e){var t={creationTime:e.creationTime,maxMsgExternalId:e.maxMsgExternalId,maxMsgSortOrderMs:e.maxMsgSortOrderMs,minMsgExternalId:e.minMsgExternalId,minMsgSortOrderMs:e.minMsgSortOrderMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,t).readByteArrayView()}}function M(e){var t=e.ctas==null?[]:e.ctas.map(function(e){return o("MAWXMACTAUtil").toMAWCTAEncode(e)}),n={author:e.author,ctas:t,defaultCTA:e.defaultCTA==null?e.defaultCTA:o("MAWXMACTAUtil").toMAWCTAEncode(e.defaultCTA),defaultPreviewMediaPlaintextHash:e.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:e.faviconPlaintextHash,headerMediaPlaintextHash:e.headerMediaPlaintextHash,headerTitle:e.headerTitle,isTombstoned:e.isTombstoned,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines,maxTitleNumOfLines:e.maxTitleNumOfLines,msgId:e.msgId,overlayDescription:e.overlayDescription,overlayIconGlyph:e.overlayIconGlyph,overlayTitle:e.overlayTitle,previewMediaIds:e.previewMediaIds,subtitleText:e.subtitleText,targetId:e.targetId,targetType:e.targetType,targetUsername:e.targetUsername,threadJid:e.threadJid,titleText:e.titleText,xmaLayoutType:e.xmaLayoutType};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,n).readByteArrayView()}}function w(e){var t={author:e.author,editExternalId:e.editExternalId,editTs:e.editTs,msgContent:e.msgContent,sendStatus:e.sendStatus,specialTextSize:e.specialTextSize};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,t).readByteArrayView()}}function A(e){var t={accessibilitySummaryText:e.accessibilitySummaryText,mimetype:e.mimetype,previewHeight:e.previewHeight,previewUrl:e.previewUrl,previewUrlExpirationTimestampMs:e.previewUrlExpirationTimestampMs,previewWidth:e.previewWidth,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,t).readByteArrayView()}}function F(e){var t=Array.from(e.pollOptions,function(e){var t=e[0],n=e[1];return{pollOption:{optionText:n.optionText,voteAuthors:Array.from(n.voteAuthors)},pollOptionHash:t}}),n=Array.from(e.latestSenderTimestampsMs,function(e){var t=e[0],n=e[1];return{author:t,latestSenderTimestampMs:n}}),r={encKey:e.encKey,latestSenderTimestampsMs:n,pollAuthor:e.pollAuthor,pollOptions:t,pollParticipantCount:e.pollParticipantCount,pollState:e.pollState,selectableOptionsCount:e.selectableOptionsCount,title:e.title};return{encodedFields:r,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,r).readByteArrayView()}}l.encodeDbObj=m,l.encodeDbPollForEncryption=F}),98);
__d("MAWMpsMigrationRunningState",[],(function(t,n,r,o,a,i){"use strict";var e=!1;function l(){return e}function s(t){e=t}i.isMawMpsMigrationRunning=l,i.setIsMawMpsMigrationRunning=s}),66);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWMpsMigrationRunningState","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","pageID","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u="_encryptedContent",c=new Set(["threads","messages","participants"]);function d(e,t,n){if(!(r("isEncryptionAtRestEnabled")()||r("gkx")("23910")===!0)||!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(t))return e;var a=o("MAWQplProxy").startQplUserFlow(r("qpl")._(25300256,"115"),{bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:t}});try{var i=babelHelpers.extends({},e),l=n(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear"),d=l.keys,m=d[0],p=l.version,_=l.randomisedVersion;o("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&r("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",t,o("MAWDexieTable").getDexiePSDItem("transactorName")),a.addAnnotations({int:{keyVersion:p,randomisedVersion:_}});var f=o("MAWKeychainUtil").makeAAD(p,o("MAWCryptoConsts").CIPHER_ID),g=o("MAWDbObjEncode").encodeDbObj(e,t),h=g.encodedFields,y=g.proto;Object.keys(h).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&delete i[t]});var C=o("MAWDbEncryptObjContent").encryptContent(m,y,f);return i[u]=C,c.has(t)&&(i.updatedAt_S456130=Date.now(),i.randomisedVersion_S456130=_,i.encryptedWith_S456130=o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",i.keyVersion_S456130=p),a==null||a.endSuccess(),i}catch(e){var b=r("getErrorSafe")(e);throw a==null||a.endFail("ear_encrypt_fail"),r("FBLogger")("messenger_web").catching(b).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",b.name,b.message,t)}}function m(t,n,a){if(!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(n)||!Object.prototype.hasOwnProperty.call(t,u))return t;var i=(s||(s=r("ExecutionEnvironment"))).isInMainThread?null:o("MAWQplProxy").startQplUserFlow(r("qpl")._(25313004,"118"));i==null||i.addAnnotations({bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:n}});var l;try{var d=t[u],m=babelHelpers.extends({},t);(e||(e=o("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+n+"."+(d instanceof ArrayBuffer?"ArrayBuffer":"string"));var f=d instanceof ArrayBuffer?d:o("WABase64").decodeB64(d),g=o("MAWKeychainCrypto").getKeyVersionFromCipherDataString(f),h=g.aadLengthInBytes,y=g.keyVersion,C=a(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",y);l=C;var b=C.dbEntry,v=C.keys,S=C.randomisedVersion;i==null||i.addAnnotations({int:{contentVersion:t==null?void 0:t.keyVersion_S456130,keyVersion:y,randomisedVersion:S},string:{encryptedWith:t==null?void 0:t.encryptedWith_S456130,randomisedVersionEncryption:t==null?void 0:t.randomisedVersion_S456130}});var R={},L,E;for(var k of v)try{L=o("MAWKeychainNaClCrypto").decryptArrayBuffer(k,f,y,b.formatVersion,h);break}catch(e){E=e}if(L==null)throw r("getErrorSafe")(E);var I=o("MAWDbObjDecode").decodeDbObj(L,n);Object.keys(I).forEach(function(e){R[e]=I[e]}),delete m[u];var T=babelHelpers.extends({},m,R);return i==null||i.endSuccess(),T}catch(e){var D,x,$;if(c.has(n)){var P;i==null||i.addAnnotations({int:{updatedAt:(P=t==null?void 0:t.updatedAt_S456130)!=null?P:-1}})}if((e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&o("MAWMpsMigrationRunningState").isMawMpsMigrationRunning()){i==null||i.addAnnotations({bool:{earDecryptionErrorSuppressed:!0}}),r("FBLogger")("messenger_web").mustfix("[EAR] Ignoring EAR decryption error during MAW->MPS migration. Table: %s.",n);return}(s||(s=r("ExecutionEnvironment"))).isInWorker&&(e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(r("FBLogger")("messenger_web").mustfix("[EAR] Encountered EAR Error - submitting unrecoverableDbError. Table: %s.",n),i==null||i.addAnnotations({bool:{unrecoverableDbError:!0}}),o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError}));var N=r("getErrorSafe")(e);throw i==null||i.markError("ear_decrypt_exception",null,N),i==null||i.endFail("ear_decrypt_fail"),r("FBLogger")("messenger_web").catching(N).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",N.name,N.message,n,p(t==null?void 0:t.updatedAt_S456130),_(t,l),(t==null?void 0:t.randomisedVersion_S456130)!=null&&((D=l)==null?void 0:D.randomisedVersion)!=null?t.randomisedVersion_S456130===l.randomisedVersion:null,(x=($=l)==null?void 0:$.dbEntry.source)!=null?x:"-1",o("MWEARKeychainV3").isKeychainSettled("maw_ear"),(s||(s=r("ExecutionEnvironment"))).isInWorker,t==null?void 0:t.encryptedWith_S456130,r("pageID"),o("MAWDexieTable").getDexiePSDItem("transactorName"))}}function p(e){if(e==null)return"unknown";var t=Date.now()-e,n=Math.floor(t/(1e3*60*60*24));return n<1?"0-1 days":n<7?"1-7 days":n<14?"7-14 days":n<30?"14-30 days":"30+ days"}function _(e,t){if((e==null?void 0:e.updatedAt_S456130)==null||t==null)return null;var n=o("WATimeUtils").castToUnixTime(e.updatedAt_S456130/1e3),r=t.dbEntry.expiration-o("MAWCryptoConsts").ENC_KEY_TTL;return n===r?"same":n>r?"key_older":"key_newer"}l.ENCRYPTED_COLUMN_NAME=u,l.encryptDbObj=d,l.decryptDbObj=m}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=o("MAWKeychainUtil").getBufferWithRandomValuesFromLength(o("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return c(e).then(function(e){return o("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",e)})}function s(e,t){var n=new TextEncoder().encode(e),a=new Uint8Array(t),i=r("tweetnacl-auth")(n,a);return o("WABase64").encodeB64UrlSafe(i)}function u(){return e().then(function(e){return o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(t){return function(){return o("MAWDbMsgTypeVersionTxns").getHMACKey(t).then(function(n){return n!=null?n:o("MAWDbMsgTypeVersionTxns").addHMACKey(t,e).then(function(){return e})})}})()})}function c(e){return o("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",e,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}l.genHMACKey=e,l.hmacTweetNaCl=s,l.generateAndInsertHMACKey=u}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMsgType","WAAsConsumerApplication","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){switch(t===void 0&&(t="media"),e){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return t==="xma-media"?"xma-image":"image";case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case o("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case o("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case o("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw r("FBLogger")("messenger_web").mustfixThrow("get a wrong media file with type %s",e)}}function s(e){try{return o("WABlobToArrayBuffer").blobToArrayBuffer(e).then(u)}catch(e){var t=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("Got %s when convert the blob to Uint8Array",t.message)}}function u(e){return self.crypto.subtle.digest("SHA-256",e).then(function(e){return new Uint8Array(e)})}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s(e),n=o("WAHashUtils").toPlaintextHash(t),r=_(n);return[n,r]}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u(e),n=o("WAHashUtils").toPlaintextHash(t);return n}),p.apply(this,arguments)}function _(e){var t=o("WAGlobals").getHMACKey();return o("WAHashUtils").toHashedPlaintextHash(o("MAWHMACKey").hmacTweetNaCl(e,t))}function f(e){if(e==null)return null;var t="preview-"+o("WATimeUtils").unixTime().toString()+".jpeg";return g(e,t,"image/jpeg")}function g(e,t,n){return new File([new Blob([new Uint8Array(e)],{type:n})],t,{type:n})}function h(e,t,n){var r=function(){return n!=null?o("MAWDexieTable").dexieResolve(n.filter(function(e){return e.type!==o("WAMsgType").REVOKED&&t.msgIds.includes(e.msgId)})):e.messages.where("msgId").anyOf(t.msgIds).filter(function(e){return e.type!==o("WAMsgType").REVOKED}).toArray()};return r().then(function(e){return C(t,e)})}function y(e){return e.reduce(function(e,t){var n=t.hdType;return n!=null&&(e[t.msgId]=n),e},{})}function C(e,t){var n=t.filter(function(t){return t.type!==o("WAMsgType").REVOKED&&e.msgIds.includes(t.msgId)}),a=n.map(function(e){return e.msgId}),i=babelHelpers.extends({},e,{msgIds:a}),l=n.reduce(function(e,t){return e[t.msgId]=o("WATimeUtils").castToMillisTime(t.sortOrderMs!=null?t.sortOrderMs:t.ts*1e3),e},{});if(i=babelHelpers.extends({},i,{messagesSortOrderMs:l}),n.every(function(e){return e.type===o("WAMsgType").STICKER})){var s=o("MAWImageUtils").boundHeightWidth(i.previewHeight,i.previewWidth,o("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE),u=s.height,c=s.width;i=babelHelpers.extends({},i,{mediaType:o("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:u,previewHeightLarge:u,previewWidth:c,previewWidthLarge:c})}var d=new Set(n.map(function(e){return e.type}));return d.forEach(function(t){t!==o("MAWMsgType").MSG_TYPE.RAVEN&&e.mediaType!==b(t)&&r("FBLogger")("messenger_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",t,e.mediaType)}),i}function b(e){switch(e){case o("MAWMsgType").MSG_TYPE.IMAGE:return o("MAWDbMedia").MEDIA_TYPE.IMAGE;case o("MAWMsgType").MSG_TYPE.VIDEO:return o("MAWDbMedia").MEDIA_TYPE.VIDEO;case o("MAWMsgType").MSG_TYPE.PTT:return o("MAWDbMedia").MEDIA_TYPE.PTT;case o("MAWMsgType").MSG_TYPE.GIF:return o("MAWDbMedia").MEDIA_TYPE.GIF;case o("MAWMsgType").MSG_TYPE.STICKER:return o("MAWDbMedia").MEDIA_TYPE.STICKER;case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}function v(e){var t,n,r=((t=e.ancillary)==null?void 0:t.gifPlayback)===!0,a=((n=e.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null?void 0:n.mimetype)===o("WAAsConsumerApplication").GIF_MIME_TYPE;return r&&a}l.getServerMediaTypeFromMediaType=e,l.hashBlob=s,l.hashArrayBuffer=u,l.genBlobHashes=c,l.genHashFromArrayBuffer=m,l.genHMACPlaintextHash=_,l.convertJpegThumbnailArrayBufferToFile=f,l.getBridgeMediaAnnotatedForDisplay=h,l.createHdTypesForBridgeMedia=y,l.annotateBridgeMediaForDisplay=C,l.getMediaTypeFromMsgType=b,l.isTransportLegacyGif=v}),98);
__d("mergeMaps",[],(function(t,n,r,o,a,i){"use strict";function e(){for(var e=new Map,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++)for(var a=n[o].keys(),i=void 0;!(i=a.next()).done;)e.set(i.value,n[o].get(i.value));return e}i.default=e}),66);
__d("MpsPreprocessor",["Promise","getSafeQplErrorMessage","mergeMaps"],(function(t,n,r,o,a,i,l){"use strict";var e=["errors"],s;function u(t,a){return function(r){var o=r.payloadList.map(function(e){return e.message.messageId});r.ctx.messageToQpl.all(o).addPoint(a+"_start");var l=r.errors,u=babelHelpers.objectWithoutPropertiesLoose(r,e),c=t(u);return c instanceof(s||(s=n("Promise")))?c.then(function(e){return i(e,l!=null?l:new Map)}):i(c,l!=null?l:new Map)};function i(e,t){var n=e.payloadList.map(function(e){return e.message.messageId});return e.ctx.messageToQpl.all(n).addPoint(a+"_end"),e.errors.entries().forEach(function(t){var n=t[0],r=t[1];e.ctx.messageToQpl.endFail(n,a.toLowerCase()+"-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r))}),babelHelpers.extends({},e,{errors:r("mergeMaps")(t,e.errors)})}}l.preprocessor=u}),98);
__d("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor",["MAWDbMsgTypeVersionTxns","MAWProtobufDeserializers","MpsPreprocessor","WAGlobals","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){e=t}var u=o("MpsPreprocessor").preprocessor((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.ctx,r=t.payloadList,a=new Map,i=[];for(var l of r){var s,u,c=l.directive,d=l.insertionSource,m=l.message,p=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(m.payload),_=(s=p.payload().proto)==null||(s=s.event)==null?void 0:s.deviceChange;if(_==null){i.push({directive:c,insertionSource:d,message:m});continue}if(((u=p.proto.metadata)==null?void 0:u.senderId)===o("WAGlobals").getMyUserJid()){n.messageToQpl.addPoint(m.messageId,"drop_security_alert_my_device"),n.messageToQpl.endSuccess(m.messageId);continue}e===null&&(e=yield o("MAWDbMsgTypeVersionTxns").getSecuritySettingForContactTxn()),e===!0?i.push({directive:c,insertionSource:d,message:m}):(n.messageToQpl.addPoint(m.messageId,"drop_security_alert_disabled"),n.messageToQpl.endSuccess(m.messageId))}return{ctx:n,errors:a,payloadList:i}});return function(e){return t.apply(this,arguments)}})(),"maybe_drop_security_alerts");l.setCachedShouldSaveSecurityAlert=s,l.MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor=u}),98);
__d("MAWMsgCleaner",["MAWLoggerUtils","MWFBLogger","Promise","WAAssertUnreachable","WAShiftTimer","WATimeUtils","WorkerScheduler","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="Unsend",m="Ephemeral",p="DeleteForMe",_="PendingStanza",f="Xma",g="IGDDM",h="Quote",y=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.MsgCleaner,o("MAWLoggerUtils").Tag.CleanerUpdate]),C={DELETE_FOR_ME:p,EPHEMERAL:m,IGDDM:g,PENDING_STANZA:_,QUOTE:h,UNSEND:d,XMA:f},b;function v(){return b==null&&(b=o("WorkerScheduler").makeScheduler("cleaner",{concurrency:1,maxTaskLimit:1,maxThrottleMs:8e3})),b}var S=(function(){function t(e,t){var n=this;this.$1=new(o("WAShiftTimer")).ShiftTimer(function(){r("promiseDone")(n.$2())}),this.getNextTs=e.getNextTs,this.removeExpired=e.removeExpired,this.cleanerType=t,this.purgeEnabled=e.purgeEnabled,this.$1.forceRunNow()}var a=t.prototype;return a.update=function(n){var t=R(this.cleanerType);y.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["","::update ",""])),t,n),this.$1.onOrBefore(o("WATimeUtils").cappedMillisecondsUntil(n))},a.$2=function(){var e=this,t=function(){if(!e.purgeEnabled())return(c||(c=n("Promise"))).resolve();var t=R(e.cleanerType);return y.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow"])),t),e.removeExpired().then(function(n){return n>0&&y.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow "," msgs' content cleaned"])),t,n),e.getNextTs()}).then(function(t){t!=null&&e.update(t)})};return this.$3!=null?(c||(c=n("Promise"))).resolve():(this.$3=v().task({fn:t,name:this.cleanerType,priority:o("WorkerScheduler").BACKGROUND_PRIORITY}),this.$3.run().finally(function(){e.$3=null}))},t})();function R(e){switch(e){case"Unsend":return"UnsendMsgCleaner";case"Ephemeral":return"EphemeralCleaner";case"DeleteForMe":return"DeleteForMeCleaner";case"PendingStanza":return"PendingStanzaCleaner";case"Xma":return"XmaCleaner";case"IGDDM":return"IGDDisappearingMsgCleaner";case"Quote":return"QuoteCleaner";default:return r("WAAssertUnreachable")(e)}}var L=S;l.CLEANER_TYPE=C,l.MsgCleaner=S,l.MSG_CLEANER_FOR_TESTING_ONLY=L}),98);
__d("isE2EEConversationSearchEnabled",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("4741")}l.default=e}),98);
__d("isMAWUniversalSearchEnabled",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("4741")}l.default=e}),98);
__d("MpsDeletedCleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=null;function c(e){u==null&&(u=new(o("MAWMsgCleaner")).MsgCleaner(e,o("MAWMsgCleaner").CLEANER_TYPE.UNSEND))}function d(t){if(u==null){var n="Trying to add new MpsDeletedTimestamp before the cleaner is initialized!";throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),n),r("FBLogger")("messenger_web").mustfixThrow(n)}else o("WALogger").DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["MpsDeletedCleaner: Adding timestamps (",")"])),t),u.update(t)}function m(){return u}function p(){u=null}l.startMpsDeletedCleaner=c,l.addNewMpsDeletedTimestamp=d,l.getMpsDeletedCleaner_FOR_TESTING_ONLY=m,l.resetMpsDeletedCleaner_FOR_TESTING_ONLY=p}),98);
__d("MpsEphemeralCleaner",["MAWLoggerUtils","MAWMsgCleaner","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null,u=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.Ephemeral,o("MAWLoggerUtils").Tag.MsgCleaner,o("MAWLoggerUtils").Tag.CleanerTimestamp,"purgeDeletions"]);function c(e){s==null&&(s=new(o("MAWMsgCleaner")).MsgCleaner(e,o("MAWMsgCleaner").CLEANER_TYPE.EPHEMERAL))}function d(t){if(s==null)throw u.mustfixThrow("Trying to add new ephemeral timestamp before the cleaner is initialized!");u.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCleaner: Adding timestamps for expiry(",")"])),t),s.update(t)}function m(){return s}function p(){s=null}l.startMpsEphemeralCleaner=c,l.addNewMpsEphemeralTimestamp=d,l.getEphemeralCleaner_FOR_TESTING_ONLY=m,l.resetEphemeralCleaner_FOR_TESTING_ONLY=p}),98);
__d("MpsLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return r("FBLogger")("mps",t)};l.MpsLogger=e}),98);
__d("WormMemoryDriver",["Promise","WAResolvable","WormStoreFunctions","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=0;function u(){return s+=1,s}function c(){s=0}var d=(function(){function t(t){this.$2={},this.$3=(e||(e=n("Promise"))).resolve(),this.$1=t;for(var r of Object.keys(t))this.$2[r]=new Map}var r=t.prototype;return r.getSchema=function(){return this.$1},r.getDbAlias=function(){},r.runInTransaction=function(t,r,a,i){var e=this,l=new(o("WAResolvable")).Resolvable;return this.$3=this.$3.then(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n={};for(var o of Object.keys(e.$1))n[o]=new Map(e.$2[o]);var i=t.reduce(function(t,r){var o;return babelHelpers.extends({},t,(o={},o[r]=new m(n[r],e.$1[r]),o))},{}),s={abort:function(){},commit:function(){return l.promise.then(function(){})},stores:i},u=yield a(s);r==="readwrite"&&(e.$2=n),l.resolve(u)})).catch(function(e){l.reject(e)}),l.promise},r.close=function(){},r.init=function(r){return(e||(e=n("Promise"))).resolve({isNewDb:!0,isUpgraded:!1})},t})(),m=(function(){function t(t,o){var a=this;this.readIndexRange=function(t,o,i){var l=a.$2.indexes;if(l==null)throw r("err")("No indexes found");var s=l[t];if(s==null)throw r("err")("Index not found");var u=Array.from(a.$1.values());if(o!=null){var c,d,m,p;u=_(u,(c=(d=o.lessThan)!=null?d:o.lessThanOrEqual)!=null?c:o.only,o.lessThanOrEqual!=null||o.only!=null,(m=(p=o.greaterThan)!=null?p:o.greaterThanOrEqual)!=null?m:o.only,o.greaterThanOrEqual!=null||o.only!=null,s)}return(e||(e=n("Promise"))).resolve(a.$4(u,i,t))},this.$1=t,this.$2=o}var a=t.prototype;return a.bulkAdd=function(o){var t=this;for(var a of o){if(this.$2.autoIncrement===!0&&a[this.$2.primaryKey]===void 0&&(a[this.$2.primaryKey]=u()),this.$1.has(a[this.$2.primaryKey]))throw r("err")("Item with key already exists");this.$3(a),this.$1.set(a[this.$2.primaryKey],a)}return(e||(e=n("Promise"))).resolve(o.map(function(e){return e[t.$2.primaryKey]}))},a.bulkPut=function(r){var t=this;for(var o of r)this.$3(o),this.$2.autoIncrement===!0&&o[this.$2.primaryKey]===void 0&&(o[this.$2.primaryKey]=u()),this.$1.set(o[this.$2.primaryKey],o);return(e||(e=n("Promise"))).resolve(r.map(function(e){return e[t.$2.primaryKey]}))},a.$3=function(t){var e=this,n=this.$2.indexes;if(n!=null){for(var o of Object.values(n))if(!(typeof o!="object"||o==null)){var a=o.fields,i=o.unique;if(i!==!1){var l=a.map(function(e){return t[e]}).join(":"),s=function(o){if(o[e.$2.primaryKey]===t[e.$2.primaryKey])return 1;var n=a.map(function(e){return o[e]}).join(":");if(l===n)throw r("err")("ConstraintError")};for(var u of this.$1.values())s(u)}}}},a.bulkGet=function(r){var t=this;return(e||(e=n("Promise"))).resolve(r.map(function(e){return t.$1.get(e)}))},a.get=function(r){return(e||(e=n("Promise"))).resolve(this.$1.get(r))},a.getByIndex=function(t,n,r){return o("WormStoreFunctions").getByIndex(this,t,n,r)},a.readByKeyRange=function(r,o){var t,a,i=p(Array.from(this.$1.values()),(t=r.lessThan)!=null?t:r.lessThanOrEqual,r.lessThanOrEqual!=null,(a=r.greaterThan)!=null?a:r.greaterThanOrEqual,r.greaterThanOrEqual!=null,this.$2.primaryKey);return(e||(e=n("Promise"))).resolve(this.$4(i,o))},a.bulkDelete=function(r){for(var t of r)this.$1.delete(t);return(e||(e=n("Promise"))).resolve()},a.delete=function(r){return this.$1.delete(r),(e||(e=n("Promise"))).resolve()},a.bulkUpsert=function(t,n){return o("WormStoreFunctions").bulkUpsert(this,this.$2,t,n)},a.readKeysByIndexRange=function(t,n,r){var e=this;return this.readIndexRange(t,n,r).then(function(t){return t.map(function(t){return t[e.$2.primaryKey]})})},a.getIndexRangeIterator=function(t,n,r,a){return o("WormStoreFunctions").getIndexRangeIterator(this.readIndexRange,this.$2,t,n,r,a)},a.$4=function(t,n,r){var e=t;return(n==null?void 0:n.filter)!=null&&(e=e.filter(n.filter)),(n==null?void 0:n.order)!=null&&r!=null&&(e=e.sort(function(e,t){var o=e[r],a=t[r];return o===a?0:n.order==="desc"?a>o?1:-1:o>a?1:-1})),(n==null?void 0:n.limit)!=null&&(e=e.slice(0,n.limit)),e},a.readIndex=function(o,a,i){var t=this.$2.indexes;if(t==null)throw r("err")("No indexes found");var l=t[o];if(l==null)throw r("err")("Index not found");var s=Array.from(this.$1.values());return a!=null&&(s=s.filter(function(e){for(var t=0;t<l.fields.length;t++)if(e[l.fields[t]]!==a[t])return!1;return!0})),(e||(e=n("Promise"))).resolve(this.$4(s,i,o))},a.readIndexAnyOf=function(o,a,i){var t=this.$2.indexes;if(t==null)throw r("err")("No indexes found");var l=t[o];if(l==null)throw r("err")("Index not found");if(a.length===0)return(e||(e=n("Promise"))).resolve([]);var s=Array.from(this.$1.values());return s=s.filter(function(e){return a.some(function(t){for(var n=0;n<l.fields.length;n++)if(t[n]!==void 0&&e[l.fields[n]]!==t[n])return!1;return!0})}),(e||(e=n("Promise"))).resolve(this.$4(s,i,o))},a.readIndexKeys=function(t,n,r){var e=this;return this.readIndex(t,n,r).then(function(t){return t.map(function(t){return t[e.$2.primaryKey]})})},a.readAll=function(r){var t=this,o=Array.from(this.$1.values());return(r==null?void 0:r.filter)!=null&&(o=o.filter(r.filter)),(r==null?void 0:r.order)!=null&&(o=o.sort(function(e,n){var o=e[t.$2.primaryKey],a=n[t.$2.primaryKey];return o===a?0:r.order==="desc"?a>o?1:-1:o>a?1:-1})),(r==null?void 0:r.limit)!=null&&(o=o.slice(0,r.limit)),(e||(e=n("Promise"))).resolve(o)},a.readKeys=function(t){var e=this;return this.readAll(t).then(function(t){return t.map(function(t){return t[e.$2.primaryKey]})})},a.clear=function(){return this.$1.clear(),(e||(e=n("Promise"))).resolve()},a.count=function(){return(e||(e=n("Promise"))).resolve(this.$1.size)},t})();function p(e,t,n,r,o,a){return e.filter(function(e){return!(r!=null&&r>e[a]||t!=null&&t<e[a]||t!=null&&n===!1&&e[a]===t||r!=null&&o===!1&&e[a]===r)})}function _(e,t,n,r,o,a){return e.filter(function(e){for(var i=0;i<a.fields.length;i++)if(r!=null&&r[i]>e[a.fields[i]]||t!=null&&t[i]<e[a.fields[i]]||i===a.fields.length-1&&(t!=null&&n===!1&&e[a.fields[i]]===t[i]||r!=null&&o===!1&&e[a.fields[i]]===r[i]))return!1;return!0})}l.TEST_ONLY_resetPK=c,l.WormMemoryDriver=d,l.WormMemoryStore=m}),98);
__d("WebReverbSchema",["FBLogger","MAWWormOdsLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(t,n,r,o,a,i,l){"use strict";var e={autoIncrement:!0,indexes:{"[threadId+messageId]":{fields:["threadId","messageId"],unique:!0},"[threadId+timestampMs+messageId]":{fields:["threadId","timestampMs","messageId"],unique:!1},expiryTimestampMs:{fields:["expiryTimestampMs"],unique:!1},messageId:{fields:["messageId"],unique:!1},timestampMs:{fields:["timestampMs"],unique:!1}},nonEncryptedFields:["timestampMs","expiryTimestampMs","messageId","debugFlags"],primaryKey:"pk",secure:!0},s={autoIncrement:!0,indexes:{"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!0}},nonEncryptedFields:["topLevelMessageId"],primaryKey:"pk",secure:!0},u={autoIncrement:!0,indexes:{"[threadId+deletedMessageId]":{fields:["threadId","deletedMessageId"],unique:!0},"[threadId+timestampMs+deletedMessageId]":{fields:["threadId","timestampMs","deletedMessageId"],unique:!0},"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!1},deletionTimestampMs:{fields:["deletionTimestampMs"],unique:!1}},nonEncryptedFields:["topLevelMessageId","deletionTimestampMs"],primaryKey:"pk",secure:!0},c={autoIncrement:!0,indexes:{"[threadId+messageId+tag]":{fields:["threadId","messageId","tag"],unique:!0},"[threadId+tag+timestampMs]":{fields:["threadId","tag","timestampMs"],unique:!1}},nonEncryptedFields:["messageId","timestampMs","messagePk","tag"],primaryKey:"pk",secure:!0},d={autoIncrement:!1,indexes:{},primaryKey:"pk",secure:!0},m={dbMetadata:d,deleted:u,message:e,supplemental:s,tags:c};function p(e,t,n,a,i){var l=o("WAHex").parseHex(t),s="reverb",u=new(o("WormEAR")).WormEAR(m,s,l),c=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(e,s,m,u,o("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:n,onBlockingError:a,onTransactionError:function(t){if(t instanceof o("WormEAR").DecryptionError){var e=t;r("FBLogger")("mps").mustfix("EAR decryption error in store: %s. Dropping corrupted entity %s",e.store,e.maybeHashedPk),c.runInTransaction([e.store],"readwrite",function(t){var n=t.stores[e.store];return e.maybeHashedPk!=null?n.delete(e.maybeHashedPk):n.clear()},"delete-corrupted-entity")}}}),i);return c}function _(e){return new(o("Worm")).WormDatabase(new(o("WormMemoryDriver")).WormMemoryDriver(m),e)}l.schema=m,l.makeWebReverbSchema=p,l.makeInMemoryReverbSchema_TEST_ONLY=_}),98);
__d("WebReverbDB",["MpsLogger","WAResolvable","WebReverbSchema","asyncToGeneratorRuntime","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l){var u;try{var c=o("WebReverbSchema").makeWebReverbSchema(t,n,a,i,l);return e=c,u=yield c.init(),s.resolve(c),u}catch(e){throw o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("Error performing WebReverb init"),e}}),c.apply(this,arguments)}function d(){if(e==null)throw r("err")("Reverb DB is not initialized");return e}function m(){return s.promise}function p(e){return"WebReverb - "+e}l.makeWebReverb=u,l.getWebReverbDB=d,l.getDbPromise=m,l.mpsOp=p}),98);
__d("MpsReverbDbDump",["WebReverbDB","WormDump"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("WebReverbDB").getWebReverbDB();return t.dump({dbMetadata:{customFields:{mawDBMigrationCurrentMessageId:(e=o("WormDump")).wormNonSensitiveField,mawDBMigrationCurrentThread:e.wormNonSensitiveField,mawDBMigrationStartMs:e.wormNonSensitiveField,mawDBMigrationState:e.wormNonSensitiveField,pk:e.wormNonSensitiveField}},deleted:{customFields:{deletedMessageId:e.wormNonSensitiveField,deletionMessageId:e.wormNonSensitiveField,deletionTimestampMs:e.wormNonSensitiveField,isLocalOnlyMessage:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,supplementalKey:e.wormNonSensitiveField,threadId:e.wormNonSensitiveField,timestampMs:e.wormNonSensitiveField,topLevelMessageId:e.wormNonSensitiveField},limit:1e3},message:{customFields:{debugFlags:e.wormNonSensitiveField,expiryTimestampMs:e.wormNonSensitiveField,isLocalOnlyMessage:e.wormNonSensitiveField,isTransportErrorPlaceholder:e.wormNonSensitiveField,messageId:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,senderId:e.wormNonSensitiveField,threadId:e.wormNonSensitiveField,timestampMs:e.wormNonSensitiveField},limit:2500},supplemental:{customFields:{messageId:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,supplementalKey:e.wormNonSensitiveField,threadId:e.wormNonSensitiveField,timestampMs:e.wormNonSensitiveField,topLevelMessageId:e.wormNonSensitiveField},limit:1e3},tags:{customFields:{messageId:e.wormNonSensitiveField,messagePk:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,threadId:e.wormNonSensitiveField,timestampMs:e.wormNonSensitiveField},limit:1e3}})}l.debugGetReverbDbDump=e}),98);
__d("WormMaintenanceSchema",["MAWWormOdsLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(t,n,r,o,a,i,l){"use strict";var e={autoIncrement:!0,indexes:{name:{fields:["name"],unique:!0}},nonEncryptedFields:["name","startedAtMs","finishedAtMs"],primaryKey:"pk",secure:!0},s={migrations:e};function u(e,t,n,r,a,i){var l=o("WAHex").parseHex(t),u="worm_maintenance",c=new(o("WormEAR")).WormEAR(s,u,l);return new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(e,u,s,c,o("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:n,onBlockingError:r,onTransactionError:a}),i)}function c(e){return new(o("Worm")).WormDatabase(new(o("WormMemoryDriver")).WormMemoryDriver(s),e)}l.makeWormMaintenanceSchema=u,l.makeWormMaintenanceSchema_TEST_ONLY=c}),98);
__d("WormMaintenanceDb",["FBLogger","Promise","WAResolvable","WormEAR","WormMaintenanceSchema","asyncToGeneratorRuntime","err","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new(o("WAResolvable")).Resolvable;function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t.blockingErrorThreshold,i=t.dbName,l=t.onBlockingError,c=t.qplEvent,d=t.strEncKey;try{var m=o("WormMaintenanceSchema").makeWormMaintenanceSchema(i,d,a,l,function(t){if(t instanceof o("WormEAR").DecryptionError){var a,i,l=t;r("FBLogger")("messenger_web").mustfix("EAR decryption error in store: %s. Dropping corrupted entity",l.store),r("promiseDone")((a=(i=s)==null?void 0:i.runInTransaction([l.store],"readwrite",function(e){var t=e.stores[l.store];return l.maybeHashedPk!=null?t.delete(l.maybeHashedPk):t.clear()},"delete-corrupted-entity"))!=null?a:(e||(e=n("Promise"))).resolve())}},c);return s=m,yield m.init(),u.resolve(m),m}catch(e){throw r("FBLogger")("messenger_web").catching(r("getErrorSafe")(e)).mustfix("Error performing WORM PersistedQueue init"),e}}),d.apply(this,arguments)}function m(){if(s==null)throw r("err")("WormMaintenanceDb is not initialized");return s}function p(){return u.promise}l.makeWormMaintenanceDb=c,l.getWormMaintenanceDb=m,l.getWormMaintenanceDbPromise=p}),98);
__d("MAWWormMaintenanceDbSetup",["BackendInitLoggingUtils","MAWCurrentUser","MAWIndexedDbMetadata","MAWODSProxy","MessengerWebInitData","WAOdsEnums","WormMaintenanceDb","asyncToGeneratorRuntime","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("BackendInitLoggingUtils").measureMawInit("worm_maintenance_db_init",n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("WormMaintenanceDb").makeWormMaintenanceDb({blockingErrorThreshold:r("justknobx")._("3218"),dbName:o("MAWIndexedDbMetadata").wormMaintenanceDbName(o("MAWCurrentUser").getID()),onBlockingError:function(t){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+t})},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2})}))}),s.apply(this,arguments)}l.mawWormDbMaintenanceDbSetup=e}),98);
__d("MpsTags",["FBLogger","MAWProtobufDeserializers","MSGDataclassTypes.flow","getErrorSafe","getMediaTypeFromConsumerMessage"],(function(t,n,r,o,a,i,l){"use strict";function e(e){try{var t,n=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(e),a=(t=n.encryptedTransportMessage())==null||(t=t.consumerMessage())==null?void 0:t.proto,i=o("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(a);return s(i)}catch(e){var l=r("getErrorSafe")(e);return r("FBLogger")("wmi").tags(["mps","mps-tags"]).catching(l).mustfix("Failed to get the tag from the protobuf"),null}}function s(e){return e==="image"?o("MSGDataclassTypes.flow").MpsMessageTag.Photo:e==="video"?o("MSGDataclassTypes.flow").MpsMessageTag.Video:e==="gif"?o("MSGDataclassTypes.flow").MpsMessageTag.Gif:e==="ptt"?o("MSGDataclassTypes.flow").MpsMessageTag.Audio:e==="document"?o("MSGDataclassTypes.flow").MpsMessageTag.File:e==="sticker"||e==="md-app-state"||e==="xma-image"||e===void 0||e===null?null:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}l.getTagFromProto=e,l.getMpsMessageTagFromMediaType=s}),98);
__d("WebMpsReverbWrites",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e,t,r,o,a,i,l){var s=[a,o,r];return l((function(){var l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var l,u=yield n.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",s);if(!(((l=u==null?void 0:u.timestampMs)!=null?l:0)>=i)){var c={messageId:e,payload:t,supplementalKey:r,threadId:a,timestampMs:i,topLevelMessageId:o};yield n.stores.supplemental.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:c,selector:s}])}});return function(e){return l.apply(this,arguments)}})())}function l(e,t,r){var o=e.messageId,a=e.threadId;return r((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r,i=yield n.stores.message.getByIndex("[threadId+messageId]",[a,o]);if(!(i!=null&&!i.isTransportErrorPlaceholder)&&!(i!=null&&i.isTransportErrorPlaceholder&&t.isTransportErrorPlaceholder)){var l=yield n.stores.deleted.getByIndex("[threadId+deletedMessageId]",[e.threadId,e.messageId]),s=babelHelpers.extends({},e,{debugFlags:t.debugFlags,expiryTimestampMs:t.expiryTimestampMs,isLocalOnlyMessage:t.isLocalOnly,isTransportErrorPlaceholder:t.isTransportErrorPlaceholder,timestampMs:(r=i==null?void 0:i.timestampMs)!=null?r:e.timestampMs});if(l)l.payload=s.payload,yield n.stores.deleted.bulkPut([l]),i!=null&&(i.timestampMs=e.timestampMs,yield n.stores.message.bulkPut([i]));else{var u=yield n.stores.message.bulkUpsert("[threadId+messageId]",[{item:s,selector:[a,o]}]),c=u[0],d=yield n.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[a,o]});d.length>0&&(yield n.stores.tags.bulkDelete(d.map(function(e){return e.pk}))),t.tags.length>0&&(yield n.stores.tags.bulkAdd(t.tags.map(function(e){return{messageId:s.messageId,messagePk:c,tag:e,threadId:s.threadId,timestampMs:s.timestampMs}})))}}});return function(e){return r.apply(this,arguments)}})())}i.upsertSupplementalToReverb=e,i.upsertTopLevelToReverb=l}),66);
__d("WebMpsMigrationReverbTxns",["FBLogger","MpsTags","MpsTypes","Promise","WebMpsReverbWrites","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return r("FBLogger")("mps").tags(["mps_migration"])};function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){try{yield o("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags","dbMetadata"],"readwrite",function(r){var o=function(t){return t(r)};return(e||(e=n("Promise"))).all(t.map(function(e){return d(e,o)}))},"mps-persist-messages-migrated-from-maw-db")}catch(e){throw r.endFail("reverb_write_failure"),e}}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=[],i=[],l=o("MpsTags").getTagFromProto(t.toplevelProtobuf.payload);a.push(o("WebMpsReverbWrites").upsertTopLevelToReverb(t.toplevelProtobuf,{actionType:o("MpsTypes").ActionType.UpsertTopLevel,debugFlags:["MAW_Migration"],isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:l!=null?[l]:[],targetMessageId:t.toplevelProtobuf.messageId},r));for(var u of t.supplementalsToInsert.entries()){var c=u[0],d=u[1];a.push(o("WebMpsReverbWrites").upsertSupplementalToReverb(d.messageId,d.payload,c,t.toplevelProtobuf.messageId,t.toplevelProtobuf.threadId,d.timestampMs,r))}var m=yield(e||(e=n("Promise"))).allSettled(a),p=m.filter(function(e){return e.status==="rejected"});for(var _ of p)s().mustfix("Failed to upsert a row into Reverb: %s",_.reason);if(p.length>0)throw s().mustfixThrow("Reverb upsert failed");var f=function*(){var e=g[0],o=g[1];i.push(r((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=[t.toplevelProtobuf.threadId,t.toplevelProtobuf.messageId,e],o=yield n.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",r);o!=null&&(yield n.stores.supplemental.bulkDelete([o.pk]))});return function(e){return r.apply(this,arguments)}})()))};for(var g of t.supplementalsToDelete.entries())yield*f();var h=yield e.allSettled(i),y=h.filter(function(e){return e.status==="rejected"});for(var C of y)s().mustfix("Failed to delete a row from Reverb: %s",C.reason);if(y.length>0)throw s().mustfixThrow("Reverb delete failed")}),m.apply(this,arguments)}function p(){return o("WebReverbDB").getWebReverbDB().runInTransaction(["dbMetadata"],"readonly",function(e){return e.stores.dbMetadata.get("db-info")},"mps-get-db-metadata")}function _(e,t){try{return o("WebReverbDB").getWebReverbDB().runInTransaction(["dbMetadata"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield t.stores.dbMetadata.bulkAdd([babelHelpers.extends({},e,{pk:"db-info"})])});return function(e){return t.apply(this,arguments)}})(),"mps-set-db-metadata")}catch(e){throw t.endFail("migration_state_write_failure"),e}}function f(e,t){try{return o("WebReverbDB").getWebReverbDB().runInTransaction(["dbMetadata"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,r,o,a,i=yield t.stores.dbMetadata.get("db-info");if(i==null)throw s().mustfixThrow("DB Metadata row does not exist, cannot update the cursor");var l=i,u=babelHelpers.extends({},l,{mawDBMigrationCurrentMessageId:(n=e.mawDBMigrationCurrentMessageId)!=null?n:l.mawDBMigrationCurrentMessageId,mawDBMigrationCurrentThread:(r=e.mawDBMigrationCurrentThread)!=null?r:l.mawDBMigrationCurrentThread,mawDBMigrationStartMs:(o=e.mawDBMigrationStartMs)!=null?o:l.mawDBMigrationStartMs,mawDBMigrationState:(a=e.mawDBMigrationState)!=null?a:l.mawDBMigrationState});yield t.stores.dbMetadata.bulkPut([u])});return function(e){return t.apply(this,arguments)}})(),"mps-update-db-metadata")}catch(e){throw t.endFail("migration_state_write_failure"),e}}l.persistMigratedMessagesFromMawDb=u,l.getMawMpsMigrationState=p,l.setInitialMawMpsMigrationState=_,l.setMawMpsMigrationState=f}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e=12e4,s=new(o("WAResolvable")).Resolvable,u=o("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxTaskLimit:1,defaultSamplingRate:1e3,timeoutMs:e});function c(){s.resolveWasCalled()&&(s=new(o("WAResolvable")).Resolvable,d())}function d(){u.runTask({name:"offline-queue",fn:function(){return s.promise},priority:o("WorkerScheduler").BLOCKING_PRIORITY})}function m(){return s.promise}function p(){s.resolve()}function _(){return!s.resolveWasCalled()}l.maybeResetWaitForUserUnblocked=c,l.markOfflineQueueAsStarted=d,l.waitForUserUnblocked=m,l.unblockUser=p,l.isStillWaitingForUserUnblocked=_}),98);
__d("WebMpsPopulateMediaTagsDBMigration",["MpsTags","MpsTypes","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=20,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=t!=null?o("MpsTypes").toTimestamp(parseInt(t,10)):null,a=yield o("WebReverbDB").getWebReverbDB().runInTransaction(["message"],"readonly",function(t){return t.stores.message.readIndexRange("timestampMs",{greaterThan:[r!=null?r:o("MpsTypes").toTimestamp(0)]},{limit:e,order:"asc"})},"get-message-batch-after-timestamp");if(n.addPoint("messages_fetched_from_reverb",{int:{messageCount:a.length}}),a.length===0)return{hasMore:!1};var i=a.map(function(e){var t=o("MpsTags").getTagFromProto(e.payload);if(t==null)return null;var n=t;return{item:{messageId:e.messageId,messagePk:e.pk,tag:n,threadId:e.threadId,timestampMs:e.timestampMs},selector:[e.threadId,e.messageId,n]}}).filter(Boolean);return n.addPoint("tags_generated",{int:{tagCount:i.length}}),yield o("WebReverbDB").getWebReverbDB().runInTransaction(["tags"],"readwrite",function(e){return e.stores.tags.bulkUpsert("[threadId+messageId+tag]",i)},"upsert-tags"),n.addPoint("tags_updated"),{hasMore:!0,nextCursor:a[a.length-1].timestampMs.toString()}});return function(n,r){return t.apply(this,arguments)}})();l.WebMpsPopulateMediaTagsMigrationTask=s}),98);
__d("WormDbMigrationScheduler",["FBLogger","MpsTypes","ODS","QPLFlow","WAWaitForUserUnblocked","WebMpsPopulateMediaTagsDBMigration","WorkerScheduler","WormMaintenanceDb","asyncToGeneratorRuntime","getErrorSafe","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=function(){return r("FBLogger")("wmi").tags(["worm_db_migration"])},d=null,m={concurrency:1,maxTaskLimit:1,maxThrottleMs:r("justknobx")._("3546"),timeoutMs:r("justknobx")._("3614")},p={"reverb-populate-media-tags":o("WebMpsPopulateMediaTagsDBMigration").WebMpsPopulateMediaTagsMigrationTask},_=new Map;function f(e,t){return e+":"+(t!=null?t:"null")}function g(e){var t;return(t=_.get(e))!=null?t:0}function h(e){_.set(e,g(e)+1)}function y(){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),b(p)}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!r("justknobx")._("3720")){c().info("DB Migrations are disabled");return}if(d!=null){c().info("DB Migrations are already running");return}var t=!1,n=!1,o;try{for(var a=babelHelpers.asyncIterator(Object.entries(e)),i;t=!(i=yield a.next()).done;t=!1){var l=i.value,s=l[0],u=l[1];yield S(s,u)}}catch(e){n=!0,o=e}finally{try{t&&a.return!=null&&(yield a.return())}finally{if(n)throw o}}}),v.apply(this,arguments)}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=o("QPLFlow").startQPLFlow(r("qpl")._(767107656,"1154"),{annotations:{string:{migrationName:t}}}),i=yield L(t),l;if(i==null?(a.addPoint("migration_state_not_found"),l=yield E(t),(u||(u=o("ODS"))).bumpEntityKey(9819,"worm.db_migration",t+".started"),a.addPoint("initial_migration_state_set")):(a.addPoint("migration_state_retrieved"),l=i),l.finishedAtMs!=null){c().info("Migration "+t+" is already complete"),(u||(u=o("ODS"))).bumpEntityKey(9819,"worm.db_migration",t+".skipped"),a.addPoint("migration_already_complete"),a.endSuccess();return}var p=f(t,l.currentCursor),_=g(p);if(_>r("justknobx")._("2141")){c().INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Migration "," has exceeded the max retry count"])),t),(u||(u=o("ODS"))).bumpEntityKey(9819,"worm.db_migration",t+".stuck"),a.addPoint("retry_count_exceeded"),a.endSuccess();return}d=o("WorkerScheduler").makeScheduler("WormDbMigrations",m).task({fn:function(){return n(l.currentCursor,a)},name:"worm_db_migration_"+t,priority:o("WorkerScheduler").BACKGROUND_PRIORITY});try{var y=yield d.run();a.addPoint("migration_task_complete"),d=null,y.hasMore?(yield k(babelHelpers.extends({},l,{currentCursor:y.nextCursor})),a.addPoint("migration_state_updated"),S(t,n)):(yield k(babelHelpers.extends({},l,{currentCursor:void 0,finishedAtMs:o("MpsTypes").toTimestamp(Date.now())})),(u||(u=o("ODS"))).bumpEntityKey(9819,"worm.db_migration",t+".complete"),a.addPoint("migration_complete")),a.endSuccess()}catch(e){d=null;var C=r("getErrorSafe")(e);c().FATAL(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Runtime error when running migration ",": ",""])),t,C.message),a.endFail("runtime_error",{string:{errorMessage:C.message}}),h(p),S(t,n)}}),R.apply(this,arguments)}function L(e){return o("WormMaintenanceDb").getWormMaintenanceDb().runInTransaction(["migrations"],"readonly",function(t){return t.stores.migrations.getByIndex("name",[e])},"mps-get-migration-by-name")}function E(e){return o("WormMaintenanceDb").getWormMaintenanceDb().runInTransaction(["migrations"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n={name:e,startedAtMs:o("MpsTypes").toTimestamp(Date.now())},r=yield t.stores.migrations.bulkAdd([n]),a=r[0];return babelHelpers.extends({},n,{pk:a})});return function(e){return t.apply(this,arguments)}})(),"mps-add-initial-migration-state")}function k(e){return o("WormMaintenanceDb").getWormMaintenanceDb().runInTransaction(["migrations"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield t.stores.migrations.bulkPut([e])});return function(e){return t.apply(this,arguments)}})(),"mps-set-migration-state")}l.runAllDbMigrations=y,l.getDbMigrationStateByName=L}),98);
__d("MpsReverbInit",["BrowserLockManager","MAWMpsMigrationStatus","MAWWormMaintenanceDbSetup","MpsTypes","Promise","WebMpsMigrationReverbTxns","WebReverbDB","WormDbMigrationScheduler","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s="wmi_mps_m4_non_migrated_status_lock",u="wmi_mps_new_db_status_lock",c,d=["reverb-populate-media-tags"],m=new Map(d.map(function(e){return[e,null]}));function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield o("WebReverbDB").makeWebReverb(t.name,t.strEncKey,t.blockingErrorThreshold,t.onBlockingError,t.qplEvent),i=a.isNewDb;yield o("MAWWormMaintenanceDbSetup").mawWormDbMaintenanceDbSetup();var l,p=[];if(i)l=!0,p=d.map(function(e){return{migrationName:e,ready:!0}});else{var _=yield o("WebMpsMigrationReverbTxns").getMawMpsMigrationState();l=(_==null?void 0:_.mawDBMigrationState)===o("MpsTypes").MawDBMigrationState.Completed,p=yield(e||(e=n("Promise"))).all(d.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WormDbMigrationScheduler").getDbMigrationStateByName(e);return{migrationName:e,ready:(t==null?void 0:t.finishedAtMs)!=null}});return function(t){return e.apply(this,arguments)}})()))}if(r("BrowserLockManager")==null){o("MAWMpsMigrationStatus").setStatus(l),p.forEach(function(e){o("MAWMpsMigrationStatus").setDbMigrationState(e.migrationName,e.ready)});return}var f=yield r("BrowserLockManager").query(),g=f.held.some(function(e){return e.name===u});if(g){o("MAWMpsMigrationStatus").setStatus(!0),d.forEach(function(e){o("MAWMpsMigrationStatus").setDbMigrationState(e,!0)});return}if(l===!0){var h=f.held.some(function(e){return e.name===s})||f.pending.some(function(e){return e.name===s});h?l=!1:i===!0&&(c=r("BrowserLockManager").request(u,function(){return new(e||(e=n("Promise")))(function(){})}))}l||(c=r("BrowserLockManager").request(s,function(){return new(e||(e=n("Promise")))(function(){})})),o("MAWMpsMigrationStatus").setStatus(l),p.forEach(function(t){var a="LOCK_NOT_READY_MIGRATION-"+t.migrationName;if(t.ready){var i=f.held.some(function(e){return e.name===a})||f.pending.some(function(e){return e.name===a});i?o("MAWMpsMigrationStatus").setDbMigrationState(t.migrationName,!1):o("MAWMpsMigrationStatus").setDbMigrationState(t.migrationName,!0)}else o("MAWMpsMigrationStatus").setDbMigrationState(t.migrationName,!1),m.set(t.migrationName,r("BrowserLockManager").request(a,function(){return new(e||(e=n("Promise")))(function(){})}))})}),_.apply(this,arguments)}l.initReverb=p}),98);
__d("QPLMultiplexedFlow",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=Array.from(new Set(e));return{addAnnotations:function(n){t.forEach(function(e){return e.addAnnotations(n)})},addPoint:function(n,r){t.forEach(function(e){return e.addPoint(n,r)})},endCancel:function(n,r){t.forEach(function(e){return e.endCancel(n,r)})},endFail:function(n,r){t.forEach(function(e){return e.endFail(n,r)})},endSuccess:function(n){t.forEach(function(e){return e.endSuccess(n)})},getQPLAttrs:function(){return t.map(function(e){return e.getQPLAttrs()})[0]},isActive:function(){return t.some(function(e){return e.isActive()})},start:function(){}}}i.makeQplMultiplexedFlow=e}),66);
__d("WebMpsGetDistinctSupplementals",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=new Map(e),r=new Map;return t.forEach(function(e,t){var o=n.get(t);if(o==null)n.set(t,e),r.set(t,e);else{var a=o.timestampMs,i=e.timestampMs;i>a&&(n.set(t,e),r.set(t,e))}}),{supplementals:n,supplementalsToWriteToReverb:r}}i.getDistinctSupplementals=e}),66);
__d("WebMpsGetDistinctMessages",["WebMpsGetDistinctSupplementals"],(function(t,n,r,o,a,i,l){"use strict";var e=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"],s=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"];function u(t,n){var r=new Map,a=new Map;t.forEach(function(t){var n=t.reverbTopLevel,o=n.debugFlags,i=n.expiryTimestampMs,l=n.isLocalOnlyMessage,s=n.isTransportErrorPlaceholder,u=n.pk,c=babelHelpers.objectWithoutPropertiesLoose(n,e);a.set(t.reverbTopLevel.messageId,t),r.set(t.reverbTopLevel.messageId,{expiryTimestampMs:i,supplementalProtobufs:t.supplementalProtobufs,tags:t.tags,toplevelProtobuf:c})});var i=new Map,l=new Map,u=new Map;return n.forEach(function(e){var t=e.supplementalProtobufs,n=e.tags,c=e.toplevelProtobuf,d=c.messageId,m=a.get(d);if(m==null||m.reverbTopLevel.isTransportErrorPlaceholder===!0)r.set(d,e),i.set(d,c),l.set(d,new Map(t)),u.set(d,n);else{var p=m.supplementalProtobufs,_=o("WebMpsGetDistinctSupplementals").getDistinctSupplementals(p,t),f=_.supplementals,g=_.supplementalsToWriteToReverb,h=m.reverbTopLevel,y=h.debugFlags,C=h.expiryTimestampMs,b=h.isLocalOnlyMessage,v=h.isTransportErrorPlaceholder,S=h.pk,R=babelHelpers.objectWithoutPropertiesLoose(h,s);r.set(d,{expiryTimestampMs:C,supplementalProtobufs:f,tags:m.tags,toplevelProtobuf:R}),g.size>0&&l.set(d,new Map(g))}}),{messages:Array.from(r.values()),supplementalMessagesToWriteToReverb:l,tagsToWriteToReverb:u,topLevelMessagesToWriteToReverb:i}}l.getDistinctMessages=u}),98);
__d("WebMpsGetIsMessageExpired",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e!=null&&o("WATimeUtils").cappedMillisecondsUntil(o("WATimeUtils").castMilliSecondsToUnixTime(e))<=0}l.getIsMessageExpired=e}),98);
__d("WebMpsPersistMessagesFromEb",["FBLogger","MpsLogger","MpsTypes","Promise","WebMpsReverbWrites","WebReverbDB","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(!(t.length===0||t.every(function(e){return e.topLevelProtobufs.size===0&&e.supplementalProtobufs.size===0&&e.tags.size===0})))try{yield o("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags","dbMetadata"],"readwrite",function(o){var a=t.map(function(t){var n=t.supplementalProtobufs,a=t.tags,i=t.threadId,l=t.topLevelProtobufs;return r("FBLogger")("mps").INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Persisting EB messages thread: "," topLevelProtobufs: "," supplementalProtobufs: ",""])),i,Array.from(l.keys()).join(","),Array.from(n.keys()).join(",")),d(l,n,a,i,function(e){return e(o)})}).flat();return(s||(s=n("Promise"))).all(a)},"mps-persist-messages-from-eb")}catch(e){var a=r("getErrorSafe")(e);throw o("MpsLogger").MpsLogger().catching(a).mustfix("Runtime error performing persistMessagesFromEB"),a}}),c.apply(this,arguments)}function d(e,t,n,r,a){var i=[];return e.forEach(function(e,t){var r;i.push(o("WebMpsReverbWrites").upsertTopLevelToReverb(e,{actionType:o("MpsTypes").ActionType.UpsertTopLevel,debugFlags:["EB"],isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:(r=n.get(t))!=null?r:[],targetMessageId:t},a))}),t.forEach(function(e,t){e.forEach(function(e,n){i.push(o("WebMpsReverbWrites").upsertSupplementalToReverb(e.messageId,e.payload,n,t,r,e.timestampMs,a))})}),i}l.persistMessagesFromEB=u}),98);
__d("groupBy",[],(function(t,n,r,o,a,i){function e(e,t){return e.reduce(function(e,n){return(e[t(n)]=e[t(n)]||[]).push(n),e},{})}i.default=e}),66);
__d("WebMpsBatchLoadMessage",["CoalescingLoader","MpsLogger","Promise","QPLMultiplexedFlow","WebMpsGetDistinctMessages","WebMpsGetIsMessageExpired","WebMpsPersistMessagesFromEb","WebReverbDB","asyncToGeneratorRuntime","getErrorSafe","getSafeQplErrorMessage","groupBy"],(function(t,n,r,o,a,i,l){"use strict";var e=["messageId"],s=["config","ctx","messageId","threadId"],u=["pk","supplementalKey","threadId","topLevelMessageId"],c,d=(function(){function t(t){var a=this;this.$3=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var i=r("groupBy")(t,function(e){return a.$4(e)}),l=new Map;return yield(c||(c=n("Promise"))).all(Object.entries(i).map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t[0],r=t[1],i=r.map(function(e){return e.ctx.metric}),s=o("QPLMultiplexedFlow").makeQplMultiplexedFlow(i);s.addAnnotations({int:{coalesced_batch_size:r.length}});var u=r[0],c=u.messageId,d=babelHelpers.objectWithoutPropertiesLoose(u,e),m=babelHelpers.extends({},d,{ctx:{metric:s},messageIds:r.map(function(e){return e.messageId})}),p=yield a.batchLoad(m);l.set(n,p)});return function(e){return t.apply(this,arguments)}})())),t.map(function(e){var t=l.get(a.$4(e));return t==null?void 0:t.find(function(t){return(t==null?void 0:t.toplevelProtobuf.messageId)===e.messageId})})});return function(e){return t.apply(this,arguments)}})(),this.$1=t,this.$2=new(o("CoalescingLoader")).CoalescingLoader(this.$3)}var a=t.prototype;return a.$4=function(t){var e=t.config,n=t.ctx,r=t.messageId,o=t.threadId,a=babelHelpers.objectWithoutPropertiesLoose(t,s);return JSON.stringify({config:e,threadId:o})},a.$5=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){try{i.metric.addPoint("load-message-from-reverb_start");var l=o("WebReverbDB").getWebReverbDB(),s=yield l.runInTransaction(["message","supplemental","tags"],"readonly",function(r){return(c||(c=n("Promise"))).all(t.map(function(t){var o=r.stores.message.readIndex("[threadId+messageId]",[e,t],{limit:1}),i=a.shouldFetchTags?r.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[e,t]}):[],l=a.shouldFetchSupplementals?r.stores.supplemental.readIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[e,t]}):[];return(c||(c=n("Promise"))).all([t,o,l,i])}))},"mps-load-message");i.metric.addPoint("load-message-from-reverb_end");var d=new Map;return s.forEach(function(e){var t=e[0],n=e[1],r=n[0],a=e[2],i=e[3];if(r==null||o("WebMpsGetIsMessageExpired").getIsMessageExpired(r.expiryTimestampMs))return null;var l=new Map;a.forEach(function(e){var t=e.pk,n=e.supplementalKey,r=e.threadId,o=e.topLevelMessageId,a=babelHelpers.objectWithoutPropertiesLoose(e,u);l.set(n,a)});var s=i.map(function(e){var t=e.tag;return t});d.set(t,{reverbTopLevel:r,supplementalProtobufs:l,tags:s})}),d}catch(e){return i.metric.addPoint("load-message-from-reverb_fail"),o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("Runtime error performing loadMessageFromReverb"),new Map}});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),a.$6=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){try{var a=this.$1,i=a.decryptedProtobufToFullMessage,l=a.eb,s=l.isEbEnabled(),u=s===!0?"true":s===!1?"false":"unset";if(n.metric.addAnnotations({string:{ebEnabled:u}}),s!==!0)return new Map;n.metric.addPoint("load-message-from-eb_start");var c=l.messagePointQuery,d=yield c({ctx:n,messageIds:t,threadId:e});if(d.success===!1)return new Map;var m=i(d.value,e);return n.metric.addPoint("load-message-from-eb_end"),new Map(m.map(function(e){return[e.toplevelProtobuf.messageId,e]}))}catch(e){n.metric.addPoint("load-message-from-eb_fail");var p=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(p).mustfix("Runtime error performing loadFromEB"),new Map}});function t(t,n,r){return e.apply(this,arguments)}return t})(),a.batchLoad=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,a=e.config,i=e.ctx,l=e.messageIds,s=e.threadId;try{i.metric.addPoint("load-message_start");var u=function(){return t.$5(s,l,a,i)},d=function(){return t.$6(s,l,i)},m=a.strategy==="local-first"?n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield u(),t=e.size===l.length;return t?[e,new Map]:[e,yield d()]}):a.strategy==="full-fetch"?function(){return(c||(c=n("Promise"))).all([u(),d()])}:a.strategy==="local-only"?n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return[yield u(),new Map]}):a.strategy==="remote-only"?n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return[new Map,yield d()]}):(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+a.strategy)})(),p=yield m(),_=p[0],f=p[1],g=l.map(function(e){var t=_.get(e),n=f.get(e);return o("WebMpsGetDistinctMessages").getDistinctMessages([t].filter(Boolean),[n].filter(Boolean))});return a.persistToReverb==="persist"&&o("WebMpsPersistMessagesFromEb").persistMessagesFromEB(g.map(function(e){var t=e.supplementalMessagesToWriteToReverb,n=e.tagsToWriteToReverb,r=e.topLevelMessagesToWriteToReverb;return{supplementalProtobufs:t,tags:n,threadId:s,topLevelProtobufs:r}})),i.metric.addPoint("load-message_end"),g.map(function(e){return e.messages[0]})}catch(e){var h=r("getErrorSafe")(e);throw i.metric.addPoint("load-message_fail",{string:{errorDescription:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(h)}}),o("MpsLogger").MpsLogger().catching(h).mustfix("Runtime error performing loadMessage"),h}});function t(t){return e.apply(this,arguments)}return t})(),a.load=function(t){return this.$2.gen(t)},t})();l.WebMpsPointQueryApi=d}),98);
__d("PackedMpsRange",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.packMpsRange=e}),66);
__d("WebMpsBatchLoadFromReverb",["MpsLogger","Promise","WebMpsGetIsMessageExpired","WebReverbDB","WormRangeIterator","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=["pk","supplementalKey","threadId","topLevelMessageId"],s;function u(e,t,n,r,o,a,i,l,s,u,d){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i,l,u,c,d,m,p,_){var f,g=a[0],h=a[1],y=d?function(e){return e.isLocalOnlyMessage===!1}:function(e){return!0},C=function(t){return!o("WebMpsGetIsMessageExpired").getIsMessageExpired(t.expiryTimestampMs)},b=function(t){return y(t)&&C(t)};function v(){var e=t.stores.message.getIndexRangeIterator("[threadId+timestampMs+messageId]",i,{greaterThanOrEqual:[r],lessThanOrEqual:[r]},b),n=h==null?[r,g]:[r,g,h];return e.read(n,l)}function S(e){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var a="[threadId+tag+timestampMs]",u=yield(s||(s=n("Promise"))).all(Array.from(e).map(function(e){return t.stores.tags.getIndexRangeIterator(a,i,{greaterThanOrEqual:[r,e],lessThanOrEqual:[r,e]}).read([r,e,g],l)})),c=o("WormRangeIterator").mergeRanges(u,["timestampMs","messageId"],i,l),d=yield s.all(c.data.map(function(e){return t.stores.message.getByIndex("[threadId+messageId]",[e.threadId,e.messageId],{filter:b})})).then(function(e){return e.filter(Boolean)}),m=o("WormRangeIterator").makeCursorInfoFromList(d,["threadId","timestampMs","messageId"],c.cursorInfo.hasNext,c.cursorInfo.hasPrevious);return{cursorInfo:m,data:d}}),R.apply(this,arguments)}var L;m!=="all"?(p.metric.addPoint("load_messages_with_tags_"+_+"_start"),L=yield S(m),p.metric.addPoint("load_messages_with_tags_"+_+"_end")):(p.metric.addPoint("load_messages_canoincal_"+_+"_start"),L=yield v(),p.metric.addPoint("load_messages_canonical_"+_+"_end"));var E=L,k=E.cursorInfo,I=E.data;p.metric.addPoint("load_message_results_"+_+"_start"),p.metric.addAnnotations({bool:{shouldFetchTags:c}});var T=yield(s||(s=n("Promise"))).all(I.map((function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var o=u?yield t.stores.supplemental.readIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[r,n.messageId]}):[],a=new Map;o.forEach(function(t){var n=t.pk,r=t.supplementalKey,o=t.threadId,i=t.topLevelMessageId,l=babelHelpers.objectWithoutPropertiesLoose(t,e);a.set(r,l)});var i=c?yield t.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[r,n.messageId]}):[],l=i.map(function(e){var t=e.tag;return t});return{reverbTopLevel:n,supplementalProtobufs:a,tags:l}});return function(e){return o.apply(this,arguments)}})())),D=T.reduce(function(e,t){return e+t.supplementalProtobufs.size},0);return p.metric.addAnnotations({int:(f={},f["supplementalCount_"+_]=D,f)}),p.metric.addPoint("load_message_results_"+_+"_end"),{cursorInfo:{endCursor:k.endCursor!=null?[k.endCursor[1],k.endCursor[2]]:null,hasNext:k.hasNext,hasPrevious:k.hasPrevious,startCursor:k.startCursor!=null?[k.startCursor[1],k.startCursor[2]]:null},messages:T,threadId:r}}),c.apply(this,arguments)}function d(e,t,n,r,o,a){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i,l,c){try{l.metric.addPoint("reverb_fetch_start");var d=o("WebReverbDB").getWebReverbDB(),m=new Map(yield d.runInTransaction(["message","supplemental","tags"],"readonly",function(r){return(s||(s=n("Promise"))).all(e.map(function(e,n){return u(r,e.threadId,e.from,e.direction,e.numMessages,t,a,i,c,l,n).then(function(t){return[e,t]})}))},"mps-load-messages"));return l.metric.addPoint("reverb_fetch_end"),m}catch(e){var p=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(p).mustfix("Runtime error performing WebMpsBatchLoadFromReverb"),l.metric.addPoint("reverb_fetch_end",{bool:{reverbFail:!0}}),new Map}}),m.apply(this,arguments)}l.batchLoadMessagesFromReverb=d}),98);
__d("WebMpsLoadMessagesFromEb",["MpsLogger","WAPromiseDelays","WAResultOrError","asyncToGeneratorRuntime","getErrorSafe","getSafeQplErrorMessage","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e={endCursor:null,hasNext:!1,hasPrevious:!1,startCursor:null};function s(e,t,n,r,o,a){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i,l){function s(){throw a.metric.addPoint("eb_fetch_timeout"),o("MpsLogger").MpsLogger().mustfixThrow("Timed out waiting for EB Fetch")}var u=e.reduce(function(e,t){return e+t.numMessages},0),c=Math.min(Math.max((u-20)/180,0),1),d=r("justknobx")._("3429")*(1+c*2),m=yield o("WAPromiseDelays").withTimeout(t.messageRangeQuery({ctx:a,ranges:e,source:l,tagsFilter:i}),d,s),p=m.map(function(t,r){var a=e[r],i=a.threadId;if(t.success===!1)return t;var l=t.value,s=l.cursorInfo,u=l.messages,c=n(u,i);return o("WAResultOrError").makeResult({cursorInfo:s,messages:c,threadId:i})});return a.metric.addPoint("eb_fetch_end"),p}),u.apply(this,arguments)}function c(e,t,n,r,o){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l){var u=n.decryptedProtobufToFullMessage,c=n.eb;try{var d=c.isEbEnabled(),m=d===!0?"true":d===!1?"false":"unset";if(a.metric.addAnnotations({string:{ebEnabled:m}}),d!==!0)return new Map(t.map(function(t){return[t,o("WAResultOrError").makeResult({cursorInfo:e,messages:[],threadId:t.threadId})]}));var p=!1;a.metric.addPoint("load-messages-from-eb_start");var _=yield s(t,c,u,a,i,l),f=new Map(t.map(function(e,t){var n=_[t];return n.success===!1&&(p=!0),[e,n]}));return p&&a.metric.addAnnotations({bool:{ebFetchFailed:!0}}),a.metric.addPoint("load-messages-from-eb_end"),f}catch(e){var g=r("getErrorSafe")(e);return a.metric.addPoint("load-messages-from-eb_fail",{string:{ebFetchFailReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),o("MpsLogger").MpsLogger().catching(g).mustfix("Error fetching from EB"),new Map}}),d.apply(this,arguments)}l.loadMessagesFromEb=c}),98);
__d("WebMpsMergeMessageRangesFromDifferentSources",["WebMpsGetDistinctMessages","err","first","last"],(function(t,n,r,o,a,i,l){"use strict";var e=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"];function s(t,n,a,i,l){var s,u,c=o("WebMpsGetDistinctMessages").getDistinctMessages((s=n==null?void 0:n.messages)!=null?s:[],(u=t==null?void 0:t.messages)!=null?u:[]),d=c.messages,m=c.supplementalMessagesToWriteToReverb,p=c.tagsToWriteToReverb,_=c.topLevelMessagesToWriteToReverb;if(n==null||t==null){var f=n!=null?babelHelpers.extends({},n,{messages:n.messages.map(function(t){var n=t.reverbTopLevel,r=t.supplementalProtobufs,o=n.debugFlags,a=n.expiryTimestampMs,i=n.isLocalOnlyMessage,l=n.isTransportErrorPlaceholder,s=n.pk,u=babelHelpers.objectWithoutPropertiesLoose(n,e);return{expiryTimestampMs:a,supplementalProtobufs:r,tags:[],toplevelProtobuf:u}})}):t;if(f==null)throw r("err")("data-fetching-error");return{range:f,supplementalMessagesToWriteToReverb:m,tagsToWriteToReverb:p,topLevelMessagesToWriteToReverb:_}}var g=t,h=[].concat(d).sort(function(e,t){return a==="asc"?e.toplevelProtobuf.timestampMs-t.toplevelProtobuf.timestampMs:t.toplevelProtobuf.timestampMs-e.toplevelProtobuf.timestampMs}),y=h.slice(0,i),C=r("first")(y),b=r("last")(y),v=C!=null?[C.toplevelProtobuf.timestampMs,C.toplevelProtobuf.messageId]:void 0,S=b!=null?[b.toplevelProtobuf.timestampMs,b.toplevelProtobuf.messageId]:void 0,R=S!=null?g.cursorInfo.hasNext||n.cursorInfo.hasNext:!1,L=v!=null?g.cursorInfo.hasPrevious||n.cursorInfo.hasPrevious:!1;return{range:{cursorInfo:{endCursor:S,hasNext:R,hasPrevious:L,startCursor:v},messages:y,threadId:l},supplementalMessagesToWriteToReverb:m,tagsToWriteToReverb:p,topLevelMessagesToWriteToReverb:_}}l.mergeMessageRangesFromDifferentSources=s}),98);
__d("WebMpsEbCache",["MpsTypes","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,a,i){var l=o("WAJids").validateChatJid(t);if(l==null)return[];var s=e.getMetadataFromCache({chatJid:l,direction:n,numberOfMessages:r,referenceMessage:i,referenceTimestamp:a==null?null:o("WATimeUtils").castToMillisTime(a)});return s.success===!1?[]:s.value.map(function(e){var t=e.offlineThreadingId,n=e.sortOrderMs;return{offlineThreadingId:t,sortOrderMs:o("MpsTypes").toTimestamp(n)}})}function s(e,t){if(e==null||t.length===0)return"no-match";if(e.cursorInfo.hasNext!==!0)return"reverb-cursor-ended";var n=new Set(e.messages.map(function(e){return e.reverbTopLevel.messageId})),r=new Set(t.map(function(e){return e.offlineThreadingId}));if(n.size!==r.size)return"no-match";if(Array.from(n).every(function(e){return r.has(e)}))return"match";for(var o=e.messages.map(function(e){return e.reverbTopLevel.timestampMs}).sort(function(e,t){return t-e}),a=t.map(function(e){return e.sortOrderMs}).sort(function(e,t){return t-e}),i=0,l=0;l<o.length;l++){var s=o[l],u=a[i];if(s<u)return"no-match";s>u||i++}return"reverb-newer"}l.loadEBMetadataCache=e,l.compareReverbVsMetadataCache=s}),98);
__d("WebMpsValidateReverbViaCacheAndFetchFromEb",["MpsLogger","WebMpsEbCache","WebMpsLoadMessagesFromEb","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,o){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){var i=yield t;if(a!=="all")return r.metric.addAnnotations({string:{ebMetadataCache:"skip"}}),{eb:yield o("WebMpsLoadMessagesFromEb").loadMessagesFromEb(e,n,r,a),reverb:i};var l=e.filter(function(e){var t=e.direction,a=e.from,l=e.numMessages,s=e.threadId,u=o("WebMpsEbCache").loadEBMetadataCache(n.eb,s,t,l,a[0],a[1]),c=o("WebMpsEbCache").compareReverbVsMetadataCache(i.get(e),u);return r.metric.addAnnotations({string:{ebMetadataCache:c}}),o("MpsLogger").MpsLogger().debug("MPS Range query metadata comparison: ",c),!(c==="match"||t==="desc"&&c==="reverb-newer")});return l.length===0?{eb:new Map,reverb:i}:{eb:yield o("WebMpsLoadMessagesFromEb").loadMessagesFromEb(l,n,r,a),reverb:i}}),s.apply(this,arguments)}l.validateReverbViaCacheAndFetchFromEb=e}),98);
__d("WebMpsBatchLoadMessages",["MpsLogger","PackedMpsRange","WebMpsBatchLoadFromReverb","WebMpsLoadMessagesFromEb","WebMpsMergeMessageRangesFromDifferentSources","WebMpsPersistMessagesFromEb","WebMpsValidateReverbViaCacheAndFetchFromEb","asyncToGeneratorRuntime","err","getErrorSafe","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a){var i=n.persistToReverb,l=n.shouldFetchSupplementals,s=n.shouldFetchTags,u=n.shouldIgnoreLocalOnly,c=n.source,d=n.strategy,m=n.tagsFilter,p=e.map(function(e){return o("PackedMpsRange").packMpsRange(e)});try{a.metric.addPoint("mps_fetch_start");var _=function(){return o("WebMpsBatchLoadFromReverb").batchLoadMessagesFromReverb(p,l,s,u,a,m)},f,g;switch(d){case"full-fetch":{var h=yield o("WebMpsValidateReverbViaCacheAndFetchFromEb").validateReverbViaCacheAndFetchFromEb(p,_(),t,a,m);f=h.reverb,g=h.eb;break}case"local-only":f=yield _(),g=new Map;break;case"remote-only":g=yield o("WebMpsLoadMessagesFromEb").loadMessagesFromEb(p,t,a,m,c),f=new Map;break;default:throw r("err")("empty strategy")}var y=p.map(function(e){var t,n=e.direction,r=e.numMessages,a=e.threadId,i=f.get(e),l=(t=g.get(e))==null?void 0:t.value;if(!(i==null&&l==null)){var s=o("WebMpsMergeMessageRangesFromDifferentSources").mergeMessageRangesFromDifferentSources(l,i,n,r,a),u=s.range,c=s.supplementalMessagesToWriteToReverb,d=s.tagsToWriteToReverb,m=s.topLevelMessagesToWriteToReverb;return{range:u,supplementalMessagesToWriteToReverb:c,tagsToWriteToReverb:d,threadId:a,topLevelMessagesToWriteToReverb:m}}}).filter(Boolean);return i==="persist"&&o("WebMpsPersistMessagesFromEb").persistMessagesFromEB(y.map(function(e){var t=e.supplementalMessagesToWriteToReverb,n=e.tagsToWriteToReverb,r=e.threadId,o=e.topLevelMessagesToWriteToReverb;return{supplementalProtobufs:t,tags:n,threadId:r,topLevelProtobufs:o}})),y.map(function(e){var t=e.range;return t})}catch(e){var C=r("getErrorSafe")(e);throw o("MpsLogger").MpsLogger().catching(C).mustfix("Runtime error performing loadMessages"),a.metric.addAnnotations({string:{errorDescription:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(C)}}),C}}),s.apply(this,arguments)}l.batchLoadMessages=e}),98);
__d("MAWMpsCleanersContants",["DateConsts"],(function(t,n,r,o,a,i,l){"use strict";var e=30*o("DateConsts").MS_PER_DAY,s=6*o("DateConsts").MS_PER_HOUR;l.PURGE_DELETED_MESSAGES_WINDOW_IN_MS=e,l.REPORTING_WINDOW_IN_MS=s}),98);
__d("WebMpsInsertionCleaners",["MAWMpsCleanersContants","MpsDeletedCleaner","MpsEphemeralCleaner","MpsLogger","MpsTypes","Promise","WATimeUtils","asyncToGeneratorRuntime","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{yield(e||(e=n("Promise"))).all(t.map(c)),yield e.all(t.map(m))}catch(e){var a=r("getErrorSafe")(e);o("MpsLogger").MpsLogger().catching(a).mustfix("Failed to run side effects")}}),u.apply(this,arguments)}function c(t){return t.directive.actionType===o("MpsTypes").ActionType.DeleteTopLevel||t.directive.actionType===o("MpsTypes").ActionType.DeleteSupplemental||t.directive.actionType===o("MpsTypes").ActionType.DeleteThread?d(t.message.timestampMs):t.directive.actionType===o("MpsTypes").ActionType.UpsertTopLevel||t.directive.actionType===o("MpsTypes").ActionType.UpsertSupplemental||t.directive.actionType===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder||t.directive.actionType===o("MpsTypes").ActionType.Noop?(e||(e=n("Promise"))).resolve():t.directive.actionType===o("MpsTypes").ActionType.Unknown||t.directive.actionType===o("MpsTypes").ActionType.Preprocess?(e||(e=n("Promise"))).reject(r("err")("this should not happen")):(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t.directive.actionType)})()}function d(t){var r=o("WATimeUtils").castToUnixTime(Math.ceil((t+o("MAWMpsCleanersContants").REPORTING_WINDOW_IN_MS)/1e3));return o("MpsDeletedCleaner").addNewMpsDeletedTimestamp(r),(e||(e=n("Promise"))).resolve()}function m(t){var r,a=(r=t.directive)==null?void 0:r.expiryTimestampMs;if(a==null)return(e||(e=n("Promise"))).resolve();var i=o("WATimeUtils").castToUnixTime(Math.ceil(a/1e3));return o("MpsEphemeralCleaner").addNewMpsEphemeralTimestamp(i),(e||(e=n("Promise"))).resolve()}l.scheduleCleaners=s}),98);
__d("WebMpsInsertionFlow",["MpsLogger","MpsTypes","Promise","WebMpsReverbWrites","WebReverbDB","asyncToGeneratorRuntime","err","getErrorSafe","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{return yield o("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags","dbMetadata"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){for(var n of e)yield m(n,function(e){return e(t)})});return function(e){return t.apply(this,arguments)}})(),"mps-insertion-flow-shared"),new Map}catch(e){o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("Failed to persist messages")}return c(e)}),u.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,n=function*(n){yield m(n,function(e){return o("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted","tags","dbMetadata"],"readwrite",function(t){return e(t)},"mps-insertion-flow-separate")}).catch(function(e){t.set(n.message.messageId,e)})};for(var r of e)yield*n(r);return t}),d.apply(this,arguments)}function m(t,a){switch(t.directive.actionType){case o("MpsTypes").ActionType.UpsertTopLevel:return p(t,a);case o("MpsTypes").ActionType.UpsertSupplemental:return f(t,a);case o("MpsTypes").ActionType.DeleteTopLevel:return h(t,a);case o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return y(t,a);case o("MpsTypes").ActionType.DeleteSupplemental:return C(t,a);case o("MpsTypes").ActionType.DeleteThread:return b(t,a);case o("MpsTypes").ActionType.Noop:return(e||(e=n("Promise"))).resolve();case o("MpsTypes").ActionType.Unknown:case o("MpsTypes").ActionType.Preprocess:return(e||(e=n("Promise"))).reject(r("err")("this should not happen"))}}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.directive,r=e.message;yield o("WebMpsReverbWrites").upsertTopLevelToReverb(r,n,t)}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.directive,a=e.message,i=r("nullthrows")(n.supplementalKey);yield o("WebMpsReverbWrites").upsertSupplementalToReverb(a.messageId,a.payload,i,n.targetMessageId,a.threadId,a.timestampMs,t)}),g.apply(this,arguments)}function h(e,t){var r=e.message,o=e.directive.targetMessageId,a=[r.threadId,o];return t((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=yield e.stores.message.getByIndex("[threadId+messageId]",a),i=yield e.stores.deleted.getByIndex("[threadId+deletedMessageId]",a);if(!(((t=i==null?void 0:i.deletionTimestampMs)!=null?t:0)>=r.timestampMs)){var l={deletedMessageId:o,deletionMessageId:r.messageId,deletionMessagePayload:r.payload,deletionTimestampMs:r.timestampMs,isLocalOnlyMessage:!1,payload:n==null?void 0:n.payload,threadId:r.threadId,timestampMs:n==null?void 0:n.timestampMs};yield e.stores.deleted.bulkUpsert("[threadId+deletedMessageId]",[{item:l,selector:a}]),n&&(yield e.stores.message.bulkDelete([n.pk]))}});return function(t){return e.apply(this,arguments)}})())}function y(e,t){var n=e.directive,r=e.message;return o("WebMpsReverbWrites").upsertTopLevelToReverb(r,n,t)}function C(e,t){var o=e.message,a=r("nullthrows")(e.directive.supplementalKey),i=e.directive.targetMessageId,l=[o.threadId,i,a];return t((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",l);if(n!=null){var r=yield t.stores.deleted.getByIndex("[threadId+topLevelMessageId+supplementalKey]",l,{filter:function(t){return t.deletionTimestampMs>=o.timestampMs}});if(!r){var s={deletedMessageId:n.messageId,deletionMessageId:o.messageId,deletionMessagePayload:o.payload,deletionTimestampMs:o.timestampMs,isLocalOnlyMessage:e.directive.isLocalOnly,payload:n.payload,supplementalKey:a,threadId:o.threadId,timestampMs:n.timestampMs,topLevelMessageId:i};yield t.stores.deleted.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:s,selector:l}]),yield t.stores.supplemental.bulkDelete([n.pk])}}});return function(e){return t.apply(this,arguments)}})())}function b(e,t){var r=e.message;return t((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.supplemental.readKeysByIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[r.threadId]});yield e.stores.supplemental.bulkDelete(t);var n=yield e.stores.message.readIndexRange("[threadId+messageId]",{only:[r.threadId]});yield e.stores.message.bulkDelete(n.map(function(e){return e.pk}));var o=yield e.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:[r.threadId]});yield e.stores.tags.bulkDelete(o);var a=yield e.stores.deleted.readKeysByIndexRange("[threadId+deletedMessageId]",{only:[r.threadId]});yield e.stores.deleted.bulkDelete(a),yield e.stores.deleted.bulkAdd(n.map(function(e){return{deletedMessageId:e.messageId,deletionMessageId:r.messageId,deletionMessagePayload:r.payload,deletionTimestampMs:r.timestampMs,isLocalOnlyMessage:e.isLocalOnlyMessage,payload:e.payload,threadId:e.threadId,timestampMs:e.timestampMs}}))});return function(t){return e.apply(this,arguments)}})())}l.persistNewMessages=s}),98);
__d("WebMpsLoadDeletedMessages",["MpsTypes","Promise","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["pk","supplementalKey","threadId","topLevelMessageId"],s;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=o("WebReverbDB").getWebReverbDB(),i=yield a.runInTransaction(["deleted","supplemental"],"readonly",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=yield r.stores.deleted.readIndexRange("[threadId+timestampMs+deletedMessageId]",{lessThanOrEqual:[t.threadId,o("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER)]},{limit:t.numMessages});return(s||(s=n("Promise"))).all(a.map((function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var o=yield r.stores.supplemental.readIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:[t.threadId,n.deletedMessageId]}),a=new Map;return o.forEach(function(t){var n=t.pk,r=t.supplementalKey,o=t.threadId,i=t.topLevelMessageId,l=babelHelpers.objectWithoutPropertiesLoose(t,e);a.set(r,l)}),{deletedEntity:n,supplementalProtobufs:a}});return function(e){return o.apply(this,arguments)}})()))});return function(e){return r.apply(this,arguments)}})(),"get-deleted-messages-for-spam-report"),l=i.map(function(e){if(e.deletedEntity.payload!=null){var n=e.deletedEntity.payload;if(e.deletedEntity.timestampMs!=null){var o=e.deletedEntity.timestampMs;return r([{otid:e.deletedEntity.deletedMessageId,supplementalProtobufs:new Map(e.supplementalProtobufs.entries().map(function(e){var t=e[0],n=e[1];return[t,{decryptedProtobuf:n.payload,protobufTimestampMS:n.timestampMs}]})),tags:[],toplevelProtobuf:{decryptedProtobuf:n,protobufTimestampMS:o}}],t.threadId)[0]}}}).filter(Boolean);return{messages:l,tombstones:new Set(i.map(function(e){return e.deletedEntity.deletionMessageId}))}}),c.apply(this,arguments)}l.loadDeletedMessages=u}),98);
__d("WebMpsPostprocess",["MpsLogger","Promise","asyncToGeneratorRuntime","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){yield(e||(e=n("Promise"))).all(r.map((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var i=r.process(t,a),l=i instanceof(e||(e=n("Promise")))?yield i.catch(function(e){o("MpsLogger").MpsLogger().catching(e).mustfix("PostProcessor Runtime failure")}):i;l!=null&&l.size>0&&l.forEach(function(e,t){o("MpsLogger").MpsLogger().catching(e).mustfix("Non-critical postprocessor fails %s",t)})});return function(e){return r.apply(this,arguments)}})())).catch(function(e){o("MpsLogger").MpsLogger().catching(e).mustfix("Non-critical postprocessors runtime failure")})}),u.apply(this,arguments)}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){var i=new Map,l=function*(l){a.messageToQpl.all(t.map(function(e){return e.message.messageId})).addPoint(l.name+"_start");var r=l.process(t,a),s=r instanceof(e||(e=n("Promise")))?yield r.catch(function(e){o("MpsLogger").MpsLogger().catching(e).mustfix("PostProcessor Runtime failure")}):r;s!=null&&s.size>0&&s.forEach(function(e,t){i.set(t,e),o("MpsLogger").MpsLogger().catching(e).mustfix("Critical postprocessor fails %s",t),a.messageToQpl.endFail(t,l.name.toLowerCase()+"-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e))}),a.messageToQpl.all(t.map(function(e){return e.message.messageId})).addPoint(l.name+"_end")};for(var s of r)yield*l(s);return i}),d.apply(this,arguments)}l.runNonCriticalPostprocessor=s,l.runCriticalPostprocessor=c}),98);
__d("WebMpsPurgeDeletedPayload",["MAWMpsCleanersContants","MpsTypes","WATimeUtils","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WebReverbDB").getWebReverbDB().runInTransaction(["deleted","supplemental","tags","message"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=o("MpsTypes").toTimestamp(o("WATimeUtils").unixTimeMs()-o("MAWMpsCleanersContants").REPORTING_WINDOW_IN_MS),r=yield t.stores.deleted.readIndexRange("deletionTimestampMs",{lessThanOrEqual:[n]}),a=r.filter(function(e){return e.payload!=null});return e.metric.addAnnotations({int:{num_deletions:a.length}}),yield t.stores.deleted.bulkPut(a.map(function(e){return babelHelpers.extends({},e,{payload:null,timestampMs:null})})),a.length});return function(e){return t.apply(this,arguments)}})(),"web-mps-purge-deletions")}function s(){try{return o("WebReverbDB").getWebReverbDB().runInTransaction(["deleted"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("MpsTypes").toTimestamp(o("WATimeUtils").unixTimeMs()-o("MAWMpsCleanersContants").REPORTING_WINDOW_IN_MS),n=yield e.stores.deleted.readIndexRange("deletionTimestampMs",{greaterThan:[t]},{order:"asc"}),r=n.filter(function(e){return e.payload!=null});if(!(r.length===0||r[0].deletionTimestampMs==null))return o("WATimeUtils").castMilliSecondsToUnixTime(r[0].deletionTimestampMs+o("MAWMpsCleanersContants").REPORTING_WINDOW_IN_MS)});return function(t){return e.apply(this,arguments)}})(),"web-mps-next-deletion-timestamp-ms")}catch(e){throw e}}l.purgeDeletedPayload=e,l.getNextDeletionTimestampMs=s}),98);
__d("WebMpsPurgeDeletions",["MAWMpsCleanersContants","MpsTypes","Promise","WATimeUtils","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("WebReverbDB").getWebReverbDB().runInTransaction(["deleted","supplemental","tags","message"],"readwrite",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=o("MpsTypes").toTimestamp(o("WATimeUtils").unixTimeMs()-o("MAWMpsCleanersContants").PURGE_DELETED_MESSAGES_WINDOW_IN_MS),i=yield r.stores.deleted.readIndexRange("deletionTimestampMs",{lessThanOrEqual:[a]}),l=i.map(function(e){return[e.threadId,e.deletedMessageId]});t.metric.addAnnotations({int:{num_deletions:i.length}});var s=(e||(e=n("Promise"))).all(l.map(function(e){return r.stores.supplemental.readKeysByIndexRange("[threadId+topLevelMessageId+supplementalKey]",{only:e})})).then(function(e){return e.flat()}).then(function(e){return r.stores.supplemental.bulkDelete(e)}),u=e.all(l.map(function(e){return r.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:e})})).then(function(e){return e.flat()}).then(function(e){return r.stores.tags.bulkDelete(e)}),c=r.stores.deleted.bulkDelete(i.map(function(e){return e.pk}));return yield e.all([s,u,c]),i.length});return function(e){return r.apply(this,arguments)}})(),"web-mps-purge-deletions")}l.purgeDeletions=s}),98);
__d("WebMpsScheduler",["WorkerScheduler","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){if(e==null){var t;e=o("WorkerScheduler").makeScheduler("MPS",{concurrency:(t=r("justknobx"))._("4338"),defaultSamplingRate:t._("4540"),maxTaskLimit:t._("4338"),maxThrottleMs:t._("4339"),timeoutMs:t._("4337")})}return e}l.mpsScheduler=s}),98);
__d("WmiMultiQplTracker",["QPLMultiplexedFlow"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map,s=(function(){function e(e){var t=this;this.$1=new Map,e.forEach(function(e){t.$1.set(e[0],e[1])})}e.from=function(n){return new e(n)};var t=e.prototype;return t.addAnnotations=function(t,n){var e;(e=this.$1.get(t))==null||e.addAnnotations(n)},t.addPoint=function(t,n,r){var e;(e=this.$1.get(t))==null||e.addPoint(n,r)},t.endSuccess=function(t){var e=this.$1.get(t);e!=null&&(e.endSuccess(),this.$1.delete(t),this.$2=null)},t.endFail=function(t,n,r){var e=this.$1.get(t);e!=null&&(e.endFail(n,{string:{errorDescription:r}}),this.$1.delete(t),this.$2=null)},t.size=function(){return this.$1.size},t.all=function(t){var e=this;if(t!=null){var n=t.map(function(t){return e.$1.get(t)}).filter(Boolean);return o("QPLMultiplexedFlow").makeQplMultiplexedFlow(n)}if(!this.$2){var r=o("QPLMultiplexedFlow").makeQplMultiplexedFlow(Array.from(this.$1.values()));return this.$2=r,r}return this.$2},t.failAllPending=function(t){this.$1.forEach(function(e){return e.endFail(t)}),this.$1.clear(),this.$2=null},e.empty_TEST_ONLY=function(){return new e([])},e})();function u(t,n){e.set(t,n)}function c(t){return e.get(t)}l.WmiMultiQplTracker=s,l.trackQplForSeqId=u,l.getQplForSeqId=c}),98);
__d("memoizeWithArgsLFUCache",["LFUCache"],(function(t,n,r,o,a,i,l){function e(e,t,n,o){var a;function i(){return a||(a=new(r("LFUCache"))(n)),a}function l(e){if(e===void 0)a=null;else{var t;(t=a)==null||t.delete(e)}}o&&o(l);var s=function(){var n=i(),r=t.apply(void 0,arguments);n.has(r)||n.set(r,e.apply(void 0,arguments));var o=n.get(r);return o};return s}l.default=e}),98);
__d("schedulePeriodicTask",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e,t){var r=(function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield e()}finally{globalThis.setTimeout(r,t)}});return function(){return o.apply(this,arguments)}})();globalThis.setTimeout(r,0)}i.schedulePeriodicTask=e}),66);
__d("WebMps",["DateConsts","MpsDeletedCleaner","MpsEphemeralCleaner","MpsLogger","MpsReverbDbDump","MpsReverbInit","MpsTypes","Promise","QPLFlow","WAPromiseQueue","WAResultOrError","WATimeUtils","WAWaitForUserUnblocked","WebMpsBatchLoadMessage","WebMpsBatchLoadMessages","WebMpsInsertionCleaners","WebMpsInsertionFlow","WebMpsLoadDeletedMessages","WebMpsPostprocess","WebMpsPurgeDeletedPayload","WebMpsPurgeDeletions","WebMpsPurgeExpiredMessages","WebMpsScheduler","WmiMultiQplTracker","WorkerScheduler","asyncToGeneratorRuntime","err","getErrorSafe","getSafeQplErrorMessage","justknobx","memoizeWithArgsLFUCache","mergeMaps","qpl","schedulePeriodicTask"],(function(t,n,r,o,a,i,l){"use strict";var e=["debug"],s=["config"],u=["debug"],c,d;function m(e){return JSON.stringify(e)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.db,n=e.dependencies,a=e.getMpsExtensionConfiguration;if(d!=null)throw r("err")("MPS already initialised");yield o("MpsReverbInit").initReverb(t);var i=new f(a(),n);return d=i,i}),_.apply(this,arguments)}var f=(function(){function t(t,a){var i=this;this.$3=[],this.$6=new(o("WAPromiseQueue")).PromiseQueue,this.batchLoadMessage=function(e){var t,n,a,l,s=e.config,u=e.debug,c=e.messageIds,d=e.threadId,m={persistToReverb:(t=s==null?void 0:s.persistToReverb)!=null?t:"persist",shouldFetchSupplementals:(n=s==null?void 0:s.shouldFetchSupplementals)!=null?n:!0,shouldFetchTags:(a=s==null?void 0:s.shouldFetchTags)!=null?a:!0,strategy:(l=s==null?void 0:s.strategy)!=null?l:"full-fetch"};return o("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:u.purpose,strategy:m.strategy}},customFlags:{runtimeReliability:!0},eventSamplingRate:r("justknobx")._("4538"),fn:function(t){return i.$2.batchLoad({config:m,ctx:t,messageIds:c,threadId:d})},name:"batch-load-message",priority:o("WorkerScheduler").BLOCKING_PRIORITY}).then(function(e){return i.$10(e.filter(Boolean),m),o("WAResultOrError").makeResult(e)}).catch(function(e){var t=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(t).mustfix("Runtime error in batchLoadMessage"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",t)})},this.$11=r("memoizeWithArgsLFUCache")(function(e){var t,a,l,s,u=e.config,c=e.debug,d=e.messageId,m=e.threadId,p={persistToReverb:(t=u==null?void 0:u.persistToReverb)!=null?t:"persist",shouldFetchSupplementals:(a=u==null?void 0:u.shouldFetchSupplementals)!=null?a:!0,shouldFetchTags:(l=u==null?void 0:u.shouldFetchTags)!=null?l:!0,strategy:(s=u==null?void 0:u.strategy)!=null?s:"full-fetch"};return o("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:c.purpose,strategy:p.strategy}},customFlags:{runtimeReliability:!0},eventSamplingRate:r("justknobx")._("4536"),fn:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield i.$2.load({config:p,ctx:e,messageId:d,threadId:m});return t!=null&&i.$10([t],p),t});function t(t){return e.apply(this,arguments)}return t})(),name:"load-message",priority:o("WorkerScheduler").BLOCKING_PRIORITY})},function(t){var n=t.debug,r=babelHelpers.objectWithoutPropertiesLoose(t,e);return m(babelHelpers.extends({},r,{ebEnabled:i.$1.eb.isEbEnabled()}))},1,function(e){i.$3.push(e)}),this.loadMessage=function(e){return i.$11(e).then(function(e){return o("WAResultOrError").makeResult(e)}).catch(function(e){i.$7();var t=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(t).mustfix("Runtime error in loadMessage"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",t)})},this.$12=function(e){var t,n,a=e.config,l=e.debug,s=e.ranges;return o("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:l.purpose,strategy:(t=a==null?void 0:a.strategy)!=null?t:"full-fetch"}},customFlags:{runtimeReliability:!0},eventSamplingRate:r("justknobx")._("4538"),fn:function(t){return o("WebMpsBatchLoadMessages").batchLoadMessages(s.map(function(e){var t=e.direction,n=e.from,r=e.numMessages,a=e.threadId;return{direction:t,from:[o("MpsTypes").toTimestamp(o("WATimeUtils").miAdjustTimestamp(n[0])),n[1]],numMessages:r,threadId:a}}),i.$1,a,t)},name:"batch-load-messages",priority:(n=a.priority)!=null?n:o("WorkerScheduler").BLOCKING_PRIORITY})},this.batchLoadMessages=function(e){var t,n,a,l,u,c,d,m=e.config,p=babelHelpers.objectWithoutPropertiesLoose(e,s),_={persistToReverb:(t=m==null?void 0:m.persistToReverb)!=null?t:"persist",priority:(n=m==null?void 0:m.priority)!=null?n:o("WorkerScheduler").BLOCKING_PRIORITY,shouldFetchSupplementals:(a=m==null?void 0:m.shouldFetchSupplementals)!=null?a:!0,shouldFetchTags:(l=m==null?void 0:m.shouldFetchTags)!=null?l:!0,shouldIgnoreLocalOnly:(u=m==null?void 0:m.shouldIgnoreLocalOnly)!=null?u:!1,strategy:(c=m==null?void 0:m.strategy)!=null?c:"full-fetch",tagsFilter:(d=m==null?void 0:m.tagsFilter)!=null?d:"all"};return i.$12(babelHelpers.extends({},p,{config:_})).then(function(e){var t=e.flatMap(function(e){return e.messages});return i.$10(t,_),o("WAResultOrError").makeResult(e)}).catch(function(e){var t=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(t).mustfix("Runtime error in batchLoadMessages"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",t)})},this.$13=r("memoizeWithArgsLFUCache")(function(e){var t,n,a,l,s,u,c,d=e.config,m=e.debug,p=e.direction,_=e.from,f=e.numMessages,g=e.source,h=e.threadId,y={persistToReverb:(t=d==null?void 0:d.persistToReverb)!=null?t:"persist",shouldFetchSupplementals:(n=d==null?void 0:d.shouldFetchSupplementals)!=null?n:!0,shouldFetchTags:(a=d==null?void 0:d.shouldFetchTags)!=null?a:!0,shouldIgnoreLocalOnly:(l=d==null?void 0:d.shouldIgnoreLocalOnly)!=null?l:!1,source:g,strategy:(s=d==null?void 0:d.strategy)!=null?s:"full-fetch",tagsFilter:(u=d==null?void 0:d.tagsFilter)!=null?u:"all"};return o("WebMpsScheduler").mpsScheduler().runTask({annotations:{string:{purpose:m.purpose,strategy:y.strategy}},customFlags:{runtimeReliability:!0},eventSamplingRate:r("justknobx")._("4538"),fn:function(t){return o("WebMpsBatchLoadMessages").batchLoadMessages([{direction:p,from:[o("MpsTypes").toTimestamp(o("WATimeUtils").miAdjustTimestamp(_[0])),_[1]],numMessages:f,threadId:h}],i.$1,y,t).then(function(e){e.length>1&&o("MpsLogger").MpsLogger().mustfix("loadMessages returned more than one range");var t=e.at(0);if(t==null)throw r("err")("loadMessages returned no result. Likely this is the result of both reverb and EB queries failing");return i.$10(t.messages,y),t})},name:"load-messages",priority:(c=d==null?void 0:d.priority)!=null?c:o("WorkerScheduler").BLOCKING_PRIORITY})},function(e){var t,n=e.debug,r=babelHelpers.objectWithoutPropertiesLoose(e,u);return m(babelHelpers.extends({},r,{config:babelHelpers.extends({},r.config,{tagsFilter:(function(e){if(e==="all"||e===void 0)return"all";{var t=e;return Array.from(t.values())}})((t=r.config)==null?void 0:t.tagsFilter)}),ebEnabled:i.$1.eb.isEbEnabled()}))},10/60,function(e){i.$3.push(e)}),this.loadMessages=function(e){return i.$13(e).then(function(e){return o("WAResultOrError").makeResult(e)}).catch(function(e){i.$7();var t=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(t).mustfix("Runtime error in loadMessages"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",t)})},this.extensionConfiguration=t,this.$1=a,this.$2=new(o("WebMpsBatchLoadMessage")).WebMpsPointQueryApi(a),this.$4(),this.$5(function(e){return a.generateDeletionMessage(e)})}var a=t.prototype;return a.saveNewMessages=function(t,a){var e=this,i=o("WebMpsScheduler").mpsScheduler().task({annotations:{string:{source:a.source}},customFlags:{runtimeReliability:!0},eventSamplingRate:r("justknobx")._("4535"),fn:(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){e.$7();var n={messageToQpl:o("WmiMultiQplTracker").WmiMultiQplTracker.from(t.map(function(e){return[e.message.messageId,o("QPLFlow").startQPLFlow(r("qpl")._(1056834650,"494"),{annotations:{string:{messageId:e.message.messageId,senderId:e.message.senderId,threadId:e.message.threadId}}})]}))};n.messageToQpl.all(t.map(function(e){return e.message.messageId})).addPoint("preprocess_start");var a=yield e.extensionConfiguration.preprocessors.run({ctx:n,payloadList:t}),i=a.errors,l=a.payloadList;n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("preprocess_end"),i.entries().forEach(function(e){var t=e[0],r=e[1];n.messageToQpl.endFail(t,"preprocess-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r))}),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("schedule_cleaners_start"),yield o("WebMpsInsertionCleaners").scheduleCleaners(l),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("schedule_cleaners_end"),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("persist_start");var s=yield o("WebMpsInsertionFlow").persistNewMessages(l);n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("persist_end"),s.entries().forEach(function(e){var t=e[0],r=e[1];n.messageToQpl.endFail(t,"persist-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r))}),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("persisted"),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("critical_postprocess_start");var u=yield e.$8(l,n);return n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("critical_postprocess_end"),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("non_critical_postprocess_start"),e.$9(l,n),n.messageToQpl.all(l.map(function(e){return e.message.messageId})).addPoint("non_critical_postprocess_end"),l.forEach(function(e){n.messageToQpl.endSuccess(e.message.messageId)}),r("mergeMaps")(i,s,u)});function i(){return a.apply(this,arguments)}return i})(),name:"save-new-messages",priority:o("WorkerScheduler").BLOCKING_PRIORITY});return this.$6.enqueue(function(){return i.run()})},a.$9=function(t,n){o("WebMpsPostprocess").runNonCriticalPostprocessor(t,this.extensionConfiguration.postProcessors.nonCritical,n).catch(function(e){var t=r("getErrorSafe")(e);o("MpsLogger").MpsLogger().catching(t).mustfix("Non-critical postprocessor failed with runtime error")})},a.$8=function(t,n){return o("WebMpsPostprocess").runCriticalPostprocessor(t,this.extensionConfiguration.postProcessors.critical,n).catch(function(e){var t=r("getErrorSafe")(e);return o("MpsLogger").MpsLogger().catching(t).mustfix("Critical postprocessor failed with runtime error"),new Map})},a.purgeDeletions=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("WebMpsScheduler").mpsScheduler().runTask({fn:o("WebMpsPurgeDeletions").purgeDeletions,name:"purge-deletions",priority:o("WorkerScheduler").BACKGROUND_PRIORITY})}catch(e){return o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("failed running purgeDeletions"),0}});function t(){return e.apply(this,arguments)}return t})(),a.purgeDeletedPayload=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("WebMpsScheduler").mpsScheduler().runTask({fn:o("WebMpsPurgeDeletedPayload").purgeDeletedPayload,name:"purge-deleted-payload",priority:o("WorkerScheduler").BACKGROUND_PRIORITY})}catch(e){return o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("failed running purgeDeletedPayload"),0}});function t(){return e.apply(this,arguments)}return t})(),a.getNextDeletionTimestampMs=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("WebMpsScheduler").mpsScheduler().runTask({fn:o("WebMpsPurgeDeletedPayload").getNextDeletionTimestampMs,name:"get-next-deletion-timestamp-ms",priority:o("WorkerScheduler").BACKGROUND_PRIORITY})}catch(e){o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("failed running getNextDeletionTimestampMs")}});function t(){return e.apply(this,arguments)}return t})(),a.purgeExpiredMessages=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("WebMpsScheduler").mpsScheduler().runTask({eventSamplingRate:r("justknobx")._("4539"),fn:function(n){return o("WebMpsPurgeExpiredMessages").purgeExpiredMessages(e,n)},name:"purge-expired-messages",priority:o("WorkerScheduler").BACKGROUND_PRIORITY})}catch(e){return o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("failed running purgeExpiredMessages"),0}});function t(t){return e.apply(this,arguments)}return t})(),a.getNextExpiryTimestampMs=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{return yield o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("WebMpsScheduler").mpsScheduler().runTask({eventSamplingRate:r("justknobx")._("4539"),fn:o("WebMpsPurgeExpiredMessages").getNextExpiryTimestampMs,name:"get-next-expire-timestamp-ms",priority:o("WorkerScheduler").BACKGROUND_PRIORITY})}catch(e){o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("failed running getNextExpiryTimestampMs")}});function t(){return e.apply(this,arguments)}return t})(),a.debugDbDump=function(){return o("MpsReverbDbDump").debugGetReverbDbDump()},a.spamReportLoadMessages=function(t){var e=this;return o("WebMpsScheduler").mpsScheduler().runTask({fn:(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var r=yield(c||(c=n("Promise"))).all([e.$13({config:{persistToReverb:"no-persist",shouldFetchSupplementals:!0,shouldFetchTags:!1,shouldIgnoreLocalOnly:!1,strategy:"local-only",tagsFilter:"all"},debug:{purpose:"get-latest-msgs-for-spam-report"},direction:"desc",from:[o("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),null],numMessages:t.numMessages,threadId:t.threadId}),o("WebMpsLoadDeletedMessages").loadDeletedMessages(t,e.$1.decryptedProtobufToFullMessage)]),a=r[0],i=r[1],l=a.messages.filter(function(e){return!i.tombstones.has(e.toplevelProtobuf.messageId)});return[].concat(l,i.messages).toSorted(function(e,t){return t.toplevelProtobuf.timestampMs-e.toplevelProtobuf.timestampMs}).slice(0,t.numMessages)});function a(){return r.apply(this,arguments)}return a})(),name:"get-latest-msgs-for-spam-report"})},a.$7=function(){this.$3.forEach(function(e){return e()})},a.$10=function(t,n){var e=this.extensionConfiguration.readSideEffects;if(!(e==null||t.length===0))try{e(t,n)}catch(e){o("MpsLogger").MpsLogger().catching(r("getErrorSafe")(e)).mustfix("readSideEffects failed")}},a.$4=function(){var e=this;o("schedulePeriodicTask").schedulePeriodicTask(function(){return e.purgeDeletions()},o("DateConsts").MS_PER_MIN*20)},a.$5=function(t){var e=this;o("MpsEphemeralCleaner").startMpsEphemeralCleaner({getNextTs:function(){return e.getNextExpiryTimestampMs()},purgeEnabled:function(){return!0},removeExpired:function(){return e.purgeExpiredMessages(t)}}),o("MpsDeletedCleaner").startMpsDeletedCleaner({getNextTs:function(){return e.getNextDeletionTimestampMs()},purgeEnabled:function(){return!0},removeExpired:function(){return e.purgeDeletedPayload()}})},t})();function g(){if(d==null)throw r("err")("MPS not initialised");return d}function h(){d=void 0}l.makeMps=p,l.mps=g,l.resetMps_TEST_ONLY=h}),98);
__d("WebMpsPurgeExpiredMessages",["MpsTypes","WATimeUtils","WebMps","WebReverbDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["debugFlags","expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk","timestampMs"];function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=o("MpsTypes").toTimestamp(o("WATimeUtils").unixTimeMs()),i=yield o("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.message.readIndexRange("expiryTimestampMs",{lessThanOrEqual:[a]});return r.metric.addAnnotations({int:{num_expired_messages:t.length}}),t});return function(t){return e.apply(this,arguments)}})(),"web-mps-purge-deletions");if(i.length===0)return 0;var l=i.map(function(n){var r=n.debugFlags,i=n.expiryTimestampMs,l=n.isLocalOnlyMessage,s=n.isTransportErrorPlaceholder,u=n.pk,c=n.timestampMs,d=babelHelpers.objectWithoutPropertiesLoose(n,e);return{directive:null,insertionSource:o("MpsTypes").InsertionSource.Send,message:t(babelHelpers.extends({},d,{timestampMs:a}))}});return yield o("WebMps").mps().saveNewMessages(l,{source:"purge-expired-messages"}),i.length}),u.apply(this,arguments)}function c(){try{return o("WebReverbDB").getWebReverbDB().runInTransaction(["message"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("MpsTypes").toTimestamp(o("WATimeUtils").unixTimeMs()),n=yield e.stores.message.readIndexRange("expiryTimestampMs",{greaterThan:[t]},{limit:1,order:"asc"});if(!(n.length===0||n[0].expiryTimestampMs==null))return o("WATimeUtils").castMilliSecondsToUnixTime(n[0].expiryTimestampMs)});return function(t){return e.apply(this,arguments)}})(),"web-mps-next-expiry-timestamp-ms")}catch(e){throw e}}l.purgeExpiredMessages=s,l.getNextExpiryTimestampMs=c}),98);
__d("MAWBlockUtils",["I64","LSContactUserBlockAction","LSIntEnum","LSThreadBitOffset","ReQL","asyncToGeneratorRuntime","promiseDone","react","react-compiler-runtime","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(c||(c=o("react"))).useCallback,m=[0,31,35,55,56,58,24,25,19,85],p=[0,31,35,55,56,58,24,25,19,85,8,22],_=[35,19,85,56,24,25];function f(){var t=o("react-compiler-runtime").c(2),a=(e||(e=r("useReStore")))(),l;return t[0]!==a?(l=function(t,l){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.participants).getKeyRange(t));if(e!=null){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.threads).getKeyRange(e.threadKey).filter(g));if(n!=null){var c=(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSContactUserBlockAction").MN_BLOCK))?o("LSThreadBitOffset").clear(m,n.capabilities,n.capabilities2,n.capabilities3,n.capabilities4,n.capabilities5):(s||(s=o("I64"))).equal(l,(u||(u=o("LSIntEnum"))).ofNumber(r("LSContactUserBlockAction").FB_BLOCK))?o("LSThreadBitOffset").clear(p,n.capabilities,n.capabilities2,n.capabilities3,n.capabilities4,n.capabilities5):o("LSThreadBitOffset").set(_,n.capabilities,n.capabilities2,n.capabilities3,n.capabilities4,n.capabilities5),d=c[0],f=c[1];yield a.runInTransaction(function(e){var t=babelHelpers.extends({},n,{capabilities:d,capabilities2:f});return e.threads.put(t)},"readwrite",void 0,void 0,i.id+":137")}}})())},t[0]=a,t[1]=l):l=t[1],l}function g(e){return(s||(s=o("I64"))).equal(e.threadType,(u||(u=o("LSIntEnum"))).ofNumber(15))}l.clearedMnBlockCapabilities=m,l.clearedFbBlockCapabilities=p,l.useChangeThreadBlockCapabilities=f}),98);
__d("MAWMessageRequestUtil",["I64","LSContactBitOffset","LSContactViewerRelationship","LSIntEnum","LSMessagingThreadTypeUtil","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n,a){if(t==="pending"||t==="other")return o("MWFBLogger").MWLogger().debug("isMessagerRequestV2 returns true: folderName is "+t+", contactViewerRelationship is "+(e||(e=o("I64"))).to_string(a.contactViewerRelationship)),!0;var i=o("LSContactBitOffset").hasWithDefault(64,a,!0);return t==="inbox"&&(e||(e=o("I64"))).equal(a.contactViewerRelationship,(s||(s=o("LSIntEnum"))).ofNumber(r("LSContactViewerRelationship").NOT_CONTACT))&&!i?(n&&o("MWFBLogger").MWLogger().debug("isMessagerRequestV2 returns true: folderName is inbox, contactViewerRelationship is "+(e||(e=o("I64"))).to_string(a.contactViewerRelationship)+", isViewerUnconnected is false, hasActivity is true"),n):!1}function c(e){return e==="pending"||e==="other"}function d(e){return o("LSMessagingThreadTypeUtil").isOneToOne(e.threadType)?c(e.folderName):!1}function m(t,n){return n!=null?u(t.folderName,(e||(e=o("I64"))).gt(t.lastActivityTimestampMs,e.zero),n[1]):!1}function p(e,t){return o("LSMessagingThreadTypeUtil").isOneToOne(e.threadType)?m(e,t):!1}function _(e){return o("LSMessagingThreadTypeUtil").isGroup(e.threadType)?c(e.folderName):!1}var f=[8,18,19,34,24,25,122],g=[21,48];l.isMessageRequestV2=u,l.isOneOnOneMessageRequest=d,l.isOneOnOneMessageRequestV2=p,l.isGroupMessageRequest=_,l.disabledThreadCapabilitiesForIncomingRequest=f,l.enabledThreadCapabilitiesForIncomingRequest=g}),98);
__d("clearedMAWMnRestrictCapabilities",[],(function(t,n,r,o,a,i){"use strict";var e=[0,31,35,55,56,58,24,25,35,19],l=e;i.default=l}),66);
__d("MAWUpdateLSThreadCapabilities",["fbt","I64","LSBitOffset","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWBlockUtils","MAWCurrentUser","MAWMessageRequestUtil","Promise","ReQL","asyncToGeneratorRuntime","clearedMAWMnRestrictCapabilities","emptyFunction"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d=o("MAWCurrentUser").getID(),m=(c||(c=o("I64"))).of_string(d);function p(t,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(a)).then(function(r){if(r==null)return(e||(e=n("Promise"))).resolve();var a=o("LSBitOffset").set((u||(u=o("LSIntEnum"))).ofNumber(27),r.capabilities),i=babelHelpers.extends({},r,{capabilities:a});return t.threads.put(i)}).then(r("emptyFunction"))}function _(t,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(a)).then(function(r){if(r==null)return(e||(e=n("Promise"))).resolve();var a=o("LSBitOffset").clear((u||(u=o("LSIntEnum"))).ofNumber(27),r.capabilities),i=babelHelpers.extends({},r,{capabilities:a});return t.threads.put(i)}).then(r("emptyFunction"))}function f(t,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.threads).getKeyRange(a)).then(function(r){if(r==null)return(e||(e=n("Promise"))).resolve([void 0,void 0]);var i=o("ReQL").firstAsync(o("LSMessagingThreadTypeUtil").isOneToOne(r.threadType)?o("ReQL").mergeJoin(o("ReQL").fromTableAscending(t.participants).getKeyRange(a),o("ReQL").fromTableAscending(t.contacts)).filter(function(e){var t=e[1];return!(c||(c=o("I64"))).equal(t.id,m)}).map(function(e){var t=e[1];return t}):o("ReQL").empty());return(e||(e=n("Promise"))).all([e.resolve(r),i])}).then(function(a){var i=a[0];if(i==null)return(e||(e=n("Promise"))).resolve();var l=a[1];if(l==null)return(e||(e=n("Promise"))).resolve();var s=(c||(c=o("I64"))).equal(l.blockedByViewerStatus,(u||(u=o("LSIntEnum"))).ofNumber(r("LSContactBlockedByViewerStatus").MESSAGE_BLOCKED)),d=c.equal(l.blockedByViewerStatus,u.ofNumber(r("LSContactBlockedByViewerStatus").FULLY_BLOCKED)),m=o("LSContactBitOffset").has(66,l),p=d?o("LSThreadBitOffset").clear(o("MAWBlockUtils").clearedFbBlockCapabilities,i.capabilities,i.capabilities2,i.capabilities3,i.capabilities4,i.capabilities5):s?o("LSThreadBitOffset").clear(o("MAWBlockUtils").clearedMnBlockCapabilities,i.capabilities,i.capabilities2,i.capabilities3,i.capabilities4,i.capabilities5):m?o("LSThreadBitOffset").clear(r("clearedMAWMnRestrictCapabilities"),i.capabilities,i.capabilities2,i.capabilities3,i.capabilities4,i.capabilities5):[i.capabilities,i.capabilities2,i.capabilities3,i.capabilities4,i.capabilities5],_=p[0],f=p[1],g=p[2],h=p[3],y=p[4];return t.threads.put(babelHelpers.extends({},i,{capabilities:_,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:y})).then(r("emptyFunction"))})}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=t.threads,i=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a).getKeyRange(r));if(i==null)return(e||(e=n("Promise"))).resolve();var l=o("LSThreadBitOffset").set.apply(o("LSThreadBitOffset"),[o("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest].concat(o("LSThreadBitOffset").clear(o("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,i.capabilities,i.capabilities2,i.capabilities3,i.capabilities4,i.capabilities5))),s=l[0],u=l[1],c=l[2],d=l[3],m=l[4];yield a.put(babelHelpers.extends({},i,{additionalThreadContext:void 0,capabilities:s,capabilities2:u,capabilities3:c,capabilities4:d,capabilities5:m}))}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t));if(r!=null){var a=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.contacts,["name"]).getKeyRange(n));if(a!=null){var i=s._(/*BTDS*/"\u0b9a\u0bc7\u0bb0\u0bcd\u0bb5\u0ba4\u0bb1\u0bcd\u0b95\u0bc1 \u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bc8 {Inviter Name} \u0b85\u0bb4\u0bc8\u0ba4\u0bcd\u0ba4\u0bc1\u0bb3\u0bcd\u0bb3\u0bbe\u0bb0\u0bcd",[s._param("Inviter Name",a.name)]).toString(),l=o("LSThreadBitOffset").set([105],r.capabilities,r.capabilities2,r.capabilities3,r.capabilities4,r.capabilities5),u=l[0],c=l[1],d=l[2],m=l[3],p=l[4];yield e.threads.put(babelHelpers.extends({},r,{capabilities:u,capabilities2:c,capabilities3:d,capabilities4:m,capabilities5:p,snippet:i}))}}}),C.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t));if(r!=null){var a=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.group_invites).getKeyRange(t)),i=o("LSThreadBitOffset").clear([105],r.capabilities,r.capabilities2,r.capabilities3,r.capabilities4,r.capabilities5),l=i[0],s=i[1],u=i[2],c=i[3],d=i[4];yield e.threads.put(babelHelpers.extends({},r,{capabilities:l,capabilities2:s,capabilities3:u,capabilities4:c,capabilities5:d,snippet:void 0})),yield a.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield e.group_invites.delete(t.threadKey,t.inviterId,t.inviteeId)});return function(e){return t.apply(this,arguments)}})())}}),v.apply(this,arguments)}l.enableAddMembersTxn=p,l.disableAddMembersTxn=_,l.disableBlockerCapabilitiesTxn=f,l.updateNonMessageRequestThreadTxn=g,l.setGroupInviteTxn=y,l.clearGroupInviteTxn=b}),226);
__d("uniqueArray",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(t,n){var r=n!=null?n:e,o=[],a=new Set;return t.forEach(function(e){var t=r(e);a.has(t)||(a.add(t),o.push(e))}),o}i.default=l}),66);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWJids","MAWMiActMappingTableAPI","MAWUpdateLSThreadCapabilities","Promise","asyncToGeneratorRuntime","uniqueArray"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c,d=o("MAWCurrentUser").getID(),m=(c||(c=o("I64"))).of_string(d);function p(e,t){var n=t.map(function(e){var t=e.chatJid,n=e.type,r=e.userJid;return babelHelpers.extends({chatJid:t},E(n),{userJid:r})});return f(e,n)}function _(e,t){var n=t.participants.map(function(e){return{chatJid:e.threadJid,isAdmin:e.isAdmin,isInvited:e.isInvited,isSuperAdmin:e.isSuperAdmin,userJid:o("MAWJids").toUserJid(e.fbid)}});return f(e,n)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield C(t,r);yield(e||(e=n("Promise"))).all(a.map(function(r){var a=r.mawParticipant,i=r.threadKey,l=o("MAWJids").convertChatJidToIntJid(a.userJid);return[t.participants.get(i,l).then(function(r){var o=R(r,a,i);return r!=null?t.participants.put(o):(e||(e=n("Promise"))).all([t.participants.add(o),h(t,l)])}),v(t,l,i,a.isAdmin)]}).flat(1/0))}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){yield r("LSVerifyContactRowExistsStoredProcedure")(r("LSFactory")(e),{authorityLevel:(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:u.ofNumber(r("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:u.ofNumber(r("LSContactIdType").FBID),contactType:u.ofNumber(r("LSContactType").USER),contactViewerRelationship:u.ofNumber(r("LSContactViewerRelationship").UNKNOWN),gender:u.ofNumber(r("LSContactGender").UNKNOWN),id:t,isBlocked:!1,isMemorialized:!1,isSelf:d===(c||(c=o("I64"))).to_string(t),workForeignEntityType:u.ofNumber(r("LSContactWorkForeignEntityType").UNKNOWN)})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=r("uniqueArray")(a.map(function(e){return e.chatJid})),l=new Map;return yield(e||(e=n("Promise"))).all(i.map(function(e){return o("MAWMiActMappingTableAPI").getThreadKeyForChatJid(t,e).then(function(t){return t!=null&&l.set(e,t)})})),a.map(function(e){var t=l.get(e.chatJid);return t==null?null:{mawParticipant:e,threadKey:t}}).filter(Boolean)}),b.apply(this,arguments)}function v(e,t,n,r){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){yield o("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(e,n),(c||(c=o("I64"))).equal(m,t)&&(r?yield o("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(e,n):yield o("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(e,n))}),S.apply(this,arguments)}function R(e,t,n){return e==null?babelHelpers.extends({},L(t),{authorityLevel:(c||(c=o("I64"))).zero,contactId:o("MAWJids").convertChatJidToIntJid(t.userJid),deliveredWatermarkTimestampMs:c.zero,isSuperAdmin:t.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:c.zero,readWatermarkTimestampMs:c.zero,threadKey:n,threadRoles:c.zero}):babelHelpers.extends({},e,L(t))}function L(e){return{groupParticipantJoinState:e.isInvited?(u||(u=o("LSIntEnum"))).ofNumber(r("LSGroupParticipantJoinState").INVITED):(u||(u=o("LSIntEnum"))).ofNumber(r("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,subscribeSource:e.isSuperAdmin?s._(/*BTDS*/"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0b89\u0bb0\u0bc1\u0bb5\u0bbe\u0b95\u0bcd\u0b95\u0bbf\u0baf\u0bb5\u0bb0\u0bcd").toString():void 0}}function E(e){return{isAdmin:e==="superadmin"||e==="admin",isInvited:e==="invitedParticipant",isSuperAdmin:e==="superadmin"}}l.callFromMainThread=p,l.call=_,l.mawToLsParticipantTypeConversion=E}),226);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWGetUserDeviceChangeAdminType","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e={add:"add",remove:"remove",update:"update"};function s(e,t,n,a,i){return o("MAWDbMsgTxns").getIsThreadEmpty(e,n.jid).then(function(l){if(l)return o("MAWDexieTable").dexieResolve();var s=t===o("MAWUserJidWrapper").getMyUserJid(),u=o("MAWGetUserDeviceChangeAdminType").getUserDeviceAdminType(a,s),c=s?[]:[o("WAJids").userIdFromJid(t)],d=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:c,adminType:u,version:1},n.jid,o("MAWExternalId").generateExternalId(),i);return o("MAWWriteMsgTxns").writeMsg(e,d,n).then(r("emptyFunction"))})}function u(e,t,n,a){var i=o("MAWAdminMsgHelpers").UNKNOWN_USER,l=t===o("MAWUserJidWrapper").getMyUserJid(),s={ack:o("MAWAckLevel").ACK.received,altIndex:void 0,author:l?o("WAJids").AUTHOR_ME:t,externalId:o("MAWExternalId").generateExternalId(),msgContent:{adminType:o("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:i},threadJid:n.jid,ts:a!=null?a:o("WATimeUtils").unixTime(),type:o("MAWMsgType").MSG_TYPE.ICDC_ALERT};return o("MAWWriteMsgTxns").writeMsg(e,s,n).then(r("emptyFunction"))}l.DeviceChange=e,l.writeUserDeviceAdminMsg=s,l.writeICDCAlert=u}),98);
__d("MAWBridgeTraceEvent",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["ReceivedReceipt","ReceivedSent","FlowEndForFailure","FlowEndForSuccess"]),l=e;i.default=l}),66);
__d("MAWCastToMsgrServerMediaType",["EncryptedBackupsUploadEntity","MAWDbMedia","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,n){if(n===void 0&&(n=!1),n&&t==="image")return"xma";switch(t){case"image":case"video":case"gif":case"sticker":return t;case"document":return"file";case"ptt":return"audio";case"xma-image":return"xma";case"preview":return"preview";default:return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaType: "," for castToMsgrServerMediaType method"])),t),null}}function d(e,t){if(t===void 0&&(t=!1),t&&e===o("MAWDbMedia").MEDIA_TYPE.IMAGE)return"xma";switch(e){case"Image":return"image";case"Video":return"video";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"file";case"Ptt":return"audio";default:return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["invalid client mediaType: "," for castClientMediaTypeToServerMediaType method"])),e),null}}function m(e){switch(e){case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return"image";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return"video";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return"gif";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER:return"sticker";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return"file";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return"audio";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA:return"xma";case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW:return"preview";default:return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["invalid attachment mediaType: "," for castMediaAttachmentTypeToServerMediaType method"])),e),null}}l.castToMsgrServerMediaType=c,l.castClientMediaTypeToServerMediaType=d,l.castMediaAttachmentTypeToServerMediaType=m}),98);
__d("MAWJobsIndexedDb",["FBLogger","MAWCurrentUser","MAWErrorObject","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","WALogger","WAWorkerGlobalScope","emptyFunction","promiseDone","qex","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=null,c=null,d="jobs";function m(){return r("qex")._("940")}function p(){if(u==null)throw r("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return u}function _(){if(c==null)throw r("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return c.then(function(){return p()})}function f(){return u!=null}var g=[function(e){var t=e.target.result,n=t.createObjectStore(d,{autoIncrement:!0,keyPath:"jobId"});n.createIndex("uniqKey","uniqKey")},r("emptyFunction"),r("emptyFunction")];function h(e){return c=null,u=null,y(e).then(function(){return u.version})}function y(t){var a;if(c!=null)return c;if(u!=null)return(s||(s=n("Promise"))).resolve();var i=o("MAWCurrentUser").getID(),l=o("MAWIndexedDbMetadata").jobsDbName(i),d=(a=t!=null?t:m())!=null?a:g.length,p=r("qpl")._(25310776,"6155");return c=new(s||(s=n("Promise")))(function(t,n){var r=indexedDB.open(l,d);r.onupgradeneeded=function(e){for(var t=0;t<g.length;t++){var n=g[t],r=t+1;C(e,r)&&n(e)}},r.onsuccess=function(n){var r=n.target.result;r.onversionchange=function(){var t;o("MAWQplProxy").sendQplPointThroughBridge(p,"database_jobs_db_versionchange"),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[JobsDb initialization] upgradeneeded is triggered in another worker. This should not happen."]))),r.close(),(t=o("WAWorkerGlobalScope").workerGlobalScope.location)==null||t.reload==null||t.reload()},u=r,o("MAWQplProxy").sendQplPointThroughBridge(p,"database_jobs_db_ready"),t()},r.onerror=function(){o("MAWQplProxy").sendQplPointThroughBridge(p,"database_jobs_db_failed"),n(r.error)}}),c}function C(e,t){var n=e.newVersion,r=e.oldVersion;return r<t&&n>=t}function b(e){return e===o("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function v(e,t,n,a){var i=b(t);return function(t){return function(){for(var l=arguments.length,s=new Array(l),d=0;d<l;d++)s[d]=arguments[d];var m=a!=null?o("MAWQplProxy").startQplUserFlow(a):null,p=function(l){return _().then(function(n){var r=function(r){var t=n.transaction(e,r!=null?b(r):i,{durability:"relaxed"});return o("WAExceededStorageQuota").listenToQuotaExceededError(t),t.objectStore(e)};return t.apply(void 0,[r].concat(s))}).then(function(e){return m==null||m.endSuccess(),e}).catch(function(t){m==null||m.endFail("job_transaction_fail");var a=o("MAWErrorObject").getErrorObject(t);if((a==null?void 0:a.name)==="InvalidStateError"&&l===1)return c=null,u=null,r("promiseDone")(y()),p(l-1);throw a instanceof Error?r("FBLogger")("maw_db").catching(a).mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",n,e):r("FBLogger")("maw_db").mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",n,e)})};return p(1)}}}l.getJobsDbVersion=m,l.getJobDB=p,l.isJobDBInitted=f,l.dbMigrations=g,l.makeJobsDbIgnoringPreviousCreations=h,l.makeJobsDb=y,l.makeJobsTransactor=v}),98);
__d("WADbTransactor",["MAWDexie","MAWIndexedDb","MAWTransactionMode","WAExceededStorageQuota","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=Object.keys(e),a=r.some(function(t){return e[t]===o("MAWTransactionMode").READWRITE})?o("MAWTransactionMode").READWRITE:o("MAWTransactionMode").READONLY;return function(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];return o("MAWIndexedDb").getSignalDB(t).then(function(e){return s(a,r,function(){return n(e.stores).apply(void 0,i)})}).then(function(e){return e}).catch(function(e){throw m(e,t)})}}function s(e,t,n){if(r("MAWDexie").currentTransaction!=null)throw r("err")("protocolDB transactor %s cannot be called within another transaction");return o("MAWIndexedDb").getSignalDB().then(function(r){return r.transact(e,t,n)})}function u(e){return e instanceof Error?e:typeof e=="string"?r("err")(e):null}function c(e,t,n,r){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=e+"_"+r,i=yield o("MAWIndexedDb").getDB(a);return i.transact(t,[e],function(){return n(i.stores[e])}).then(function(e){return e}).catch(function(e){throw m(e,a)})}),d.apply(this,arguments)}function m(e,t){var n;o("WAExceededStorageQuota").checkQuotaExceededError(e);var a=u(e);return a?(a.message="["+((n=a==null?void 0:a.toString())!=null?n:"unknown error")+"] Error performing %s transaction "+t,a):r("err")("[unknown error] Error performing %s transaction "+t)}l.makeSignalTransactor=e,l.persistedQueueTransactor=c}),98);
__d("WAClearSignalStores",["MAWDexieTable","MAWTransactionMode","WADbTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({tasks:o("MAWTransactionMode").READWRITE},"clearSignalStores",function(e){return function(){return o("MAWDexieTable").dexieAll([e.tasks.clear()]).then(function(){})}});l.clearSignalStores=e}),98);
__d("WAClearSignalStoresV2",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return o("WASignalDB").getDb().runInTransaction(["identity","contacts","meta","prekey","prekeyGeneration","senderKeySessions","session","signedPrekey","personalSenderKeyStatuses"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){yield(e||(e=n("Promise"))).all([t.stores.identity.clear(),t.stores.contacts.clear(),t.stores.meta.clear(),t.stores.prekey.clear(),t.stores.prekeyGeneration.clear(),t.stores.senderKeySessions.clear(),t.stores.session.clear(),t.stores.signedPrekey.clear(),t.stores.personalSenderKeyStatuses.clear()])});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("clearSignalStores"))};l.clearSignalStores=s}),98);
__d("MAWClearSignalAndTempStores",["MAWDeleteOldLogsFromDisk","MAWJobActionsV2","MAWJobsIndexedDb","MAWLoggingSwitches","MAWTransactionMode","Promise","WAClearSignalStores","WAClearSignalStoresV2","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWJobsIndexedDb").makeJobsTransactor("jobs",o("MAWTransactionMode").READWRITE,"clearJob")(o("MAWJobActionsV2").clearJobs),u=function(){return(e||(e=n("Promise"))).all([o("MAWLoggingSwitches").removeLoggingFromBridge&&o("MAWDeleteOldLogsFromDisk").clearLogs(),o("WAClearSignalStores").clearSignalStores(),s(),o("WAClearSignalStoresV2").clearSignalStores()]).then(r("emptyFunction"))};l.clearSignalAndTempStores=u}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxTaskLimit:10,maxThrottleMs:5e3})),e}l.mawCommonScheduler=s}),98);
__d("MAWConstants",[],(function(t,n,r,o,a,i){"use strict";var e=5,l="Facebook user",s="Instagram user",u=3;i.MESSAGE_RETRY_COUNT_LIMIT=e,i.FB_UNKNOWN_USER=l,i.INS_UNKNOWN_USER=s,i.CURRENT_REGISTRATION_VERSION=u}),66);
__d("MAWCreateMaybeAddPointForMediaRender",["MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return function(t,n){e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25302828,"2195"),t,{annotations:n,instanceKey:e},!0)}}l.createMaybeAddPointForMediaRender=e}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.deviceChangeAlerts.add(t)}i.addDeviceChangeAlertsTxn=e}),66);
__d("MAWDbDeviceChangeAlerts",[],(function(t,n,r,o,a,i){"use strict";var e="add",l="keyChange",s="remove";function u(e){return e}i.ADD=e,i.KEY_CHANGE=l,i.REMOVE=s,i.unsafeCoerceToDeviceChangeAlertsID=u}),66);
__d("MAWJobPersistenceAccessorsApi",["MAWJobActionsV2","MAWJobsIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t,n;return{deletePersistedJob:(e=o("MAWJobsIndexedDb")).makeJobsTransactor("jobs",(t=o("MAWTransactionMode")).READWRITE,"deletePersistedJob")((n=o("MAWJobActionsV2")).deletePersistedJob),loadAllJobs:e.makeJobsTransactor("jobs",t.READONLY,"loadAllJobs")(n.readAllPersistedJobs),maybeCreateJob:e.makeJobsTransactor("jobs",t.READWRITE,"maybeCreateJob")(n.maybeCreateJob),readPersistedJob:e.makeJobsTransactor("jobs",t.READONLY,"readPersistedJob")(n.readPersistedJob),updatePersistedJob:e.makeJobsTransactor("jobs",t.READWRITE,"updatePersistedJob")(n.updatePersistedJob)}}l.getJobPersistenceAccessors=e}),98);
__d("WAJobRequirement",["Promise","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(){function t(e){var t=this;this.$1=(s||(s=n("Promise"))).resolve(),this.$2=!0,this.$3=null,this.$4=function(){var e=t.$3;if(e!=null)return t.$3=null,(s||(s=n("Promise"))).all(e).then(t.$4);t.$2=!0},this.name=e}var r=t.prototype;return r.addBlocker=function(r){var t=this,a=r.catch(function(n){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["JobRequirement[","] blocker errored ",""])),t.name,n).sendLogs("job-blocker-rejected")});if(this.$2)this.$2=!1,this.$1=(s||(s=n("Promise"))).all([this.$1,a]).then(this.$4);else{var i=this.$3;i!=null?i.push(a):this.$3=[a]}},r.waitUntilSatisfied=function(){return this.$1},r.isSatisfied=function(){return this.$2},r.isSatisfiable=function(){return!0},t})(),c=(function(e){function t(t){var r;return r=e.call(this,t)||this,e.prototype.addBlocker.call(r,new(s||(s=n("Promise")))(function(){})),r}babelHelpers.inheritsLoose(t,e);var r=t.prototype;return r.addBlocker=function(){},r.isSatisfiable=function(){return!1},t})(u);function d(e,t){var r=e.filter(function(e){return!e.isSatisfiable()});if(r.length>0){var o=r.map(function(e){return e.name});return function(e){return t==null||t("unsatisfiable",o,e),r[0].waitUntilSatisfied()}}var a=e.map(function(){return(s||(s=n("Promise"))).resolve()}),i=(s||(s=n("Promise"))).resolve(),l=null,u=function(){if(a.every(function(t,n){return t===e[n].waitUntilSatisfied()})){l=null;return}var t=[],r=e.map(function(e){var n=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),n.then(function(){var n=t.indexOf(e.name);t.splice(n,1)})),n});return a=r,l=t,(s||(s=n("Promise"))).all(r).then(u)};return function(e){if(l==null){var n=u();n!=null&&(i=i.then(function(){return n}))}return t==null||t(l==null?"satisfied":"unsatisfied",l,e),i}}l.JobRequirement=u,l.UnsatisfiableJobRequirement=c,l.joinRequirements=d}),98);
__d("WAJobPriorityBucket",["WAJobOrchestratorTypes","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(){function t(e){var t;this.tasks=[],this.pendingTasks=[],this.lastJobStartedTimestampMs=null,this.jobMaxConcurrency=(t=e.jobMaxConcurrencyMap)!=null?t:{}}var n=t.prototype;return n.updateConfig=function(t){var e;this.jobMaxConcurrency=(e=t.jobMaxConcurrencyMap)!=null?e:{}},n.getStats=function(){return[].concat(this.tasks,this.pendingTasks).reduce(function(e,t){var n,r=(n=e[t.jobName])!=null?n:0;return e[t.jobName]=r+1,e},{})},n.next=function(){var e=this;if(this.tasks.length===0)return null;var t=this.pendingTasks.reduce(function(e,t){var n,r=(n=e.get(t.jobName))!=null?n:0;return e.set(t.jobName,r+1),e},new Map),n=this.tasks.filter(function(n){var r,a;return((r=t.get(n.jobName))!=null?r:0)<((a=e.jobMaxConcurrency[n.jobName])!=null?a:o("WAJobOrchestratorTypes").DEFAULT_CONCURRENCY)});return n.length>0?[n[0]]:null},n.add=function(t,n,r,o){var e={jobId:r,jobInfo:n,jobName:t,run:o};return this.tasks.push(e),e},n.markJobTaskPending=function(n){this.pendingTasks.includes(function(e){return e.jobId===n.jobId})&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"])),n.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.lastJobStartedTimestampMs=Date.now(),this.pendingTasks.push(n),this.tasks=this.tasks.filter(function(e){return e.jobId!==n.jobId})},n.markJobTaskDone=function(t){this.pendingTasks=this.pendingTasks.filter(function(e){return e.jobId!==t}),this.tasks.includes(function(e){return e.jobId===t})&&o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"])),t).sendLogs("JobOrchestrator::markJobTaskDone")},n.count=function(){return this.tasks.length},n.pendingCount=function(){return this.pendingTasks.length},n.clearWaitingTasks=function(){this.tasks=[]},n.clear=function(){this.tasks=[],this.pendingTasks=[]},n.getLastJobStartedTimestamp=function(){return this.lastJobStartedTimestampMs},t})(),c=(function(e){function t(){return e.apply(this,arguments)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.next=function(){var e=this,t,n;if(this.tasks.length===0)return null;var r=this.pendingTasks.reduce(function(e,t){var n,r=(n=e.get(t.jobName))!=null?n:0;return e.set(t.jobName,r+1),e},new Map),o=this.tasks.filter(function(t){var n,o;return((n=r.get(t.jobName))!=null?n:0)<((o=e.jobMaxConcurrency[t.jobName])!=null?o:1)});if(o.length===0)return null;var a=(t=this.jobMaxConcurrency[o[0].jobName])!=null?t:1,i=(n=r.get(o[0].jobName))!=null?n:0;if(a>1&&i<a){var l=o.filter(function(e){return e.jobName===o[0].jobName}),s=Math.min(l.length,a-i);return l.slice(0,s)}return[o[0]]},t})(u);l.BaseJobBucket=u,l.LowJobBucket=c}),98);
__d("WAMetrics",["Promise","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("WATimeUtils").performanceAbsoluteNow();return new(e||(e=n("Promise")))(function(e){setTimeout(function(){e(o("WATimeUtils").performanceAbsoluteNow()-t)},0)})}l.getEventLoopDelay=s}),98);
__d("WAConcurrentBucketJobQueue",["Promise","WABase64","WACryptoDependencies","WACustomError","WAJobOrchestratorTypes","WAJobPriorityBucket","WALogger","WAMetrics","WANullthrows","WAPromiseTimeout","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=30,d=new Map([[o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]);function m(e){var t=new Uint8Array(e);return o("WACryptoDependencies").getCrypto().getRandomValues(t),o("WABase64").encodeB64(t)}var p=(function(){function t(){this.$1=!1,this.$2=0,this.$3=0,this.$4=0,this.$5=new Map,this.$6=new Map,this.$7=new Map,this.$9=0}var a=t.prototype;return a.init=function(t,n){var e,a,i,l,s,u;if(this.$1)throw r("err")("WAConcurrentBucketJobQueue has already initialized");this.$4=(e=t==null?void 0:t.bestEffortWaitTimeoutSec)!=null?e:c,this.$2=t.maxConcurrency,this.$3=t.maxConcurrency,this.$8=n,this.$7=this.$11(t==null?void 0:t.jobPrioritiesQuota),this.$6=new Map(this.$7),this.$5=new Map,this.$9=Date.now();var d=new(o("WAJobPriorityBucket")).BaseJobBucket({jobMaxConcurrencyMap:(a=t.maxConcurrencyPerJob)!=null?a:{}}),m=new(o("WAJobPriorityBucket")).LowJobBucket({jobMaxConcurrencyMap:(i=t.maxConcurrencyPerJob)!=null?i:{}}),p=new(o("WAJobPriorityBucket")).LowJobBucket({jobMaxConcurrencyMap:(l=t.maxConcurrencyPerJob)!=null?l:{}}),_=new(o("WAJobPriorityBucket")).BaseJobBucket({jobMaxConcurrencyMap:(s=t.maxConcurrencyPerJob)!=null?s:{}}),f=new(o("WAJobPriorityBucket")).BaseJobBucket({jobMaxConcurrencyMap:(u=t.maxConcurrencyPerJob)!=null?u:{}});this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION,d),this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,d),this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.OFFLINE,_),this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.HISTORY_SYNC,f),this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,m),this.$5.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,p),this.$1=!0},a.updateConfig=function(n){this.$3+=n.maxConcurrency-this.$2,this.$2=n.maxConcurrency,this.$5.forEach(function(e){var t;return e.updateConfig({jobMaxConcurrencyMap:(t=n.maxConcurrencyPerJob)!=null?t:{}})}),this.$7=this.$11(n==null?void 0:n.jobPrioritiesQuota),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated WAConcurrentBucketJobQueue config"])))},a.isInitialized=function(){return this.$1},a.clearQueue=function(){if(!this.$1)throw r("err")("WAConcurrentBucketJobQueue not initialized");this.$5.forEach(function(e){return e.clear()})},a.clearQueueByPriority=function(t){var e;if(!this.$1)throw r("err")("WAConcurrentBucketJobQueue not initialized");(e=this.$5.get(t))==null||e.clearWaitingTasks()},a.getIntStats=function(){var e=this,t=function(n){var t,r,o=e.$5.get(n);return((t=o==null?void 0:o.count())!=null?t:0)+((r=o==null?void 0:o.pendingCount())!=null?r:0)};return{highPriorityBucketSize:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityBucketSize:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityBucketSize:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}},a.getStringStats=function(){var e=this,t=function(n){var t,r,o=(t=(r=e.$5.get(n))==null?void 0:r.getStats())!=null?t:{},a=Object.keys(o).reduce(function(e,t){var n=e[0],r=e[1],a=o[t];return a>n?[a,t]:[n,r]},[0,null]),i=a[1];return i};return{highPriorityMaxJob:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityMaxJob:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityMaxJob:t(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}},a.enqueue=function(t,a,i,l){var e,s,c=this;if(!this.$1)return(u||(u=n("Promise"))).reject(r("err")("WAConcurrentBucketJobQueue not initialized"));var d,p,_=new(u||(u=n("Promise")))(function(e,t){d=e,p=t}),f=babelHelpers.extends({priority:o("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},i),g=this.getJobBucketByType(f.priority);if(!g)return(u||(u=n("Promise"))).reject(r("err")("WAConcurrentBucketJobQueue no bucket for job with name "+t+" was found."));o("WAMetrics").getEventLoopDelay().then(function(e){l!=null&&l.isActive()&&(l==null||l.addPoint("measure_event_loop_delay",{int:{eventLoopDelay:e}}))}),l==null||l.addPoint("scheduling_job",{string:babelHelpers.extends({},this.getStringStats(),{priority:f.priority}),int:babelHelpers.extends({},this.getIntStats(),{maxTimeoutMs:(e=i==null?void 0:i.maxTimeoutMs)!=null?e:0})});var h=f.priority+"-"+t+"-"+((s=i==null?void 0:i.jobId)!=null?s:m(8)),y=g.add(t,f,h,n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{c.$8.logJobStarted(h);var e=yield c.$12(a(),i==null?void 0:i.maxTimeoutMs);c.$8.logJobCompleted(h),d(e)}catch(e){e instanceof o("WACustomError").TimeoutError?c.$8.logJobTimeout(h):c.$8.logJobError(h),p(e)}}));return this.$8.logJobCreated({jobId:h,jobName:t,jobPriority:f.priority,pendingJobsCount:g.count()}),i&&i.priority===o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$13(y),this.$14(),_},a.getAvailableThreadsCount=function(){return this.$3},a.getJobQuotaConfig=function(){return this.$7},a.getRemainingJobCountMap=function(){return this.$6},a.getJobBucketByType=function(t){return this.$5.get(t)},a.getSnapshot=function(t){var e=this.getJobBucketByType(t);return e?e.getStats():null},a.$11=function(t){var e;return t?e=new Map(t):e=new Map(d),e.set(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,0),e},a.$15=function(t){var e;return(e=this.$6.get(t))!=null?e:0},a.$16=function(){this.$6=new Map(this.$7)},a.$17=function(t){var e=this;t===void 0&&(t=!0);var n=0,r=null,a=0;this.$5.forEach(function(t,o){n+=t==null?void 0:t.count(),a+=e.$15(o),r==null&&t.count()>0&&e.$15(o)>0&&(r=t)});var i=r==null||a===0;return i&&this.$16(),this.$18(n,i)?this.getJobBucketByType(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT):r==null&&t?this.$17(!1):r},a.$18=function(t,n){var e,r=this;function a(e,t){var n=Date.now();return e>n?!1:n-e<t*1e3}function i(e,t){var n=Math.ceil(e-Date.now())+t*1e3;return n>0?n:0}var l=this.getJobBucketByType(o("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT),s=t-((e=l==null?void 0:l.count())!=null?e:0),u=l==null?void 0:l.getLastJobStartedTimestamp();if((l==null?void 0:l.count())===0)return!1;if(u==null&&a(this.$9,this.$4)){if(this.$10==null){var c=i(this.$9,this.$4);this.$10=setTimeout(function(){r.$14(),r.$10=null},c)}return!1}return s>0&&u!=null&&a(u,this.$4)?!1:n},a.$19=function(t){var e=this.$20(t);return r("WANullthrows")(this.$5.get(e))},a.$20=function(t){var e=t.split("-")[0],n=o("WAJobOrchestratorTypes").JOB_PRIORITY.cast(e);if(!n)throw r("err")("ConcurrentBucketQueue cannot extract known job priority type from id: "+t);return n},a.$21=function(t){var e=this.$20(t);this.$15(e)>0?this.$6.set(e,this.$15(e)-1):this.$6.set(e,0)},a.$14=function(){for(var e=this;this.$3>0;){var t=this.$17(),n=t==null?void 0:t.next();if(n==null)break;n.forEach(function(t){e.$21(t.jobId),e.$13(t)})}},a.$12=function(t,n){return n!==void 0?o("WAPromiseTimeout").promiseTimeout(t,n):t},a.$13=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,n=this.$19(e.jobId);this.$3--,n.markJobTaskPending(e);var r=e.run,a=e.jobId,i=e.jobName;try{var l;yield this.$12(r(),((l=e.jobInfo)==null?void 0:l.maxTimeoutMs)===void 0?o("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(e){if(e instanceof o("WACustomError").TimeoutError)this.$8.logJobTimeout(a),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."])),i);else throw e}finally{this.$3++,n.markJobTaskDone(a),this.$3>0&&setTimeout(function(){return t.$14()},0)}});function t(t){return e.apply(this,arguments)}return t})(),t})();l.WAConcurrentBucketJobQueue=p}),98);
__d("WAConcurrentPreemptiveJobQueue",["Promise","WACustomError","WAJobOrchestratorTypes","WALogger","WAPromiseTimeout","WARandomHex","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=(function(){function t(){this.$1=!1,this.$2=0,this.$3=0,this.$4={},this.$5=[],this.$6=[]}var a=t.prototype;return a.init=function(t,n){var e;if(this.$1)throw r("err")("ConcurrentPreemptiveJobQueue has already initialized");this.$2=t.maxConcurrency,this.$3=t.maxConcurrency,this.$4=(e=t.maxConcurrencyPerJob)!=null?e:{},this.$7=n,this.$1=!0},a.updateConfig=function(n){var t;this.$3+=n.maxConcurrency-this.$2,this.$2=n.maxConcurrency,this.$4=(t=n.maxConcurrencyPerJob)!=null?t:{},o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated ConcurrentPreemptiveJobQueue config"])))},a.isInitialized=function(){return this.$1},a.clearQueueByPriority=function(t){if(!this.$1)throw r("err")("ConcurrentPreemptiveJobQueue not initialized");this.$5=this.$5.filter(function(e){var n;return((n=e.jobInfo)==null?void 0:n.priority)!==t})},a.clearQueue=function(){if(!this.$1)throw r("err")("ConcurrentPreemptiveJobQueue not initialized");this.$5=[],this.$6=[]},a.enqueue=function(t,a,i){var e,l=this;if(!this.$1)return(d||(d=n("Promise"))).reject(r("err")("ConcurrentPreemptiveJobQueue not initialized"));var s,u,c=new(d||(d=n("Promise")))(function(e,t){s=e,u=t}),m=babelHelpers.extends({priority:o("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},i),p=(e=i==null?void 0:i.jobId)!=null?e:o("WARandomHex").randomHex(8).substr(0,64),_=this.$8(t,m,p,n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{l.$7.logJobStarted(p);var e=yield l.$9(a(),i==null?void 0:i.maxTimeoutMs);l.$7.logJobCompleted(p),s(e)}catch(e){e instanceof o("WACustomError").TimeoutError?l.$7.logJobTimeout(p):l.$7.logJobError(p),u(e)}}));return i&&i.priority===o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$10(_),this.$11(),c},a.getAvailableThreadsCount=function(){return this.$3},a.getJobMaxConcurrency=function(){return this.$4},a.getSnapshot=function(t){},a.$11=function(){for(;this.$3>0;){var e=this.$12();if(e==null)break;this.$10(e)}},a.$9=function(t,n){return n!==void 0?o("WAPromiseTimeout").promiseTimeout(t,n):t},a.$10=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;this.$3--,this.$13(e);var n=e.run,r=e.jobId,a=e.jobName;try{var i;yield this.$9(n(),((i=e.jobInfo)==null?void 0:i.maxTimeoutMs)===void 0?o("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(e){if(e instanceof o("WACustomError").TimeoutError)this.$7.logJobTimeout(r),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."])),a);else throw e}finally{this.$3++,this.$14(r),setTimeout(function(){return t.$11()},0)}});function t(t){return e.apply(this,arguments)}return t})(),a.$8=function(t,n,r,o){var e={jobId:r,jobInfo:n,jobName:t,run:o};return this.$7.logJobCreated({jobId:r,jobName:t,jobPriority:n.priority,pendingJobsCount:this.$5.length}),this.$5.push(e),e},a.$13=function(t){this.$6.includes(function(e){return e.jobId===t.jobId})&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"])),t.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.$6.push(t),this.$5=this.$5.filter(function(e){return e.jobId!==t.jobId})},a.$14=function(t){this.$6=this.$6.filter(function(e){return e.jobId!==t}),this.$5.includes(function(e){return e.jobId===t})&&o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"])),t).sendLogs("JobOrchestrator::markJobTaskDone")},a.$12=function(){var e=this;if(this.$5.length===0)return null;var t=this.$6.reduce(function(e,t){var n,r=(n=e.get(t.jobName))!=null?n:0;return e.set(t.jobName,r+1),e},new Map),n=this.$5.filter(function(n){var r,o;return((r=t.get(n.jobName))!=null?r:0)<((o=e.$4[n.jobName])!=null?o:1)});return n[0]},t})();l.WAConcurrentPreemptiveJobQueue=m}),98);
__d("WADefaultJobNoQueue",["WAJobOrchestratorTypes","WARandomHex","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$2=!1}var t=e.prototype;return t.init=function(t,n){if(this.$2)throw r("err")("DefaultNoQueue has already initialized");this.$1=n,this.$2=!0},t.updateConfig=function(t){},t.isInitialized=function(){return this.$2},t.clearQueue=function(){},t.clearQueueByPriority=function(t){},t.getSnapshot=function(){throw r("err")("getSnapshot is not implemented for DefaultNoQueue")},t.enqueue=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a,i=(r=n==null?void 0:n.jobId)!=null?r:o("WARandomHex").randomHex(8).substr(0,64);this.$1.logJobCreated({jobId:i,jobName:e,jobPriority:(a=n==null?void 0:n.priority)!=null?a:o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,pendingJobsCount:0});try{this.$1.logJobStarted(i);var l=yield t();return this.$1.logJobCompleted(i),l}catch(e){throw this.$1.logJobError(i),e}});function t(t,n,r){return e.apply(this,arguments)}return t})(),e})();l.WADefaultJobNoQueue=e}),98);
__d("WAOrchestratorJobStatsLogger",["WAGlobals","WAPREList","WAPREMetrics"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){this.jobName=e,this.pendingJobsCount=n,this.jobPriority=t}var t=e.prototype;return t.logJobAdded=function(){this.webcJobAddedT=Date.now(),this.eventFlow=o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR,{string:{name:this.jobName,jobPriority:this.jobPriority,orchestratorVersion:o("WAGlobals").getConfig().orchestratorVersion()},int:{pendingJobsCount:this.pendingJobsCount,addedAt:this.webcJobAddedT}})},t.logJobStarted=function(){this.webcJobStartedT=Date.now(),this.eventFlow.addPoint("start_job",{int:{startedAt:this.webcJobStartedT}})},t.logJobCompleted=function(t){this.webcJobCompletedT=Date.now(),this.jobResultType=t;var e={int:{pendingJobsCount:this.pendingJobsCount,completedAt:this.webcJobCompletedT}};t==="completed"?this.eventFlow.endSuccess(e):this.eventFlow.endFail(t,e)},e})(),s=(function(){function t(){this.$1=new Map}var n=t.prototype;return n.logJobCreated=function(n){var t=n.jobName,r=n.jobId,o=n.jobPriority,a=n.pendingJobsCount,i=new e(t,o,a);i.logJobAdded(),this.$1.set(r,i)},n.logJobStarted=function(t){var e=this.$1.get(t);e==null||e.logJobStarted()},n.logJobCompleted=function(t){this.$2(t,"completed")},n.logJobError=function(t){this.$2(t,"error")},n.logJobTimeout=function(t){this.$2(t,"timeout")},n.logJobAborted=function(t){this.$2(t,"aborted")},n.$2=function(t,n){var e=this.$1.get(t);e==null||e.logJobCompleted(n),this.$1.delete(t)},t})();l.JobInfoEvent=e,l.JobStatsLogger=s}),98);
__d("WAOrchestrator",["WAConcurrentBucketJobQueue","WAConcurrentPreemptiveJobQueue","WADefaultJobNoQueue","WAGlobals","WAJobOrchestratorTypes","WAOrchestratorJobStatsLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e={maxConcurrency:1},t="default",n={},r=e,a=new(o("WAOrchestratorJobStatsLogger")).JobStatsLogger;return function(i,l){var c,d,m,p,_;i===void 0&&(i=!1);var f=i?t:o("WAGlobals").getConfig().orchestratorVersion(),g=(c=u())!=null?c:e,h;if(l==null||l.addPoint("get_orchestrator",{string:{orchestrator:f},int:{maxConcurrency:g.maxConcurrency,highPriorityQuota:(d=(m=g.jobPrioritiesQuota)==null?void 0:m.get(o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH))!=null?d:0,lowPriorityQuota:(p=(_=g.jobPrioritiesQuota)==null?void 0:_.get(o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW))!=null?p:0}}),n[f])return s(r,g)&&(r=g,n[f].updateConfig(g)),n[f];switch(f){case"preemptive":{h=new(o("WAConcurrentPreemptiveJobQueue")).WAConcurrentPreemptiveJobQueue;break}case"bucket":{h=new(o("WAConcurrentBucketJobQueue")).WAConcurrentBucketJobQueue;break}default:h=new(o("WADefaultJobNoQueue")).WADefaultJobNoQueue;break}return h.init(g,a),n[f]=h,r=g,h}}function s(e,t){var n,r,o,a;return e.maxConcurrency!==t.maxConcurrency||((n=e.jobPrioritiesQuota)==null?void 0:n.size)!==((r=t.jobPrioritiesQuota)==null?void 0:r.size)||Object.keys((o=e.maxConcurrencyPerJob)!=null?o:{}).length!==Object.keys((a=t.maxConcurrencyPerJob)!=null?a:{}).length?!0:JSON.stringify(e)!==JSON.stringify(t)}function u(){var e={jobPrioritiesQuota:new Map([[o("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[o("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]),maxConcurrency:5,maxConcurrencyPerJob:{}};return e}l.getInstanceDelegate=e}),98);
__d("WAPersistedJobManager",["Promise","WAJobRequirement","WALogger","WAPromiseBackoffs","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w=1,A=(function(){function e(e){this.feature=e}var t=e.prototype;return t.toString=function(){return"RequiresPage: "+this.feature},e})(),F=(function(){function e(e){this.backoffOptions=e}var t=e.prototype;return t.toString=function(){return"RetryOnBackoff"},e})(),O=(function(e){function t(){return e.apply(this,arguments)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"NonRetryableError"},t})(babelHelpers.wrapNativeSuper(Error)),B=function(t){this.result=t},W="$unstarted",q="$finished",U=(function(){function t(t){var r=this,a=t.isRestartAfterCrash,i=t.accessors,l=t.unfinishedJobEntries,u=new Map,c=l.then(function(t){var l=[],c=[];return t.forEach(function(e){e.stepHardStartCountAfterTimeout>=5?l.push(e):c.push(e)}),(M||(M=n("Promise"))).all(l.map(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"])),H(t),t.step).sendLogs("job-stuck-"+t.type),i.deletePersistedJob(t.jobId)})).then(function(){c.forEach(function(e){u.has(e.jobId)||(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",": restarting"])),V(e)),u.set(e.jobId,r.$1(e,a)))})})});this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=i,this.activeJobs=u,this.initialJobsPromise=c,this.listeners=t.listeners,this.deprecatedJobs=t.deprecatedJobs}var r=t.prototype;return r.loadAndRunJobFromId=function(t){var e=this.activeJobs.get(t);if(e!=null)return e;var n=this.$2(t);return this.activeJobs.set(t,n),n},r.$2=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this.initialJobsPromise,n=this.accessors;yield t;var r=yield n.readPersistedJob(e);return r?this.$1(r,!1):(o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]))),null)});function t(t){return e.apply(this,arguments)}return t})(),r.$3=function(t){var e=this.implementations,n=this.implementationLoaders,r=e.get(t);if(r)return r;var o=n.get(t);if(!o)return null;var a=o();return e.set(t,a),a},r.$4=function(t,r){if(r==null||r.length===0)return(M||(M=n("Promise"))).resolve();var e=this.stepBlockers,a=e.get(r);return a==null&&(a=o("WAJobRequirement").joinRequirements(r.map(function(e){return e()}),z),e.set(r,a)),a(t)},r.$5=function(t,n,r,a){var e=this;r===void 0&&(r=!1);var i=t.step,l=n.findIndex(function(e){return e.stepName===i}),s=n[l].info(t.current,t.original,j(t,r)),u=s.requirements,m=s.code,p=this.$4(t,u);return a&&(p=p.then(a)),p.then(function(){return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",": running step"])),G(t)),m(t.current,t.original,j(t,r))}).then(function(a){if(a instanceof B)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"])),G(t)),a.result;var i=l+1;if(i>=n.length)return a;var s=n[i];return t.step=s.stepName,t.current=a,t.stepHardStartCountAfterTimeout=0,t.stepFirstStartTime=o("WATimeUtils").unixTime(),t.stepUnexpectedErrorCount=0,t.waitUntil=null,t.backedOffCount=0,e.accessors.updatePersistedJob(t).then(function(){return e.$5(t,n,r)})})},r.$1=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r,a=this,i=this.accessors,l=this.activeJobs,s=this.deprecatedJobs,u=this.listeners,c=u.onJobFinished,d=u.onJobStarted,D=yield this.$3(e.type),x=s[e.type];if(!D){if(x){if(x==="NOOP")return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"])),e.type),yield i.deletePersistedJob(e.jobId),null}else return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"])),e.type).sendLogs("missing-job-implementation"),yield i.deletePersistedJob(e.jobId),null;D=yield x()}var $=D;x&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""])),e.type);var P=(r=e.stepFirstStartTime)!=null?r:o("WATimeUtils").unixTime();if(e.stepFirstStartTime=P,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===q){var N=e.waitUntil,O=o("WATimeUtils").secondsUntil(P);return N!=null&&o("WATimeUtils").isInFuture(N)&&O>0&&(o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"])),V(e)),N=o("WATimeUtils").castToUnixTime(N-O),o("WATimeUtils").isInFuture(N)&&(e.stepFirstStartTime=o("WATimeUtils").castToUnixTime(P-O),e.waitUntil=N,yield this.accessors.updatePersistedJob(e))),(N==null||!o("WATimeUtils").isInFuture(N))&&(o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"])),V(e)),yield i.deletePersistedJob(e.jobId)),l.delete(e.jobId),e.current}var B=e.step!==W?D.find(function(t){return t.stepName===e.step}):D[0];if(!B)return o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""])),e.type,e.step).sendLogs("missing-job-step"),yield i.deletePersistedJob(e.jobId),null;e.step=B.stepName;var U=function(){var r=e.waitUntil,i=(M||(M=n("Promise"))).resolve();if(r!=null){var l=o("WATimeUtils").futureUnixTime(o("WATimeUtils").DAY_SECONDS);r>l?(o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""])),G(e),r,l),e.waitUntil=l,i=a.accessors.updatePersistedJob(e).then(function(){return o("WATimeUtils").delayUntil(l)})):(o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""])),G(e),r),i=o("WATimeUtils").delayUntil(r))}return i.then(function(){var r=function(){return e.waitUntil=null,o("WATimeUtils").happenedWithin(P,o("WATimeUtils").DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,a.accessors.updatePersistedJob(e)};return a.$5(e,$,t,r).catch(function(t){if(t instanceof A)return o("WALogger").LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"])),G(e)),e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,a.accessors.updatePersistedJob(e)),new(M||(M=n("Promise")))(function(){});if(t instanceof F){o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"])),G(e));var r=o("WAPromiseBackoffs").getDelay(++e.backedOffCount,t.backoffOptions);return e.waitUntil=o("WATimeUtils").futureUnixTime(Math.ceil(r/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,a.accessors.updatePersistedJob(e).then(U)}else if(e.stepUnexpectedErrorCount<w)return o("WALogger").WARN(S||(S=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"])),G(e),e.stepUnexpectedErrorCount),o("WALogger").WARN(R||(R=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""])),G(e),t),e.stepUnexpectedErrorCount++,a.accessors.updatePersistedJob(e).then(U);throw t})})},H=U(),z=H.then((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"])),G(e));var n=null;try{n=c(e.jobId,e.type,e.original,t)}catch(t){o("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""])),e.type,t).sendLogs("onJobFinished-threw")}n!=null&&n>0?(e.waitUntil=o("WATimeUtils").futureUnixTime(Math.ceil(n/1e3)),e.step=q,e.current=t,e.stepFirstStartTime=o("WATimeUtils").unixTime(),yield a.accessors.updatePersistedJob(e)):(yield i.deletePersistedJob(e.jobId),l.delete(e.jobId))});return function(e){return t.apply(this,arguments)}})(),(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){o("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""])),e.type,n).sendLogs("job-threw-exception-"+e.type);var r=$.find(function(t){return t.stepName===e.step});if(!r)o("WALogger").ERROR(I||(I=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"])),e.type,e.step);else{var a=r.info(e.current,e.original,j(e,t));a.stopRetryIf!=null&&(yield a.stopRetryIf.onStopRetry(e.current,e.original,j(e,t)))}yield i.deletePersistedJob(e.jobId),l.delete(e.jobId)});return function(e){return r.apply(this,arguments)}})());try{d(e.jobId,e.type,e.original)}catch(t){o("WALogger").ERROR(T||(T=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""])),e.type,t).sendLogs("onJobStarted-threw")}return z.then(function(){return H})});function t(t,n){return e.apply(this,arguments)}return t})(),r.addPersistedJobImplementation=function(t,n){var e=this.implementationLoaders,r=this.deprecatedJobs;if(e.has(t)){o("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""])),t).sendLogs("repeat-job-loader");return}r&&r[t],e.set(t,n)},r.fireAndForget=function(t){var e=this;this.accessors.maybeCreateJob(t).then(function(t){var n=t.id;return e.loadAndRunJobFromId(n)})},r.waitUntilPersisted=function(t){var e=this;return this.accessors.maybeCreateJob(t).then(function(t){var n=t.id;e.loadAndRunJobFromId(n)})},r.waitUntilCompleted=function(t){var e=this;return this.accessors.maybeCreateJob(t).then(function(t){var n=t.id;return e.loadAndRunJobFromId(n)})},r.fireAndForgetNonPersisted=function(t){o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["fireAndForgetNonPersisted not implemented in PersistedJobManager"])))},r.waitUntilCompletedNonPersisted=function(t){return(M||(M=n("Promise"))).resolve(function(){return o("WALogger").LOG($||($=babelHelpers.taggedTemplateLiteralLoose(["waitUntilCompletedNonPersisted not implemented in PersistedJobManager"])))})},t})();function V(e){return"Job["+e.jobId+"] ("+e.type+")"}function H(e){return"[Job "+e.type+"] "}function G(e){return"Job["+e.jobId+"] ("+e.type+"."+e.step+")"}function z(e,t,n){e==="unsatisfiable"?o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""])),G(n),t):e==="unsatisfied"&&o("WALogger").LOG(N||(N=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""])),G(n),t)}function j(e,t){return t===void 0&&(t=!1),{jobStartTime:e.startTime,afterCrash:t,interruptJob:K}}function K(e){return new B(e)}l.RequiresPage=A,l.RetryOnBackoff=F,l.NonRetryableError=O,l.InterruptJob=B,l.UNSTARTED_JOB=W,l.FINISHED_JOB=q,l.PersistedJobManager=U}),98);
__d("WaJobInMemoryAccessors",["Promise","WARandomHex","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=-1,r=new Map;return{deletePersistedJob:function(o){return(e||(e=n("Promise"))).resolve(r.delete(o))},loadAllJobs:function(){return(e||(e=n("Promise"))).resolve(Array.from(r.values()))},maybeCreateJob:function(i){var a,l=JSON.stringify([i.type,(a=i.uniqKey)!=null?a:o("WARandomHex").randomHex(32)]),s={backedOffCount:0,current:i.args,original:i.args,startTime:o("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:i.type,uniqKey:l,version:i.version,waitUntil:null,scheduleConfig:i.scheduleConfig},u=function(){var o=t--,a=babelHelpers.extends({},s,{jobId:o});return r.set(o,a),(e||(e=n("Promise"))).resolve({id:o,newlyCreated:!0})};if(i.uniqKey!=null){var c=Array.from(r.values()).filter(function(e){return e.uniqKey===l});if(c.length===0)return u();var d=null;return c.forEach(function(e){e.step!=="$finished"?d=e:r.delete(e.jobId)}),d!=null?(e||(e=n("Promise"))).resolve({id:d.jobId,newlyCreated:!1}):u()}return u()},readPersistedJob:function(o){var t=r.get(o);return(e||(e=n("Promise"))).resolve(t&&babelHelpers.extends({},t))},updatePersistedJob:function(o){return(e||(e=n("Promise"))).resolve(r.set(o.jobId,babelHelpers.extends({},o)))}}}l.getJobInMemoryAccessors=s}),98);
__d("WAPersistedJobManagerV2",["Promise","WAGlobals","WAJids","WAJobOrchestratorTypes","WAJobRequirement","WALogger","WAOrchestrator","WAPREList","WAPREMetrics","WAPersistedJobManager","WAPromiseBackoffs","WAResolvable","WATimeUtils","WaJobInMemoryAccessors","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w,A,F,O=1;function B(e){var t=e.code,n=e.annotations,r=n===void 0?{}:n,o=e.eventFlow,a=o===void 0?W(r):o;return t(a).then(function(e){return a.endSuccess(),e}).catch(function(e){throw a.endFail("error",{string:{error:""+e}}),e})}function W(e){var t,n;return e===void 0&&(e={}),o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.WA_JOB_MANAGER,babelHelpers.extends({},e,{string:babelHelpers.extends({},(t=(n=e)==null?void 0:n.string)!=null?t:{},{userHash:o("WAGlobals").getDependencies().isEmployee()&&o("WAGlobals").getDependencies().isUseridAnnotationEnabled()?o("WAJids").extractUserId(o("WAGlobals").getMyUserJid()).slice(-5):null})}))}var q=(function(){function t(t){var r=this;this.$1=[];var a=t.isRestartAfterCrash,i=t.accessors,l=t.unfinishedJobEntries,u=t.ignoreForceNonPersistedJobList;this.getOrchestratorDelegate=o("WAOrchestrator").getInstanceDelegate(),this.activeJobs=new Map,this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=i,this.isRestartAfterCrash=a||!1,this.listeners=t.listeners,this.deprecatedJobs=t.deprecatedJobs,this.inMemoryAccessors=o("WaJobInMemoryAccessors").getJobInMemoryAccessors(),this.offlineQueueMode=!0,this.$1=u,t.offlineQueueCompletePromise!=null?t.offlineQueueCompletePromise.finally(function(){r.offlineQueueMode=!1}):this.offlineQueueMode=!1,this.initialJobsPromise=l.then(function(t){var a=[],i=[];return t.forEach(function(e){e.stepHardStartCountAfterTimeout>=5?a.push(e):i.push(e)}),(F||(F=n("Promise"))).all(a.map(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"])),V(t),t.step).sendLogs("job-stuck-"+t.type),r.accessors.deletePersistedJob(t.jobId)})).then(function(){i.forEach(function(e){var t=r.$2(e.jobId);if(t.alreadyActive===!0){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[JOB MANAGER] Restarting job with the same id"])));return}t.deferred.resolve(B({code:function(n){return r.$3(e,r.accessors,{eventFlow:n})},annotations:{string:{name:e.type},bool:{offlineQueueMode:r.offlineQueueMode}}}))})})})}var a=t.prototype;return a.$4=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a;n===void 0&&(n={});var i=this.$2(e);if((a=n.eventFlow)==null||a.addPoint("start_load_and_run",{bool:{skipped:i.alreadyActive}}),i.alreadyActive===!0)return i.deferred;var l=yield t.readPersistedJob(e);if(l==null)throw o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]))).sendLogs("missing-job-entry"),r("err")("Persisted job missing for given ID "+e);return i.deferred.resolve(this.$3(l,t,n)),i.deferred.promise});function t(t,n,r){return e.apply(this,arguments)}return t})(),a.$3=function(t,n,r){var e,a;return r===void 0&&(r={}),(e=r.eventFlow)==null||e.addPoint("enqueueing_job",{string:{name:t.type}}),this.getOrchestratorDelegate(((a=t.scheduleConfig)==null?void 0:a.priority)===o("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP,r.eventFlow).enqueue(t.type,this.$5(t,n,r),t.scheduleConfig,r.eventFlow)},a.$6=function(t,n,r){var e=this;return r===void 0&&(r={}),n.maybeCreateJob(t).then(function(t){var o,a=t.id;return(o=r.eventFlow)==null||o.addPoint("job_persisted",{int:{jobId:a},bool:{nonPersisted:n===e.inMemoryAccessors}}),a})},a.$2=function(t){var e=this.activeJobs.get(t);if(e!=null)return{alreadyActive:!0,deferred:e};var n=new(o("WAResolvable")).Resolvable;return this.activeJobs.set(t,n.promise),{alreadyActive:!1,deferred:n}},a.$5=function(t,n,r){var e=this;return function(){return e.$7(t,n,r)}},a.$8=function(t){var e=this.implementations,n=this.implementationLoaders,r=e.get(t);if(r)return r;var o=n.get(t);if(!o)return null;var a=o();return e.set(t,a),a},a.$9=function(t,r){if(r==null||r.length===0)return(F||(F=n("Promise"))).resolve();var e=this.stepBlockers,a=e.get(r);return a==null&&(a=o("WAJobRequirement").joinRequirements(r.map(function(e){return e()}),G),e.set(r,a)),a(t)},a.$10=function(t,n,r,a,i){var e,l=this;i===void 0&&(i={});var s=t.step;(e=i.eventFlow)==null||e.addPoint("start_step");var u=n.findIndex(function(e){return e.stepName===s}),m=n[u].info(t.current,t.original,z(t,this.isRestartAfterCrash)),p=m.requirements,_=m.code,f=this.$9(t,p);return a&&(f=f.then(a)),f.then(function(){var e;return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",": running step"])),H(t)),(e=i.eventFlow)==null||e.addPoint("run_step"),_(t.current,t.original,z(t,l.isRestartAfterCrash,i.eventFlow))}).then(function(e){var a;if((a=i.eventFlow)==null||a.addPoint("step_is_complete"),e instanceof o("WAPersistedJobManager").InterruptJob)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"])),H(t)),e.result;var s=u+1;if(s>=n.length)return e;var c=n[s];return t.step=c.stepName,t.current=e,t.stepHardStartCountAfterTimeout=0,t.stepFirstStartTime=o("WATimeUtils").unixTime(),t.stepUnexpectedErrorCount=0,t.waitUntil=null,t.backedOffCount=0,r.updatePersistedJob(t).then(function(){return l.$10(t,n,r,void 0,i)})})},a.$7=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){var a,i,l=this;r===void 0&&(r={});var s=this.activeJobs,u=this.deprecatedJobs,c=this.listeners,d=c.onJobFinished,T=c.onJobStarted;(a=r.eventFlow)==null||a.addPoint("run_job");var D=yield this.$8(e.type),x=u[e.type];if(!D){if(x){if(x==="NOOP")return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"])),e.type),yield t.deletePersistedJob(e.jobId),null}else return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"])),e.type).sendLogs("missing-job-implementation"),yield t.deletePersistedJob(e.jobId),null;D=yield x()}var $=D;x&&o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""])),e.type);var P=(i=e.stepFirstStartTime)!=null?i:o("WATimeUtils").unixTime();if(e.stepFirstStartTime=P,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===o("WAPersistedJobManager").FINISHED_JOB){var N=e.waitUntil,M=o("WATimeUtils").secondsUntil(P);return N!=null&&o("WATimeUtils").isInFuture(N)&&M>0&&(o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"])),U(e)),N=o("WATimeUtils").castToUnixTime(N-M),o("WATimeUtils").isInFuture(N)&&(e.stepFirstStartTime=o("WATimeUtils").castToUnixTime(P-M),e.waitUntil=N,yield t.updatePersistedJob(e))),(N==null||!o("WATimeUtils").isInFuture(N))&&(o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"])),U(e)),yield t.deletePersistedJob(e.jobId)),s.delete(e.jobId),e.current}var w=e.step!==o("WAPersistedJobManager").UNSTARTED_JOB?D.find(function(t){return t.stepName===e.step}):D[0];if(!w)return o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""])),e.type,e.step).sendLogs("missing-job-step"),yield t.deletePersistedJob(e.jobId),null;e.step=w.stepName;var A=function(){var a=e.waitUntil,i=(F||(F=n("Promise"))).resolve();if(a!=null){var s=o("WATimeUtils").futureUnixTime(o("WATimeUtils").DAY_SECONDS);a>s?(o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""])),H(e),a,s),e.waitUntil=s,i=t.updatePersistedJob(e).then(function(){return o("WATimeUtils").delayUntil(s)})):(o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""])),H(e),a),i=o("WATimeUtils").delayUntil(a))}return i.then(function(){var n=function(){return e.waitUntil=null,o("WATimeUtils").happenedWithin(P,o("WATimeUtils").DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,t.updatePersistedJob(e)};return l.$10(e,$,t,n,r).catch(function(n){if(n instanceof o("WAPersistedJobManager").RetryOnBackoff){var a;o("WALogger").LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"])),H(e)),(a=r.eventFlow)==null||a.addPoint("retry_on_backoff");var i=o("WAPromiseBackoffs").getDelay(++e.backedOffCount,n.backoffOptions);return e.waitUntil=o("WATimeUtils").futureUnixTime(Math.ceil(i/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,t.updatePersistedJob(e).then(A)}else{if(!(n instanceof o("WAPersistedJobManager").NonRetryableError)&&e.stepUnexpectedErrorCount<O){var l;return(l=r.eventFlow)==null||l.addPoint("retry_on_unexpected_error"),o("WALogger").WARN(v||(v=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"])),H(e),e.stepUnexpectedErrorCount),o("WALogger").WARN(S||(S=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""])),H(e),n),e.stepUnexpectedErrorCount++,t.updatePersistedJob(e).then(A)}throw n}})})},B=A(),W=B.then((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){o("WALogger").LOG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"])),H(e));var r=null;try{r=d(e.jobId,e.type,e.original,n)}catch(t){o("WALogger").ERROR(L||(L=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""])),e.type,t).sendLogs("onJobFinished-threw")}r!=null&&r>0?(e.waitUntil=o("WATimeUtils").futureUnixTime(Math.ceil(r/1e3)),e.step=o("WAPersistedJobManager").FINISHED_JOB,e.current=n,e.stepFirstStartTime=o("WATimeUtils").unixTime(),yield t.updatePersistedJob(e)):(yield t.deletePersistedJob(e.jobId),s.delete(e.jobId))});return function(e){return r.apply(this,arguments)}})(),(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){o("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""])),e.type,n).sendLogs("job-threw-exception-"+e.type);var r=$.find(function(t){return t.stepName===e.step});if(!r)o("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"])),e.type,e.step);else{var a=r.info(e.current,e.original,z(e,l.isRestartAfterCrash));a.stopRetryIf!=null&&(yield a.stopRetryIf.onStopRetry(e.current,e.original,z(e,l.isRestartAfterCrash)))}yield t.deletePersistedJob(e.jobId),s.delete(e.jobId)});return function(e){return r.apply(this,arguments)}})());try{T(e.jobId,e.type,e.original)}catch(t){o("WALogger").ERROR(I||(I=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""])),e.type,t).sendLogs("onJobStarted-threw")}return W.then(function(){return B})});function t(t,n,r){return e.apply(this,arguments)}return t})(),a.addPersistedJobImplementation=function(t,n){var e=this.implementationLoaders,r=this.deprecatedJobs;if(e.has(t)){o("WALogger").ERROR(T||(T=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""])),t).sendLogs("repeat-job-loader");return}r&&r[t],e.set(t,n)},a.fireAndForget=function(t){var e=this;if(this.$1.indexOf(t.type)===-1){o("WALogger").LOG(D||(D=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),t.type),this.fireAndForgetNonPersisted(t);return}o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),t.type),B({code:(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r={eventFlow:n};return yield e.initialJobsPromise,n.addPoint("initial_jobs_promise_fulfilled"),e.$6(t,e.accessors,r).then(function(t){return e.$4(t,e.accessors,r)})});function o(e){return r.apply(this,arguments)}return o})(),annotations:{string:{name:t.type},bool:{offlineQueueMode:this.offlineQueueMode}}})},a.waitUntilPersisted=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this;if(this.$1.indexOf(e.type)===-1)return o("WALogger").LOG($||($=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),e.type),this.fireAndForgetNonPersisted(e),(F||(F=n("Promise"))).resolve();o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),e.type);var r=W({string:{name:e.type},bool:{offlineQueueMode:this.offlineQueueMode}});return yield this.initialJobsPromise,r.addPoint("initial_jobs_promise_fulfilled"),this.$6(e,this.accessors,{eventFlow:r}).then(function(e){B({code:function(r){var n={eventFlow:r};return t.$4(e,t.accessors,n)},eventFlow:r})}).catch(function(e){throw r.endFail("error",{string:{error:""+e}}),e})});function t(t){return e.apply(this,arguments)}return t})(),a.waitUntilCompleted=function(t){var e=this;return this.$1.indexOf(t.type)===-1?(o("WALogger").LOG(N||(N=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"])),t.type),this.waitUntilCompletedNonPersisted(t)):(o("WALogger").LOG(M||(M=babelHelpers.taggedTemplateLiteralLoose(["",": running in persisted mode"])),t.type),B({code:(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r={eventFlow:n};return yield e.initialJobsPromise,n.addPoint("initial_jobs_promise_fulfilled"),e.$6(t,e.accessors,r).then(function(t){return e.$4(t,e.accessors,r)})});function o(e){return r.apply(this,arguments)}return o})(),annotations:{string:{name:t.type},bool:{offlineQueueMode:this.offlineQueueMode}}}))},a.fireAndForgetNonPersisted=function(t){var e=this;B({code:(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r={eventFlow:n};return yield e.initialJobsPromise,n.addPoint("initial_jobs_promise_fulfilled"),e.$6(t,e.inMemoryAccessors,r).then(function(t){return e.$4(t,e.inMemoryAccessors,r)})});function o(e){return r.apply(this,arguments)}return o})(),annotations:{string:{name:t.type},bool:{offlineQueueMode:this.offlineQueueMode}}})},a.waitUntilCompletedNonPersisted=function(t){var e=this;return B({code:(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r={eventFlow:n};return yield e.initialJobsPromise,n.addPoint("initial_jobs_promise_fulfilled"),e.$6(t,e.inMemoryAccessors,r).then(function(t){return e.$4(t,e.inMemoryAccessors,r)})});function o(e){return r.apply(this,arguments)}return o})(),annotations:{string:{name:t.type},bool:{offlineQueueMode:this.offlineQueueMode}}})},t})();function U(e){return"Job["+e.jobId+"] ("+e.type+")"}function V(e){return"[Job "+e.type+"] "}function H(e){return"Job["+e.jobId+"] ("+e.type+"."+e.step+")"}function G(e,t,n){e==="unsatisfiable"?o("WALogger").LOG(w||(w=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""])),H(n),t):e==="unsatisfied"&&o("WALogger").LOG(A||(A=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""])),H(n),t)}function z(e,t,n){return t===void 0&&(t=!1),{jobStartTime:e.startTime,afterCrash:t,interruptJob:j,eventFlow:n}}function j(e){return new(o("WAPersistedJobManager")).InterruptJob(e)}l.PersistedJobManager=q}),98);
__d("WACommsConnectionState",["WAGenericStateManager"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){return e.call(this,!1)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.isConnected=function(){return this.get()},n.waitForConnection=function(){return this.waitForValue(!0)},t})(o("WAGenericStateManager").WAGenericStateManager),s=new e;l.WACommsConnectionState=s}),98);
__d("WAWaitForComms",["WACommsConnectionState","WAResolvable"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("WAResolvable")).Resolvable;function s(){return e.promise}function u(){o("WACommsConnectionState").WACommsConnectionState.set(!1),e.isSettled&&(e=new(o("WAResolvable")).Resolvable)}function c(){o("WACommsConnectionState").WACommsConnectionState.set(!0),e.resolve()}function d(){return!e.resolveWasCalled()}function m(t){return e.reject(t)}l.waitForComms=s,l.commsConnectionLost=u,l.unblockComms=c,l.isStillWaitingForComms=d,l.failComms=m}),98);
__d("MAWJobManager",["MAWBridge","MAWDefinePersistedJob","MAWJobPersistenceAccessorsApi","WAPersistedJobManagerV2","WAWaitForComms","WAWaitForUserUnblocked","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("WAPersistedJobManagerV2")).PersistedJobManager({accessors:o("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors(),deprecatedJobs:{removeCurrentDevice:"NOOP"},ignoreForceNonPersistedJobList:["sendMsg","sendBumpMsg","sendReactionMsg","sendMediaMsg","sendWrittenMsg","downloadAndHandleMedia"],isRestartAfterCrash:!1,listeners:{onJobFinished:function(t,n,r,a){return o("MAWBridge").getBridge().fireAndForget("event","onJobFinished",{id:t,originalArgs:r,result:a,type:n},!0),null},onJobStarted:r("emptyFunction")},offlineQueueCompletePromise:o("WAWaitForUserUnblocked").waitForUserUnblocked(),unfinishedJobEntries:o("WAWaitForComms").waitForComms().then(function(){return o("MAWJobPersistenceAccessorsApi").getJobPersistenceAccessors().loadAllJobs()})});function s(){return o("MAWDefinePersistedJob").persistedJobsApi}function u(){return e}l.getPersistedJobsApi=s,l.getJobManager=u}),98);
__d("WAJobBuilder",["Promise","WAPersistedJobManager","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function e(e){this.steps=e}var t=e.prototype;return t.step=function(t,n){return this.$1(t,typeof n=="function"?{code:n}:n)},t.$1=function(n,r){var t=r.stopRetryIf,a=r.requirements,i=r.code,l=d(a,i,t);if(t){var s=t.timePassedSeconds,u=t.appCrashed,p=t.onStopRetry,_=d(null,m(p),t);s!=null&&(l=c(function(e,t,n){var r=n.jobStartTime;return o("WATimeUtils").happenedWithin(r,s)},l,_)),u&&(l=c(function(e,t,n){var r=n.afterCrash;return!r},l,_))}return new e([].concat(this.steps,[{stepName:n,info:l}]))},t.finalStep=function(t,n){var e=this.step(t,n);return{end:function(){return e.steps}}},e})();function u(){return new s([])}function c(e,t,n){return function(r,o,a){return e(r,o,a)?t(r,o,a):n(r,o,a)}}function d(e,t,n){var r={requirements:e,code:t,stopRetryIf:n};return function(){return r}}function m(t){return function(r,a,i){return(e||(e=n("Promise"))).resolve(t(r,a,i)).then(function(e){return e instanceof o("WAPersistedJobManager").InterruptJob?e:new(o("WAPersistedJobManager")).InterruptJob(e)})}}l.JobBuilder=s,l.definePersistedJob=u}),98);
__d("MAWDefinePersistedJob",["MAWJobManager","Promise","WAJobBuilder"],(function(t,n,r,o,a,i,l){"use strict";var e,s={definePersistedJob:function(){return o("WAJobBuilder").definePersistedJob()}};function u(t){var r=o("MAWJobManager").getJobManager();Object.keys(t).forEach(function(o){var a=t[o];r.addPersistedJobImplementation(o,function(){return(e||(e=n("Promise"))).resolve(a)})})}function c(e){var t=o("MAWJobManager").getJobManager();Object.keys(e).forEach(function(n){var r=e[n];t.addPersistedJobImplementation(n,r)})}l.persistedJobsApi=s,l.setMsgrJobImplementations=u,l.setMsgrDeferredJobImplementations=c}),98);
__d("WAGetHashFromProtocolMsgId",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.externalId+"_"+e.author+"_"+e.chat}i.getHashFromProtocolMsgId=e}),66);
__d("MAWEBUploadTrackingUtils",["MAWAckLevel","MAWEBSwitch","MAWExternalId","MAWMsgType","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","ODS","QPLUserFlow","QuickPerformanceLogger","WACommsConnectionState","WAExceededStorageQuota","WAGetHashFromProtocolMsgId","WAGlobals","WAHashStringToNumber","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u={ERROR_FETCHING_DB_MESSAGE:"error_fetching_db_message",FAILED_TO_ACK_MESSAGE:"failed_to_ack_message",FAILED_TO_CONSTRUCT_ECHO_MESSAGE:"failed_to_construct_echo_message",MESSAGE_UPLOAD_TIMEOUT:"message_upload_timeout",RUNTIME_ERROR:"runtime_error"};function c(e,t,n,a,i,l,u,c,d,m){var _;if(l===void 0&&(l=!1),u===void 0&&(u=!1),d===void 0&&(d="unknown"),m===void 0&&(m=0),!!r("MAWEBSwitch").isEnabled()){r("QPLUserFlow").start(r("qpl")._(521481602,"829"),{annotations:{bool:{eb_switch:r("MAWEBSwitch").isEnabled(),eb_upload_queue:!0,fromUploadQueue:l,is_retroactive_upload:u,is_unified_attachment_upload:!0,is_wasm_serializer_on:r("gkx")("18428"),middleware_init:!1},int:{attachmentsSize:(_=c==null?void 0:c.attachmentInfos.length)!=null?_:0,instanceKey:i,retryCount:m},string:{comms_status:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected",externalId:e,msgType:n,payloadType:d,threadId:t,triggerType:a,userJid:o("WAGlobals").getMyUserJid()},string_array:{attachment_trace_ids:c==null?void 0:c.attachmentInfos.map(function(e){var t;return(t=e.attachmentTraceId)!=null?t:"null"}),media_types:c==null?void 0:c.attachmentInfos.map(function(e){return e.mediaType})}},instanceKey:i,timeoutInMs:r("justknobx")._("1405")}),p(i,"upload_tracking_started"),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").START),o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+(n!=null?n:"unknown"));var f=o("MAWMsgType").isMAWSupportedMediaType(n!=null?n:"Text")?"media":"non-media";o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+f)}}function d(e){return e==null?{string:{comms_status_on_failure:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"}}:babelHelpers.extends({},e,{string:babelHelpers.extends({},e.string,{comms_status_on_failure:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"})})}function m(e,t,n,r){switch(e){case"success":h(t,n,r);break;case"fail":g(t,n,r);break;case"point":p(t,n,r);break}}function p(e,t,n){n&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),n,{instanceKey:e}),r("QPLUserFlow").addPoint(r("qpl")._(521481602,"829"),t,{instanceKey:e})}function _(e,t){r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),t,{instanceKey:e})}function f(e,t){var n;r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),d(t),{instanceKey:e}),r("QPLUserFlow").endCancel(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:t==null||(n=t.string)==null?void 0:n.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").CANCEL)}function g(e,t,n){var a;r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),d(n),{instanceKey:e}),r("QPLUserFlow").endFailure(r("qpl")._(521481602,"829"),t,{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:n==null||(a=n.string)==null?void 0:a.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").FAIL)}function h(e,t,n){p(e,t),y(e,n)}function y(e,t){t&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),t,{instanceKey:e}),r("QPLUserFlow").endSuccess(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").SUCCESS)}function C(e,t,n){var a;p(e,t),n&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),n,{instanceKey:e}),r("QPLUserFlow").endTimeout(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:n==null||(a=n.string)==null?void 0:a.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").TIMEOUT)}function b(t,n,o){var a=r("qpl")._(521481602,"829");p(t,n),o&&(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(a,o,{instanceKey:t}),(e||(e=r("QuickPerformanceLogger"))).markerEnd(a,52,t,e.currentTimestamp())}function v(){return o("WAHashStringToNumber").hashStringToNumber(o("MAWExternalId").generateExternalId())}function S(e,t){return t===void 0&&(t=0),o("WAHashStringToNumber").hashStringToNumber(o("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(e)+"_"+o("WAGlobals").getMyDeviceJid()+"_"+t)}function R(e){return r("MAWEBSwitch").isEnabled()&&o("MAWMsgType").isEBSupportedMsgType(e.type)&&e.ack>=o("MAWAckLevel").ACK.sent&&e.serverTs!=null&&!(e.ephemeralSetting!=null&&e.ephemeralSetting.ephemeralExpirationInSec>0)}function L(e){return{addAnnotations:function(n){_(e,n)},addPoint:function(n,r){p(e,n,r)},endCancel:function(n,r){f(e,r)},endFail:function(n,r){g(e,n,r)},endSuccess:function(n){y(e,n)},getQPLAttrs:function(){return{instanceKey:e}},isActive:function(){return!0},start:function(){}}}function E(e,t){return e.get(t)}function k(e,t,n,r,o){var a=E(t,n);if(a!=null)switch(e){case"success":h(a,r,o);break;case"fail":g(a,r,o);break;case"point":p(a,r,o);break}}l.EBUploadTrackingWorkerFailurePoints=u,l.startUploadTracking=c,l.handleBridgeEbUploadTrackingQPL=m,l.addPointWorkerOnly=p,l.addAnnotationsWorkerOnly=_,l.endCancelWorkerOnly=f,l.endFailWorkerOnly=g,l.endSuccessWorkerOnly=h,l.endTimeoutWorkerOnly=C,l.endRetryWorkerOnly=b,l.genInstanceKeyOnly=v,l.genInstanceKeyForUploadQueue=S,l.isUploadSupported=R,l.makeEBWorkerQplFlowFromInstanceKey=L,l.getUploadTrackingInstanceKey=E,l.addUploadTrackingByType=k}),98);
__d("WAFindMostRecentMediaEntry",["WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null;for(var n of e){var r,a,i=n[0],l=n[1],s=o("WAMediaUtils").decodeMediaEntryData(l);(((r=t)==null?void 0:r[1].mediaKeyTimestamp)==null||s.mediaKeyTimestamp!=null&&s.mediaKeyTimestamp>((a=t)==null?void 0:a[1].mediaKeyTimestamp))&&(t=[i,s])}return t!=null?o("WAResultOrError").makeResult(t):o("WAResultOrError").makeError("no-media-entry")}l.findMostRecentMediaEntry=e}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","MWFBLogger","WAFindMostRecentMediaEntry","WAHashUtils","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MWFBLogger").MWMediaLogger().tags(["getMostRecentDecodedMediaEntry"]),u=o("MAWIndexedDb").makeMsgrTransactor({media:o("MAWTransactionMode").READONLY},"getMediaEntries",function(t){return function(n){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(t,n).then(function(t){return t?o("WAResultOrError").makeResult(t.mediaEntries):(s.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."])),o("WAHashUtils").sanitisePlaintextHash(n)),o("WAResultOrError").makeError("no-media-by-plaintext-hash"))})}});function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u(e);if(t.success===!1)return t;var n=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(t.value);return n.success===!1?n:o("WAResultOrError").makeResult(n.value[1])}),d.apply(this,arguments)}l.getMediaEntries=u,l.getMostRecentDecodedMediaEntry=c}),98);
__d("MAWGetProtocolMsgIdAndSortOrderMsApi",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"getProtocolMsgIdAndSortOrderMs",function(e){return function(t){return e.messages.get({msgId:t}).then(function(e){if(e==null)return null;var t=e.sortOrderMs;if(t==null||o("WAJids").isAuthorSystem(e.author))return null;var n={author:e.author,chat:e.threadJid,externalId:e.externalId};return{protocolMsgId:n,sortOrderMs:t}})}});l.getProtocolMsgIdAndSortOrderMs=e}),98);
__d("MAWMediaPreviewDownloadManager",["WAResolvable"],(function(t,n,r,o,a,i,l){"use strict";var e=1e4,s=[],u=new Map;function c(e){if(!u.has(e)){_();var t=new(o("WAResolvable")).Resolvable;u.set(e,t),s.push(e)}}function d(e,t){var n=u.get(e);n!=null&&(n.reject(t),p(e))}function m(e){return u.get(e)}function p(e){u.delete(e)}function _(){if(s.length>=e){var t=s.shift();t!=null&&u.delete(t)}}function f(){s=[],u.clear()}l.markMediaPreviewAsDownloading=c,l.markMediaPreviewAsFailed=d,l.getMediaPreviewDownloadingResolvable=m,l.removeMediaPreviewDownloadingResolvable=p,l.clear=f}),98);
__d("MpsMediaEntryCache",["FBLogger","MpsMessageToBridgeWrapper","WADirectPath","WAHashUtils","WALongInt","WAMediaUtils","WAProgressiveJpegGetScanLengths","WATimeUtils","getErrorSafe","getMediaTypeFromConsumerMessage","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(t){var n,r,o=e.get(t.plaintextHash);if(((n=t.mediaKeyTimestamp)!=null?n:0)>=((r=o==null?void 0:o.mediaKeyTimestamp)!=null?r:0))return e.set(t.plaintextHash,t),t}function u(e){try{var t=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(e);return[c(t),p(t)].concat(m(t)).filter(Boolean)}catch(e){var n=r("getErrorSafe")(e);if(e.message.includes("FormatError"))return r("FBLogger")("mps").catching(n).warn("Error in hydrateCache"),[];throw r("FBLogger")("mps").catching(n).mustfixThrow("Error in hydrateCache")}}function c(e){var t,n=e.deserialize(),r=(t=n.encryptedTransportMessage())==null?void 0:t.consumerMessage();if(r!=null)return d(e,r)}function d(e,t){var n,r,a,i,l,s,u,c,d,m=(n=(r=(a=(i=(l=t.audioMessage())==null?void 0:l.payload)!=null?i:(s=t.documentMessage())==null?void 0:s.payload)!=null?a:(u=t.imageMessage())==null?void 0:u.payload)!=null?r:(c=t.stickerMessage())==null?void 0:c.payload)!=null?n:(d=t.videoMessage())==null?void 0:d.payload;if(m!=null){var p=o("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(t.proto);return _(m,p,e)}}function m(e){var t,n,r=(t=e.deserialize().encryptedTransportMessage())==null?void 0:t.armadillo(),o=r==null?void 0:r.extendedContentMessage();if(o==null||r==null)return[];var a="xma-image",i=o.previews().map(function(t){return _(t,a,e)}),l=o.headerImage();l!=null&&i.push(_(l,a,e));var s=o.favicon();s!=null&&i.push(_(s,a,e));var u=(n=o.associatedMessage())==null?void 0:n.consumerMessage();return u!=null&&i.push(d(e,u)),i.filter(Boolean)}function p(e){var t,n=(t=e.deserialize().encryptedTransportMessage())==null?void 0:t.armadillo(),a=n==null?void 0:n.noteReply(),i=a==null?void 0:a.stickerContent(),l=a==null?void 0:a.videoContent(),s=i!=null?i:l;if(s!=null){var u=l!=null?o("getMediaTypeFromConsumerMessage").getMediaTypeForVideo(l):void 0,c=i!=null?"sticker":void 0,d=r("nullthrows")(u!=null?u:c);return _(s,d,e)}}function _(e,t,n){var a,i,l,u,c,d,m,p,_,f,g,h,y,C=e.ancillary,b=e.integral;if(C==null||b==null){var v=Object.entries({ancillary:C,integral:b}).filter(function(e){var t=e[0],n=e[1];return n==null}).map(function(e){var t=e[0];return t}).join(", ");r("FBLogger")("mps").warn("invalid media entry, missing %s. type %s",v,t);return}var S=o("WADirectPath").validateDirectPath((a=b.transport)==null||(a=a.integral)==null?void 0:a.directPath).value,R=(i=b.transport)==null||(i=i.integral)==null?void 0:i.mediaKeyTimestamp,L=R!=null?o("WATimeUtils").castLongIntToUnixTime(R):void 0,E=(l=b.transport)==null||(l=l.integral)==null?void 0:l.fileSha256,k=E!=null?o("WAHashUtils").toPlaintextHash(E):void 0;if(S==null||E==null||k==null||t==null){var I=Object.entries({directPath:S,fileSha256:E,mediaType:t,plaintextHash:k}).filter(function(e){var t=e[0],n=e[1];return n==null}).map(function(e){var t=e[0];return t}).join(", ");r("FBLogger")("mps").warn("Missing media entry fields: %s. type :%s",I,t);return}var T=null,D=C.scanLengths,x=C.scansSidecar;x!=null&&D!=null&&(T={scanLengths:D.map(o("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength),sidecar:x});var $=void 0,P=(u=b.transport)==null||(u=u.ancillary)==null||(u=u.thumbnail)==null?void 0:u.downloadableThumbnail;if(P!=null){var N;$={directPath:o("WADirectPath").validateDirectPath(P.directPath).value,fileEncSha256:P.fileEncSha256,fileSha256:P.fileSha256,mediaKey:P.mediaKey==null?void 0:o("WAMediaUtils").castToMediaKey(P.mediaKey),mediaKeyTimestamp:o("WATimeUtils").castLongIntToUnixTime((N=P.mediaKeyTimestamp)!=null?N:0),objectId:P.objectId==null?void 0:o("WAMediaUtils").stringToDeliveryObjectId(P.objectId)}}var M={directPath:S,downloadableThumbnail:$,fileEncSha256:(c=b.transport)==null||(c=c.integral)==null?void 0:c.fileEncSha256,filename:null,fileSha256:E,mediaKey:((d=b.transport)==null||(d=d.integral)==null?void 0:d.mediaKey)==null?void 0:o("WAMediaUtils").castToMediaKey((m=b.transport)==null||(m=m.integral)==null?void 0:m.mediaKey),mediaKeyTimestamp:L,objectId:(b==null||(p=b.transport)==null||(p=p.ancillary)==null?void 0:p.objectId)==null?void 0:o("WAMediaUtils").stringToDeliveryObjectId(b==null||(_=b.transport)==null||(_=_.ancillary)==null?void 0:_.objectId),progressiveJpegDetails:T,serverMediaType:t,size:o("WALongInt").numberOrThrowIfTooLarge((f=b==null||(g=b.transport)==null||(g=g.ancillary)==null?void 0:g.fileLength)!=null?f:0),uploadToken:void 0},w=o("WAMediaUtils").encodeMediaEntryWithUpdatedPath(M,S);return s({decodedMediaEntry:M,mediaEntry:w,mediaKeyTimestamp:L,message:{messageId:n.message.messageId,threadId:n.message.threadId},plaintextHash:k,serverMediaType:t,thumbnailHash:((h=$)==null?void 0:h.fileSha256)!=null?o("WAHashUtils").toPlaintextHash((y=$)==null?void 0:y.fileSha256):void 0})}function f(t){return e.get(t)}function g(){e.clear()}l.storeEntry=s,l.hydrateCache=u,l.getEntry=f,l.clear__TEST_ONLY=g}),98);
__d("WATypedArraysConcat",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){n===void 0&&(n=0);var r=t.reduce(function(e,t){return e+t.length},n),o=new e(r),a=0;return t.forEach(function(e){o.set(e,a),a+=e.length}),o}i.concatTypedArrays=e}),66);
__d("WACryptoAesCbc",["Promise","WABinary","WACryptoDependencies","WAPromiseDelays","WATypedArraysCast","WATypedArraysConcat","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=16,u=1024,c=16,d=1024*1024,m=s*d,p=(function(){function e(e,t,n,r){this.$4=null,this.$6=!1,this.$1=e,this.$2=t,this.$3=n;var a={name:"AES-CBC",iv:r};this.$5=o("WACryptoDependencies").getCrypto().subtle.importKey("raw",n,"AES-CBC",!1,[t]).then(function(e){return{algo:a,key:e}})}var t=e.prototype;return t.append=function(t){var e=this;this.$7("append");var n,r=this.$4;if(r)if(r.writeByteArray(t),r.size()>u){var a=r.size()%s;n=r.readByteArrayView(r.size()-a),r.size()||(this.$4=null)}else n=null;else if(t.length>u){var i=t.length%s;i?(this.$4=new(o("WABinary")).Binary(t),n=this.$4.readByteArrayView(t.length-i)):n=t}else this.$4=new(o("WABinary")).Binary(t),n=null;var l=n;return l&&(this.$5=this.$5.then(function(t){var n=t.key,r=t.algo;if(e.$2==="encrypt")return o("WACryptoDependencies").getCrypto().subtle.encrypt(r,n,l).then(function(t){return e.$1.writeByteArray(new Uint8Array(t,0,t.byteLength-s)),new Uint8Array(t,t.byteLength-2*s,s)});var a=l.slice(-s);return o("WACryptoDependencies").getCrypto().subtle.decrypt(r,n,l).then(function(t){return e.$1.writeBuffer(t),a})}).then(function(t){var n={name:"AES-CBC",iv:t};return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",e.$3,"AES-CBC",!1,[e.$2]).then(function(e){return{algo:n,key:e}})})),this.$5.then(function(){})},t.finalize=function(t){var e=this;this.$7("finalize");var n;if(this.$4){var r=this.$4;t&&r.writeByteArray(t),n=r.readByteArrayView(),this.$4=null}else t&&(n=t);if(n){var a=n;return this.$5.then(function(t){var n=t.algo,r=t.key;return e.$2==="encrypt"?o("WACryptoDependencies").getCrypto().subtle.encrypt(n,r,a):o("WACryptoDependencies").getCrypto().subtle.decrypt(n,r,a)}).then(function(t){e.$1.writeBuffer(t)})}else return this.$5.then(function(){})},t.$7=function(t){if(this.$6)throw r("err")("AesCbcStream."+t+" called after finalize")},e})();function _(e){return{name:"AES-CBC",iv:o("WATypedArraysCast").castTypedArrays(Uint8Array,e)}}function f(e){return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function g(e){if(e)return o("WATypedArraysCast").castTypedArrays(Uint8Array,e);var t=new Uint8Array(c);return o("WACryptoDependencies").getCrypto().getRandomValues(t),t}function h(e){var t=e.byteLength,n=s-t%s;return Number.isNaN(n)?t:t+n}function y(t,r,a){var i=_(r);return(e||(e=n("Promise"))).resolve(o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,t),"AES-CBC",!1,["decrypt"])).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.decrypt(i,e,a)})}function C(t,r){return(e||(e=n("Promise"))).resolve().then(function(){var e=r.slice(0,c),n=r.slice(c);return y(t,e,n)})}function b(t,r,a){return(e||(e=n("Promise"))).resolve().then(function(){var i=g(a),l=_(i);return(e||(e=n("Promise"))).resolve(f(t)).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.encrypt(l,e,r)}).then(function(e){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[i,new Uint8Array(e)]).buffer})})}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.encKey,n=e.plaintext,a=e.optionalIv,i=e.chunkSize,l=i===void 0?m:i,u=e.delayInBetween,c=u===void 0?!1:u;if(l%s!==0)throw r("err")("chunkSize must be a multiple of "+s+", "+l+" received");var d=yield f(t),p=new Uint8Array(n),_=Math.ceil(p.byteLength/l),y=g(a),C=new Uint8Array(h(p)+y.byteLength);C.set(y);for(var b=0,v=y,S;b<_;b++){var L=b===_-1,E=b*l;S=p.subarray(E,E+l);var k=yield R(L,S,v,d),I=k.encryptedChunk,T=k.nextIv;C.set(I,y.byteLength+b*l),v=T,c===!0&&(yield o("WAPromiseDelays").releaseToMainThread())}return C.buffer}),S.apply(this,arguments)}function R(e,t,n,r){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=yield o("WACryptoDependencies").getCrypto().subtle.encrypt(_(n),r,t).then(function(t){return e?new Uint8Array(t):new Uint8Array(t).subarray(0,-s)}),i=a.slice(-s);return{encryptedChunk:a,nextIv:i}}),L.apply(this,arguments)}l.AES_CBC_BLOCK_SIZE=s,l.AesCbcStream=p,l.importRawKey=f,l.getIv=g,l.aesCbcDecrypt=y,l.aesCbcDecryptSplit=C,l.aesCbcEncrypt=b,l.aesCbcEncryptWithChunking=v,l.aesCbcEncryptChunk=R}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=255*o("WACryptoHmac").SHA256_BYTE_LENGTH;function u(t,a,i){if(i<0||i>s)return(e||(e=n("Promise"))).reject(r("err")("HKDF::expand given bad length "+i));for(var l,u=Math.ceil(i/o("WACryptoHmac").SHA256_BYTE_LENGTH),c=o("WABinary").Binary.build(a).readByteArrayView(),d=new(o("WABinary")).Binary,m=o("WACryptoHmac").encodeKeySha256(t).then(function(e){return l=e,new Uint8Array(0)}),p=function(t){m=m.then(function(e){return o("WACryptoHmac").sign(l,o("WABinary").Binary.build(e,c,t).readByteArrayView())}).then(function(e){var t=new Uint8Array(e);return d.writeByteArray(t),t})},_=1;_<=u;_++)p(_);return m.then(function(){return d.readBuffer(i)})}function c(e,t,n){return o("WACryptoHmac").extractSha256(null,e).then(function(e){return u(new Uint8Array(e),t,n)})}function d(e,t,n,r){return o("WACryptoHmac").extractSha256(t,e).then(function(e){return u(new Uint8Array(e),n,r)})}l.expand=u,l.extractAndExpand=c,l.extractWithSaltAndExpand=d}),98);
__d("WAConcurrentIterate",["Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r,o){for(var a=[],i=[],l=0,s=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(;l<t;){var e=l;l++,i[e]=yield r(e)}});return function(){return e.apply(this,arguments)}})(),u=Math.min(t,o),c=0;c<u;c++)a.push(s());return(e||(e=n("Promise"))).all(a).then(function(){return i})}i.concurrentIterate=l}),66);
__d("WAMediaCryptoSidecar",["WAConcurrentIterate","WACryptoHmac","WAMediaUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e==="video"}var s=16,u=10,c=64*1024;function d(e,t,n){n===void 0&&(n=1);var r=t.buffer.byteLength,a=Math.ceil((r-s)/c),i=new Uint8Array(u*a);return o("WAConcurrentIterate").concurrentIterate(a,function(n){var r=n*c,a=r+s+c,l=t.subarray(r,a);return o("WACryptoHmac").sign(e,l).then(function(e){var t=new Uint8Array(e,0,u);i.set(t,n*u)})},n).then(function(){return o("WAMediaUtils").castToStreamingSidecar(i.buffer)})}l.shouldHaveStreamingSidecar=e,l.calculateStreamingSidecar=d}),98);
__d("WAMediaHkdfInfo",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"document":return"WhatsApp Document Keys";case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";case"md-msg-hist":return"WhatsApp History Keys";default:throw r("err")("getMediaHkdfInfo: unexpected media type "+e)}}function s(){return"Messenger Preview Keys"}l.getMediaHkdfInfo=e,l.getPreviewMediaHkdfInfo=s}),98);
__d("WAMediaCrypto",["Promise","WABinary","WACryptoAesCbc","WACryptoDependencies","WACryptoHkdf","WACryptoHmac","WACryptoSha256","WACryptoUtils","WACustomError","WAHashUtils","WAMediaCryptoSidecar","WAMediaHkdfInfo","WATagsLogger","WATypedArraysConcat","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["WAMediaCrypto"]),d=o("WACustomError").customError("HmacValidationError",!1),m=new Uint8Array([2,2]);function p(e,t){return o("WACryptoHkdf").extractAndExpand(new Uint8Array(e),t,112).then(function(e){return{iv:new Uint8Array(e,0,16),cipherKey:new Uint8Array(e,16,32),hmacKey:new Uint8Array(e,48,32),refKey:new Uint8Array(e,80,32)}})}function _(e,t){var n=o("WAMediaHkdfInfo").getMediaHkdfInfo(t);return p(e,n)}function f(e){var t=o("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return p(e,t)}function g(e){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new Map,r=yield f(e);t.set("preview",r);var o=["document","image","video","audio","md-app-state","md-msg-hist"];return yield(u||(u=n("Promise"))).all(o.map(function(n){return _(e,n).then(function(e){t.set(n,e)})})),t}),h.apply(this,arguments)}function y(e){switch(e){case"image":case"video":return e;default:return null}}var C=16,b=16,v=10,S=64*1024;function R(e,t,n,r,o){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r,a,i){var l=new(o("WABinary")).Binary;l.ensureCapacity(b+a.byteLength+C+v),l.writeByteArray(t);for(var s=new(o("WACryptoAesCbc")).AesCbcStream(l,"encrypt",e,t),c=0,d=c+S;d<a.byteLength;){var m=a.slice(c,d);yield s.append(new Uint8Array(m)),c=d,d+=S}var p=yield a.slice(c);yield s.finalize(new Uint8Array(p));var _=l.peek(function(e){return e.readByteArrayView()}),f=yield o("WACryptoHmac").encodeKeySha256(r),g=yield o("WACryptoHmac").sign(f,_);l.writeByteArray(new Uint8Array(g,0,v));var h=l.readByteArrayView(),y=h.subarray(b),R=yield(u||(u=n("Promise"))).all([o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",y),o("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(i)?o("WAMediaCryptoSidecar").calculateStreamingSidecar(f,h):void 0]),L=R[0],E=R[1];return{ciphertext:y,ciphertextHash:L,sidecar:E,ivCiphertext:_,ivCiphertextHmac:h}}),L.apply(this,arguments)}function E(e,t,n){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("WACryptoHmac").encodeKeySha256(e),a=o("WABinary").Binary.build(t,n).readByteArrayView();return o("WACryptoHmac").sign(r,a)}),k.apply(this,arguments)}function I(e,t,n,r,o){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new d("Bad hmac size "+a.length);var i=o("WABinary").Binary.build(t,n).readByteArrayView(),l=yield o("WACryptoHmac").hmacSha256(r,i).then(function(e){return new Uint8Array(e)}),s=l.slice(0,a.length);if(!N(s,a))throw new d("hmacAndDecrypt hmac mismatch");var u=yield o("WACryptoAesCbc").aesCbcDecrypt(e,t,n),c=yield o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",u);return{plaintextHash:o("WAHashUtils").toPlaintextHash(c),plaintext:u}}),T.apply(this,arguments)}function D(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new d("Bad hmac size "+a.length);var i=o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[t,n]);return o("WACryptoHmac").hmacSha256(r,i,a.length).then(function(e){return new Uint8Array(e)}).then(function(e){if(!o("WACryptoUtils").uint8ArraysEqual(e,a))throw new d("hmacAndDecrypt hmac mismatch")}).then(function(){var e=n.byteLength%C===v;return e===!0?n.subarray(0,-10):n}).then(function(n){return x(e,t,n)})}function x(e,t,n){var r=n.subarray(-C);return o("WACryptoAesCbc").aesCbcEncrypt(e,m,r).then(function(e){return e.slice(b)}).then(function(e){return o("WABinary").Binary.build(n,e).readByteArrayView()}).then(function(n){return o("WACryptoAesCbc").aesCbcDecrypt(e,t,n)}).then(function(e){return new Uint8Array(e,0,e.byteLength-m.byteLength)}).then(function(e){return{plaintext:e,nextIv:r}})}function $(e,t,n,r,o,a){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a,i,l,u){l>u.scanLengths.length&&c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialChunks targetScan greater length of scanLength array"])));var d=Math.min(l,u.scanLengths.length);if(d<1)throw c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt partial due to invalid target scan"]))),r("err")("Unable to decrypt partial due to invalid target scan");for(var m=new(o("WABinary")).Binary,p=[],_=0;_<d;_++)p.push(new Uint8Array(u.sidecar,_*10,10));for(var f=0,g=n,h=0,y=0;y<d;y++){var C=u.alignedScanLengths[y],b=f+C,v=a.subarray(f,b),S=yield D(t,g,v,i,p[y]),R=S.plaintext,L=S.nextIv;m.write(R),f+=C,g=L,h+=u.scanLengths[y]}var E=m.readBuffer(h),k=yield o("WACryptoSha256").sha256(E);return{plaintextHash:o("WAHashUtils").toPlaintextHash(k),plaintext:E}}),P.apply(this,arguments)}function N(e,t){if(e.length!==t.length)return!1;for(var n=1,r=e.length,o=0;o<r;o++)n&=e[o]===t[o]?1:0;return n!==0}l.HmacValidationError=d,l.DEFAULT_PADDING=m,l.computeMediaKeys=_,l.computeMediaKeysForPreview=f,l.deprecated_getAllCommonComputedMediaKeys=g,l.convertServerMediaTypeToPreviewMediaType=y,l.CBC_BLOCK_SIZE=C,l.IV_LENGTH=b,l.HMAC_LENGTH=v,l.encryptAndHmac=R,l.hmacCiphertext=E,l.hmacAndDecrypt=I,l.hmacAndDecryptPartial=D,l.decryptPartialChunks=$}),98);
__d("WAAlignChunkLengthsToMultipleOfAesBlockSize",[],(function(t,n,r,o,a,i){"use strict";function e(e){return parseInt((e+15)/16,10)*16}function l(t,n){for(var r=[],o=0,a=0,i=0,l=0;l<t.length;++l)if(o+=t[l],l===t.length-1&&n!=null&&n>0){o>a?r.push(n-a):(r.pop(),r.push(n-i));break}else if(o>a){var s=e(o-a);i=a,r.push(s),a+=s}return r}i.alignChunkSizeToMultipleAesBlockSize=e,i.alignChunkLengthsToMultipleOfAesBlockSize=l}),66);
__d("WAProgressiveJpegAlignScanLengths",["WAAlignChunkLengthsToMultipleOfAesBlockSize"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=e.totalEncryptedBytes;return o("WAAlignChunkLengthsToMultipleOfAesBlockSize").alignChunkLengthsToMultipleOfAesBlockSize(t.map(function(e){return e}),n).map(function(e){return e})}function s(e){return e}l.progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize=e,l.toProgressiveJpegAlignedScanLength=s}),98);
__d("WAProgressiveJpegGetPJpegDetails",["WAMediaCrypto","WAProgressiveJpegAlignScanLengths","WAProgressiveJpegGetScanLengths","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["WAProgressiveJpegDetails"]);function m(e){var t=e.progressiveJpegDetails,n=e.ciphertextLength;return babelHelpers.extends({},t,{alignedScanLengths:o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:t.scanLengths,totalEncryptedBytes:n})})}function p(e,t,n){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=t.byteLength-o("WAMediaCrypto").IV_LENGTH,a=o("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(e),i=o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:a,totalEncryptedBytes:r}),l=yield f(i,t,n);return{scanLengths:a,sidecar:l}}),_.apply(this,arguments)}function f(e,t,n){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){for(var r=new Uint8Array(e.length*10),a=0,i=0,l=t.slice(0,16),s=t.slice(16),u=0;u<e.length;u++){var c=e[u];i=a+c;var d=s.subarray(a,i),m=(yield o("WAMediaCrypto").hmacCiphertext(n,l,d)).slice(0,10);r.set(new Uint8Array(m),u*10),l=d.slice(d.length-16,d.length),a=i}return r.buffer}),g.apply(this,arguments)}function h(t){return t.sidecar.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0?(d.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar has an invalid length"]))),o("WAResultOrError").makeError("pjpeg-check-sidecar-invalid-length")):t.scanLengths.length>0&&t.sidecar.byteLength===0?(d.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar is missing"]))),o("WAResultOrError").makeError("pjpeg-check-no-sidecar")):t.scanLengths.length===0?o("WAResultOrError").makeResult(!1):t.scanLengths.length*o("WAMediaCrypto").HMAC_LENGTH!==t.sidecar.byteLength?(d.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar size mismatch"]))),o("WAResultOrError").makeError("pjpeg-check-scan-length-mismatch")):t.scanLengths.length<3?(d.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg has too few scans"]))),o("WAResultOrError").makeError("pjpeg-too-few-scans")):o("WAResultOrError").makeResult(!0)}function y(e,t){var n=0;if(t===0)return 0;for(var r=0;r<t;r++){var o=e[r];o!=null&&(n+=o)}return n}function C(e){var t=e.progressiveJpegDetails;if(t==null)return o("WAResultOrError").makeResult(null);var n=h(t);return n.success===!1?n:n.value===!0?o("WAResultOrError").makeResult({scanLengths:t.scanLengths,sidecar:t.sidecar}):o("WAResultOrError").makeResult(null)}l.getExtendedProgressiveJpegDetails=m,l.getProgressiveJpegDetails=p,l.isValidProgressiveJpegDetails=h,l.getTotalByteSizeForScan=y,l.maybeGetProgressiveJpegDetailsUsingMediaEntry=C}),98);
__d("WAStartMediaDownloadQplFlow",["QPLFlow","WAGetPlatformFromStanzaId","WAGetStorageQplAnnotations","WAJids","WAMediaUtils","WAPREMetrics","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.downloadEntry,n=e.msgType,a=e.triggerUIView,i=e.protocolMsgId,l=e.isPreview,s=e.xmaMediaType,u=o("QPLFlow").startQPLFlow(r("qpl")._(25312150,"83"),{annotations:{bool:{isTransformStreamSupported:o("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:i==null?null:o("WAJids").switchOnMsgrChatJidType(i.chat,{group:function(){return"group"},user:function(){return"user"}}),downloadEntry:l===!0?t+"-preview":t,e2eePlatform:i==null?null:o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(i.externalId),msgType:n,trigger_ui_view:a,xmaMediaType:s!=null?s:void 0}},timeoutInMs:o("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS});return o("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(e){u.addAnnotations(e)}),babelHelpers.extends({},u,{downloadEntry:t,triggerUIView:a})}l.startMediaDownloadQplFlow=e}),98);
__d("WADownloadDownloadablePreview",["WADownloadMedia","WAMediaCrypto","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WADownloadMedia").mediaDownloadLogger.TAGS(["DownloadDownloadablePreview"]);function f(e,t,n,r,o,a,i){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a,i,l,f){var g=l.handleMediaPreviewBeforeDownload,h=l.handleMediaPreviewDownloadFailed,y=a.downloadableThumbnail,C=y==null?void 0:y.directPath,b=C!=null,v=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a);if(_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_available: ",""])),b),y==null||C==null)return _.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No downloadableThumbnail. Skipping..."]))),o("WAResultOrError").makeError("preview-not-supported");_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["DownloadableThumbnail exists. Attempting to download."])));var S=y.fileEncSha256,R=y.fileSha256,L=y.mediaKey,E=y.objectId,k=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:t,downloadEntry:i,msgType:null,triggerUIView:f,isPreview:!0});if(k.addAnnotations({bool:{duplicateDirectPath:C===a.directPath,isProgressiveJpeg:v.success===!0,hasObjectId:E!=null},string:{mediaType:"preview",fullSizeMediaType:a.serverMediaType}}),k.addPoint("wa_protocol_media_download_start"),C==null||S==null||R==null||L==null)return _.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - mediaEntryData "," is incomplete for media preview"])),a),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-incomplete-media-entry"}}),o("WAResultOrError").makeError("media-entry-invalid");var I=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(r);if(I==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),r),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-unsupported-type"}}),o("WAResultOrError").makeError("request-error");yield g(n);var T=yield o("WADownloadMedia").downloadMediaImpl({downloadFlow:k,mediaTypeDetails:{messageType:I,type:"preview"},directPath:C,fileEncSha256:S,fileSha256:R,mediaKey:L});return T.success===!1?(_.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["failed to download media. Reason: ",""])),T.error),h(n,T.error),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:T.error}}),T):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["finished downloading"]))),k.addPoint("wa_protocol_media_download_end"),k.endSuccess(),o("WAResultOrError").makeResult(T.value))}),g.apply(this,arguments)}l.maybeDownloadDownloadablePreview=f}),98);
__d("WADecryptMedia",["WAMediaCrypto","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptMedia"]);function f(e,t,n,r){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a){_.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Encountered enc-hash-mismatch - looking for a potential working hmac salt"])));var i=r.type==="preview"?"preview":r.mediaType,l=yield o("WAMediaCrypto").deprecated_getAllCommonComputedMediaKeys(a),d;for(var m of l){var p=m[0],f=m[1];try{if(p===i)continue;_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Trying "," as an alternative hmac salt."])),p);var g=o("WAResultOrError").makeResult(yield o("WAMediaCrypto").hmacAndDecrypt(f.cipherKey,f.iv,t,f.hmacKey,n));return d={hmacAndDecryptResult:g,alternativeHmacSaltUsed:p},_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found a working hmac salt using ","."])),p),d}catch(e){_.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," is not a working hmac salt."])),p);continue}}return{hmacAndDecryptResult:o("WAResultOrError").makeError("enc-hash-mismatch")}}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.ciphertextHmac,n=e.mediaKey,r=e.mediaTypeDetails,a=e.plaintextHash;_.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Using default plaintext verifier"])));var i=t.byteLength-o("WAMediaCrypto").HMAC_LENGTH,l=new Uint8Array(t,i),s=new Uint8Array(t,0,i),u;r.type==="preview"?u=o("WAMediaCrypto").computeMediaKeysForPreview(n):u=o("WAMediaCrypto").computeMediaKeys(n,r.mediaType);var c,g=null;if(c=yield u.then(function(e){var t=e.iv,n=e.cipherKey,r=e.hmacKey;return o("WAMediaCrypto").hmacAndDecrypt(n,t,s,r,l)}).then(o("WAResultOrError").makeResult).catch(function(e){return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")}),c.success===!1&&c.error==="enc-hash-mismatch"){var h=yield f(s,l,r,n);c=h.hmacAndDecryptResult,g=h.alternativeHmacSaltUsed}if(!c.success)return c;var y=c.value,C=y.plaintext,b=y.plaintextHash;return a!==b?o("WAResultOrError").makeError("hash-mismatch"):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Success"]))),o("WAResultOrError").makeResult({plaintext:C,alternativeHmacSaltUsed:g}))}),y.apply(this,arguments)}l.decryptMedia=h}),98);
__d("WAArrayUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e,t){var n=e.pop();t<e.length&&(e[t]=n)}function*s(e,t){for(var n=0;n<e.length;n+=t)yield e.slice(n,n+t)}function u(t,n){return c(t,n,e)}function c(e,t,n){var r=new Map;for(var o of e){var a,i=t(o),l=(a=r.get(i))!=null?a:[];l.push(n(o)),r.set(i,l)}return r}i.removeIndexWithoutPreservingOrder=l,i.peekEvery=s,i.groupBy=u,i.groupByAndMap=c}),66);
__d("WABaseGlobals",["err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){e=t}function u(){if(e==null)throw r("err")("Trying to access WAGlobals before being set");return e}function c(e){var t=u();t.myJids=e}function d(){var e,t=(e=u().myJids)==null?void 0:e.deviceJid;if(t==null)throw r("err")("Trying to access myDeviceJid, but it's not set");return t}function m(){var e,t=(e=u().myJids)==null?void 0:e.userJid;if(t==null)throw r("err")("Trying to access myUserJid, but it's not set");return t}function p(){return u().jidUtils}function _(){return u().qpl}function f(){return e==null?!1:u().newClockSkewCalculation()}l.setGlobals=s,l.setMyJids=c,l.getMyDeviceJid=d,l.getMyUserJid=m,l.getJidUtilsApi=p,l.getQplConfig=_,l.newClockSkewCalculation=f}),98);
__d("WAErrors",["WACustomError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=o("WACustomError")).customError("BufferTooLarge",!1),u=e.customError("Disconnected",!1),c=e.customError("Offline",!1,u),d=e.customError("MaxRetries",!1),m=e.customError("Aborted",!1);l.BufferTooLargeError=s,l.Disconnected=u,l.Offline=c,l.MaxRetries=d,l.Aborted=m}),98);
__d("WANotifyConnectionChangeFactory",[],(function(t,n,r,o,a,i){"use strict";var e=15e3;function l(t,n,r){r===void 0&&(r=e);var o={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},a=function(){var e=o.optimismLevel,t=o.connectionStatus;e==="optimist"?o.timeoutID=setTimeout(function(){o.optimismLevel="realist",n(t)},r):n(t)};return function(e){o.connectionStatus=e,e==="disconnected"||e==="in_handshake"?a():(o.timeoutID!=null&&(clearTimeout(o.timeoutID),o.timeoutID=null),n(e)),t(e)}}i.notifyConnectionChangeFactory=l}),66);
__d("WASmaxInPingsEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e={validators:[o("WAJids").validateDomainJid,o("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};l.DOMAINJID_USERJID=e}),98);
__d("WADeepEquals",[],(function(t,n,r,o,a,i){"use strict";function e(t,n){if(t===n)return!0;if(!t||!n||typeof t!="object"&&typeof n!="object")return!1;var r=Array.isArray(t),o=Array.isArray(n);if(r!==o)return!1;var a=!0;if(r){var i=t.length;if(i!==n.length)return!1;for(var l=0;a&&l<i;l++)a=e(t[l],n[l]);return a}for(var s=Object.keys(t),u=0;a&&u<s.length;u++){var c=s[u];a=n.propertyIsEnumerable(c)&&e(t[c],n[c])}return a&&Object.keys(n).length===s.length}i.deepEqual=e}),66);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e={JID:0,JID_U:1,JID_AD:1,JID_FB:3,JID_INTEROP:4},s=n("$InternalEnum")({WHATSAPP:0,LID:1,HOSTED:128,HOSTED_LID:129}),u=(function(){function t(e){this.$1=e}t.createAD=function(r,o,a){return new t({type:e.JID_AD,user:r,device:a==null?0:a,agent:o==null?0:o,domainType:s.WHATSAPP})},t.createJidU=function(r,o,a){return new t({type:e.JID_U,user:r,device:a==null?0:a,domainType:o==null?s.WHATSAPP:o})},t.createFbJid=function(r,o){var n=o==null?0:o;return new t({type:e.JID_FB,user:r,device:n})},t.createInteropJid=function(r,o,a){var n=o==null?0:o;return new t({type:e.JID_INTEROP,user:r,device:n,integrator:a})},t.create=function(r,o){return new t({type:e.JID,user:r,server:o})};var n=t.prototype;return n.toString=function(){if(this.$1.type===e.JID_AD||this.$1.type===e.JID_U){var t=this.$1,n=t.user,r=t.device,a=t.domainType,i="";return a===s.WHATSAPP?i=o("WAJids").WA_USER_JID_SUFFIX:a===s.HOSTED?i=o("WAJids").HOSTED_SUFFIX:a===s.HOSTED_LID?i=o("WAJids").HOSTED_LID_SUFFIX:i=o("WAJids").LID_SUFFIX,r===0?n+"@"+i:n+":"+r+"@"+i}else if(this.$1.type===e.JID_FB){var l=this.$1,u=l.user,c=l.device,d=o("WAJids").MSGR_USER_JID_SUFFIX;return u+":"+c+"@"+d}else if(this.$1.type===e.JID_INTEROP){var m=this.$1,p=m.user,_=m.device,f=m.integrator,g=o("WAJids").INTEROP_USER_JID_SUFFIX;return f+"-"+p+":"+_+"@"+g}else{this.$1.type;var h=this.$1,y=h.user,C=h.server;return y!=null?y+"@"+C:C}},n.getInnerJid=function(){return this.$1},t})();l.WAP_JID_SUBTYPE=e,l.DomainType=s,l.WapJid=u}),98);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WAResultOrError").makeResult();function s(t,n){return t.tag!==n?O(t,"to be <"+n+">"):e}function u(e,t){return B(e,t)?W(e,e.attrs[t]):O(e,'to have attribute "'+t+'"')}function c(e,t,n,r){var a=u(e,t);if(!a.success)return a;var i=n(a.value);return i!=null?o("WAResultOrError").makeResult(i):O(e,'to have "'+t+'"={'+r+'}, but instead has "'+a.value+'"')}function d(e,t,n){var r=P(e);if(!r.success)return r;var a=t(r.value);return a!=null?o("WAResultOrError").makeResult(a):O(e,"to have "+n+' content, but instead has "'+r.value+'"')}function m(t,n,r){var o=u(t,n);if(o.success){if(o.value!==r)return O(t,'to have "'+n+'"="'+r+'", but instead has "'+o.value+'"')}else return o;return e}function p(e,t){return c(e,t,o("WAStanzaUtils").toStanzaId,"stanzaID")}function _(e,t){return c(e,t,o("WAStanzaUtils").validateCallId,"callID")}function f(e,t){return c(e,t,q,"integer")}function g(e,t,n,r){var a=f(e,t);if(!a.success)return a;var i=a.value;return n!==void 0&&i<n?O(e,'to have "'+t+'"={at least '+n+"} but has value "+i):r!==void 0&&i>r?O(e,'to have "'+t+'"={at most '+r+"} but has value "+i):o("WAResultOrError").makeResult(i)}function h(e){var t=e.content;return t instanceof Uint8Array?O(e,"to have children"):o("WAResultOrError").makeResult(t)}function y(t,n){var r=h(t);if(!r.success)return r;var a=r.value;if(a==null)return e;for(var i=null,l=0;l<a.length;l++){var s=a[l];if(s.tag===n){if(i!=null)return O(t,"to have 1 child <"+n+">, but found more than 1");i=s}}return o("WAResultOrError").makeResult(i)}function C(t,n,r){var o=y(t,n);return o.success?o.value==null?e:r(o.value):o}function b(e,t,n){var r=C(e,t,n);if(!r.success)return r;var a=r.value;return a==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(a)}function v(e,t){var n=y(e,t);return n.success?n.value==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(n.value):n}function S(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=[],s=0;s<i.value.length;s++){var u=a(i.value[s]);if(!u.success)return u;l.push(u.value)}return o("WAResultOrError").makeResult(l)}function R(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=i.value.length,s=0;s<l;s++){var u=a(i.value[s]);if(!u.success)return u}return o("WAResultOrError").makeResult(l)}function L(e,t,n){var r=S(e,t,0,1/0,n);if(!r.success)return r;for(var a=0;a<r.value.length;a++)if(!o("WADeepEquals").deepEqual(r.value[0],r.value[a]))return O(e,"to have homogeneous children, but found two children that are not equal");return r}function E(e,t,n){var r=L(e,t,n);return r.success?o("WAResultOrError").makeResult(r.value.length):r}function k(t,n,r,o,a){return B(n,r)?t(n,r,o,a):e}function I(t,n,r,a){if(a==null)return e;var i=k(t,n,r);return i.success?i.value===a?o("WAResultOrError").makeResult(a):i.value==null?e:O(n,'to have "'+r+'"={'+a+'}, but instead has "'+i.value+'"'):i}function T(e,t,n,r){var a=e(t,n);return a.success?a.value===r?o("WAResultOrError").makeResult(r):O(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"'):a}function D(e,t,n){var r=e(t);return r.success?r.value===n?o("WAResultOrError").makeResult(n):O(t,'to have content "'+n+'", but instead has "'+r.value+'"'):r}function x(e,t,n){var r=u(e,t);if(!r.success)return r;var a=n[r.value];if(a!=null)return o("WAResultOrError").makeResult(a);var i=Object.values(n).join("|");return O(e,'to have "'+t+'"={'+i+'}, but instead has "'+r.value+'"')}function $(e,t){var n=P(e);if(!n.success)return n;var r=t[n.value];if(r!=null)return o("WAResultOrError").makeResult(r);var a=Object.values(t).join("|");return O(e,'to have content "'+a+'", but instead has "'+n.value+'"')}function P(e){var t=N(e);if(t.success)try{var n=new(o("WABinary")).Binary(t.value),a=n.readString(n.size());return o("WAResultOrError").makeResult(a)}catch(t){return O(e,"to have string content, but run into decoding error: "+r("getErrorSafe")(t).message)}else return t}function N(e){var t=e.content;return t==null?O(e,"to have content"):Array.isArray(t)?O(e,"to have content, but has children instead"):o("WAResultOrError").makeResult(t)}function M(e,t){var n=N(e);return n.success?o("WACryptoUtils").uint8ArraysEqual(n.value,t)?o("WAResultOrError").makeResult(t):O(e,'to have content ":binary:'+o("WABase64").encodeB64(t)+'", but instead has ":binary:'+o("WABase64").encodeB64(n.value)+'"'):n}function w(e,t,n){var r=e.content;if(r==null)return t===void 0||t<1?o("WAResultOrError").makeResult(new Uint8Array([])):O(e,"to have content");if(Array.isArray(r))return O(e,"to have content, but has children instead");var a=r.length;return t!==void 0&&a<t?O(e,"to have binary content at least "+t+" bytes but has "+a+" bytes"):n!==void 0&&a>n?O(e,"to have binary content at most "+n+" bytes but has "+a+" bytes"):o("WAResultOrError").makeResult(r)}function A(e){return d(e,q,"integer")}function F(e){return e}function O(e,t){return o("WAResultOrError").makeError("expected <"+e.tag+">: "+t)}function B(e,t){return r("WAHasProperty")(e.attrs,t)}function W(e,t){return t instanceof o("WAWapJid").WapJid?o("WAResultOrError").makeResult(t.toString()):typeof t=="string"?o("WAResultOrError").makeResult(t):O(e,"decodeAsString: attribute is "+typeof t+" not a string: "+String(t))}function q(e){var t=parseInt(e,10);return Number.isNaN(t)?null:t}function U(e,t,n,r){var a=h(e);if(!a.success)return a;var i=a.value;if(i==null)return n!==0?O(e,"to have at least "+n+" <"+t+"> children, but found 0"):o("WAResultOrError").makeResult([]);for(var l=[],s=0;s<i.length;s++){var u=i[s];u.tag===t&&l.push(u)}var c=l.length;return c<n?O(e,"to have at least "+n+" <"+t+"> children, but found "+c):c>r?O(e,"to have at most "+r+" <"+t+"> children, but found "+c):o("WAResultOrError").makeResult(l)}var V={};function H(e,t,n){var r=t.map(function(e,t){return e+": "+n[t].error});return O(e,["to match any of following mixins: "+t.join(", ")+", but all mixins failed."].concat(r).join(" "))}l.voidSuccess=e,l.assertTag=s,l.attrString=u,l.attrValidate=c,l.contentValidate=d,l.assertAttr=m,l.attrStanzaId=p,l.attrCallId=_,l.attrInt=f,l.attrIntRange=g,l.maybeChildren=h,l.optionalChild=y,l.optionalChildWithTag=C,l.childWithTag=b,l.flattenedChildWithTag=v,l.mapChildrenWithTag=S,l.countChildrenWithTag=R,l.mapHomogeneousChildrenWithTag=L,l.countHomogeneousChildrenWithTag=E,l.optional=k,l.optionalLiteral=I,l.literal=T,l.literalContent=D,l.attrStringEnum=x,l.contentStringEnum=$,l.contentString=P,l.contentBytes=N,l.contentLiteralBytes=M,l.contentBytesRange=w,l.contentInt=A,l.identity=F,l.errorMessage=O,l.emptyObject=V,l.errorMixinDisjunction=H}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateUserJid,"UserJid")}function s(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateLidUserJid,"LidUserJid")}function u(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDeviceJid,"DeviceJid")}function c(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateGroupJid,"GroupJid")}function d(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateCallJid,"CallJid")}function m(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDomainJid,"DomainJid")}function p(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateBroadcastJid,"BroadcastJid")}function _(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateStatusJid,"StatusJid")}function f(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateNewsletterJid,"NewsletterJid")}function g(e,t,n){var r=o("WASmaxParseUtils").attrString(e,t);if(!r.success)return r;for(var a=n.validators,i=n.typeName,l=0;l<a.length;l++){var s=a[l](r.value);if(s!=null)return o("WAResultOrError").makeResult(s)}return o("WASmaxParseUtils").errorMessage(e,'to have "'+t+'"={'+i+'}, but instead has "'+r.value+'"')}function h(e,t,n,r){var a=e(t,n);return!a.success||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}function y(e,t,n,r){var a=o("WASmaxParseUtils").optional(e,t,n);return!a.success||a.value==null||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}l.attrUserJid=e,l.attrLidUserJid=s,l.attrDeviceJid=u,l.attrGroupJid=c,l.attrCallJid=d,l.attrDomainJid=m,l.attrBroadcastJid=p,l.attrStatusJid=_,l.attrNewsletterJid=f,l.attrJidEnum=g,l.literalJid=h,l.optionalLiteralJid=y}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,o){var a=m(t,n);if(!a.success)return _(a);var i=e(a.value,n[n.length-1],r,o);return i.success?i:_(i)}function s(t,n,r,a,i){return p(n,r)?e(t,n,r,a,i):o("WASmaxParseUtils").voidSuccess}function u(t,n){return e(o("WASmaxParseUtils").attrString,t,n)}function c(e,t){return p(e,t)?u(e,t):o("WASmaxParseUtils").voidSuccess}function d(e,t){var n=m(e,t);if(!n.success)return _(n);var r=o("WASmaxParseUtils").contentString(n.value);return r.success?r:_(r)}function m(e,t){for(var n=t.length,r=e,a=0;a<n-1;a++){var i=t[a],l=o("WASmaxParseUtils").flattenedChildWithTag(r,i);if(!l.success)return l;r=l.value}return o("WAResultOrError").makeResult(r)}function p(e,t){var n=m(e,t);return n.success&&r("WAHasProperty")(n.value.attrs,t[t.length-1])}function _(e){return o("WAResultOrError").makeError("in the reference, "+e.error)}l.attrFromReference=e,l.optionalAttrFromReference=s,l.attrStringFromReference=u,l.optionalAttrStringFromReference=c,l.contentStringFromReference=d}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseJid").attrJidEnum(e,"from",o("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").attrInt(e,"t");return s.success?o("WAResultOrError").makeResult({from:r.value,type:a.value,t:s.value}):s}l.parseClientResponseServerResponse=e}),98);
__d("WAWapDict",[],(function(t,n,r,o,a,i){"use strict";var e=3,l=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","notification","disappearing_mode","status","jid","broadcast","user","devices","device_hash","to","offline","message","result","class","xmlns","duration","notify","iq","t","ack","g.us","enc","urn:xmpp:whatsapp:push","presence","config_value","picture","verified_name","config_code","key-index-list","contact","mediatype","routing_info","edge_routing","get","read","urn:xmpp:ping","fallback_hostname","0","chatstate","business_hours_config","unavailable","download_buckets","skmsg","verified_level","composing","handshake","device-list","media","text","fallback_ip4","media_conn","device","creation","location","config","item","fallback_ip6","count","w:profile:picture","image","business","2","hostname","call-creator","display_name","relaylatency","platform","abprops","success","msg","offline_preview","prop","key-index","v","day_of_week","pkmsg","version","1","ping","w:p","download","video","set","specific_hours","props","primary","unknown","hash","commerce_experience","last","subscribe","max_buckets","call","profile","member_since_text","close_time","call-id","sticker","mode","participants","value","query","profile_options","open_time","code","list","host","ts","contacts","upload","lid","preview","update","usync","w:stats","delivery","auth_ttl","context","fail","cart_enabled","appdata","category","atn","direct_connection","decrypt-fail","relay_id","mmg-fallback.whatsapp.net","target","available","name","last_id","mmg.whatsapp.net","categories","401","is_new","index","tctoken","ip4","token_id","latency","recipient","edit","ip6","add","thumbnail-document","26","paused","true","identity","stream:error","key","sidelist","background","audio","3","thumbnail-image","biz-cover-photo","cat","gcm","thumbnail-video","error","auth","deny","serial","in","registration","thumbnail-link","remove","00","gif","thumbnail-gif","tag","capability","multicast","item-not-found","description","business_hours","config_expo_key","md-app-state","expiration","fallback","ttl","300","md-msg-hist","device_orientation","out","w:m","open_24h","side_list","token","inactive","01","document","te2","played","encrypt","msgr","hide","direct_path","12","state","not-authorized","url","terminate","signature","status-revoke-delay","02","te","linked_accounts","trusted_contact","timezone","ptt","kyc-id","privacy_token","readreceipts","appointment_only","address","expected_ts","privacy","7","android","interactive","device-identity","enabled","attribute_padding","1080","03","screen_height"],s=["read-self","active","fbns","protocol","reaction","screen_width","heartbeat","deviceid","2:47DEQpj8","uploadfieldstat","voip_settings","retry","priority","longitude","conflict","false","ig_professional","replaced","preaccept","cover_photo","uncompressed","encopt","ppic","04","passive","status-revoke-drop","keygen","540","offer","rate","opus","latitude","w:gp2","ver","4","business_profile","medium","sender","prev_v_id","email","website","invited","sign_credential","05","transport","skey","reason","peer_abtest_bucket","America/Sao_Paulo","appid","refresh","100","06","404","101","104","107","102","109","103","member_add_mode","105","transaction-id","110","106","outgoing","108","111","tokens","followers","ig_handle","self_pid","tue","dec","thu","joinable","peer_pid","mon","features","wed","peer_device_presence","pn","delete","07","fri","audio_duration","admin","connected","delta","rcat","disable","collection","08","480","sat","phash","all","invite","accept","critical_unblock_low","group_update","signed_credential","blinded_credential","eph_setting","net","09","background_location","refresh_id","Asia/Kolkata","privacy_mode_ts","account_sync","voip_payload_type","service_areas","acs_public_key","v_id","0a","fallback_class","relay","actual_actors","metadata","w:biz","5","connected-limit","notice","0b","host_storage","fb_page","subject","privatestats","invis","groupadd","010","note.m4r","uuid","0c","8000","sun","372","1020","stage","1200","720","canonical","fb","011","video_duration","0d","1140","superadmin","012","Opening.m4r","keystore_attestation","dleq_proof","013","timestamp","ab_key","w:sync:app:state","0e","vertical","600","p_v_id","6","likes","014","500","1260","creator","0f","rte","destination","group","group_info","syncd_anti_tampering_fatal_exception_enabled","015","dl_bw","Asia/Jakarta","vp8/h.264","online","1320","fb:multiway","10","timeout","016","nse_retry","urn:xmpp:whatsapp:dirty","017","a_v_id","web_shops_chat_header_button_enabled","nse_call","inactive-upgrade","none","web","groups","2250","mms_hot_content_timespan_in_seconds","contact_blacklist","nse_read","suspended_group_deletion_notification","binary_version","018","https://www.whatsapp.com/otp/copy/","reg_push","shops_hide_catalog_attachment_entrypoint","server_sync",".","ephemeral_messages_allowed_values","019","mms_vcache_aggregation_enabled","iphone","America/Argentina/Buenos_Aires","01a","mms_vcard_autodownload_size_kb","nse_ver","shops_header_dropdown_menu_item","dhash","catalog_status","communities_mvp_new_iqs_serverprop","blocklist","default","11","ephemeral_messages_enabled","01b","original_dimensions","8","mms4_media_retry_notification_encryption_enabled","mms4_server_error_receipt_encryption_enabled","original_image_url","sync","multiway","420","companion_enc_static","shops_profile_drawer_entrypoint","01c","vcard_as_document_size_kb","status_video_max_duration","request_image_url","01d","regular_high","s_t","abt","share_ext_min_preliminary_image_quality","01e","32","syncd_key_rotation_enabled","data_namespace","md_downgrade_read_receipts2","patch","polltype","ephemeral_messages_setting","userrate","15","partial_pjpeg_bw_threshold","played-self","catalog_exists","01f","mute_v2"],u=["reject","dirty","announcement","020","13","9","status_video_max_bitrate","fb:thrift_iq","offline_batch","022","full","ctwa_first_business_reply_logging","h.264","smax_id","group_description_length","https://www.whatsapp.com/otp/code","status_image_max_edge","smb_upsell_business_profile_enabled","021","web_upgrade_to_md_modal","14","023","s_o","smaller_video_thumbs_status_enabled","media_max_autodownload","960","blocking_status","peer_msg","joinable_group_call_client_version","group_call_video_maximization_enabled","return_snapshot","high","America/Mexico_City","entry_point_block_logging_enabled","pop","024","1050","16","1380","one_tap_calling_in_group_chat_size","regular_low","inline_joinable_education_enabled","hq_image_max_edge","locked","America/Bogota","smb_biztools_deeplink_enabled","status_image_quality","1088","025","payments_upi_intent_transaction_limit","voip","w:g2","027","md_pin_chat_enabled","026","multi_scan_pjpeg_download_enabled","shops_product_grid","transaction_id","ctwa_context_enabled","20","fna","hq_image_quality","alt_jpeg_doc_detection_quality","group_call_max_participants","pkey","America/Belem","image_max_kbytes","web_cart_v1_1_order_message_changes_enabled","ctwa_context_enterprise_enabled","urn:xmpp:whatsapp:account","840","Asia/Kuala_Lumpur","max_participants","video_remux_after_repair_enabled","stella_addressbook_restriction_type","660","900","780","context_menu_ios13_enabled","mute-state","ref","payments_request_messages","029","frskmsg","vcard_max_size_kb","sample_buffer_gif_player_enabled","match_last_seen","510","4983","video_max_bitrate","028","w:comms:chat","17","frequently_forwarded_max","groups_privacy_blacklist","Asia/Karachi","02a","web_download_document_thumb_mms_enabled","02b","hist_sync","biz_block_reasons_version","1024","18","web_is_direct_connection_for_plm_transparent","view_once_write","file_max_size","paid_convo_id","online_privacy_setting","video_max_edge","view_once_read","enhanced_storage_management","multi_scan_pjpeg_encoding_enabled","ctwa_context_forward_enabled","video_transcode_downgrade_enable","template_doc_mime_types","hq_image_bw_threshold","30","body","u_aud_limit_sil_restarts_ctrl","other","participating","w:biz:directory","1110","vp8","4018","meta","doc_detection_image_max_edge","image_quality","1170","02c","smb_upsell_chat_banner_enabled","key_expiry_time_second","pid","stella_interop_enabled","19","linked_device_max_count","md_device_sync_enabled","02d","02e","360","enhanced_block_enabled","ephemeral_icon_in_forwarding","paid_convo_status","gif_provider","project_name","server-error","canonical_url_validation_enabled","wallpapers_v2","syncd_clear_chat_delete_chat_enabled","medianotify","02f","shops_required_tos_version","vote","reset_skey_on_id_change","030","image_max_edge","multicast_limit_global","ul_bw","21","25","5000","poll","570","22","031","1280","WhatsApp","032","bloks_shops_enabled","50","upload_host_switching_enabled","web_ctwa_context_compose_enabled","ptt_forwarded_features_enabled","unblocked","partial_pjpeg_enabled","fbid:devices","height","ephemeral_group_query_ts","group_join_permissions","order","033","alt_jpeg_status_quality","migrate","popular-bank","win_uwp_deprecation_killswitch_enabled","web_download_status_thumb_mms_enabled","blocking","url_text","035","web_forwarding_limit_to_groups","1600","val","1000","syncd_msg_date_enabled","bank-ref-id","max_subject","payments_web_enabled","web_upload_document_thumb_mms_enabled","size","request","ephemeral","24","receipt_agg","ptt_remember_play_position","sampling_weight","enc_rekey","mute_always","037","034","23","036","action","click_to_chat_qr_enabled","width","disabled","038","md_blocklist_v2","played_self_enabled","web_buttons_message_enabled","flow_id","clear","450","fbid:thread","bloks_session_state","America/Lima","attachment_picker_refresh","download_host_switching_enabled","1792","u_aud_limit_sil_restarts_test2","custom_urls","device_fanout","optimistic_upload","2000","key_cipher_suite","web_smb_upsell_in_biz_profile_enabled","e","039","siri_post_status_shortcut","pair-device","lg","lc","stream_attribution_url","model","mspjpeg_phash_gen","catalog_send_all","new_multi_vcards_ui","share_biz_vcard_enabled","-","clean","200","md_blocklist_v2_server","03b","03a","web_md_migration_experience","ptt_conversation_waveform","u_aud_limit_sil_restarts_test1"],c=["64","ptt_playback_speed_enabled","web_product_list_message_enabled","paid_convo_ts","27","manufacturer","psp-routing","grp_uii_cleanup","ptt_draft_enabled","03c","business_initiated","web_catalog_products_onoff","web_upload_link_thumb_mms_enabled","03e","mediaretry","35","hfm_string_changes","28","America/Fortaleza","max_keys","md_mhfs_days","streaming_upload_chunk_size","5541","040","03d","2675","03f","...","512","mute","48","041","alt_jpeg_quality","60","042","md_smb_quick_reply","5183","c","1343","40","1230","043","044","mms_cat_v1_forward_hot_override_enabled","user_notice","ptt_waveform_send","047","Asia/Calcutta","250","md_privacy_v2","31","29","128","md_messaging_enabled","046","crypto","690","045","enc_iv","75","failure","ptt_oot_playback","AIzaSyDR5yfaG7OG8sMTUj8kfQEb8T9pN8BM6Lk","w","048","2201","web_large_files_ui","Asia/Makassar","812","status_collapse_muted","1334","257","2HP4dm","049","patches","1290","43cY6T","America/Caracas","web_sticker_maker","campaign","ptt_pausable_enabled","33","42","attestation","biz","04b","query_linked","s","125","04a","810","availability","1411","responsiveness_v2_m1","catalog_not_created","34","America/Santiago","1465","enc_p","04d","status_info","04f","key_version","..","04c","04e","md_group_notification","1598","1215","web_cart_enabled","37","630","1920","2394","-1","vcard","38","elapsed","36","828","peer","pricing_category","1245","invalid","stella_ios_enabled","2687","45","1528","39","u_is_redial_audio_1104_ctrl","1025","1455","58","2524","2603","054","bsp_system_message_enabled","web_pip_redesign","051","verify_apps","1974","1272","1322","1755","052","70","050","1063","1135","1361","80","1096","1828","1851","1251","1921","key_config_id","1254","1566","1252","2525","critical_block","1669","max_available","w:auth:backup:token","product","2530","870","1022","participant_uuid","web_cart_on_off","1255","1432","1867","41","1415","1440","240","1204","1608","1690","1846","1483","1687","1749","69","url_number","053","1325","1040","365","59","Asia/Riyadh","1177","test_recommended","057","1612","43","1061","1518","1635","055","1034","1375","750","1430","event_code","1682","503","55","865","78","1309","1365","44","America/Guayaquil","535","LIMITED","1377","1613","1420","1599","1822","05a","1681","password","1111","1214","1376","1478","47","1082","4282","Europe/Istanbul","1307","46","058","1124","256","rate-overlimit","retail","u_a_socket_err_fix_succ_test","1292","1370","1388","520","861","psa","regular","1181","1766","05b","1183","1213","1304","1537"],d=["1724","profile_picture","1071","1314","1605","407","990","1710","746","pricing_model","056","059","061","1119","6027","65","877","1607","05d","917","seen","1516","49","470","973","1037","1350","1394","1480","1796","keys","794","1536","1594","2378","1333","1524","1825","116","309","52","808","827","909","495","1660","361","957","google","1357","1565","1967","996","1775","586","736","1052","1670","bank","177","1416","2194","2222","1454","1839","1275","53","997","1629","6028","smba","1378","1410","05c","1849","727","create","1559","536","1106","1310","1944","670","1297","1316","1762","en","1148","1295","1551","1853","1890","1208","1784","7200","05f","178","1283","1332","381","643","1056","1238","2024","2387","179","981","1547","1705","05e","290","903","1069","1285","2436","062","251","560","582","719","56","1700","2321","325","448","613","777","791","51","488","902","Asia/Almaty","is_hidden","1398","1527","1893","1999","2367","2642","237","busy","065","067","233","590","993","1511","54","723","860","363","487","522","605","995","1321","1691","1865","2447","2462","NON_TRANSACTIONAL","433","871","432","1004","1207","2032","2050","2379","2446","279","636","703","904","248","370","691","700","1068","1655","2334","060","063","364","533","534","567","1191","1210","1473","1827","069","701","2531","514","prev_dhash","064","496","790","1046","1139","1505","1521","1108","207","544","637","final","1173","1293","1694","1939","1951","1993","2353","2515","504","601","857","modify","spam_request","p_121_aa_1101_test4","866","1427","1502","1638","1744","2153","068","382","725","1704","1864","1990","2003","Asia/Dubai","508","531","1387","1474","1632","2307","2386","819","2014","066","387","1468","1706","2186","2261","471","728","1147","1372","1961"],m=[s,u,c,d];i.DICT_VERSION=e,i.SINGLE_BYTE_TOKEN=l,i.DICTIONARY_0_TOKEN=s,i.DICTIONARY_1_TOKEN=u,i.DICTIONARY_2_TOKEN=c,i.DICTIONARY_3_TOKEN=d,i.DICTIONARIES=m}),66);
__d("WAXmlFormatter",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),n=t.length,r=!1,o=0,a="",i=0,s=["\n"];for(i=0;i<100;i++)s.push(s[i]+"    ");var u=function(t,n){var e=/^<[\w:\-.,]+/.exec(t[n-1]),r=/^<\/[\w:\-.,]+/.exec(t[n]);return e!=null&&r!=null&&e[0]===r[0]};for(i=0;i<n;i++)t[i].search(/<!/)>-1?(a+=s[o]+t[i],r=!0,(t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1||t[i].search(/!DOCTYPE/)>-1)&&(r=!1)):t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1?(a+=t[i],r=!1):u(t,i)?(a+=t[i],r||o--):t[i].search(/<\w/)>-1&&t[i].search(/<\//)===-1&&t[i].search(/\/>/)===-1?(t[i]=l(t[i]),a=r?a+=t[i]:a+=s[o++]+t[i]):t[i].search(/<\w/)>-1&&t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o===0?o:--o]+t[i]:t[i].search(/\/>/)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\?/)>-1||t[i].search(/xmlns:/)>-1||t[i].search(/xmlns=/)>-1?a+=s[o]+t[i]:a+=t[i];return a[0]==="\n"?a.slice(1):a}function l(e){var t=e.match(/(<query.*>|<result>)(\{.*\})/);if(t===null)return e;try{var n=t[1],r=JSON.stringify(JSON.parse(t[2]),null,2);return n+"\n"+r}catch(t){return e+"[Error formatting JSON]"}}i.default=e}),66);
__d("WAXmlNode",["WAHex"],(function(t,n,r,o,a,i,l){"use strict";var e={},s=(function(){function t(t,n,r){n===void 0&&(n=e),r===void 0&&(r=null),this.tag=t,this.attrs=n,this.content=r}var n=t.prototype;return n.toString=function(){var e="<"+this.tag;e+=u(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t instanceof Uint8Array?e+=">"+c(t)+"</"+this.tag+">":t!=null?e+=">"+String(t)+"</"+this.tag+">":e+=" />",e},t})();function u(e){for(var t=Object.keys(e),n="",r=0;r<t.length;r++){var o=t[r];n+=" "+o+'="'+e[o].toString()+'"'}return n}function c(e){var t="";return e.length===0?t="<!-- empty binary -->":e.length<50?t=o("WAHex").bytesToDebugString(e):t="<!-- "+e.length+" bytes -->",t}l.XmlNode=s,l.attrsToString=u,l.uint8ArrayToDebugString=c}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WACryptoDependencies","WAJids","WALogger","WALongInt","WATextEncoding","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(s=o("WAJids")).MSGR_USER_DOMAIN.replace("@",""),d=s.WA_USER_DOMAIN.replace("@",""),m=s.LID_DOMAIN.replace("@",""),p=s.INTEROP_DOMAIN.replace("@",""),_=s.HOSTED_DOMAIN.replace("@",""),f=2,g=128,h=0,y=236,C=237,b=238,v=239,S=[y,C,b,v],R=245,L=246,E=247,k=248,I=249,T=250,D=251,x=252,$=253,P=254,N=255,M=["0","1","2","3","4","5","6","7","8","9","-",".","\uFFFD","\uFFFD","\uFFFD","\uFFFD"],w=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],A="",F=1,O={sentinel:"DROP_ATTR"},B=(u=o("WAWapJid")).WapJid.create(null,"g.us"),W=u.WapJid.create(null,s.WA_SERVER_JID_SUFFIX),q=u.WapJid.create("status","broadcast"),U=u.WapJid.create(null,"newsletter"),V=u.WapJid.create(null,"hosted"),H=u.WapJid.create(null,"hosted.lid"),G=u.WapJid.create(null,"call"),z={},j=!1;function K(){j=!0}var Q=o("WATextEncoding").newTextEncoder(),X=(function(){function e(e,t,n){t===void 0&&(t=z),n===void 0&&(n=null),this.tag=e,this.attrs=t,this.content=n}var t=e.prototype;return t.toString=function(){var e="<"+this.tag;e+=o("WAXmlNode").attrsToString(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t?e+=">"+o("WAXmlNode").uint8ArrayToDebugString(t)+"</"+this.tag+">":e+=" />",j&&(e=r("WAXmlFormatter")(e)),e},e})();function Y(e,t,n){var a=null;if(t&&t.children!=null)throw r("err")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(n))a=n.filter(Boolean);else if(typeof n=="string")a=o("WABinary").Binary.build(n).readByteArrayView();else if(n instanceof ArrayBuffer)a=new Uint8Array(n);else if(n instanceof Uint8Array)a=n;else{for(var i=[],l=2;l<arguments.length;l++){var s=arguments[l];s&&i.push(s)}a=i}Array.isArray(a)&&a.length===0&&(a=null);var u={};if(t){var c=t;Object.keys(c).forEach(function(t){if(!["__self","__source"].includes(t)){var n=c[t];if(n==null)throw r("err")("Attr "+t+" in <"+e+"> is null");n!==O&&(u[t]=n)}})}return new X(e,u,a)}var J=Y;function Z(e){return e instanceof o("WAWapJid").WapJid?e.toString():e}function ee(e){var t=e.content;return Array.isArray(t)?t=t.map(ee):typeof t=="string"&&(t=o("WABinary").Binary.build(t).readByteArrayView()),new X(e.tag,e.attrs||z,t)}function te(e){var t=e instanceof X?e:ee(e),n=new(o("WABinary")).Binary;ne(t,n);var r=0,a=n.readByteArrayView(),i=new Uint8Array(1+a.length);return i[0]=r,i.set(a,1),i}function ne(e,t){if(e==null)t.writeUint8(h);else if(e instanceof X)oe(e,t);else if(e instanceof o("WAWapJid").WapJid)re(e,t);else if(typeof e=="string")se(e,t);else if(e instanceof Uint8Array)ce(e,t);else{var n=typeof e;throw r("err")("Invalid payload type "+n)}}function re(e,t){var n=e.getInnerJid();if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_U){var r=n.user,a=n.device,i=n.domainType;t.writeUint8(E),t.writeUint8(i),t.writeUint8(a),ne(r,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_FB){var l=n.user,s=n.device;t.writeUint8(L),ne(l,t),t.writeUint16(s),ne(c,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_INTEROP){var u=n.user,d=n.device,m=n.integrator;t.writeUint8(R),ne(u,t),t.writeUint16(d),t.writeUint16(m)}else{var p=n.user,_=n.server;t.writeUint8(T),p!=null?ne(p,t):t.writeUint8(h),ne(_,t)}}function oe(e,t){if(e.tag===void 0){t.writeUint8(k),t.writeUint8(h);return}var n=1;e.attrs&&(n+=Object.keys(e.attrs).length*2),e.content&&n++,n<256?(t.writeUint8(k),t.writeUint8(n)):n<65536&&(t.writeUint8(I),t.writeUint16(n)),ne(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach(function(n){se(n,t),ne(e.attrs[n],t)});var r=e.content;if(Array.isArray(r)){r.length<256?(t.writeUint8(k),t.writeUint8(r.length)):r.length<65536&&(t.writeUint8(I),t.writeUint16(r.length));for(var o=0;o<r.length;o++)oe(r[o],t)}else r&&ne(r,t)}var ae,ie;function le(e){for(var t=new Map,n=0;n<e.length;n++)t.set(e[n],n);return t}function se(e,t){if(e===""){t.writeUint8(x),t.writeUint8(0);return}ae==null&&(ae=le(o("WAWapDict").SINGLE_BYTE_TOKEN));var n=ae.get(e);if(n!=null){t.writeUint8(n+1);return}if(ie==null){ie=[];for(var r=0;r<o("WAWapDict").DICTIONARIES.length;++r)ie.push(le(o("WAWapDict").DICTIONARIES[r]))}for(var a=0;a<ie.length;++a){var i=ie[a].get(e);if(i!=null){t.writeUint8(S[a]),t.writeUint8(i);return}}var l=o("WABinary").numUtf8Bytes(e);if(l<128){var s=/[^0-9.-]+?/,u=/[^0-9A-F]+?/;if(s.exec(e)){if(!u.exec(e)){ue(e,D,t);return}}else{ue(e,N,t);return}}de(l,t),t.writeString(e)}function ue(e,t,n){var o=e.length%2===1;n.writeUint8(t);var a=Math.ceil(e.length/2);o&&(a|=g),n.writeUint8(a);for(var i=0,l=0;l<e.length;l++){var s=e.charCodeAt(l),u=null;if(48<=s&&s<=57?u=s-48:t===N?s===45?u=10:s===46&&(u=11):t===D&&65<=s&&s<=70&&(u=s-55),u==null)throw r("err")("Cannot nibble encode "+s);l%2===0?(i=u<<4,l===e.length-1&&(i|=15,n.writeUint8(i))):(i|=u,n.writeUint8(i))}}function ce(e,t){de(e.length,t),t.writeByteArray(e)}function de(e,t){if(e<256)t.writeUint8(x),t.writeUint8(e);else if(e<1048576)t.writeUint8($),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(e&255);else if(e<4294967296)t.writeUint8(P),t.writeUint32(e);else throw r("err")("Binary with length "+e+" is too big for WAP protocol")}function me(t,n){var r=new(o("WABinary")).Binary(t),a=r.readUint8(),i=a&f;return i?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]))),n(r.readByteArrayView()).then(function(e){return ge(new(o("WABinary")).Binary(e))})):Promise.resolve(ge(r))}function pe(e){var t=new(o("WABinary")).Binary(e),n=t.readUint8(),a=n&f;if(a)throw r("err")("Cannot pass compressed stanza to decodeStanzaDebug");return ge(t)}function _e(e,t){var n=e.readUint8();if(n===h)return null;if(n===k)return fe(e,e.readUint8());if(n===I)return fe(e,e.readUint16());if(n===x){var a=e.readUint8();return Re(e,a,t)}if(n===$){var i=e.readUint8(),l=e.readUint8(),s=e.readUint8(),u=((i&15)<<16)+(l<<8)+s;return Re(e,u,t)}if(n===P){var c=e.readUint32();return Re(e,c,t)}if(n===T)return Ce(e);if(n===L)return be(e);if(n===R)return ve(e);if(n===E)return Se(e);if(n===N){var d=e.readUint8(),m=d>>>7,p=d&127;return Le(e,M,m,p)}if(n===D){var _=e.readUint8(),f=_>>>7,g=_&127;return Le(e,w,f,g)}if(n<=0||n>=240)throw r("err")("Unable to decode WAP buffer");if(n>=y&&n<=v){var C=n-y,b=o("WAWapDict").DICTIONARIES[C];if(b===void 0)throw r("err")("Missing WAP dictionary "+C);var S=e.readUint8(),A=b[S];if(A===void 0)throw r("err")("Invalid value index "+S+" in dict "+C);return A}var F=o("WAWapDict").SINGLE_BYTE_TOKEN[n-1];if(F===void 0)throw r("err")("Undefined token with index "+n);return F}function fe(e,t){for(var n=[],r=0;r<t;r++)n.push(ge(e));return n}function ge(e){var t=e.readUint8(),n;if(t===k)n=e.readUint8();else if(t===I)n=e.readUint16();else throw r("err")("Failed to decode node since type byte "+String(t)+" is invalid");var a=void 0,i=null;if(n===0)throw r("err")("Failed to decode node, list cannot be empty");var l=he(e);for(n-=1;n>1;){a||(a={});var s=he(e),u=_e(e,!0);a[s]=u,n-=2}return n===1&&(i=_e(e,!1),i instanceof o("WAWapJid").WapJid&&(i=String(i)),typeof i=="string"&&(i=Q.encode(i))),new X(l,a,i)}function he(e){var t=_e(e,!0);if(typeof t!="string")throw r("err")("WAWap:decodeString got invalid value, string expected");return t}function ye(e){var t=_e(e,!0);if(t!=null&&typeof t!="string")throw r("err")("WAWap:decodeNullableString got invalid value, string expected");return t}function Ce(e){var t=ye(e),n=he(e);return o("WAWapJid").WapJid.create(t,n)}function be(e){var t=he(e),n=e.readUint16();return he(e),o("WAWapJid").WapJid.createFbJid(t,n)}function ve(e){var t=he(e),n=e.readUint16(),r=e.readUint16();return he(e),o("WAWapJid").WapJid.createInteropJid(t,n,r)}function Se(e){var t=null,n=e.readUint8();if(n===0)t=o("WAWapJid").DomainType.WHATSAPP;else if(n===1)t=o("WAWapJid").DomainType.LID;else if((1&n)===0&&(128&n)!==0)t=o("WAWapJid").DomainType.HOSTED;else if(n===129)t=o("WAWapJid").DomainType.HOSTED_LID;else throw r("err")("decodeJidU - Invalid domain type encoding "+n);var a=e.readUint8(),i=he(e);return o("WAWapJid").WapJid.createJidU(i,t,a)}function Re(e,t,n){return n===void 0&&(n=!1),n?e.readString(t):e.readByteArrayView(t)}function Le(e,t,n,r){for(var o=new Array(r*2-n),a=0;a<o.length-1;a+=2){var i=e.readUint8();o[a]=t[i>>>4],o[a+1]=t[i&15]}if(n){var l=e.readUint8();o[o.length-1]=t[l>>>4]}return o.join("")}function Ee(){if(!A){var e=new Uint16Array(2);o("WACryptoDependencies").getCrypto().getRandomValues(e),A=String(e[0])+"."+String(e[1])+"-"}return""+A+F++}function ke(e){switch(e.type){case"group":return e.groupJid;case"status":return o("WAJids").STATUS_JID;case"device":return e.deviceJid;case"newsletter":return e.newsletterJid;case"hosted":return e.hostedDeviceJid;case"hostedLid":return e.hostedLidDeviceJid;default:return e.type,e.broadcastJid}}function Ie(e){switch(e.type){case"group":return e.author;case"status":return e.author;case"broadcast":return e.author;default:return e.type,null}}function Te(e){return e.type==="status"||e.type==="group"||e.type==="broadcast"?xe(e.author):O}function De(e){return xe(ke(e))}function xe(e){var t=o("WAJids").validateDomainJid(e);if(t!=null)return $e(t);var n=e.split("@"),a=n[0],i=n[1],l=null,s=null;if((i===d||i===c||i===p||i===m||i===_||i===o("WAJids").HOSTED_LID_SUFFIX)&&a.indexOf(":")!==-1){var u=a.split(":");a=u[0],l=u[1],s=parseInt(l,10)}if(i===p){var f=a.split("-"),g=f[0],h=f[1];return o("WAWapJid").WapJid.createInteropJid(h,s,parseInt(g,10))}else if(i===c)return o("WAWapJid").WapJid.createFbJid(a,s);var y=null;if(i===m)y=o("WAWapJid").DomainType.LID;else if(i===_){if(s!==99)throw r("err")("wid unexpected deviceId");y=o("WAWapJid").DomainType.HOSTED}else if(i===o("WAJids").HOSTED_LID_SUFFIX){if(s!==99)throw r("err")("lid invalid deviceId");y=o("WAWapJid").DomainType.HOSTED_LID}else y=o("WAWapJid").DomainType.WHATSAPP;return s!=null&&s!==0?o("WAWapJid").WapJid.createJidU(a,y,s):o("WAWapJid").WapJid.create(a,i)}function $e(e){return e==="s.whatsapp.net"?W:e==="g.us"?B:e==="newsletter"?U:e==="call"?G:r("WAAssertUnreachable")(e)}function Pe(e){return xe(e)}function Ne(e){return xe(e)}function Me(e){return xe(e)}function we(e){return xe(e)}function Ae(e){return xe(e)}function Fe(e){return xe(e)}function Oe(e){return e.jidType==="phoneDevice"||e.jidType==="msgrDevice"||e.jidType==="lidDevice"?xe(e.deviceJid):e.jidType==="phoneUser"||e.jidType==="msgrUser"||e.jidType==="lidUser"?xe(e.userJid):e.jidType==="group"?xe(e.groupJid):e.jidType==="status"?xe(e.statusJid):e.jidType==="call"?xe(e.callJid):e.jidType==="interopDevice"?xe(e.deviceJid):e.jidType==="interopUser"?xe(e.userJid):e.jidType==="newsletter"?xe(e.newsletterJid):e.jidType==="hosted"?xe(e.hostedDeviceJid):e.jidType==="hostedLid"?xe(e.hostedLidDeviceJid):e.jidType==="bot"?xe(e.botJid):(e.jidType,xe(e.broadcastJid))}function Be(e){return e}function We(e){return e.toString()}function qe(e){return e}function Ue(e){return e}function Ve(e){return e==null?O:e}function He(e){return e.toString()}function Ge(e){return o("WALongInt").longIntToDecimalString(e)}function ze(e,t){t===void 0&&(t=4);for(var n=e,r=new Uint8Array(t),o=t-1;o>=0;o--)r[o]=n&255,n>>>=8;return r}l.DROP_ATTR=O,l.G_US=B,l.S_WHATSAPP_NET=W,l.STATUS_BROADCAST=q,l.NEWSLETTER=U,l.HOSTED=V,l.HOSTED_LID=H,l.CALL=G,l.enableXMLFormat=K,l.WapNode=X,l.makeWapNode=Y,l.wap=J,l.decodeAsString=Z,l.makeStanza=ee,l.encodeStanza=te,l.decodeStanza=me,l.decodeStanzaDebug=pe,l.generateId=Ee,l.extractToJid=ke,l.extractParticipantJid=Ie,l.PARTICIPANT_JID=Te,l.TO_JID=De,l.JID=xe,l.DOMAIN_JID=$e,l.USER_JID=Pe,l.DEVICE_JID=Ne,l.GROUP_JID=Me,l.BROADCAST_JID=we,l.CALL_JID=Ae,l.NEWSLETTER_JID=Fe,l.TO_WAP_JID=Oe,l.STANZA_ID=Be,l.SMAX_ID=We,l.CUSTOM_STRING=qe,l.CALL_ID=Ue,l.MAYBE_CUSTOM_STRING=Ve,l.INT=He,l.LONG_INT=Ge,l.BIG_ENDIAN_CONTENT=ze}),98);
__d("WASmaxJsx",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";l.smax=o("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(t,n,r,o,a,i,l){"use strict";var e="smax$any";function s(e,t){return c(e,t),d(e,t),t.content instanceof Uint8Array?p(e,t.content):t.content!=null&&_(e,t.content),e}function u(e,t,n,r){return n!=null?e(t,n,r):t}function c(t,n){var r=t.tag,o=n.tag;if(o!==e&&r!==o)throw new Error("tag mismatch: "+r+" != "+o)}function d(e,t){var n=e.attrs,r=t.attrs;Object.keys(r).forEach(function(e){var t=r[e],o=n[e];if(t!=null&&o!=null){if(m(t,o))return;throw new Error("conflict for key: "+e)}n[e]=t})}function m(e,t){return typeof e=="string"&&typeof t=="string"?e===t:e instanceof o("WAWapJid").WapJid&&t instanceof o("WAWapJid").WapJid?e.toString()===t.toString():!1}function p(e,t){var n=e.content;if(n instanceof Uint8Array){if(!o("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(n,t))throw new Error("elementValue mismatch: bytes dose not equal");return}if(n!=null)throw new Error("elementValue mismatch: destination has children");e.content=t}function _(e,t){var n=e.content;if(n instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(n==null||n.length===0){e.content=t;return}if(!f(n,t))throw new Error("children mismatch: child counts are not compatible");var r=[],o=Array.from(n);t.forEach(function(e){var t=o.findIndex(function(t){return t.tag===e.tag});if(t===-1)r.push(e);else{var n=o.splice(t,1),a=s(n[0],e);r.push(a)}}),o.forEach(function(e){return r.push(e)}),e.content=r}function f(e,t){for(var n=g(t),r=g(e),o=Object.keys(n),a=0;a<o.length;a++){var i=o[a],l=n[i],s=r[i];if(l!=null&&s!=null&&l!==s)return!1}return!0}function g(e){return e.reduce(function(e,t){var n=t.tag,r=e[n];return e[n]=r==null?1:r+1,e},{})}l.mergeStanzas=s,l.optionalMerge=u}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeClientWellFormedToMixin=s}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get",xmlns:"w:p"}));return e}l.makeClientRequest=e}),98);
__d("WAComms",["Promise","WAArrayUtils","WABaseGlobals","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAPromiseRetryLoop","WAResolvable","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w,A=null,F=null,O=1,B=0,W=(function(){function t(t,n,r){var a=this,i,l,c;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this.pendingSmaxStanzas=new Map,this.$2=new(o("WAResolvable")).Resolvable,this.socketAbortController=null,this.activePing=null,this.$3=new Set,this.socketId=B,this.socket=null,this.softCloseSocket=null,this.handleStanza=function(t,n,r){var i=o("WASmaxParseUtils").attrString(t,"id");if(i.success&&t.tag!=="receipt"){var l=i.value,u=a.pendingSmaxStanzas.get(l);if(u)return a.pendingSmaxStanzas.delete(l),u.resolve(t),a.maybeScheduleHealthCheck(),"NO_ACK"}var c=ce(t);if(c!=null){var d=a.pendingIqs.get(c);d?(a.pendingIqs.delete(c),d.resolve(t),a.maybeScheduleHealthCheck()):(o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""])),c),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]))))}else if(t.tag==="ack")a.handleAck(t);else return t.tag==="failure"&&a.config.shouldBlockReceivingUntilSuccess?a.$1(t,n,r):a.$2.promise.then(function(){return a.$1(t,n,r)});return"NO_ACK"},this.healthCheckTimer=new(o("WAShiftTimer")).ShiftTimer(function(){a.socketId&&a.sendPing()}),this.deadSocketTimer=new(o("WAShiftTimer")).ShiftTimer(function(e){e===a.socketId&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," expired"])),e),a.softCloseSocket&&a.softCloseSocket())}),this.$1=t,this.onConnectionChange=o("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((i=n.handlers.onConnectionChange)!=null?i:function(){},(l=n.handlers.onOptimisticConnectionChange)!=null?l:function(){}),this.gzipInflate=r,this.config=n,this.socketLoop=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"MainSocketLoop",code:J,timer:(c=n.socketReconnectBackoffAlgo)!=null?c:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4,isPauseEnabled:n.isPauseEnabled===!0})}var a=t.prototype;return a.filterPending=function(t){var e=[];function n(n){t(n)&&e.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),this.pendingSmaxStanzas.forEach(n),e},a.sendPendingStanza=function(t){t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.callStanza(t.stanza)},a.maybeSendPendingStanza=function(t){if(t.attempt>=this.config.maxRetries){var e,n;(e=(n=this.config.handlers).onDropStanza)==null||e.call(n,t),t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.removeHandler(t,"max-retries")}else if(this.socket){t.attempt+=1,this.sendPendingStanza(t);return}else o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"])))},a.callStanzaAsync=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield this.callStanza(e,t);return n});function t(t,n){return e.apply(this,arguments)}return t})(),a.callStanza=function(t,n){var e=this.castStanza(t,n);return this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel(),e},a.castStanzaAsync=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.castStanza(e);return t});function t(t){return e.apply(this,arguments)}return t})(),a.castStanza=function(t,r){var e=this;try{var a,i,l=(a=(i=this.config.handlers).onBeforeCastStanzaForE2E)==null?void 0:a.call(i,t,r);if(l!=null)return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. We return mock response directly."]))),Array.isArray(l)?(w||(w=n("Promise"))).all(l.map(function(t){return(w||(w=n("Promise"))).resolve(e.handleStanza(t,e.socketId,B))})):(this.handleStanza(l,this.socketId,B),(w||(w=n("Promise"))).resolve())}catch(e){}var s=this.socketOrThrow("castStanza");try{return s.sendFrame(o("WAWap").encodeStanza(t)).then(function(){e.config.handlers.onCastStanza==null||e.config.handlers.onCastStanza(t,r)}).catch(function(e){if(o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""])),e),e instanceof o("WAErrors").BufferTooLargeError)return(w||(w=n("Promise"))).reject(e)})}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""])),e)}return(w||(w=n("Promise"))).resolve()},a.socketOrThrow=function(t){var e=this.socket;if(e)return e;throw r("err")("Comms."+t+" called while no socket")},a.startHandlingRequests=function(){return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]))),this.$2.resolve(),this.$2.promise.then(function(){})},a.parseAndHandleStanza=function(t,n){var e=this;t===this.socketId&&(this.deadSocketTimer.cancel(),F&&(F.resolve(),F=null));var r=o("WAWap").decodeStanza(n,this.gzipInflate).catch(function(e){throw o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]))),e}).then(function(r){e.config.handlers.onHandleStanza==null||e.config.handlers.onHandleStanza(r,t,n.byteLength);var o=e.activePing;return o&&o.socketId===t&&o.stanzaId===ce(r)?(e.activePing=null,o.handler.resolve(r),e.maybeScheduleHealthCheck(),"NO_ACK"):e.handleStanza(r,t,n.byteLength)}).then(function(n){if(t===e.socketId){if(n==="CLOSE_SOCKET"){o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["[comms] job response is CLOSE_SOCKET"])));var r=e.socket;r&&r.close()}else n==="NO_ACK"||e.castStanza(n);return"NO_ACK"}});this.$3.add(r),r.finally(function(){return void e.$3.delete(r)})},a.handleAck=function(t){for(var e=this.ackHandlers,n=-1,r=null;!r&&++n<e.length;)r=e[n].parseAndTest(t);if(r){var a,i,l=e[n];o("WAArrayUtils").removeIndexWithoutPreservingOrder(e,n),(a=(i=this.config.handlers).onHandleAck)==null||a.call(i,t),l.resolve(r),this.maybeScheduleHealthCheck()}else o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""])),t)},a.removeHandler=function(t,r){if(r===void 0&&(r="disconnect"),t.type==="iq"||t.type==="smax"){var e=t.stanza.attrs.id;if(!e||typeof e!="string"||t.type==="iq"&&!this.pendingIqs.delete(e)||t.type==="smax"&&!this.pendingSmaxStanzas.delete(e))return}else{t.type;var a=this.ackHandlers.indexOf(t);if(a===-1)return;o("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,a)}r==="disconnect"?t.resolve((w||(w=n("Promise"))).reject(new(o("WAErrors")).Disconnected)):r==="abort"?t.resolve((w||(w=n("Promise"))).reject(new(o("WAErrors")).Aborted)):t.resolve((w||(w=n("Promise"))).reject(new(o("WAErrors")).MaxRetries))},a.maybeScheduleHealthCheck=function(){if(!this.healthCheckTimer.isScheduled()&&!(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)){var e=this.config.healthCheckInterval,t=Math.ceil(e*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}},a.sendPing=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=ue("sendPing");if(!e.socketId)return o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing when socket dead"]))),!1;if(e.activePing&&e.activePing.socketId===e.socketId)return o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing ping still pending"]))),!1;e.activePing&&e.activePing.handler.resolve();var t=o("WASmaxOutPingsClientRequest").makeClientRequest(),n=t.attrs.id;if(typeof n!="string")return o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["[comms] No stanzaId in ping request stanza"]))),!1;var r=new(o("WAResolvable")).Resolvable;e.activePing={socketId:e.socketId,stanzaId:n,handler:r};var a=Date.now();e.callStanza(t);var i=yield r.promise,l=Date.now();if(i){var s=o("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(i,t);if(s.success){var u=l-a,c=Math.round(u/2),d=o("WATimeUtils").castToUnixTime(s.value.t),m=o("WABaseGlobals").newClockSkewCalculation()?Math.round((a+c)/1e3-d):Math.round(Date.now()/1e3-d);return e.config.handlers.onClockSkewUpdate==null||e.config.handlers.onClockSkewUpdate(m),!0}}return!1});function t(){return e.apply(this,arguments)}return t})(),t})();function q(){return A}function U(e,t,n,r){r===void 0&&(r=!0),!A&&(A=new W(e,t,n),r&&setTimeout(j,0))}function V(){var e=ue("stopComms");e.socketLoop.endWithValue(),e.socket&&Z(),A=null}function H(){var e=ue("closeSocketAndPreventRetry");e.socketLoop.endWithValue(),e.socket&&(o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPreventRetry called"]))),Z())}function G(){var e=ue("closeSocketAndPause");e.socketLoop.pauseOnNextIteration(),e.socket&&(o("WALogger").LOG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPause called"]))),Z())}function z(){var e=ue("closeSocketAndResume");e.socketLoop.unpause(),e.socket&&(o("WALogger").LOG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndResume called"]))),Z())}function j(){ue("openSocketLoop").socketLoop.start()}function K(){o("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["[comms] maybeResetSocketLoop"]))),Y()||ue("maybeResetSocketLoop").socketLoop.reset()}function Q(){ue("forceResetSocketLoop").socketLoop.reset()}function X(){var e,t=ue("socketAbortController");(e=t.socketAbortController)==null||e.abort(),t.softCloseSocket==null||t.softCloseSocket()}function Y(){var e;return!!((e=A)!=null&&e.socket)}function J(){var e,t=ue("socketLoopIteration"),n=t.nextSocketId++;o("WALogger").LOG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opening"])),n);var r=function(){t.onConnectionChange("in_handshake")};return t.config.handlers.onSocketLoopIteration==null||t.config.handlers.onSocketLoopIteration(t.socketAbortController),typeof AbortController=="function"&&(t.socketAbortController=new AbortController),t.config.openChatSocket(r,(e=t.socketAbortController)==null?void 0:e.signal).then(function(e){if(e.success){var r=e.value;t.config.handlers.onSocketOpen==null||t.config.handlers.onSocketOpen();var a=new(o("WAResolvable")).Resolvable;return o("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opened"])),n),t.socketId=n,t.socket=r,t.softCloseSocket=function(){t.softCloseSocket=null,t.socket&&t.config.shouldCloseStaleSocket&&(Z(),t.socket=null),a.resolve()},t.socketLoop.resetTimeoutAfter(1e4),t.deadSocketTimer.cancel(),t.maybeScheduleHealthCheck(),r.setOnFrame(function(e){return t.parseAndHandleStanza(n,e)}),r.setOnClose(function(){o("WALogger").LOG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),n),t.activePing&&n===t.activePing.socketId&&(t.activePing.handler.resolve(),t.activePing=null),t.filterPending(function(e){return e.attachedToSocketId===n}).forEach(function(e){return void t.removeHandler(e)}),n===t.socketId&&(t.socketId=B,t.socket=null,t.onConnectionChange("disconnected"),t.config.handlers.onDisconnect==null||t.config.handlers.onDisconnect(),a.resolve())}),t.onConnectionChange("connected"),t.config.handlers.onConnect==null||t.config.handlers.onConnect(),t.filterPending(function(e){return!e.attachedToSocketId}).sort(function(e,t){return e.orderedId-t.orderedId}).forEach(function(e){switch(e.type){case"smax":case"iq":t.maybeSendPendingStanza(e);break;case"ack":t.callStanza(e.stanza);break;default:e.type;break}}),a.promise}else{var i=e.error;switch(i){case"max-hunters":o("WALogger").WARN(T||(T=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"])));break;case"disconnected":o("WALogger").WARN(D||(D=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket disconnected while in noise handshake"])));break;default:return}}}).catch(function(e){e instanceof o("WAErrors").Disconnected?o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake"]))):o("WALogger").ERROR($||($=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration failed ",""])),e)})}function Z(){var e=ue("closeSocket");e.socket&&(o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),e.socketId),o("WALogger").LOG(N||(N=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocket called"]))),e.socket.close())}function ee(){ue("onStreamErrorReceived").socketLoop.cancelReset()}function te(){return ue("waitForConnection").sendPing(),F||(F=new(o("WAResolvable")).Resolvable),F.promise}function ne(e,t){var n=ue("castStanza");n.socket?n.castStanza(e,t):o("WALogger").LOG(M||(M=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"])))}function re(e){var t=ue("castStanza");return t.socketId===e}function oe(e,t,a,i,l){return a===void 0&&(a=0),l===void 0&&(l="iq"),new(w||(w=n("Promise")))(function(s){var u=ue("sendIq"),c=e.attrs.id;if(!c||typeof c!="string")throw r("err")("[comms] sendIq given iq without id: "+String(e));var d=u.socketId;if(t&&!d){s((w||(w=n("Promise"))).reject(new(o("WAErrors")).Offline));return}var m=function(t){t===void 0&&(t="disconnect");var e=l==="iq"?u.pendingIqs.get(c):u.pendingSmaxStanzas.get(c);if(!e){s((w||(w=n("Promise"))).reject(r("err")("[comms] _sendIq unexisting stanza to be cancelled: "+c)));return}u.removeHandler(e,t)},p=null;if(a>0){var _=setTimeout(m,a*1e3);p=function(){clearTimeout(_)}}if(i!=null)if(i.aborted){s((w||(w=n("Promise"))).reject(new(o("WAErrors")).Disconnected));return}else{var f=function(){m("abort")};i.addEventListener("abort",f),p=function(){i.removeEventListener("abort",f)}}var g={resolve:s,stanza:e,attachedToSocketId:t?d:B,orderedId:O++,attempt:0,cleanup:p};if(l==="iq"){var h=babelHelpers.extends({type:l},g);u.pendingIqs.set(c,h),u.config.handlers.onSendIq==null||u.config.handlers.onSendIq(e),u.maybeSendPendingStanza(h)}else{var y=babelHelpers.extends({type:l},g);u.pendingSmaxStanzas.set(c,y),u.maybeSendPendingStanza(y)}})}function ae(e,t){var n,r,o,a=(n=t==null?void 0:t.withoutRetry)!=null?n:!1,i=(r=t==null?void 0:t.timeoutSeconds)!=null?r:0,l=(o=t==null?void 0:t.signal)!=null?o:null;return oe(e,a,i,l,"smax")}function ie(){var e=ue("sendPing");return e.sendPing()}function le(){return ue("startHandlingRequests").startHandlingRequests()}function se(){A&&A.deadSocketTimer.cancel()}function ue(e){if(A)return A;throw r("err")("[comms] "+e+" called before startComms")}function ce(e){if(e.tag==="iq"){var t=e.attrs.type;if(t==="result"||t==="error")return o("WAWap").decodeAsString(e.attrs.id)||null}return null}function de(){return O++}function me(){A=null,F=new(o("WAResolvable")).Resolvable,O=1}l.DEFAULT_SOCKET_ID=B,l.getComms=q,l.startComms=U,l.stopComms=V,l.closeSocketAndPreventRetry=H,l.closeSocketAndPause=G,l.closeSocketAndResume=z,l.openSocketLoop=j,l.maybeResetSocketLoop=K,l.forceResetSocketLoop=Q,l.forceAbortSocketConnection=X,l.isSocketConnected=Y,l.socketLoopIteration=J,l.closeSocket=Z,l.onStreamErrorReceived=ee,l.waitForConnection=te,l.castSmaxStanza=ne,l.isActiveSocket=re,l._sendIq=oe,l.sendSmaxStanza=ae,l.sendPing=ie,l.startHandlingRequests=le,l.cancelDeadSocketTimer=se,l.singletonOrThrowIfUninitialized=ue,l.getAndIncrementNextOrderedId=de,l.resetStateForTests=me}),98);
__d("WADecimalStringMod",["WALogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n){if(!/^\d+$/.test(t))throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string'])),t),r("err")("decimalStringMod is given an invalid decimal string");var a=t.length;if(a<16||a===16&&t<="9007199254740991")return Number(t)%n;if(a>20||a===20&&t>"18446744073709551615")throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits'])),t),r("err")("decimalStringMod is given value over 64 bits");for(var i=0,l=0;l<t.length;l++){var u=Number(t[l]);i=(i*10+u)%n}return i}l.decimalStringMod=u}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return function(){return t==null?null:o("WAArrayBufferUtils").arrayBufferMod(e,t)+100}}function u(t,n){return function(){if(n==null)return null;var r=t.split("/"),a=r[r.length-1],i=a.split("_")[1];return/^\d+$/.test(i)?i==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]))),null):o("WADecimalStringMod").decimalStringMod(i,n)+100:null}}l.createGetVcaEnabledBucket=s,l.msgrCreateGetVcaEnabledBucket=u}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return null;var t=s(e);if(t.has("_nc_hot")){var n=parseInt(t.get("_nc_hot"),10);return Number.isInteger(n)?o("WATimeUtils").castToUnixTime(n):null}else return null}function s(e){var t=e.split("?");return new URLSearchParams(t.length===2?t[1]:"")}l.extractNcHotTimestamp=e}),98);
__d("WAXmlParsingFailure",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.parser=e,this.reason=t}var t=e.prototype;return t.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason},e})();i.XmlParsingFailure=e}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw new TypeError('"'+e+'" is read-only')}var s=(function(){function e(e,t){var n=this;this.$1=e,this.$2=t,this.$3=Array.isArray(t.content)?t.content.map(function(t){return new n.constructor(e,t)}):null}var t=e.prototype;return t.name=function(){return this.$1},t.node=function(){return this.$2},t.hasAttr=function(t){return r("WAHasProperty")(this.$2.attrs,t)},t.assertTag=function(t){this.$2.tag!==t&&this.throw("to be <"+t+">")},t.tag=function(){return this.$2.tag},t.maybeChild=function(t){var e=this.$3;if(!e)return null;for(var n=0;n<e.length;n++)if(e[n].tag()===t)return e[n];return null},t.hasChild=function(t){return!!this.maybeChild(t)},t.child=function(t){var e=this.maybeChild(t);return e||this.throw("to have child <"+t+">")},t.assertAttr=function(t,n){var e=this.attrString(t);e!==n&&this.throw('to have "'+t+'"="'+n+'", but instead has "'+e+'"')},t.attrString=function(t){return r("WAHasProperty")(this.$2.attrs,t)?this.decodeAsString(this.$2.attrs[t]):this.throw('to have attribute "'+t+'"')},t.forEachAttributeKey=function(t){var e=this.$2.attrs;Object.keys(e).forEach(function(e){return t(e)})},t.maybeAttrString=function(t){return this.hasAttr(t)?this.decodeAsString(this.$2.attrs[t]):null},t.maybeAttrInt=function(t,n,r){return this.hasAttr(t)?this.attrInt(t,n,r):null},t.attrEnumValues=function(t,n,r){var e=new Set(n),o=this.attrString(t);if(!e.has(o)){if(r!=null)return r;var a=Array.from(e).join("|");return this.throw('to have "'+t+'"={'+a+'} but has value "'+o+'"')}return o},t.attrEnum=function(t,n){var e=this.attrString(t);if(!r("WAHasProperty")(n,e)){var o=Object.keys(n).join("|");return this.throw('to have "'+t+'"={'+o+'} but has value "'+e+'"')}return n[e]},t.attrEnumOrNullIfUnknown=function(t,n){var e=this.attrString(t);return r("WAHasProperty")(n,e)?n[e]:null},t.maybeAttrEnum=function(t,n){return this.hasAttr(t)?this.attrEnum(t,n):null},t.attrInt=function(t,n,r){var e=this.attrString(t);return this.$4(e,t,n,r)},t.$4=function(t,n,r,o){var e=parseInt(t,10);return Number.isNaN(e)?this.throw('to have "'+n+'"={integer} but has value "'+t+'"'):r!==void 0&&e<r?this.throw('to have "'+n+'"={at least '+r+"} but has value "+e):o!==void 0&&e>=o?this.throw('to have "'+n+'"={below '+o+"} but has value "+e):e},t.forEachChild=function(t){var e=this.$3;if(e)e.forEach(function(e){return t(e)});else if(this.$2.content!=null)return this.throw("to have children")},t.forEachChildWithTag=function(t,n){this.forEachChild(function(e){e.tag()===t&&n(e)})},t.mapChildren=function(t){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.map(function(e){return t(e)}):[]},t.mapChildrenWithTag=function(t,n){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.filter(function(e){return e.tag()===t}).map(function(e){return n(e)}):[]},t.mapFirstChild=function(t){var e=this.$3;return!e||e.length===0?this.throw("to have children"):t(e[0])},t.hasContent=function(){return!this.$3&&!!this.$2.content},t.hasChildren=function(){return this.$3!=null},t.getChildren=function(){return this.$3},t.mapAttrKeys=function(t){var e=this.getAttrKeys();return e&&e.length?e.map(t):[]},t.getAttrKeys=function(){return Object.keys(this.$2.attrs)},t.hasAttrs=function(){var e=this.$2.attrs?Object.keys(this.$2.attrs):[];return e.length>0},t.getNode=function(){return this.$2},t.unsafeSetChildren=function(t){this.$3=t},t.unsafeSetNodeContent=function(t){this.$2.content=t},t.contentUint=function(t){var e=this.contentBytes(t);return u(e,t)},t.contentBytes=function(t){if(t===void 0&&(t=-1),this.$3)return this.throw("to have binary content, but has children instead");if(this.$2.content!=null){var e=this.$2.content;return t!==-1&&e.length!==t?this.throw("to be "+t+" bytes, but got "+e.length+" instead"):e}else return this.throw("to have content")},t.contentString=function(){return this.$3?this.throw("to have string content, but has children instead"):this.$2.content!=null?this.$2.content:this.throw("to have content")},t.contentInt=function(t,n){var e=this.contentString();return this.$4(e,"content",t,n)},t.contentEnum=function(t){var e=this.contentString();if(!r("WAHasProperty")(t,e)){var n=Object.keys(t).join("|");return this.throw("to have content {"+n+'} but has value "'+e+'"')}return t[e]},t.decodeAsString=function(t){if(typeof t!="string")throw r("err")("decodeAsString: attribute is "+typeof t+" not a string: "+t);return t},t.throw=function(t){throw new(o("WAXmlParsingFailure")).XmlParsingFailure(this.$1,"expected <"+this.$2.tag+"> "+t)},t.toString=function(){return this.$2.toString()},e})();function u(e,t){for(var n=0,r=0;r<t;r++)n=n*256+e[r];return n}l.ParsableXmlNode=s,l.convertBytesToUint=u}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={};s.internalSpec={sessionVersion:[1,(e=o("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,e.TYPES.BYTES],remoteIdentityPublic:[3,e.TYPES.BYTES],rootKey:[4,e.TYPES.BYTES],previousCounter:[5,e.TYPES.UINT32],senderChain:[6,e.TYPES.MESSAGE,d],receiverChains:[7,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],pendingKeyExchange:[8,e.TYPES.MESSAGE,c],pendingPreKey:[9,e.TYPES.MESSAGE,u],remoteRegistrationId:[10,e.TYPES.UINT32],localRegistrationId:[11,e.TYPES.UINT32],needsRefresh:[12,e.TYPES.BOOL],aliceBaseKey:[13,e.TYPES.BYTES]},u.internalSpec={preKeyId:[1,e.TYPES.UINT32],signedPreKeyId:[3,e.TYPES.INT32],baseKey:[2,e.TYPES.BYTES]},c.internalSpec={sequence:[1,e.TYPES.UINT32],localBaseKey:[2,e.TYPES.BYTES],localBaseKeyPrivate:[3,e.TYPES.BYTES],localRatchetKey:[4,e.TYPES.BYTES],localRatchetKeyPrivate:[5,e.TYPES.BYTES],localIdentityKey:[7,e.TYPES.BYTES],localIdentityKeyPrivate:[8,e.TYPES.BYTES]},d.internalSpec={senderRatchetKey:[1,e.TYPES.BYTES],senderRatchetKeyPrivate:[2,e.TYPES.BYTES],chainKey:[3,e.TYPES.MESSAGE,p],messageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,m]},m.internalSpec={index:[1,e.TYPES.UINT32],cipherKey:[2,e.TYPES.BYTES],macKey:[3,e.TYPES.BYTES],iv:[4,e.TYPES.BYTES]},p.internalSpec={index:[1,e.TYPES.UINT32],key:[2,e.TYPES.BYTES]},_.internalSpec={currentSession:[1,e.TYPES.MESSAGE,s],previousSessions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},f.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES]},g.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES],signature:[4,e.TYPES.BYTES],timestamp:[5,e.TYPES.FIXED64]},h.internalSpec={publicKey:[1,e.TYPES.BYTES],privateKey:[2,e.TYPES.BYTES]},y.internalSpec={senderKeyId:[1,e.TYPES.UINT32],senderChainKey:[2,e.TYPES.MESSAGE,v],senderSigningKey:[3,e.TYPES.MESSAGE,C],senderMessageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,b]},C.internalSpec={public:[1,e.TYPES.BYTES],private:[2,e.TYPES.BYTES]},b.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},v.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},S.internalSpec={senderKeyStates:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},l.SessionStructureSpec=s,l.SessionStructure$PendingPreKeySpec=u,l.SessionStructure$PendingKeyExchangeSpec=c,l.SessionStructure$ChainSpec=d,l.SessionStructure$Chain$MessageKeySpec=m,l.SessionStructure$Chain$ChainKeySpec=p,l.RecordStructureSpec=_,l.PreKeyRecordStructureSpec=f,l.SignedPreKeyRecordStructureSpec=g,l.IdentityKeyPairStructureSpec=h,l.SenderKeyStateStructureSpec=y,l.SenderKeyStateStructure$SenderSigningKeySpec=C,l.SenderKeyStateStructure$SenderMessageKeySpec=b,l.SenderKeyStateStructure$SenderChainKeySpec=v,l.SenderKeyRecordStructureSpec=S}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e={name:"AES-CBC"},s={name:"HMAC",hash:"SHA-256"};function u(e,t){if(e.length!==t)throw r("err")("Signal expected "+t+" bytes, given "+e.length);return e}function c(e,t){return u(new Uint8Array(e),t)}function d(e){var t=e.buffer,n=e.byteOffset,r=e.length;return n===0&&r===t.byteLength?t:t.slice(n,n+r)}function m(e,t){return e.readByteArrayView(t)}function p(e){return new Uint8Array(e)}function _(e,t,n){if(e.length-t<n)throw r("err")("Can not split off "+n+" bytes from index "+t+" of "+e.length+" bytes");return e.slice(t,t+n)}function f(e){var t=e==="extendedRange"?2147483646:16380;return o("WACryptoUtils").randomNumberLessThan(t)+1}function g(e){return b(e)}function h(e){return o("WAParsableXmlNode").convertBytesToUint(e,4)}function y(){var e=2147483647;return o("WACryptoUtils").randomNumberLessThan(e)+1}function C(e){return b(e)}function b(e,t,n){if(t===void 0&&(t=0),n===void 0&&(n=4294967296),typeof e=="number"&&t<=e&&e<n&&Math.floor(e)===e)return e;throw r("err")("Expected integer in range ["+t+", "+n+"), given "+String(e))}function v(e,t){return o("encodeProtobuf").encodeProtobuf(e,t).readByteArrayView()}function S(e,t,n){return n(o("decodeProtobuf").decodeProtobuf(e,t))}function R(e,t,n,r){return o("WACryptoHkdf").extractWithSaltAndExpand(e,t,n,r).then(function(e){return new Uint8Array(e)})}function L(t,n){var r,a;return n==="hmac-sha256"?(r=s,a=["sign"]):(r=e,a=["encrypt","decrypt"]),o("WACryptoDependencies").getCrypto().subtle.importKey("raw",t,r,!1,a)}function E(e){return e}function k(e){return e}function I(e,t){return o("WACryptoUtils").arrayBuffersEqual(e,t)}l.AES_CBC=e,l.HMAC_SHA256=s,l.ensureSize=u,l.toBytes=c,l.toBuffer=d,l.readBytes=m,l.makeBytes=p,l.sliceBytes=_,l.makeRegistrationId=f,l.castRegistrationId=g,l.castRegistrationIdFromBytes=h,l.makeSenderKeyId=y,l.castSenderKeyId=C,l.ensureIntInRange=b,l.encodeSignalProto=v,l.decodeSignalProto=S,l.hkdf=R,l.makeCryptoKey=L,l.castToByteEncoded=E,l.castToSessionHash=k,l.areSessionHashesEqual=I}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e=5,s=16777215;function u(e,t){return{publicKey:e,privateKey:t}}function c(e){var t=o("WACryptoPrimitives").keypairFromSecretKey(e),n=t.publicKey,r=t.secretKey;return u(o("WASignalOther").ensureSize(n,32),o("WASignalOther").ensureSize(r,32))}function d(e,t){return{publicKey:o("WASignalOther").toBytes(e,32),privateKey:o("WASignalOther").toBytes(t,32)}}function m(){var e=o("WACryptoPrimitives").keyPair(),t=e.publicKey,n=e.secretKey;return n[0]&=248,n[31]=64|n[31]&63,u(o("WASignalOther").ensureSize(t,32),o("WASignalOther").ensureSize(n,32))}function p(e,t){return u(o("WASignalOther").sliceBytes(t,1,32),e)}function _(e,t){return{serializedPubKey:t,privateKey:e}}function f(){var e=m();return _(e.privateKey,g(e))}function g(t){var n=o("WASignalOther").makeBytes(33);return n[0]=e,n.set(t.publicKey,1),n}function h(t){var n=o("WASignalOther").makeBytes(33);return n[0]=e,n.set(o("WASignalOther").ensureSize(t,32),1),n}function y(e){return _(e.privateKey,g(e))}function C(e,t){var n=(e-1)%s;n<=0&&(n+=s);for(var r=[],a=0;a<t;a++){var i=n===s?1:n+1,l=m(),u=o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:i,publicKey:g(l),privateKey:l.privateKey});r.push({plainObject:{id:i,keyPair:l},record:u}),n=i}return r}function b(e){try{var t=o("decodeProtobuf").decodeProtobuf(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,e),n=t.id,r=t.publicKey,a=t.privateKey;return n==null||r==null||a==null?null:{id:v(n),keyPair:p(o("WASignalOther").toBytes(a,32),R(new Uint8Array(r)))}}catch(e){return null}}function v(e){return o("WASignalOther").ensureIntInRange(e,1,s)}function S(e){return o("WASignalOther").ensureIntInRange(e,0,s)}function R(t){if(t.length===0||t[0]!==e)throw r("err")("Unrecognized public key type");return o("WASignalOther").ensureSize(t,33)}function L(){var e=o("WASignalOther").makeBytes(32);return o("WACryptoDependencies").getCrypto().getRandomValues(e),e}function E(e,t){return o("WACryptoPrimitives").scalarMult(e,t.subarray(1)).buffer}l.KEY_TYPE=e,l.makeKeyPairFrom=c,l.makeKeyPairFromArrayBuffers=d,l.makeKeyPair=m,l.makeKeyPairFromSerialized=p,l.makeSerializedKeyPairFrom=_,l.makeSerializedKeyPair=f,l.serializePubKey=g,l.serializeIdentity=h,l.toSerializedKeyPair=y,l.makePreKeys=C,l.deserializePreKey=b,l.castToPreKeyId=v,l.castToSignedPreKeyId=S,l.castToSerializedPubKey=R,l.makeRawSenderKey=L,l.ecdh=E}),98);
__d("WAParsableWapNode",["WABinary","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(e){function t(t,n){var r;return r=e.call(this,"XmppParsingFailure: "+t+": "+n)||this,r.name="XmppParsingFailure",r.parser=t,r.reason=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason},t})(babelHelpers.wrapNativeSuper(Error)),c=(function(t){function n(e,n){return t.call(this,e,n)||this}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.assertFromServer=function(){var e=this.attrString("from");e!==o("WAJids").WA_SERVER_JID_SUFFIX&&this.throw('to have "from"="s.whatsapp.net", but instead has "'+e+'"')},a.attrUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.botJid!=null?n.botJid:n.userJid==null?this.throw('to have "'+t+'"={UserJid}, but instead has "'+e+'"'):n.userJid},a.attrPhoneUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:this.throw('to have "'+t+'"={PhoneUserJid}, but instead has "'+e+'"')},a.attrLidUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidUser"?n.userJid:this.throw('to have "'+t+'"={LidUserJid}, but instead has "'+e+'"')},a.maybeAttrUserJid=function(t){return this.hasAttr(t)?this.attrUserJid(t):null},a.maybeAttrPhoneUserJid=function(t){return this.hasAttr(t)?this.attrPhoneUserJid(t):null},a.maybeAttrLidUserJid=function(t){return this.hasAttr(t)?this.attrLidUserJid(t):null},a.attrGroupJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.groupJid==null?this.throw('to have "'+t+'"={GroupJid}, but instead has "'+e+'"'):n.groupJid},a.maybeAttrGroupJid=function(t){return this.hasAttr(t)?this.attrGroupJid(t):null},a.attrChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.userJid!=null?n.userJid:n.groupJid!=null?n.groupJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrPhoneChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:n.jidType==="group"?n.groupJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.deviceJid!=null?n.deviceJid:n.userJid!=null?o("WAJids").defaultDeviceJidForUser(n.userJid):n.hostedDeviceJid!=null?n.hostedDeviceJid:n.hostedLidDeviceJid!=null?n.hostedLidDeviceJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={DeviceJid}, but instead has "'+e+'"')},a.attrPhoneDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneDevice"?n.deviceJid:n.jidType==="phoneUser"?o("WAJids").defaultPhoneDeviceJidForUser(n.userJid):this.throw('to have "'+t+'"={PhoneDeviceJid}, but instead has "'+e+'"')},a.attrLidDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidDevice"?n.deviceJid:n.jidType==="lidUser"?o("WAJids").defaultLidDeviceJidForLidUserJid(n.userJid):this.throw('to have "'+t+'"={LidDeviceJid}, but instead has "'+e+'"')},a.attrDeviceId=function(t){var e=this.attrInt(t);return o("WAJids").interpretAsDeviceId(e)},a.attrFromJidChat=function(){var t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{var n=t.userJid,a=o("WAJids").defaultDeviceJidForUser(n);return{type:"device",chat:n,deviceJid:a,author:a}}case"interopUser":{var i=t.userJid,l=o("WAJids").defaultDeviceJidForUser(i);return{type:"device",chat:i,deviceJid:l,author:l}}case"phoneUser":{var s=t.userJid,u=o("WAJids").defaultDeviceJidForUser(s);return{type:"device",chat:s,deviceJid:u,author:u}}case"lidUser":{var c=t.userJid,d=o("WAJids").defaultLidDeviceJidForLidUserJid(c);return{type:"device",chat:c,deviceJid:d,author:d}}case"phoneDevice":{var m=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(m),deviceJid:m,author:m}}case"msgrDevice":{var p=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(p),deviceJid:p,author:p}}case"interopDevice":{var _=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(_),deviceJid:_,author:_}}case"lidDevice":{var f=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(f),deviceJid:f,author:f}}case"group":{var g=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return g==null?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:g}}case"broadcast":{var h=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return h==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:o("WAJids").extractUserJid(h),author:h}}case"hosted":{var y=t.hostedDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(y),deviceJid:y,author:y}}case"hostedLid":{var C=t.hostedLidDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(C),deviceJid:C,author:C}}case"call":throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),t.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with jid of type "+t.jidType)}},a.attrFromJidPhoneChat=function(){var e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{var t=e.userJid,n=o("WAJids").defaultPhoneDeviceJidForUser(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{var a=e.deviceJid;return{type:"device",chat:o("WAJids").extractPhoneUserJid(a),deviceJid:a,author:a}}case"group":{var i=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return i==null?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:i}}case"broadcast":{var l=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return l==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:o("WAJids").extractPhoneUserJid(l),author:l}}case"call":throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),e.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw("attrFromJidChat should not be used with jid of type "+e.jidType)}},a.attrFromPhoneJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}else return this.attrFromJidPhoneChat()},a.attrFromJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}return e.jidType==="newsletter"?{type:"newsletter",newsletterJid:e.newsletterJid}:e.jidType==="hosted"?{type:"hosted",hostedDeviceJid:e.hostedDeviceJid}:e.jidType==="hostedLid"?{type:"hostedLid",hostedLidDeviceJid:e.hostedLidDeviceJid}:this.attrFromJidChat()},a.attrJidWithType=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?this.throw('to have "'+t+'"={Jid}, but instead has "'+e+'"'):n},a.attrWapJid=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?o("WAWapJid").WapJid.create(null,e):o("WAWap").JID(o("WAJids").extractFromJid(n))},a.attrLongInt=function(t){var e=this.attrString(t);return o("WALongInt").decimalStringToLongInt(e)},a.attrTime=function(t){return o("WATimeUtils").castToUnixTime(this.attrInt(t))},a.maybeAttrTime=function(t){return this.hasAttr(t)?this.attrTime(t):null},a.attrFutureTime=function(t){var e=this.attrInt(t);return o("WATimeUtils").futureUnixTime(e)},a.contentString=function(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){var e=new(o("WABinary")).Binary(this.contentBytes());return e.readString(e.size())}else return this.throw("to have content")},a.decodeAsString=function(t){return o("WAWap").decodeAsString(t)},a.contentSerializedPubKey=function(){return this.hasContent()?o("WASignalKeys").serializeIdentity(this.contentBytes()):this.throw("to have content")},a.createParseError=function(t){return new u(this.name(),"expected <"+this.tag()+"> "+t)},a.throw=function(t){throw this.createParseError(t)},n})(o("WAParsableXmlNode").ParsableXmlNode);l.XmppParsingFailure=u,l.ParsableWapNode=c}),98);
__d("WADeprecatedWapParser",["WAParsableWapNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.parse=function(t){var e=new(o("WAParsableWapNode")).ParsableWapNode(this.$1,t);try{return{success:this.$2(e)}}catch(e){if(e instanceof o("WAParsableWapNode").XmppParsingFailure)return{error:e};throw e}},t.parseOrThrow=function(t){var e=this.parse(t);if(e.error)throw r("err")(String(e.error));return e.success},e})();l.default=e}),98);
__d("WAAckParser",["WADeprecatedWapParser","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("ack",function(e){return e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null,recipient:e.hasAttr("recipient")?e.attrUserJid("recipient"):null}});function s(e,t){return e.id===t.id&&(t.class===void 0||e.class===t.class)&&(t.type===void 0||e.type===t.type)&&(t.from===void 0||u(e.from,t.from))&&(t.participant===void 0||e.participant===t.participant)&&(t.recipient===void 0||e.recipient===t.recipient)&&(t.ts===void 0||e.ts===t.ts)}function u(e,t){if(o("WAJids").extractFromJid(e)===t)return!0;if(e.userJid!=null)return o("WAJids").defaultDeviceJidForUser(e.userJid)===t;if(e.deviceJid!=null){var n=e.deviceJid;return o("WAJids").extractDeviceId(n)===0&&o("WAJids").extractUserJid(n)===t}return!1}l.AckParser=e,l.ackMatchesTemplate=s,l.fromJidsAreEqual=u}),98);
__d("WAParseIqResponse",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=e.content;if(r&&Array.isArray(r)&&r[0]){var a=r[0];if(a.tag==="error"){var i=a.attrs||{},l;n&&(typeof n=="function"?l=n(e):l=n.parseOrThrow(a));var u=l;return{success:!1,errorCode:parseInt(i.code,10),errorText:o("WAWap").decodeAsString(i.text)||"",errorType:o("WAWap").decodeAsString(i.type)||"",errorBackoff:parseInt(i.backoff,10),toString:s,customError:u}}}return typeof t=="function"?{success:!0,result:t(e)}:{success:!0,result:t.parseOrThrow(e)}}function s(){return"IqError "+this.errorCode+": "+this.errorText}l.parseIqResponse=e}),98);
__d("WADeprecatedSendIq",["Promise","WAAckParser","WAArrayUtils","WAComms","WALogger","WAParseIqResponse"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function c(e,t,n){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t,n)})}function d(e,t,n){return o("WAComms")._sendIq(e,!1,n).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function m(e,t){return o("WAComms")._sendIq(e,!0).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function p(e,t){return _(e,t).then(function(){})}function _(t,r){return new(s||(s=n("Promise")))(function(a){var i=o("WAComms").singletonOrThrowIfUninitialized("deprecatedSendStanzaAndReturnAck"),l=function(t){var e=o("WAAckParser").AckParser.parse(t);return!e.error&&o("WAAckParser").ackMatchesTemplate(e.success,r)?t:null},u={type:"ack",parseAndTest:l,resolve:a,stanza:t,attachedToSocketId:o("WAComms").DEFAULT_SOCKET_ID,orderedId:o("WAComms").getAndIncrementNextOrderedId()};if(i.ackHandlers.push(u),!i.socket){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"])));return}i.callStanza(t).catch(function(e){var t=i.ackHandlers.indexOf(u);t!==-1&&(o("WAArrayUtils").removeIndexWithoutPreservingOrder(i.ackHandlers,t),u.resolve((s||(s=n("Promise"))).reject(e)))})})}function f(e,t){o("WAComms").castSmaxStanza(e,t)}l.deprecatedSendIq=u,l.deprecatedSendIqErrorParser=c,l.deprecatedSendIqIfConnectedWithin=d,l.deprecatedSendIqWithoutRetry=m,l.deprecatedSendStanzaAndWaitForAck=p,l.deprecatedSendStanzaAndReturnAck=_,l.deprecatedCastStanza=f}),98);
__d("WAMediaConnParser",["WADeprecatedWapParser","WAServerMediaType"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("mediaConnParser",function(e){var t,n,r=e.child("media_conn"),o=c(r);return{hosts:o,authToken:r.attrString("auth"),authTokenExpiryTs:r.attrFutureTime("auth_ttl"),routesExpiryTs:r.attrFutureTime("ttl"),maxBuckets:r.attrInt("max_buckets"),maxManualRetry:(t=r.maybeAttrInt("max_manual_retry",0,4))!=null?t:3,maxAutoDownloadRetry:(n=r.maybeAttrInt("max_auto_download_retry",0,4))!=null?n:3}});function s(e){var t,n;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:(t=e.maybeAttrString("fallback_ip4"))!=null?t:void 0,ip6:(n=e.maybeAttrString("fallback_ip6"))!=null?n:void 0}}function u(e){var t,n,r,o;return{domain:e.attrString("hostname"),fallback:s(e),uploadable:d(e,"upload"),downloadable:d(e,"download"),isFallback:e.maybeAttrString("type")==="fallback",downloadBuckets:(t=(n=e.maybeChild("download_buckets"))==null?void 0:n.mapChildren(function(e){return parseInt(e.tag(),10)}))!=null?t:[],class:e.maybeAttrString("class"),ip4:(r=e.maybeAttrString("ip4"))!=null?r:void 0,ip6:(o=e.maybeAttrString("ip6"))!=null?o:void 0}}function c(e){return e.mapChildrenWithTag("host",u)}function d(e,t){return e.hasChild(t)?e.child(t).mapChildren(function(e){var t=e.tag();return o("WAServerMediaType").castToServerMediaType(t)}).filter(Boolean):o("WAServerMediaType").SERVER_MEDIA}l.mediaConnParser=e}),98);
__d("WAGatherMediaInfo",["WADeprecatedSendIq","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=507,p=o("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},_);function _(){var e=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:g});return e.start(),e.promise()}var f=60;function g(t){var n,r=(n=o("WAWap")).wap("iq",{id:n.generateId(),to:n.S_WHATSAPP_NET,type:"set",xmlns:"w:m"},n.wap("media_conn",null));return o("WADeprecatedSendIq").deprecatedSendIqIfConnectedWithin(r,o("WAMediaConnParser").mediaConnParser,f).then(function(n){if(n.success)o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"])),n.result.hosts.length),t(o("WAResultOrError").makeResult(n.result));else if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""])),n),n.errorCode===m){var r=n.errorBackoff;o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"])),r),t(o("WAResultOrError").makeError({type:"backoff",backoffMs:r*1e3}))}else n.errorCode<500&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""])),n.errorCode),t(o("WAResultOrError").makeError({type:"client-error",code:n.errorCode,text:n.errorText})))}).catch(function(e){e instanceof o("WAErrors").Disconnected?t(o("WAResultOrError").makeError("disconnected")):o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""])),e)})}l.gatherMediaInfo=p}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null,n=null,r=null,a=e.hosts,i=e.operation,l=e.mediaType;if(e.operation==="download"){var s,u=e.catHotTimespan,c=e.ncHot,d=e.getVcaEnabledBucket,m=new Map;a.forEach(function(e){e.downloadBuckets.forEach(function(t){m.set(t,e)})});var p=m.get(0);u>0&&c!=null&&o("WATimeUtils").happenedWithin(o("WATimeUtils").castToUnixTime(c),u)?t=1:d&&(t=d());var _=null;t!=null&&(_=m.get(t)),(s=_)!=null&&s.downloadable.includes(l)?n=_:p!=null&&p.downloadable.includes(l)&&(n=p)}for(var f=0;f<a.length;f++){var g=a[f];if((i==="upload"&&g.uploadable.includes(l)||i==="download"&&g.downloadable.includes(l))&&(n==null?n=g:g.isFallback&&r==null&&(r=g)),n!=null&&r!=null)break}return{selectedHost:n,fallbackHost:r,bucket:t}}l.mediaRouteSelection=e}),98);
__d("WAGetMediaRoute",["$InternalEnum","Promise","WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WAWorkerGlobalScope","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=o("WATagsLogger").TAGS(["GetMediaRoute"]),h=86400,y=n("$InternalEnum")({Fresh:"fresh",Cached:"cached",Stale:"stale"}),C=null,b=!1,v=null;function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){t==null||t.addPoint("get_cached_or_fresh_media_access_start");var n=yield I();if(t==null||t.addPoint("get_cached_or_fresh_media_access_end"),!n.success)return g.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to get mediaAccess: ",""])),n.error),t==null||t.addPoint("get_media_access_failed",{string:{mediaAccessStatus:n.error}}),n;t==null||t.addAnnotations({string:{mediaAccessStatus:n.value.state}});var r=n.value.mediaAccess,a=r.authToken,i=r.hosts,l=r.maxBuckets,s=e.operation==="upload"?o("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:e.serverMediaType,hosts:i}):o("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:e.serverMediaType,hosts:i,catHotTimespan:h,ncHot:o("WAExtractNcHotTimestamp").extractNcHotTimestamp(e.directPath),getVcaEnabledBucket:o("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(e.directPath,l)}),u=s.selectedHost,c=s.fallbackHost,d=s.bucket;return u==null?(g.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Error: no media host"]))),o("WAResultOrError").makeError("no-host")):o("WAResultOrError").makeResult({authToken:a,selectedHost:u,fallbackHost:c,bucket:d})}),R.apply(this,arguments)}function L(){var e=v;e!=null&&(o("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(e),v=null)}function E(t){L();var n=Math.max(t.authTokenExpiryTs-o("WATimeUtils").unixTime(),0);if(!(n<=300)){var r=o("WATimeUtils").pastUnixTime(300,t.authTokenExpiryTs),a=o("WATimeUtils").pastUnixTime(Math.floor(n*.2),t.authTokenExpiryTs),i=r<a?r:a,l=o("WATimeUtils").cappedMillisecondsUntil(i),u=Math.floor(Math.random()*o("WATimeUtils").MINUTE_MILLISECONDS),c=o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){g.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["AuthTTL approaching expiry, refreshing MediaAccess routes"]))),k().catch(function(e){g.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error occurred during authTTL automatic refresh: ",""])),e)})},l+u);v=c}}var k=o("WAPromiseManagement").cacheWhilePending(function(){return"all"},n("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(b)return g.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, but we are still locked by backoff"]))),o("WAResultOrError").makeError("backoff");yield o("WAWaitForComms").waitForComms(),g.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, gather a new one"]))),L();var e=yield o("WAGatherMediaInfo").gatherMediaInfo();if(e.success)return C=e.value,E(e.value),o("WAResultOrError").makeResult({mediaAccess:e.value,state:y.Fresh});var t=e.error,n=t==="disconnected"?"disconnected":t.type;return g.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Can not get mediaAccess: ",""])),n),t==="disconnected"||t.type==="client-error"?o("WAResultOrError").makeError("disconnected"):(t.type,b=!0,o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){b=!1,k().catch(function(e){g.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Error occurred on gather after backoff expiry: ",""])),e)})},t.backoffMs),o("WAResultOrError").makeError("backoff"))})),I=function(){var e=C;if(e==null)return k();if(o("WATimeUtils").isInFuture(e.routesExpiryTs))return(f||(f=n("Promise"))).resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:y.Cached}));var t=k();return o("WATimeUtils").isInFuture(e.authTokenExpiryTs)?(f||(f=n("Promise"))).resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:y.Stale})):t};function T(){C=null,b=!1,L()}l.getMediaRoute=S,l.getCachedOrFreshMediaAccess=I,l.clearCachedMediaAccessForTest=T}),98);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=4,u={algo:{type:"constant",delay:1e3},jitter:0},c=(function(){function t(e,t,n){this.$1=e,this.routesInfo=t,this.$2=o("WAPromiseBackoffs").createPromiseTimer(u),this.$3=0,this.$4=!1,this.$5=n}var r=t.prototype;return r.run=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){for(;this.$3<s;){yield this.$2();var r=void 0;if(this.$3>0){var a;r=this.$3>=s-2&&!this.$4,o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:"," wait for internet, attempt = ",""])),this.$1,this.$3),yield(a=this.$5)==null?void 0:a.call(this)}else r=!1;var i=this.routesInfo;if(!i)return null;var l=i.host;r&&i.fallbackHost&&(l=i.fallbackHost);var u=yield t(l,i.authToken,this.$3,n);if(u.success)return u.value;++this.$3,this.$4=u.error.progressMade}return null});function r(e,n){return t.apply(this,arguments)}return r})(),t})();l.MAX_ATTEMPTS=s,l.BACKOFF_OPTIONS=u,l.MediaOperationsRetrier=c}),98);
__d("WACreateMediaDownloadRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.directPath,n=e.eventFlow,r=e.fileEncSha256,a=e.mediaTypeDetails,i=a.type==="regular"?a.mediaType:"preview";n==null||n.addPoint("get_media_route_start");var l=yield o("WAGetMediaRoute").getMediaRoute({operation:"download",serverMediaType:i,fileEncSha256:r,directPath:t},n);if(!l.success)return n==null||n.addPoint("get_media_route_fail"),l;n==null||n.addPoint("get_media_route_end");var s=l.value,u=s.selectedHost,c=s.fallbackHost,d=s.authToken,m=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("download",{host:{domain:u.domain,class:u.class},fallbackHost:c&&{domain:c.domain,class:c.class},authToken:d,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult({retrier:m,mediaRouteDetails:l.value})}),s.apply(this,arguments)}l.createMediaDownloadRetrier=e}),98);
__d("WAHttpDownloadMedia",["WAErrorMessage","WALogger","WAMediaQplHelper","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="URL signature expired";function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=n!=null?n:{},a=r.mediaMetrics,i=r.abortSignal;a==null||a.addPoint("http_fetch_start");var l=yield self.fetch(t,{method:"GET",mode:"cors",cache:"no-store",signal:i}).then(function(e){return a==null||a.addPoint("http_fetch_end"),o("WAResultOrError").makeResult(e)}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return a==null||a.addPoint("http_fetch_fail",{string:{httpFetchError:n}}),o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to initiate fetch: ",", message: ",""])),t,n),t.name==="AbortError"?o("WAResultOrError").makeError("http-fetch-aborted"):o("WAResultOrError").makeError("http-fetch-exception")});if(l.success===!1)return l;var m=l.value,p=m.headers.get("content-length"),_=m.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),_),a==null||a.addAnnotations({string:{ciphertextMediaSizeBucket:p!=null?o("WAMediaQplHelper").convertIntegerSizeToStringBucket(Number(p)):null},int:{httpStatus:_}}),_){case 200:case 206:return o("WAResultOrError").makeResult(m);case 401:return o("WAResultOrError").makeError("access-expired");case 403:return m.text().then(function(e){return e===d?o("WAResultOrError").makeError("signature-expired"):o("WAResultOrError").makeError("access-expired")}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body: ",""])),e),o("WAResultOrError").makeError("access-expired")});case 404:case 410:return o("WAResultOrError").makeError("media-not-found");case 408:return o("WAResultOrError").makeError("server-timeout");case 416:return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: can not resume from offset"]))),o("WAResultOrError").makeError("request-error");case 429:case 507:return o("WAResultOrError").makeError("download-throttled");default:return _>=400&&_<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}),p.apply(this,arguments)}l.httpDownloadMedia=m}),98);
__d("WAHttpUtils",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw r("err")('buildUrl given invalid host "'+e+'"');if(!t.startsWith("/"))throw r("err")('buildUrl given invalid path "'+t+'"');var o=n,a=""+e+t;if(!o)return a;var i=Object.keys(o).map(function(e){var t=o[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n=t instanceof Uint8Array?Array.from(t).map(function(e){return"%"+e.toString(16)}).join(""):encodeURIComponent(t.toString());return encodeURIComponent(e)+"="+n});if(i.length>0){var l=i.join("&");return a.includes("?")?a+"&"+l:a+"?"+l}else return a}l.buildUrl=e}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=1;function s(t,n,r,a,i,l,s){var u=o("WAGlobals").getDependencies().mediaUploadRoot(),c=o("WABase64").encodeB64UrlSafe(r),d=o("WABase64").encodeB64UrlSafe(n),m={auth:i,token:d};return l&&(m.resume=e),s!=null&&s>0&&(m.bytestart=s),o("WAHttpUtils").buildUrl("https://"+a,u+"/"+t+"/"+c,m)}function u(e,t,n,r,a,i,l){var s=o("WABase64").encodeB64UrlSafe(t),u={hash:s,mode:r};return a!=null&&(u._nc_cat=a),i!=null&&i>=0&&(u.bytestart=i),l!=null&&l>0&&(u.byteend=l),o("WAHttpUtils").buildUrl("https://"+n,e,u)}l.RESUME_PARAM=e,l.buildUploadUrl=s,l.buildDownloadUrl=u}),98);
__d("WADownloadCiphertext",["WAAssertUnreachable","WABase64","WACreateMediaDownloadRetrier","WACryptoSha256","WACryptoUtils","WAHashUtils","WAHttpDownloadMedia","WALogger","WAMediaUrl","WAPromiseManagement","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.abortSignal,a=t.mediaTypeDetails,i=t.fileEncSha256,l=t.directPath,p=t.plaintextHash,_=t.eventFlow,f=t.fromBytes,h=t.toBytes;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Start download ciphertext for hash: ",""])),o("WAHashUtils").sanitisePlaintextHash(p)),_.addPoint("create_retrier_start");var y=yield o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({mediaTypeDetails:a,directPath:l,eventFlow:_,fileEncSha256:i});if(!y.success)return _.addPoint("create_retrier_fail"),y;_.addPoint("create_retrier_end");var C=y.value,b=C.retrier,v=C.mediaRouteDetails,S=yield b.run(function(e,t,r){var a=e.domain,d="http_download_media_"+r,m=o("WAMediaUrl").buildDownloadUrl(l,i,a,"manual",v.bucket,f,h);return _.addPoint(d+"_start"),o("WAHttpDownloadMedia").httpDownloadMedia(m,{mediaMetrics:_,abortSignal:n,cachePolicy:r>0?"no-store":"force-cache"}).then(function(e){if(e.success)return e.value.arrayBuffer().then(function(e){return _.addPoint(d+"_end"),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult(e))}).catch(function(e){return _.addPoint("response_array_buffer_error"),_.addPoint(d+"_fail"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeResult(o("WAResultOrError").makeError("body-network-error"))});_.addPoint(d+"_fail");var t=e.error;switch(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""])),t),_.addPoint(t),t){case"signature-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("signature-expired"));case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("http-fetch-aborted"));case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){return _.addPoint(d+"_fail"),o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["downloadCiphertext http download exception: ",""])),e),o("WAResultOrError").makeError({progressMade:!1})})});if(S==null)return o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(S.success===!1){var R=S.error;switch(o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext failed: ",""])),R),R){case"signature-expired":case"http-fetch-aborted":case"media-not-found":case"download-throttled":case"body-network-error":case"request-error":return o("WAResultOrError").makeError(R);case"access-expired":return o("WAResultOrError").makeError("disconnected");default:throw r("WAAssertUnreachable")(R)}}else{var L=S.value;return!g(f,h)&&!o("WACryptoUtils").arrayBuffersEqual(yield o("WACryptoSha256").sha256(L),i)?o("WAResultOrError").makeError("ciphertext-hash-mismatch"):(_.addPoint("download_finish",{int:{byteLength:L.byteLength},bool:{isPartialDownload:g(f,h)}}),o("WAResultOrError").makeResult(L))}}),_.apply(this,arguments)}var f=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.fileEncSha256,n=e.fromBytes,r=e.toBytes;return o("WABase64").encodeB64UrlSafe(t)+"-"+(n!=null?n:"X")+"-"+(r!=null?r:"X")},p);function g(e,t){return e!=null&&e>0?!0:t!=null}l.cachedDownloadCiphertext=f}),98);
__d("WADownloadAndDecryptMedia",["WADecryptMedia","WADownloadCiphertext","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,n=e.mediaTypeDetails,r=e.fileEncSha256,a=e.directPath,i=e.mediaKey,l=e.plaintextHash,s=e.eventFlow,u=yield o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:n,fileEncSha256:r,directPath:a,eventFlow:s,plaintextHash:l});if(u.success!==!0)return u;var c=yield o("WADecryptMedia").decryptMedia({mediaKey:i,mediaTypeDetails:n,plaintextHash:l,ciphertextHmac:u.value});return c.success!==!0?c:(c.value.alternativeHmacSaltUsed!=null&&s.addAnnotations({string:{alternativeHmacSaltUsed:c.value.alternativeHmacSaltUsed}}),o("WAResultOrError").makeResult(c.value.plaintext))}),s.apply(this,arguments)}l.downloadAndDecryptMedia=e}),98);
__d("WACreateMediaDecrypterStream",["WABinary","WAMediaCrypto","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptStream"]);function f(t,r,a,i,l){if(i.byteLength===0)return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs must have at least one element"]))),o("WAResultOrError").makeError("missing-expected-hmacs");if(i.byteLength!==l.length*o("WAMediaCrypto").HMAC_LENGTH)return _.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs and ciphertextLengths must have the same length"]))),o("WAResultOrError").makeError("hmac-chiphertext-array-mismatch");var m=g(i),p=r,f=new(o("WABinary")).Binary,y=0,C=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){for(f.writeByteArray(e);y<m.length&&f.size()>=l[y];y++){var r=f.readByteArrayView(l[y]);_.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," of size ",""])),y,r.length);var i=y===l.length-1;try{var s=yield o("WAMediaCrypto").hmacAndDecryptPartial(t,p,r,a,m[y]),d=s.plaintext,g=s.nextIv;i?n.enqueue(h(d)):n.enqueue(d),p=g}catch(e){_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt chunk. isLastChunk: "," error: ",""])),i,e),e instanceof o("WAMediaCrypto").HmacValidationError?n.error("enc-hash-mismatch"):n.error("decryption-error")}}});return function(n,r){return e.apply(this,arguments)}})(),b=new TransformStream({transform:function(t,n){var e=t;return C(e,n)},flush:function(t){f.size()>0&&_.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unexpected ciphertext in buffer following flush"])))}});return o("WAResultOrError").makeResult(b)}function g(e){var t=[];if(e.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0)throw r("err")("Sidecar length is not a multiple of hmac length");for(var n=0;n<e.byteLength;n+=o("WAMediaCrypto").HMAC_LENGTH){var a=new Uint8Array(e,n,o("WAMediaCrypto").HMAC_LENGTH);t.push(a)}return t}function h(e){if(e.length<o("WAMediaCrypto").CBC_BLOCK_SIZE)return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Plaintext size is less than CBC_BLOCK_SIZE"]))),e;var t=e[e.length-1];return t===0||t>o("WAMediaCrypto").CBC_BLOCK_SIZE?(_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Invalid PKCS padding length"]))),e):e.subarray(0,-t)}l.createDefaultDecryptStream=f}),98);
__d("WAMediaProgressiveJpegTransformStream",["WABinary"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=[],r=0;for(var a of t)r+=a,n.push(r);var i=new(o("WABinary")).Binary,l=0,s=0,u=new TransformStream({transform:function(r,o){var e=r;for(s+=e.byteLength,i.writeByteArray(e);l<t.length&&n[l]<s;l++){var a=i.readByteArrayView(t[l]);o.enqueue(a)}},flush:function(t){t.enqueue(i.readByteArrayView())}});return u}l.makeProgressiveJpegHandlerTransformStream=e}),98);
__d("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry",["WACreateMediaDecrypterStream","WAHttpDownloadMedia","WAMediaCrypto","WAMediaProgressiveJpegTransformStream","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function c(e){return e}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.abortSignal,r=t.serverMediaType,a=t.downloadUrl,i=t.eventFlow,l=t.progressiveJpegDetails,c=t.mediaKey,d=t.cachePolicy,m=yield o("WAHttpDownloadMedia").httpDownloadMedia(a,{mediaMetrics:i,abortSignal:n,cachePolicy:d});if(m.success!==!0)return m;var p=m.value.body;if(p==null)return o("WAResultOrError").makeError("body-network-error");var _=m.value.headers.get("Content-Length");if(_==null)return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is missing"]))),o("WAResultOrError").makeError("missing-content-length-header");var f=Number(_);if(Number.isNaN(f))return u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is not a number"]))),o("WAResultOrError").makeError("invalid-content-length-header");var g=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:l,ciphertextLength:f}),h=yield o("WAMediaCrypto").computeMediaKeys(c,r),y=o("WACreateMediaDecrypterStream").createDefaultDecryptStream(h.cipherKey,h.iv,h.hmacKey,g.sidecar,g.alignedScanLengths);if(y.success!==!0)return y;var C=y.value,b=o("WAMediaProgressiveJpegTransformStream").makeProgressiveJpegHandlerTransformStream(g),v=p.pipeThrough(C).pipeThrough(b);return o("WAResultOrError").makeResult(v)}),m.apply(this,arguments)}l.unsafeCastToDownloadAndDecryptPJpegStream=c,l.downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry=d}),98);
__d("WADownloadProgressiveJpegPlaintextStreamer",["WAAssertUnreachable","WACreateMediaDownloadRetrier","WADownloadProgressiveJpegPlaintextStreamerWithoutRetry","WAMediaUrl","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t.abortSignal,i=t.serverMediaType,l=t.fileEncSha256,u=t.directPath,c=t.eventFlow,d=t.progressiveJpegDetails,m=t.mediaKey,p=yield o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({directPath:u,eventFlow:c,fileEncSha256:l,mediaTypeDetails:{type:"regular",mediaType:i}});if(!p.success)return p;var _=p.value,f=_.retrier,g=_.mediaRouteDetails,h=g.bucket,y=yield f.run((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var s=e.domain,p=o("WAMediaUrl").buildDownloadUrl(u,l,s,"manual",h),_=yield o("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry").downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry({abortSignal:a,downloadUrl:p,eventFlow:c,mediaKey:m,progressiveJpegDetails:d,serverMediaType:i,cachePolicy:n>0?"no-store":"force-cache"});if(_.success===!0)return o("WAResultOrError").makeResult(_);var f=_.error;switch(f){case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":case"invalid-content-length-header":case"missing-content-length-header":return o("WAResultOrError").makeError({progressMade:!0});case"access-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("disconnected"));case"body-network-error":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("request-error"));case"media-not-found":case"request-error":case"download-throttled":case"signature-expired":case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));default:throw r("WAAssertUnreachable")(f)}});return function(t,n,r){return e.apply(this,arguments)}})());return y==null?(s.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Download with stream given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded")):y}),c.apply(this,arguments)}l.downloadProgressiveJpegPlaintextUsingStreams=u}),98);
__d("WAPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=typeof((e=navigator.storage)==null?void 0:e.getDirectory)=="function",m=typeof self.caches=="object",p=0;function _(e){var t,r=e.mediaDownloadFlow,a=e.mediaEntry,i=e.logger,l=e.hash,_=a.mediaKeyTimestamp,f=a.size,g=a.serverMediaType,h=a.downloadableThumbnail,y=a.directPath,C=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(_);i.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start download ",". mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(l),C,f,g);var b=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a).value)!=null?t:null;return r.addPoint("wa_protocol_media_download_start",{string:{mediaType:g,mediaKeyTimestampAgeBucket:C,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(l)},bool:{isOPFSSupported:d,isWebCacheSupported:m,duplicateDirectPath:(h==null?void 0:h.directPath)===y,hasDownloadableThumbnail:(h==null?void 0:h.directPath)!=null,isProgressiveJpeg:b!=null}}),{logDownloadResult:function(t){return p++,r.addAnnotations({int:{concurrentDownloadCount:p}}),t.then(function(e){if(e.success){var t=e.value.plaintext.byteLength;r.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else r.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){r.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(c||(c=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){p--})}}}l.prepareMediaDownload=_}),98);
__d("WAProgressiveJpegAddJPEGTrailingTag",["WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e=new Uint8Array([255,217]);function s(t){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[new Uint8Array(t),e]).buffer}l.JPEG_TRAILING_TAG=e,l.addJPEGTrailingTag=s}),98);
__d("WAStreamAsyncIterator",[],(function(t,n,r,o,a,i){"use strict";function e(e){return l.apply(this,arguments)}function l(){return l=babelHelpers.wrapAsyncGenerator(function*(e){var t=e.getReader();try{for(;;){var n=yield babelHelpers.awaitAsyncGenerator(t.read()),r=n.done,o=n.value;if(r)return;yield o}}finally{t.releaseLock()}}),l.apply(this,arguments)}i.streamAsyncIterator=e}),66);
__d("WADownloadMedia",["Promise","WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadAndDecryptMedia","WADownloadDownloadablePreview","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAHashUtils","WAMediaCrypto","WAMediaUtils","WAPrepareMediaDownload","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAPromiseManagement","WAResultOrError","WAStreamAsyncIterator","WATagsLogger","WATypedArraysConcat","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["hash"],s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R=o("WATagsLogger").TAGS(["MediaDownload"]);function L(e){var t=e.downloadMediaMetric,n=e.hash,r=e.mediaEntry,a=e.protocolMsgId,i=e.handleMediaPreviewDownload,l=e.handleMediaPreviewBeforeDownload,s=e.handleMediaPreviewDownloadFailed,u=o("WAPrepareMediaDownload").prepareMediaDownload({mediaDownloadFlow:t,mediaEntry:r,hash:n,logger:R}),c=u.logDownloadResult;return c(k({downloadMediaMetric:t,hash:n,mediaEntry:r,protocolMsgId:a,handleMediaPreviewDownload:i,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s}))}var E=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.downloadMediaMetric,r=e.hash,a=e.mediaEntry,i=e.protocolMsgId,l=e.handleMediaPreviewDownload,p=e.handleMediaPreviewBeforeDownload,_=e.handleMediaPreviewDownloadFailed,f=o("WAMediaUtils").validateDecodedMediaEntryForDownload(a);if(!f.success)return R.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mediaEntry is incomplete. ",""])),f.error),f;var g=f.value,h=g.directPath,y=g.fileEncSha256,C=g.fileSha256,b=g.mediaKey,v=g.serverMediaType,L=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a);L.success===!1&&(R.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to get ProgressiveJpeg details: ",""])),L.error),t.addPoint(L.error));var E=L.success===!0?L.value:null,k=function(t){if(t==null)return(S||(S=n("Promise"))).resolve();var e=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(v);return e==null?(R.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),v),(S||(S=n("Promise"))).resolve()):l(r,t,e,i).then(function(){})};if(E!=null&&o("WAMediaUtils").isTransformStreamSupported()&&v==="image"){var T=yield P({directPath:h,downloadFlow:t,fileEncSha256:y,handleMediaPreviewBlob:k,hash:r,mediaKey:b,progressiveJpegDetails:E,serverMediaType:v,fileSha256:C,handleMediaPreviewBeforeDownload:p,handleMediaPreviewDownloadFailed:_});if(T.success)return o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(v),plaintext:T.value,serverMediaType:v});var D=T.error;switch(R.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Media Streaming failed to download progressive jpeg. Reason: ",". PlaintextHash: ",""])),D,o("WAHashUtils").sanitisePlaintextHash(r)),D){case"signature-expired":case"request-error":return R.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Skipping fallback for ",". PlaintextHash: ",""])),D,o("WAHashUtils").sanitisePlaintextHash(r)),o("WAResultOrError").makeError(D)}}t==null||t.addPoint("fallback_to_non_streaming_download");var x=$({hash:r,mediaEntry:a,progressiveJpegDetails:E,protocolMsgId:i,serverMediaType:v,handleMediaPreviewBeforeDownload:p,handleMediaPreviewDownloadFailed:_,downloadEntry:t.downloadEntry,triggerUIView:t.triggerUIView});return x.then(function(e){return e.success===!1?k(null):k(e.value)}),I({downloadMediaMetric:t,mediaEntry:f.value})});return function(n){return e.apply(this,arguments)}})(),k=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},E),I=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,n=e.downloadMediaMetric,r=e.mediaEntry,a=r.directPath,i=r.fileEncSha256,l=r.fileSha256,s=r.mediaKey,u=r.serverMediaType,c=yield D({abortSignal:t,downloadFlow:n,mediaTypeDetails:{mediaType:u,type:"regular"},directPath:a,fileEncSha256:i,fileSha256:l,mediaKey:s});return c.success?o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(u),plaintext:c.value,serverMediaType:u}):c});return function(n){return e.apply(this,arguments)}})(),T=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},function(t){var n=t.hash,r=babelHelpers.objectWithoutPropertiesLoose(t,e),a=o("WAPrepareMediaDownload").prepareMediaDownload({hash:n,mediaDownloadFlow:r.downloadMediaMetric,mediaEntry:r.mediaEntry,logger:R}),i=a.logDownloadResult;return i(I(r))});function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,n=e.downloadFlow,r=e.mediaTypeDetails,a=e.directPath,i=e.fileEncSha256,l=e.fileSha256,s=e.mediaKey,u=o("WAHashUtils").toPlaintextHash(l),c=yield o("WADownloadAndDecryptMedia").downloadAndDecryptMedia({abortSignal:t,directPath:a,eventFlow:n,fileEncSha256:i,mediaKey:s,mediaTypeDetails:r,plaintextHash:u});if(c.success===!1){var d=c.error;switch(d){case"signature-expired":case"media-not-found":return o("WAResultOrError").makeError(d);case"enc-hash-mismatch":return R.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch"]))),o("WAResultOrError").makeError(d);default:return o("WAResultOrError").makeError(d)}}else{var m=c.value;return o("WAResultOrError").makeResult(m)}}),x.apply(this,arguments)}function $(e){var t=e.hash,n=e.mediaEntry,r=e.progressiveJpegDetails,a=e.protocolMsgId,i=e.serverMediaType,l=e.handleMediaPreviewBeforeDownload,s=e.handleMediaPreviewDownloadFailed,u=e.downloadEntry,c=e.triggerUIView;return r==null?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(a,t,i,n,u,{handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s},c):o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreview({protocolMsgId:a,hash:t,serverMediaType:i,mediaEntry:n,progressiveJpegDetails:r,handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s,downloadEntry:u,triggerUIView:c}).then(function(e){return e.success!==!0?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(a,t,i,n,u,{handleMediaPreviewBeforeDownload:l,handleMediaPreviewDownloadFailed:s},c):e})}function P(e){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.directPath,n=e.downloadFlow,r=e.fileEncSha256,a=e.fileSha256,i=e.handleMediaPreviewBlob,l=e.hash,s=e.mediaKey,u=e.progressiveJpegDetails,c=e.serverMediaType,d=e.handleMediaPreviewBeforeDownload,m=e.handleMediaPreviewDownloadFailed,p=R.TAGS(["MediaStreaming"]);p.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_start");var S=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(u.scanLengths)-1;p.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Targeting scanIndex "," for preview. PlaintextHash: ",""])),S,o("WAHashUtils").sanitisePlaintextHash(l)),n.addAnnotations({int:{scans:u.scanLengths.length}}),d(l);var L=yield o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({directPath:t,eventFlow:n,fileEncSha256:r,mediaKey:s,progressiveJpegDetails:u,serverMediaType:c});if(L.success===!1)return n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:L.error}}),m(l,L.error),L;n.addPoint("download_pjpeg_preview_start");var E=[],k=0;try{var I=!1,T=!1,D;try{for(var x=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(L.value)),$;I=!($=yield x.next()).done;I=!1){var P=$.value;{if(P==null)continue;if(p.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(l)),E.push(P),k===S){n.addPoint("media_streaming_preview_processed"),p.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Handling preview from scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(l));var N=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));i(N),n.addPoint("download_pjpeg_preview_end")}k++}}}catch(e){T=!0,D=e}finally{try{I&&x.return!=null&&(yield x.return())}finally{if(T)throw D}}k<S&&(p.ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex for plaintextHash ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("download_pjpeg_preview_fail"));var M=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E))),w=yield o("WACryptoSha256").sha256(M);return o("WACryptoUtils").arrayBuffersEqual(a,w)?(p.LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download successful. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_end"),o("WAResultOrError").makeResult(M)):(p.WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(l)),n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:"hash-mismatch"}}),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return p.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),k<S&&(n.addPoint("download_pjpeg_preview_fail"),m(l,o("WAErrorMessage").maybeGetMessageFromError(e))),n==null||n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("stream-error")}}),N.apply(this,arguments)}l.mediaDownloadLogger=R,l.downloadMedia=L,l.downloadFullMediaOnly=I,l.cachedDownloadFullMediaOnly=T,l.downloadMediaImpl=D}),98);
__d("WADownloadProgressiveJpegPlaintext",["WADownloadCiphertext","WAMediaCrypto","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["DownloadProgressiveJpeg"]);function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,n=e.mediaTypeDetails,r=e.fileEncSha256,a=e.directPath,i=e.mediaKey,l=e.eventFlow,s=e.progressiveJpegDetails,u=e.targetScan,c=e.plaintextHash,d=e.size,m=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:s,ciphertextLength:f(d)}),_=o("WAProgressiveJpegGetPJpegDetails").getTotalByteSizeForScan(m.alignedScanLengths,u),g=yield o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:n,fileEncSha256:r,directPath:a,fromBytes:0,toBytes:_-1,eventFlow:l,plaintextHash:c});return g.success!==!0?g:p(i,n,u,m,g.value)}),m.apply(this,arguments)}function p(e,t,n,r,o){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,r,a,i){c.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using progressiveJpeg decryptAndVerify"])));var l=new Uint8Array(i),d;n.type==="preview"?d=o("WAMediaCrypto").computeMediaKeysForPreview(t):d=o("WAMediaCrypto").computeMediaKeys(t,n.mediaType);var m=yield d.then(function(e){var t=e.iv,n=e.cipherKey,i=e.hmacKey;return o("WAMediaCrypto").decryptPartialChunks(n,t,l,i,r,a)}).then(o("WAResultOrError").makeResult).catch(function(e){return c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")});if(!m.success)return m;c.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ProgressiveJpeg download and decrypt successful. Partial: ",""])),r<a.scanLengths.length);var p=o("WAProgressiveJpegAddJPEGTrailingTag").addJPEGTrailingTag(m.value.plaintext);return o("WAResultOrError").makeResult(p)}),_.apply(this,arguments)}function f(e){if(e==null)return null;var t=o("WAMediaCrypto").CBC_BLOCK_SIZE-e%o("WAMediaCrypto").CBC_BLOCK_SIZE;return e+t+o("WAMediaCrypto").HMAC_LENGTH}l.downloadProgressiveJpegPlaintext=d}),98);
__d("WALoggerTag",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]),l=e;i.default=l}),66);
__d("WAProgressiveJpegGetTargetScanLengthForBytes",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=0,r=0,o=0;o<e.length&&(r=o+1,n+=e[o],!(n>=t));o++);return r}i.getTargetScanBasedOnByteSize=e}),66);
__d("WADownloadProgressiveJpegPreview",["WADownloadMedia","WADownloadProgressiveJpegPlaintext","WAGlobals","WALoggerTag","WAProgressiveJpegGetTargetScanLengthForBytes","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WADownloadMedia").mediaDownloadLogger.TAGS([r("WALoggerTag").MediaPreview]),c=3;function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.protocolMsgId,r=t.hash,a=t.serverMediaType,i=t.mediaEntry,l=t.progressiveJpegDetails,c=t.handleMediaPreviewBeforeDownload,d=t.handleMediaPreviewDownloadFailed,m=t.downloadEntry,_=t.triggerUIView,f=i.directPath,g=i.fileEncSha256,h=i.mediaKey,y=i.size;if(f==null||g==null||h==null)return o("WAResultOrError").makeError("pjpeg-failed");var C=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:n,downloadEntry:m,isPreview:!0,msgType:null,triggerUIView:_});C.addAnnotations({bool:{isProgressiveJpeg:!0},string:{mediaType:"preview",fullSizeMediaType:i.serverMediaType},int:{mediaEntrySize:i.size}}),u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Starting progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_start");var b=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?l.scanLengths.length-1:l.scanLengths.length,v=Math.min(p(l.scanLengths,y),b);yield c(r);var S=yield o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({directPath:f,eventFlow:C,fileEncSha256:g,mediaKey:h,mediaTypeDetails:{mediaType:a,type:"regular"},progressiveJpegDetails:l,plaintextHash:r,targetScan:v,size:y});if(!S.success)return d(r,S.error),C.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:S.error}}),o("WAResultOrError").makeError("pjpeg-failed");var R=S.value;return u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finished progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_end"),C.endSuccess(),o("WAResultOrError").makeResult(R)}),m.apply(this,arguments)}function p(e,t){var n=o("WAGlobals").getConfig().jpegThumbnailTargetByteSizeKB()*1024,r=o("WAProgressiveJpegGetTargetScanLengthForBytes").getTargetScanBasedOnByteSize(e,n);return(t==null||t===0)&&(r=Math.min(r,e.length-1)),r=Math.max(r,c),r}function _(e){var t=e.abortSignal,n=e.hash,r=e.serverMediaType,a=e.mediaEntry,i=e.progressiveJpegDetails,l=e.mediaDownloadFlow,s=a.directPath,u=a.fileEncSha256,c=a.mediaKey,d=a.size,m=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?i.scanLengths.length-1:i.scanLengths.length,_=Math.min(p(i.scanLengths,d),m);return o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({abortSignal:t,directPath:s,fileEncSha256:u,mediaKey:c,mediaTypeDetails:{mediaType:r,type:"regular"},progressiveJpegDetails:i,plaintextHash:n,targetScan:_,size:d,eventFlow:l})}l.maybeDownloadProgressiveJpegPreview=d,l.getPreviewTargetScan=p,l.maybeDownloadProgressiveJpegPreviewV2=_}),98);
__d("WAIsMediaExpiredError",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){switch(t){case"signature-expired":return!0;case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return!1;default:return!0}};i.isMediaExpiredError=e}),66);
__d("WAGetKaleidoscopeWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("33861")),s=function(){return o("WAWasmModuleCache").loadWasmModule(e)};l.getKaleidoscopeWasm=s}),98);
__d("WAMediaUtilsWasmUrl",["bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("237"));l.WAMediaUtilsWasmUrl=e}),98);
__d("WAPreloadWamediaUtilsWasm",["WAMediaUtilsWasmUrl","WAWasmModuleCache"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.preloadWamediaUtilsWasm=e}),98);
__d("WAPreloadWebpCheckWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("6946")),s=function(){o("WAWasmModuleCache").loadWasmModule(e)};l.preloadWebpCheckWasm=s}),98);
__d("WAPrewarmMediaValidate",["WAGetKaleidoscopeWasm","WALogger","WAPreloadWamediaUtilsWasm","WAPreloadWebpCheckWasm","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){if(r("gkx")("3272")){o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm().catch(function(t){var n=r("getErrorSafe")(t);o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["prewarm Kaleidoscop wasm failed with error: ",""])),n.message)});return}if(t==null){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["prewarmMediaValidate: serverMediaType is null"])));return}(t==="sticker"||t==="image")&&o("WAPreloadWebpCheckWasm").preloadWebpCheckWasm(),(t==="video"||t==="audio")&&o("WAPreloadWamediaUtilsWasm").preloadWamediaUtilsWasm()}l.prewarmMediaValidate=u}),98);
__d("WAMediaManagerPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAPrewarmMediaValidate","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=0;function d(t){var r,a=t.hash,i=t.logger,l=t.mediaDownloadFlow,d=t.mediaEntry,m=d.directPath,p=d.downloadableThumbnail,_=d.mediaKeyTimestamp,f=d.serverMediaType,g=d.size;o("WAPrewarmMediaValidate").prewarmMediaValidate(f);var h=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(_);i.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start download ",". entry: "," mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(a),l.downloadEntry,h,g,f);var y=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(d).value)!=null?r:null;return l.addPoint("wa_protocol_media_download_start",{bool:{duplicateDirectPath:(p==null?void 0:p.directPath)===m,hasDownloadableThumbnail:(p==null?void 0:p.directPath)!=null,isProgressiveJpeg:y!=null},string:{mediaKeyTimestampAgeBucket:h,mediaType:f}}),{logDownloadResult:function(t){return c++,l.addAnnotations({int:{concurrentDownloadCount:c}}),t.then(function(e){if(e.success){var t=e.value.validatedResult.validatedPlaintext.byteLength;l.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){c--})}}}l.mediaManagerPrepareMediaDownload=d}),98);
__d("WAIsMp4",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.length<8?!1:e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112}i.isMp4=e}),66);
__d("WAIsWebP",[],(function(t,n,r,o,a,i){"use strict";function e(e){return!(e.length<12||e[0]!==82||e[1]!==73||e[2]!==70||e[3]!==70||e[8]!==87||e[9]!==69||e[10]!==66||e[11]!==80)}i.isWebP=e}),66);
__d("WAKaleidoscopeLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return r("FBLogger")("wmi").tags(["Kaleidoscope"])};l.ksLogger=e}),98);
__d("WAKaleidoscopeCheck",["WAGetKaleidoscopeWasm","WAKaleidoscopeLogger","WAResultOrError","WASI","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_="input",f="output",g="/"+_,h="/"+f;function y(e){var t,n=e.input,r=e.stdout,o=e.stderr,a=e.rawMimeType,i=e.mediaType;return{args:["kaleidoscope","check","--json-report="+f,"--mimetype-hint="+a,_],fs:(t={},t[g]={path:g,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(n)},t[h]={path:h,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},t),stdout:r,stderr:o,moduleName:"WAKaleidoscopeCheck_CLI"}}function C(t){var a=t.getWasmModule;return(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,i,l,_,f=t.input,g=t.rawMimeType,C=t.mediaType,b=o("WASI").createWasi(y({input:f,rawMimeType:g,mediaType:C,stderr:function(n){o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),n)},stdout:function(t){o("WAKaleidoscopeLogger").ksLogger().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)}})),v=b.getImportObject,S=b.start,R=yield a(),L=yield WebAssembly.instantiate(R,v()),E=S(L),k=E.exitCode,I=E.fs;if(k!==0)return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with exit code ",""])),k),o("WAResultOrError").makeError("wasm-runtime-error");var T=(n=I[h])==null?void 0:n.content;if(typeof T!="string")return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed invalid result type"]))),o("WAResultOrError").makeError("wasm-result-not-json");var D={};try{D=JSON.parse(T)}catch(e){return o("WAKaleidoscopeLogger").ksLogger().catching(r("getErrorSafe")(e)).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed to parse JSON"]))),o("WAResultOrError").makeError("wasm-invalid-json")}return typeof((i=D)==null?void 0:i.score)!="number"?(o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck score is null"]))),o("WAResultOrError").makeError("wasm-invalid-json")):(o("WAKaleidoscopeLogger").ksLogger().DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck called with rawMimeType: ",", mediaType: ",""])),g,C),o("WAResultOrError").makeResult({mimetype:((l=D)==null?void 0:l.mimetype)||"application/octet-stream",extension:((_=D)==null?void 0:_.extension)||null,score:D.score}))});function i(e){return t.apply(this,arguments)}return i})()}var b=C({getWasmModule:o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm});l.kaleidoscopeCheck=b}),98);
__d("WAMp4Check",["WAMediaUtilsWasmUrl","WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="output",u="/"+e,c="/"+s;function d(t){var n,r=t.input,o=t.stdout,a=t.stderr;return{args:["wamediautil","mp4check","--error-tolerance=2","--json-report="+s,e],fs:(n={},n[u]={path:u,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n[c]={path:c,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},n),stdout:o,stderr:a,moduleName:"WAMp4Check_CLI"}}function m(e){var t=e.getWasmModule,r=e.logError,a=e.logMessage;return(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n,i,l,s,u,m,p,_,f,g,h,y,C,b=e.input,v=o("WASI").createWasi(d({input:b,stderr:r,stdout:a})),S=v.getImportObject,R=v.start,L=yield t(),E=yield WebAssembly.instantiate(L,S()),k=R(E),I=k.exitCode,T=k.fs;if(I!==0)return r("mp4Check failed with exit code "+I),o("WAResultOrError").makeError("invalid-media");var D=(n=T[c])==null?void 0:n.content;if(typeof D!="string")return r("mp4check failed invalid result type"),o("WAResultOrError").makeError("runtime-error");var x=(i=JSON.parse(D))!=null?i:{};return o("WAResultOrError").makeResult({videoStreamReport:(x==null?void 0:x.video_stream_report)==null?null:{streamType:(l=x.video_stream_report)==null?void 0:l.stream_type,calculatedFps:(s=x.video_stream_report)==null?void 0:s.calculated_fps,nominalFps:(u=x.video_stream_report)==null?void 0:u.nominal_fps,videoWidth:(m=x.video_stream_report)==null?void 0:m.video_width,videoHeight:(p=x.video_stream_report)==null?void 0:p.video_height,duration:(_=x.video_stream_report)==null?void 0:_.duration,avgBitsPerSecond:(f=x.video_stream_report)==null?void 0:f.avg_bits_per_second},audioStreamReport:(x==null?void 0:x.audio_stream_report)==null?null:{streamType:(g=x.audio_stream_report)==null?void 0:g.stream_type,samplingRate:(h=x.audio_stream_report)==null?void 0:h.sampling_rate,numberOfChannels:(y=x.audio_stream_report)==null?void 0:y.number_of_channels,avgBitsPerSecond:(C=x.audio_stream_report)==null?void 0:C.avg_bits_per_second}})});function i(t){return e.apply(this,arguments)}return i})()}var p=function(){return o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.createMp4Check=m,l.getMp4CheckWasm=p}),98);
__d("WAParseWav",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=new DataView(e);return e.byteLength<44||t.getUint32(0)!==1380533830||t.getUint32(8)!==1463899717?null:e}function l(e){var t=new DataView(e),n=t.getUint16(22,!0),r=t.getUint32(24,!0);return{numChannels:n,sampleRate:r}}i.validateWav=e,i.parseWav=l}),66);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime","bx"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="/"+e;function u(t){var n,r=t.input,o=t.stdout,a=t.stderr;return{args:["webpcheck",e],fs:(n={},n[s]={path:s,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n),stdout:o,stderr:a,moduleName:"WAWebPCheck_CLI"}}function c(e){var t=e.getWasmModule,r=e.logError,a=e.logMessage;return(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e.input,i=o("WASI").createWasi(u({input:n,stderr:r,stdout:a})),l=i.getImportObject,s=i.start,c=yield t(),d=yield WebAssembly.instantiate(c,l()),m=s(d),p=m.exitCode;return p!==0?(r("WebPCheck failed with exit code "+p),o("WAResultOrError").makeError("invalid-media")):o("WAResultOrError").makeResult()});function i(t){return e.apply(this,arguments)}return i})()}var d=r("bx").getURL(r("bx")("6946")),m=function(){return o("WAWasmModuleCache").loadWasmModule(d)};l.createWebPCheck=c,l.getWebpCheckWasm=m}),98);
__d("WAValidateMedia",["FBLogger","Promise","WAIsMp4","WAIsOgg","WAIsWebP","WAKaleidoscopeCheck","WAMp4Check","WAParseWav","WAResultOrError","WAWebPCheck","asyncToGeneratorRuntime","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=function(){return r("FBLogger")("wmi").tags(["WAValidateMedia"])};function p(t,n){return n.addPoint("media_validation_start"),(r("gkx")("3272")?_(t):g(t)).then(function(e){return e.success?n.addPoint("media_validation_end",{bool:{is_validation_setup_failed:e.value.validationSetupFailed,is_validation_skipped:e.value.skipValidation},string:{validated_mime_type:e.value.mimeType}}):n.addPoint("media_validation_fail",{string:{validationError:e.error}}),e}).catch(function(a){var i=r("getErrorSafe")(a);return m().catching(i).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["validateMedia threw an exception: ",""])),i.message),n.addPoint("media_validation_fail",{string:{validationError:i.message}}),o("WAResultOrError").makeResult({skipValidation:!0,mimeType:null,validatedPlaintext:t,validationSetupFailed:!0})})}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAKaleidoscopeCheck").kaleidoscopeCheck({input:e,rawMimeType:"application/octet-stream",mediaType:"unknown"});if(!t.success)return m().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with error: ",""])),t.error),o("WAResultOrError").makeError("runtime-error");var n=t.value,r=n.score,a=n.mimetype;return r>=80?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:a,validatedPlaintext:e,validationSetupFailed:!1,isKaleidoscopeCheck:!0})}),f.apply(this,arguments)}function g(e){var t=new Uint8Array(e);if(o("WAIsWebP").isWebP(t))return C(e);if(o("WAIsMp4").isMp4(t))return v(e);if(o("WAIsOgg").isOgg(t))return(d||(d=n("Promise"))).resolve(o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/ogg",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:null}));var r=o("WAParseWav").validateWav(e);return r!=null?(d||(d=n("Promise"))).resolve(R(r)):(d||(d=n("Promise"))).resolve(o("WAResultOrError").makeResult({mimeType:null,skipValidation:!0,validatedPlaintext:e,validationSetupFailed:!1}))}var h=function(t){t!==""&&m().WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)},y=function(t){t!==""&&m().DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)};function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAWebPCheck").createWebPCheck({getWasmModule:o("WAWebPCheck").getWebpCheckWasm,logError:h,logMessage:y}),n=yield t({input:e});return n.success?o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:e,validationSetupFailed:!1}):n}),b.apply(this,arguments)}function v(e){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WAMp4Check").createMp4Check({getWasmModule:o("WAMp4Check").getMp4CheckWasm,logError:h,logMessage:y}),n=yield t({input:e});if(!n.success)return o("WAResultOrError").makeError(n.error);var r=n.value,a=r.videoStreamReport,i=r.audioStreamReport;return a==null?i==null?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/mp4",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:i}):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:e,validationSetupFailed:!1,videoStreamReport:a,audioStreamReport:i})}),S.apply(this,arguments)}function R(e){var t=o("WAParseWav").parseWav(e),n=t.numChannels,r=t.sampleRate;return o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/wav",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:{streamType:"LPCM",samplingRate:r,numberOfChannels:n}})}l.validateMedia=p}),98);
__d("WADownloadFullSizeOnlyTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","Promise","WADownloadMedia","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAResultOrError","WAValidateMedia","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,r=e.dbCallbacks,a=e.fullSizePlaintextHash,i=e.logger,l=e.mediaDownloadFlow;l.addPoint("get_media_entries_start");var s=yield r.getMediaEntries(a);if(!s.success)return l.addPoint("get_media_entries_fail"),{fullsizePromise:(c||(c=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry"))};var u=s.value;l.addPoint("get_media_entries_end");var d=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(u);if(!d.success)return{fullsizePromise:(c||(c=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry"))};var m=d.value,_=m[0],f=m[1],g=o("WAMediaUtils").validateDecodedMediaEntryForDownload(f);if(!g.success)return{fullsizePromise:(c||(c=n("Promise"))).resolve(g)};var h=g.value,y=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:a,logger:i,mediaDownloadFlow:l,mediaEntry:h}),C=y.logDownloadResult,b=p({abortSignal:t,dbCallbacks:r,logger:i,mediaDownloadFlow:l,mediaEntries:u,msgIdOfRecentMediaEntry:_,recentMediaEntry:h}).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!e.success)return e;var t=yield o("WAValidateMedia").validateMedia(e.value.plaintext,l);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[_,h],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return function(t){return e.apply(this,arguments)}})());return{fullsizePromise:C(b)}}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.abortSignal,a=t.dbCallbacks,i=t.logger,l=t.mediaDownloadFlow,c=t.mediaEntries,d=t.msgIdOfRecentMediaEntry,m=t.recentMediaEntry,p=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");p&&l.addPoint("forcing_eb_download");var _=p?o("WAResultOrError").makeError("signature-expired"):yield o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:l,mediaEntry:m});if(_.success||!o("WAIsMediaExpiredError").isMediaExpiredError(_.error)||!r("MAWEBSwitch").isEnabled())return _;var f=yield a.getProtocolMsgIdAndSortOrderMs(d);if(f==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var g=f.protocolMsgId,h=f.sortOrderMs,y=m,C=d,b=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(y.serverMediaType);if(b==null||y.objectId==null)return i.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),_.error),_;var v=yield o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:y.objectId,logger:i,mediaDownloadFlow:l,mediaKey:y.mediaKey,mediaType:b,msgId:C,protocolMsgId:g,sortOrderMs:h});if(!v.success)return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed: ",""])),v.error),v;var S=yield o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},y,{directPath:v.value})});return S.success?o("WAResultOrError").makeResult(S.value):(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),S.error),S)}),_.apply(this,arguments)}l.startDownloadFullSizeTask=d,l.downloadOrRestoreFullSize=p}),98);
__d("WADownloadMediaPreviewV2",["WADownloadMedia","WADownloadProgressiveJpegPreview","WAMediaCrypto","WAMediaUtils","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.abortSignal,r=t.hash,a=t.mediaEntry,i=t.progressiveJpegDetails,l=t.mediaDownloadFlow,s=t.logger,u=a.serverMediaType,c=o("WAMediaUtils").getMimeTypeFromServerMediaType(u),d=i==null?o("WAResultOrError").makeError("jpeg-stream-not-supported"):yield o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreviewV2({abortSignal:n,hash:r,serverMediaType:u,mediaEntry:a,progressiveJpegDetails:i,mediaDownloadFlow:l});if(d.success===!0)return o("WAResultOrError").makeResult({plaintext:d.value,mimeType:c,serverMediaType:u});l.addPoint("fallback_to_downloadable_thumbnail");var m=a.downloadableThumbnail;if((m==null?void 0:m.directPath)==null)return o("WAResultOrError").makeError("media-not-found");var p=o("WAMediaUtils").validateDownloadableThumbnailForDownload(m);if(p.success===!1)return s.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["preview mediaEntry is incomplete: ",""])),p.error),o("WAResultOrError").makeError(p.error[0]);var _=p.value,f=_.directPath,g=_.fileEncSha256,h=_.fileSha256,y=_.mediaKey,C=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(u);if(C==null)return o("WAResultOrError").makeError("request-error");var b=yield o("WADownloadMedia").downloadMediaImpl({abortSignal:n,downloadFlow:l,mediaTypeDetails:{messageType:C,type:"preview"},directPath:f,fileEncSha256:g,fileSha256:h,mediaKey:y});return b.success===!1?b:o("WAResultOrError").makeResult({plaintext:b.value,mimeType:c,serverMediaType:u})}),u.apply(this,arguments)}l.downloadMediaPreview=s}),98);
__d("WAIsPreviewSupported",["$InternalEnum","WAProgressiveJpegGetPJpegDetails"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum").Mirrored(["NO","YES"]),s=n("$InternalEnum").Mirrored(["NO","YES","DuplicatedWithFullSize"]);function u(t){var n=t.serverMediaType;switch(n){case"image":{var r,a,i=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(t).value)!=null?r:null,l=i!=null?e.YES:e.NO;if(((a=t.downloadableThumbnail)==null?void 0:a.directPath)==null)return[l,s.NO];t.downloadableThumbnail.directPath;var u=t.downloadableThumbnail.directPath===t.directPath?s.DuplicatedWithFullSize:s.YES;return[l,u]}case"video":{var c;if(((c=t.downloadableThumbnail)==null?void 0:c.directPath)==null)return[e.NO,s.NO];t.downloadableThumbnail.directPath;var d=t.downloadableThumbnail.directPath===t.directPath?s.NO:s.YES;return[e.NO,d]}case"sticker":case"ptt":case"audio":case"document":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"template":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"novi-video":case"novi-image":case"payment-bg-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-music-artwork":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-sticker-pack":case"newsletter-thumbnail-link":case"newsletter-video":case"newsletter-ptv":case"sticker-pack":case"thumbnail-sticker-pack":case"music-artwork":case"group-history":case"ads-image":case"ads-video":case"ptv":return[e.NO,s.NO];default:return[e.NO,s.NO]}}l.PjpegPreviewSupport=e,l.DownloadablePreviewSupport=s,l.checkPreviewSupport=u}),98);
__d("WADownloadPreviewOnlyTask",["EncryptedBackupsResignCdnUrl","MAWEBSwitch","Promise","WADownloadMediaPreviewV2","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAValidateMedia","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,r=e.dbCallbacks,a=e.fullSizePlaintextHash,i=e.logger,l=e.mediaDownloadFlow;l.addPoint("get_media_entries_start");var s=yield r.getMediaEntries(a);if(!s.success)return l.addPoint("get_media_entries_fail"),{previewPromise:(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry"))};l.addPoint("get_media_entries_end");var c=s.value,d=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(c);if(!d.success)return{previewPromise:(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry"))};var p=d.value,_=p[0],f=p[1],g=o("WAMediaUtils").validateDecodedMediaEntryForDownload(f);if(!g.success)return{previewPromise:(u||(u=n("Promise"))).resolve(g)};var h=g.value,y=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:a,logger:i,mediaDownloadFlow:l,mediaEntry:h}),C=y.logDownloadResult,b=m({abortSignal:t,dbCallbacks:r,fullSizePlaintextHash:a,logger:i,mediaDownloadFlow:l,mediaEntries:s.value,msgIdOfRecentMediaEntry:_,recentMediaEntry:h}).then((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!e.success)return e;var t=yield o("WAValidateMedia").validateMedia(e.value.plaintext,l);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[_,h],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return function(t){return e.apply(this,arguments)}})());return{previewPromise:C(b)}}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a,i=t.abortSignal,l=t.dbCallbacks,c=t.fullSizePlaintextHash,d=t.logger,m=t.mediaDownloadFlow,p=t.mediaEntries,_=t.msgIdOfRecentMediaEntry,f=t.recentMediaEntry,g=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");g&&m.addPoint("forcing_eb_download");var h=o("WAIsPreviewSupported").checkPreviewSupport(f),y=h[0],C=h[1];if(y===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&C===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return o("WAResultOrError").makeError("preview-not-supported");var b=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(f),v=b.success===!0?b.value:null,S={abortSignal:i,hash:c,logger:d,mediaDownloadFlow:m,progressiveJpegDetails:v};m.addPoint("download_preview_start",{string:{preview_downloadable_support:C,preview_pjpeg_support:y}});var R=g?o("WAResultOrError").makeError("signature-expired"):yield o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},S,{mediaEntry:f}));if(R.success)return m.addPoint("download_preview_end"),o("WAResultOrError").makeResult({mimeType:R.value.mimeType,plaintext:R.value.plaintext,serverMediaType:R.value.serverMediaType});if(m.addPoint("download_preview_fail"),!o("WAIsMediaExpiredError").isMediaExpiredError(R.error)||!r("MAWEBSwitch").isEnabled()||r("gkx")("1327")!==!0)return R;var L=yield l.getProtocolMsgIdAndSortOrderMs(_);if(L==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var E=L.protocolMsgId,k=L.sortOrderMs,I=f,T=_,D=C===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO||((a=I.downloadableThumbnail)==null?void 0:a.objectId)==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:I.downloadableThumbnail.objectId,logger:d,mediaDownloadFlow:m,mediaKey:I.mediaKey,mediaType:"preview",msgId:T,protocolMsgId:E,sortOrderMs:k}),x=y===o("WAIsPreviewSupported").PjpegPreviewSupport.NO||I.objectId==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:I.objectId,logger:d,mediaDownloadFlow:m,mediaKey:I.mediaKey,mediaType:"image",msgId:T,protocolMsgId:E,sortOrderMs:k}),$=yield(u||(u=n("Promise"))).all([D,x]),P=$[0],N=$[1];if((P==null?void 0:P.success)!==!0&&(N==null?void 0:N.success)!==!0){var M;return d.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed. downloadableThumbnail error: ",". pjpegPreview error: ",""])),P==null?void 0:P.error,N==null?void 0:N.error),(M=N!=null?N:P)!=null?M:o("WAResultOrError").makeError("preview-not-supported")}m.addPoint("second_download_preview_start");var w=yield o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},S,{mediaDownloadFlow:babelHelpers.extends({},m,{addPoint:function(t,n){m.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},I,{directPath:(N==null?void 0:N.success)===!0?N.value:I.directPath,downloadableThumbnail:I.downloadableThumbnail==null?null:babelHelpers.extends({},I.downloadableThumbnail,{directPath:(P==null?void 0:P.success)===!0?P.value:I.downloadableThumbnail.directPath})})}));return w.success?(m.addPoint("second_download_preview_end"),o("WAResultOrError").makeResult({mimeType:w.value.mimeType,plaintext:w.value.plaintext,serverMediaType:w.value.serverMediaType})):(d.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),w.error),m.addPoint("second_download_preview_fail"),w)}),p.apply(this,arguments)}l.startDownloadPreviewTask=c,l.downloadOrRestorePreviewOnly=m}),98);
__d("WADownloadProgressiveJpegUsingMediaStreaming",["WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAMediaUtils","WAProgressiveJpegAddJPEGTrailingTag","WAResolvable","WAResultOrError","WAStreamAsyncIterator","WATypedArraysConcat","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.abortSignal,r=t.directPath,a=t.downloadFlow,i=t.fileEncSha256,l=t.fileSha256,m=t.logger,p=t.mediaKey,_=t.progressiveJpegDetails,f=t.serverMediaType,g=m.TAGS(["MediaStreaming"]);g.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg."]))),a.addPoint("create_pjpeg_stream_start");var y=yield o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({abortSignal:n,directPath:r,eventFlow:a,fileEncSha256:i,mediaKey:p,progressiveJpegDetails:_,serverMediaType:f}).catch(function(e){return g.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["create DownloadAndDecryptPJpegStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(y.success===!1)return a.addPoint("create_pjpeg_stream_fail"),y;a.addPoint("create_pjpeg_stream_end");var C=new(o("WAResolvable")).Resolvable,b=!1,v=h({downloadFlow:a,fileSha256:l,mediaStreamingLogger:g,previewResolvable:C,progressiveJpegDetails:_,progressiveJpegDownloadStream:y.value,serverMediaType:f}).then(function(e){return b=!0,g.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream completed"]))),e}).catch(function(e){return b=!0,g.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),C.reject(e),o("WAResultOrError").makeError("runtime-error")}),S=o("WAMediaUtils").getMimeTypeFromServerMediaType(f);function R(e){return e.success===!1?e:o("WAResultOrError").makeResult({mimeType:S,plaintext:e.value,serverMediaType:f})}var L=v.then(R),E=C.promise.then(R),k=yield C.promise;if(k.success===!0&&b===!0&&g.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["fullsizeResolvable is settled before previewResolvable"]))),k.success===!0)return o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E});var I=yield v;return k.success,I.success===!0?o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E}):(I.success,I)}),g.apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.downloadFlow,n=e.fileSha256,r=e.mediaStreamingLogger,a=e.previewResolvable,i=e.progressiveJpegDetails,l=e.progressiveJpegDownloadStream;t.addPoint("download_pjpeg_preview_start");var s=0,u=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(i.scanLengths)-1;try{var c=[],d=!1,f=!1,g;try{for(var h=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(l)),y;d=!(y=yield h.next()).done;d=!1){var C=y.value;{if(C==null)continue;if(c.push(C),s===u){t.addPoint("media_streaming_preview_processed");var b=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));a.resolve(o("WAResultOrError").makeResult(b)),t.addPoint("download_pjpeg_preview_end")}s++}}}catch(e){f=!0,g=e}finally{try{d&&h.return!=null&&(yield h.return())}finally{if(f)throw g}}a.isSettled===!1&&(r.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex"]))),a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail"));var v=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c))),S=yield o("WACryptoSha256").sha256(v);return o("WACryptoUtils").arrayBuffersEqual(n,S)?o("WAResultOrError").makeResult(v):(r.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch."]))),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return r.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),a.isSettled===!1&&(a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail")),o("WAResultOrError").makeError("runtime-error")}}),y.apply(this,arguments)}l.downloadProgresiveJpegUsingMediaStreaming=f}),98);
__d("WADownloadFullSizeAndPreviewTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","Promise","UserAgent","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WADownloadProgressiveJpegUsingMediaStreaming","WAErrorMessage","WAFindMostRecentMediaEntry","WAHashUtils","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow","WAValidateMedia","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y;function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,r=e.dbCallbacks,a=e.fullSizePlaintextHash,i=e.logger,l=e.mediaDownloadFlow;l.addPoint("get_media_entries_start");var s=yield r.getMediaEntries(a);if(!s.success)return l.addPoint("get_media_entries_fail"),{fullsizePromise:(y||(y=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:y.resolve(o("WAResultOrError").makeError("missing-media-entry"))};l.addPoint("get_media_entries_end");var m=s.value,p=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(m);if(!p.success)return{fullsizePromise:(y||(y=n("Promise"))).resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:y.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var _=p.value,f=_[0],g=_[1],h=o("WAMediaUtils").validateDecodedMediaEntryForDownload(g);return h.success?R({abortSignal:t,dbCallbacks:r,fullSizePlaintextHash:a,logger:i,mediaDownloadFlow:l,mediaEntries:m,msgIdOfRecentMediaEntry:f,recentMediaEntry:h.value}).then(function(e){return i.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["outter promise: ",""])),e.success===!0?"success":e.error),e.success?e.value:(i.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["outter promise failed: ",""])),e.error),{fullsizePromise:(y||(y=n("Promise"))).resolve(e),previewPromise:y.resolve(e)})}):(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaEntry for download: ",""])),h.error),{fullsizePromise:(y||(y=n("Promise"))).resolve(h),previewPromise:y.resolve(h)})}),b.apply(this,arguments)}function v(e,t,n){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){var a=yield e;if(!a.success)return(y||(y=n("Promise"))).resolve(a);var i=yield o("WAValidateMedia").validateMedia(a.value.plaintext,r);return i.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:t,serverMediaType:a.value.serverMediaType,unvalidatedMimeType:a.value.mimeType,validatedResult:i.value}):i}),S.apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow,l=e.mediaEntries,s=e.msgIdOfRecentMediaEntry,u=e.recentMediaEntry,c=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:u}),d=c.logDownloadResult,p={abortSignal:t,dbCallbacks:n,logger:a,mediaDownloadFlow:i,mediaEntries:l,msgIdOfRecentMediaEntry:s,recentMediaEntry:u},_=yield E(babelHelpers.extends({},p,{fullSizePlaintextHash:r}));if(_.success){var f=_.value,g=f.fullsizePromise,h=f.previewPromise,y=g.then(function(e){return e.success?e:(i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:e.error}}),o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p))}),C=[s,u];return o("WAResultOrError").makeResult({fullsizePromise:d(v(y,C,i)),previewPromise:v(h,C,i)})}var b=D(_.error);if(!b.shouldFallback)return o("WAResultOrError").makeError(b.error);i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:b.error}}),a.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["fallback to non-streaming download"])));var S=v(o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p),[s,u],i),R=I(babelHelpers.extends({},p,{fullSizePlaintextHash:r,fullsizePromise:S}));return o("WAResultOrError").makeResult({fullsizePromise:d(S),previewPromise:R})}),L.apply(this,arguments)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=e.abortSignal,a=e.dbCallbacks,i=e.logger,l=e.mediaDownloadFlow,s=e.mediaEntries,u=e.msgIdOfRecentMediaEntry,c=e.recentMediaEntry,d=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");d&&l.addPoint("forcing_eb_download");var m=c.directPath,y=c.fileEncSha256,C=c.fileSha256,b=c.mediaKey,v=c.serverMediaType,S=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(c).value)!=null?t:null;if(S==null||c.serverMediaType!=="image"||!o("WAMediaUtils").isTransformStreamSupported()||r("UserAgent").isBrowser("Safari < 18")||r("UserAgent").isBrowser("Mobile Safari < 18"))return c.serverMediaType==="image"&&S==null&&(i.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["skip pjpeg streaming because pjpeg metadata is null"]))),i.DEV(_||(_=babelHelpers.taggedTemplateLiteralLoose(["media entry: ",""])),c)),o("WAResultOrError").makeError("jpeg-stream-not-supported");l.addPoint("media_streaming_start");var R=d?o("WAResultOrError").makeError("signature-expired"):yield o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:m,downloadFlow:l,fileEncSha256:y,fileSha256:C,logger:i,mediaKey:b,progressiveJpegDetails:S,serverMediaType:v}).catch(function(e){return i.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(R.success)return l.addPoint("media_streaming_end"),R;if(!o("WAIsMediaExpiredError").isMediaExpiredError(R.error)||!r("MAWEBSwitch").isEnabled())return T(l,R),R;var L=yield a.getProtocolMsgIdAndSortOrderMs(u);if(L==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var E=L.protocolMsgId,k=L.sortOrderMs,I=c,D=u,x=I.fileEncSha256,$=I.fileSha256,P=I.mediaKey,N=I.serverMediaType,M=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(N);if(M==null||I.objectId==null)return i.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),R.error),R;var w=yield o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:I.objectId,logger:i,mediaDownloadFlow:l,mediaKey:I.mediaKey,mediaType:M,msgId:D,protocolMsgId:E,sortOrderMs:k});if(!w.success)return w;l.addPoint("second_media_streaming_start");var A=yield o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:w.value,downloadFlow:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),fileEncSha256:x,fileSha256:$,logger:i,mediaKey:P,progressiveJpegDetails:S,serverMediaType:N}).catch(function(e){return i.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});return A.success?(l.addPoint("second_media_streaming_end"),A):(T(l,A),A)}),k.apply(this,arguments)}function I(t){var r=t.abortSignal,a=t.dbCallbacks,i=t.fullSizePlaintextHash,l=t.fullsizePromise,u=t.logger,c=t.mediaDownloadFlow,d=t.mediaEntries,m=t.msgIdOfRecentMediaEntry,p=t.recentMediaEntry,_=p.serverMediaType,f=o("WAIsPreviewSupported").checkPreviewSupport(p),g=f[0],h=f[1];if(g===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&h===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["preview not supported"]))),(y||(y=n("Promise"))).resolve(o("WAResultOrError").makeError("preview-not-supported"));if(h===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["preview duplicated with fullsize"]))),l;var C=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:c.downloadEntry,isPreview:!0,msgType:null,protocolMsgId:null,triggerUIView:null}),b=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:i,logger:u,mediaDownloadFlow:C,mediaEntry:p}),S=b.logDownloadResult;C.addAnnotations({bool:{isMediaManager:!0},string:{downloadKind:"fullsizeAndPreview",fullSizeMediaType:_,mediaType:"preview",sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(i)}});var R=o("WADownloadPreviewOnlyTask").downloadOrRestorePreviewOnly({abortSignal:r,dbCallbacks:a,fullSizePlaintextHash:i,logger:u,mediaDownloadFlow:C,mediaEntries:d,msgIdOfRecentMediaEntry:m,recentMediaEntry:p});return S(v(R,[m,p],C)).then(function(e){return e.success?C.endSuccess():C.endFail(e.error,{string:{failReason:e.error}}),e}).catch(function(e){return C.endFail("runtime-error",{string:{failReason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("runtime-error")})}function T(e,t){e.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(t.error)}})}function D(e){switch(e){case"runtime-error":case"jpeg-stream-not-supported":return{error:e,shouldFallback:!0};case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return{error:e,shouldFallback:!0};case"missing-media-entry":case"missing-media-entry-for-restore":case"missing-sort-order-ms-for-restore":case"preview-not-supported":return{error:e,shouldFallback:!1};case"derive-primary-key-secret-error":case"derive-access-token-secret-error":case"direct-path-undefined":case"direct-path-corrupted":case"direct-path-empty":case"create-payload-failed":case"resign-cdn-url-request-error":case"resign-cdn-url-runtime-error":case"resign-cdn-url-timeout":case"resign-cdn-url-gql-error":return{error:e,shouldFallback:!1};case"invalid-media":return{error:e,shouldFallback:!1};case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":return{error:e,shouldFallback:!0};case"access-expired":case"disconnected":case"backoff":case"body-network-error":case"http-fetch-exception":case"http-fetch-aborted":case"no-host":case"server-timeout":case"unspecified-http-error":case"media-not-found":case"download-throttled":case"request-error":case"max-attempts-exceeded":case"signature-expired":case"media-entry-invalid":return{error:e,shouldFallback:!1};case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":return{error:e,shouldFallback:!1}}}l.startDownloadFullSizeAndPreviewTask=C}),98);
__d("WAMediaManagerLogger",["WAHashUtils","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WATagsLogger").TAGS(["MediaManager"]);function s(t){var n=t.downloadKind,r=t.fullSizePlaintextHash,a=e.TAGS(["download","hash:"+o("WAHashUtils").sanitisePlaintextHash(r),n]);return a}function u(t){var n=t.plaintextHash,r=t.uploadKind,a=e.TAGS(["upload","hash:"+o("WAHashUtils").sanitisePlaintextHash(n),r]);return a}l.baseLogger=e,l.createDownloadLogger=s,l.createUploadLogger=u}),98);
__d("WAMediaManagerTypes",["WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.success?o("WAResultOrError").makeResult({serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.unvalidatedMimeType,validatedResult:e.value.validatedResult}):e}l.transformInternalMediaDownloadResult=e}),98);
__d("WAMediaManagerWorkerScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("MediaManager",{concurrency:16,maxTaskLimit:32,maxThrottleMs:3e4,timeoutMs:6e4})),e}l.mediaManagerWorkerScheduler=s}),98);
__d("WACreateRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:e},t);if(!n.success)return n;var r=n.value,a=r.selectedHost,i=r.fallbackHost,l=r.authToken,s=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("upload",{host:{domain:a.domain,class:a.class},fallbackHost:i&&{domain:i.domain,class:i.class},authToken:l,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult(s)}),s.apply(this,arguments)}l.createUploadRetrier=e}),98);
__d("WAHttpRegularUploadMedia",["WADirectPath","WALogger","WAResultOrError","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a;try{a=yield fetch(t,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([n])})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""])),t),t}var i=a,l=i.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),l),l){case 200:return a.json().then(function(e){if(!Object.prototype.hasOwnProperty.call(e,"direct_path"))throw r("err")("direct_path not available in wa upload http response");if(typeof e.direct_path!="string")throw r("err")('directPath: "'+e.direct_path+'" is not a string');if(e.object_id&&typeof e.object_id!="string")throw r("err")('objectId: "'+e.object_id+'" is not a string');if(e.handle&&typeof e.handle!="string")throw r("err")('handle: "'+e.handle+'" is not a string');var t={directPath:o("WADirectPath").unsafeCastToDirectPath(e.direct_path),objectId:e.object_id,handle:e.handle};return o("WAResultOrError").makeResult(t)}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 408:return o("WAResultOrError").makeError("server-timeout");case 413:return o("WAResultOrError").makeError("payload-too-large");case 415:return o("WAResultOrError").makeError("invalid-media");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return l>=400&&l<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}),d.apply(this,arguments)}l.httpRegularUploadMedia=c}),98);
__d("WAHttpResumeCheck",["WADirectPath","WALogger","WAMediaUtils","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n;try{n=yield fetch(t,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""])),t),t}var r=n,a=r.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""])),a),a){case 200:return n.json().then(function(e){var t=e.resume,n=e.direct_path,r=e.object_id;if(t==="complete")return n==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: direct_path is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):r==null?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: object_id is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-found",directPath:o("WADirectPath").unsafeCastToDirectPath(n),objectId:o("WAMediaUtils").stringToDeliveryObjectId(r)});var a=parseInt(t,10);return a===0?o("WAResultOrError").makeResult({type:"media-not-found"}):Number.isNaN(a)?(o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: resume is NaN: ",""])),t),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-partial-found",resumeFromBytes:a})}).catch(function(e){return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 404:return o("WAResultOrError").makeResult({type:"media-not-found"});case 408:return o("WAResultOrError").makeError("server-timeout");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return a>=400&&a<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}),_.apply(this,arguments)}l.httpResumeCheck=p}),98);
__d("WAEncryptAndUploadPlaintext",["WABase64","WAErrorMessage","WAGlobals","WAHttpRegularUploadMedia","WAHttpResumeCheck","WALogger","WAMediaCrypto","WAMediaUrl","WAProgressiveJpegGetPJpegDetails","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=t.serverMediaType,a=t.plaintextHash,i=t.plaintext,l=t.mediaKey,f=t.mediaKeyTimestamp,g=t.uploadToken,h=t.uploadRetrier,y=t.mediaUploadFlow,C=t.fromOffset,b=C===void 0?0:C;y.addPoint("encrypt_and_upload_plaintext_start"),y.addPoint("compute_media_keys_start");var v=r==="preview"?yield o("WAMediaCrypto").computeMediaKeysForPreview(l):yield o("WAMediaCrypto").computeMediaKeys(l,r),S=v.iv,R=v.cipherKey,L=v.hmacKey;y.addPoint("compute_media_keys_end"),y.addPoint("encrypt_and_hmac_start");var E=yield o("WAMediaCrypto").encryptAndHmac(R,S,L,i,r),k=E.ciphertext,I=E.ciphertextHash,T=E.sidecar,D=E.ivCiphertextHmac;y.addPoint("encrypt_and_hmac_end");var x=null;if(r==="image"){y.addPoint("get_progressive_jpeg_details_start");var $=yield o("WAProgressiveJpegGetPJpegDetails").getProgressiveJpegDetails(new Uint8Array(i),D,L),P=o("WAProgressiveJpegGetPJpegDetails").isValidProgressiveJpegDetails($);P.success===!1?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Created invalid progressiveJpeg details during encrypt and upload: ",""])),P.error),y.addPoint(P.error)):P.value===!0&&o("WAGlobals").getConfig().isProgressiveJpegSendEnabled()&&(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Found valid progressiveJpeg details. Adding to media entry."]))),x=$,y.addPoint("get_progressive_jpeg_details_end"))}var N={fileSha256:o("WABase64").decodeB64UrlSafe(a),fileEncSha256:I,mediaKey:l,mediaKeyTimestamp:f,serverMediaType:r,uploadToken:g,sidecar:T,progressiveJpegDetails:x,size:i.byteLength,filename:void 0,lastDownloadAttemptTimestamp:void 0,directPath:void 0},M,w=yield h.run((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=e.domain,i=b;if(n>0){y.addPoint("network_retry",{int:{network_retry_attempt:n}});try{y.addPoint("resume_check_start");var l=o("WAMediaUrl").buildUploadUrl(r,g,I,a,t,!0),s=yield o("WAHttpResumeCheck").httpResumeCheck(l);if(s.success){y.addPoint("resume_check_end");var p=s.value;if(p.type==="media-found")return y.addAnnotations({bool:{existingMediaFound:!0}}),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult({directPath:p.directPath,objectId:null,handle:null}));p.type==="media-partial-found"&&(i=p.resumeFromBytes)}y.addPoint("resume_check_fail",{string:{resume_check_error:s.error}})}catch(e){y.addPoint("resume_check_fail",{string:{resume_check_error:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: error during retrier ",""])),e)}}i>0&&i<k.byteLength?(y.addAnnotations({int:{fromOffset:i},bool:{continuedFromOffset:!0}}),M=k.subarray(i)):M=k;var _=o("WAMediaUrl").buildUploadUrl(r,g,I,a,t,!1,i);return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""])),_),y.addPoint("http_upload_start"),o("WAHttpRegularUploadMedia").httpRegularUploadMedia(_,M).then(function(e){if(e.success)return y.addPoint("http_upload_end",{int:{attempt:n}}),o("WAResultOrError").makeResult(e);var t=e.error;switch(y.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),t){case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);return y.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),o("WAResultOrError").makeError({progressMade:!1})})});return function(t,n,r){return e.apply(this,arguments)}})());if(w==null)return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(w.success===!1)return w;var A=w.value,F=A.directPath,O=A.objectId,B=A.handle,W=babelHelpers.extends({},N,{directPath:F,handle:B,objectId:O});o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""])),{directPath:F},{objectId:O});var q="undefined";return O!=null&&(q=O.length>60?"new":"old"),y.addPoint("encrypt_and_upload_plaintext_end",{string:{object_id_type:q}}),o("WAResultOrError").makeResult(W)}),g.apply(this,arguments)}l.encryptAndUploadPlaintext=f}),98);
__d("WAUploadMediaQuick",["WACreateRetrier","WAEncryptAndUploadPlaintext","WAMediaUtils","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.mediaUploadFlow,r=t.plaintext,a=t.plaintextHash,i=t.serverMediaType,l=t.logger;l.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start uploadMediaQuick"]))),n.addPoint("create_upload_retrier_start");var s=yield o("WACreateRetrier").createUploadRetrier(i,n);if(!s.success)return n.addPoint("create_upload_retrier_fail"),s;n.addPoint("create_upload_retrier_end"),n.addPoint("create_media_key_start");var u=o("WAMediaUtils").createMediaKey(),c=o("WAMediaUtils").createUploadToken(),d=o("WATimeUtils").unixTime();n.addPoint("create_media_key_end");var m=yield o("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({mediaKey:u,mediaKeyTimestamp:d,serverMediaType:i,mediaUploadFlow:n,plaintext:r,plaintextHash:a,uploadRetrier:s.value,uploadToken:c});return m}),u.apply(this,arguments)}l.uploadMediaQuick=s}),98);
__d("mapWorkerSchedulerTask",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return babelHelpers.extends({},e,{promise:e.promise.then(t),run:function(){return e.run().then(t)}})}i.mapWorkerSchedulerTask=e}),66);
__d("WAMediaManager",["$InternalEnum","WADownloadFullSizeAndPreviewTask","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WAErrorMessage","WAHashUtils","WAMediaManagerCache","WAMediaManagerLogger","WAMediaManagerTypes","WAMediaManagerWorkerScheduler","WAResultOrError","WAUploadMediaQuick","WorkerScheduler","gkx","mapWorkerSchedulerTask"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=n("$InternalEnum").Mirrored(["HIGH","MEDIUM","LOW"]);function R(){return{fullsizeCache:new Map,previewCache:new Map,uploadCache:new Map}}function L(t){var n=t.createCacheState,a=t.dbCallbacks,i=o("WAMediaManagerWorkerScheduler").mediaManagerWorkerScheduler(),l=o("WAMediaManagerCache").createAttachmentCache(a.getProtocolMsgIdAndSortOrderMs,n),v=function(n){var t=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsize",fullSizePlaintextHash:n.fullSizePlaintextHash}),r=l.getFullsize(n);if(t.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),r.type),r.type==="cache-hit")return r.cache;var c=new AbortController,d=i.task({fn:function(){return o("WADownloadFullSizeOnlyTask").startDownloadFullSizeTask({abortSignal:c.signal,dbCallbacks:a,fullSizePlaintextHash:n.fullSizePlaintextHash,logger:t,mediaDownloadFlow:n.mediaDownloadFlow})},name:"media-manager-download-fullsize-only",priority:E(n.priority)}),m=d.run();return r.setDownloadCache({abortController:c,fullSizePlaintextHash:n.fullSizePlaintextHash,mediaDownloadFlow:n.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(d,function(e){return e.fullsizePromise})}),m.then(function(e){return e.fullsizePromise}).then(function(e){return x(n.fullSizePlaintextHash,e,r.setDownloadedAttachmentToUploadCache)}).catch(function(e){return t.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){t.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},S=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"preview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getPreview(t);if(e.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",""])),n.type),n.type==="cache-hit")return n.cache;var r=new AbortController,s=i.task({fn:function(){return o("WADownloadPreviewOnlyTask").startDownloadPreviewTask({abortSignal:r.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-preview-only",priority:E(t.priority)});n.setDownloadCache({abortController:r,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(s,function(e){return e.previewPromise})});var u=s.run();return u.then(function(e){return e.previewPromise}).then(function(e){return $(e,n.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},R=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsizeAndPreview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getFullsizeAndPreview(t),r=n.fullsizeCacheResult,s=n.previewCacheResult;if(e.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["fullsize: ",", preview: ",""])),r.type,s.type),r.type==="cache-hit"&&s.type==="cache-hit")return{fullsizePromise:r.cache,previewPromise:s.cache};if(s.type==="cache-hit"){var u=v(t);return{fullsizePromise:u,previewPromise:s.cache}}if(r.type==="cache-hit"){var c=S(t);return{fullsizePromise:r.cache,previewPromise:c}}r.type,s.type;var d=new AbortController,m=i.task({fn:function(){return o("WADownloadFullSizeAndPreviewTask").startDownloadFullSizeAndPreviewTask({abortSignal:d.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-fullsize-and-preview",priority:E(t.priority)});r.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.fullsizePromise})}),s.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.previewPromise})});var y=m.run();return{fullsizePromise:y.then(function(e){return e.fullsizePromise}).then(function(e){return x(t.fullSizePlaintextHash,e,r.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["fullsizePromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(f||(f=babelHelpers.taggedTemplateLiteralLoose(["fullsize end"])))}),previewPromise:y.then(function(e){return e.previewPromise}).then(function(e){return $(e,s.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["previewPromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["preview end"])))})}},L=function(t){var e=o("WAMediaManagerLogger").createUploadLogger({plaintextHash:t.plaintextHash,uploadKind:"fullsize"}),n;if(r("gkx")("19103")&&(n=l.getUploadedAttachment(t),e.DEV(y||(y=babelHelpers.taggedTemplateLiteralLoose(["cache result: ",""])),n.type),t.mediaUploadFlow.addAnnotations({string:{dedupe_result:n.type}}),n.type==="in-thread-cache-hit"))return n.cache;var a=o("WAUploadMediaQuick").uploadMediaQuick({logger:e,mediaUploadFlow:t.mediaUploadFlow,plaintext:t.plaintext,plaintextHash:t.plaintextHash,serverMediaType:t.serverMediaType}).catch(function(t){return e.ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(b||(b=babelHelpers.taggedTemplateLiteralLoose(["upload end"])))});return n!=null&&r("gkx")("19103")&&n.setUploadCache({chatJid:t.chatJid,plaintextHash:t.plaintextHash,scheduledTask:a}),a};return{clearCache:l.clearCache,dequeueDownload:l.cancelTask,enqueueDownloadFullSize:T("fullsize",v),enqueueDownloadFullSizeAndPreview:T("fullsizeAndPreview",R),enqueueDownloadPreview:T("preview",S),enqueueUploadFullSize:D(L)}}function E(e){return e===S.HIGH?o("WorkerScheduler").BLOCKING_PRIORITY:e===S.MEDIUM?o("WorkerScheduler").REGULAR_PRIORITY:e===S.LOW?o("WorkerScheduler").BACKGROUND_PRIORITY:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}var k=typeof((v=navigator.storage)==null?void 0:v.getDirectory)=="function",I=typeof self.caches=="object";function T(e,t){return function(n){var r=n.fullSizePlaintextHash,a=n.mediaDownloadFlow;try{a.addPoint("enqueue_start",{bool:{isOPFSSupported:k,isWebCacheSupported:I},string:{downloadKind:e,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var i=t(n);return a.addPoint("enqueue_end"),i}catch(e){throw a.addPoint("enqueue_fail"),e}}}function D(e){return function(t){var n=t.mediaUploadFlow,r=t.plaintextHash;try{n.addPoint("enqueue_start",{string:{sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var a=e(t);return n.addPoint("enqueue_end"),a}catch(e){throw n.addPoint("enqueue_fail"),e}}}function x(e,t,n){if(!t.success)return t;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t);var a=t.value.msgIdAndMediaEntry,i=a[0],l=a[1];return n({mediaEntry:l,msgId:i,plaintextHash:e}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t)}function $(e,t){if(!e.success)return e;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e);var n=e.value.msgIdAndMediaEntry,a=n[0],i=n[1],l=i.downloadableThumbnail;return l==null||l.directPath==null||l.fileEncSha256==null||l.fileSha256==null||l.mediaKey==null||l.mediaKeyTimestamp==null||l.objectId==null||t({mediaEntry:babelHelpers.extends({},i,{directPath:l.directPath,downloadableThumbnail:null,fileSha256:l.fileSha256,mediaKey:l.mediaKey,mediaKeyTimestamp:l.mediaKeyTimestamp,objectId:l.objectId,serverMediaType:"preview",size:e.value.validatedResult.validatedPlaintext.byteLength}),msgId:a,plaintextHash:o("WAHashUtils").toPlaintextHash(l.fileSha256)}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e)}l.MediaTaskPriority=S,l.createCacheState=R,l.createMediaManager=L,l.toWorkerSchedulerPriority=E}),98);
__d("WAMediaManagerCache",["Promise","WAErrorMessage","WAHashUtils","WAMediaManager","WAMediaManagerLogger","WAMediaManagerTypes","WAPromiseDelays","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=["mediaKeyTimestamp","objectId","size"],s,u,c,d,m,p,_,f=3e4,g=1e3*60*60*24*2;function h(e,t){t===void 0&&(t=o("WAMediaManager").createCacheState);var r=t(),a=r.fullsizeCache,i=r.previewCache,l=r.uploadCache,h=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,i=t.scheduledTask;a.set(n,{abortController:e,mediaDownloadFlow:r,task:i}),i.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){a.delete(n)})},b=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,a=t.scheduledTask;i.set(n,{abortController:e,mediaDownloadFlow:r,task:a}),a.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){i.delete(n)})},v=function(t){var e=t.chatJid,n=t.plaintextHash,r=t.scheduledTask,a=t.cacheTtlMs,i=a===void 0?g:a,s=l.get(n)||new Map;s.set(e,r),l.set(n,s),r.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(i):void 0}).finally(function(){l.delete(n)})},S=function(r){var t=r.mediaEntry,a=r.msgId,i=r.plaintextHash;e(a).then(function(e){if(e==null){o("WAMediaManagerLogger").baseLogger.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["missing chatJid, skip setDownloadedAttachmentToUploadCache"])));return}var r=e.protocolMsgId.chat,a=C(t);if(a==null){o("WAMediaManagerLogger").baseLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["can not covert mediaEntry from download to upload for cache"])));return}var l=o("WATimeUtils").timeoutFor(a.mediaKeyTimestamp,g/1e3);if(l!==0){var c=o("WATimeUtils").pastUnixTime(o("WATimeUtils").DAY_SECONDS,a.mediaKeyTimestamp);o("WATimeUtils").isInFuture(c)||v({cacheTtlMs:l,chatJid:r,plaintextHash:i,scheduledTask:(_||(_=n("Promise"))).resolve(o("WAResultOrError").makeResult(a))})}}).catch(function(e){o("WAMediaManagerLogger").baseLogger.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["setDownloadedAttachmentToUploadCache getProtocolMsgIdAndSortOrderMs: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e))})};return{cancelTask:function(t){var e=o("WAMediaManagerLogger").baseLogger.TAGS(["hash:"+o("WAHashUtils").sanitisePlaintextHash(t),"cancelTask"]);e.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["start"])));var n=[a,i];for(var r of n){var l=r.get(t);if(l!=null){var s=l.task.cancel();l.mediaDownloadFlow.addPoint("cancel_download_triggered"),s===!1?(l.abortController.abort(),l.mediaDownloadFlow.addPoint("http_abort_cancel"),e.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["http abort cancel"])))):(l.mediaDownloadFlow.addPoint("worker_task_cancel_cancel"),e.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["worker task cancel"])))),r.delete(t)}}},clearCache:function(){i.clear(),a.clear(),l.clear()},getFullsize:function(t){var e=a.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","fullsize"),{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getFullsizeAndPreview:function(t){var e=o("WAMediaManager").toWorkerSchedulerPriority(t.priority),n=a.get(t.fullSizePlaintextHash),r=i.get(t.fullSizePlaintextHash);return n!=null&&r!=null?(y(t.mediaDownloadFlow,"hit","fullsize-and-preview"),n.task.promote(e),r.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):n!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),n.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}}):r!=null?(y(t.mediaDownloadFlow,"hit","preview"),r.task.promote(e),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):(y(t.mediaDownloadFlow,"miss","fullsize-and-preview"),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}})},getPreview:function(t){var e=i.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","preview"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","preview"),{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getUploadedAttachment:function(t){var e=l.get(t.plaintextHash);if(e==null)return{setUploadCache:v,type:"cache-miss-no-plaintext-hash"};var n=e.get(t.chatJid);return n==null?{setUploadCache:v,type:"cache-miss-no-thread"}:{cache:n,type:"in-thread-cache-hit"}}}}function y(e,t,n){e.addAnnotations({string:{media_manager_cache_result:t,media_manager_cache_type:n}})}function C(t){var n=t.mediaKeyTimestamp,r=t.objectId,o=t.size,a=babelHelpers.objectWithoutPropertiesLoose(t,e);return n==null||r==null||o==null?null:babelHelpers.extends({},a,{mediaKeyTimestamp:n,objectId:r,size:o})}l.DOWNLOAD_TASK_CACHE_TTL_MS=f,l.UPLOAD_TASK_CACHE_TTL_MS=g,l.createAttachmentCache=h}),98);
__d("blobToDataUri",["Promise","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var o=new FileReader,a=new(e||(e=n("Promise")))(function(e,t){o.onloadend=e,o.onerror=t});o.readAsDataURL(t),yield a;var i=o.result;if(typeof i!="string")throw r("err")('Unexpected result type "%s" when reading Blob as DataURL.',i instanceof ArrayBuffer?"ArrayBuffer":typeof i);return i}),u.apply(this,arguments)}l.default=s}),98);
__d("MAWGetThumbnailBlobDataUrlByMediaIdApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaManager","MAWMediaPreviewDownloadManager","MAWMpsGating","MAWTransactionMode","MWFBLogger","MpsMediaEntryCache","MpsMediaManager","Promise","WAErrorMessage","WAHashUtils","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime","blobToDataUri"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x=o("MWFBLogger").MWMediaLogger().tags(["getThumbnailBlobDataUrlByMediaId"]),$=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a){x.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from , from ",""])),t,n);var i=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(a),l={string:{description:n,fetch_by:"mediaId"}};i("fetch_thumbnail_blob_api_start",l),i("get_media_from_db_start",l);var g=yield w(t);if(i("get_media_from_db_finish",{bool:{db_media_found:g!=null}}),g==null)throw x.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),t),i("fetch_thumbnail_blob_api_fail_no_media_found_in_db",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",t,n);var h=F(g);if(h.success===!0){x.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),t),i("fetch_thumbnail_blob_api_success",l);var y=yield r("blobToDataUri")(h.value);if(!y)throw x.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),t),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",t,n);return x.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),t),y}var C=h.error;switch(C){case"missing_jpeg_thumbnail":if(g.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||g.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var b=yield N(g,a);if(b!=null){i("fetch_thumbnail_blob_api_success",l);var v=yield r("blobToDataUri")(b);if(!v)throw x.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),t),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",t,n);return x.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),t),v}if((g==null?void 0:g.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time (for video). mediaId is %s, from %s",t,n);var S=yield M(g,a);if(S==null)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time or to generate thumnbail on the fly. mediaId is %s, from %s",t,n);i("fetch_thumbnail_blob_api_success",l);var R=yield r("blobToDataUri")(S);if(!R)throw x.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),t),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",t,n);return x.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),t),R}throw i("fetch_thumbnail_blob_api_fail_missing_thumbnail",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). mediaId is %s, from %s",t,n);case"invalid_media":throw i("fetch_thumbnail_blob_api_fail_invalid_media",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. mediaId is %s, from %s",t,n)}});return function(n,r,o){return t.apply(this,arguments)}})(),P=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var a=o("MpsMediaEntryCache").getEntry(e)!=null&&o("MAWMpsGating").isMpsMediaGalleryEnabled(),i=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n),l={bool:{shouldUseMpsGalleryAndMpsMediaManager:a},string:{description:t,fetch_by:"hashedPlaintextHash"}};if(i("fetch_thumbnail_blob_api_start",l),x.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from ",""])),o("WAHashUtils").sanitisePlaintextHash(e),t),o("MAWMpsGating").isMpsMessageRendering()||a){var s=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null}),u=a?o("MpsMediaManager").getMpsMediaManager():o("MAWMediaManager").getMawMediaManager(),c=u.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:e,mediaDownloadFlow:s,priority:o("WAMediaManager").MediaTaskPriority.HIGH}),d=yield c.previewPromise;if(d.success){var m;s.endSuccess();var p=d.value.validatedResult.validatedPlaintext,_=new Blob([p],{type:(m=d.value.validatedResult.mimeType)!=null?m:void 0}),f=yield r("blobToDataUri")(_);return f}if(d.error!=="preview-not-supported")throw s.endFail(d.error,{string:{failReason:d.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(e),t,d.error);var E=yield c.fullsizePromise;if(E.success){var k;s.endSuccess();var I=E.value.validatedResult.validatedPlaintext,T=new Blob([I],{type:(k=E.value.validatedResult.mimeType)!=null?k:void 0}),D=yield r("blobToDataUri")(T);return D}throw s.endFail(E.error,{string:{failReason:E.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(e),t,E.error)}var $=yield A(e);if($==null)throw x.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),i("fetch_thumbnail_blob_api_fail_no_media_found_in_db",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash because media is not in the media db. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);var P=F($);if(P.success===!0){x.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),i("fetch_thumbnail_blob_api_success",l);var w=yield r("blobToDataUri")(P.value);if(!w)throw x.MUSTFIX(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);return x.DEBUG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),w}var O=P.error;switch(O){case"missing_jpeg_thumbnail":if($.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||$.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var B=yield N($,n);if(B!=null){i("fetch_thumbnail_blob_api_success",l);var W=yield r("blobToDataUri")(B);if(!W)throw x.MUSTFIX(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);return x.DEBUG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),W}if(($==null?void 0:$.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time (for video). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);var q=yield M($,n);if(q==null)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time or to generate thumnbail on the fly. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);var U=yield r("blobToDataUri")(q);if(!U)throw x.MUSTFIX(R||(R=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);return x.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(e)),U}throw i("fetch_thumbnail_blob_api_fail_missing_thumbnail",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t);case"invalid_media":throw i("fetch_thumbnail_blob_api_fail_invalid_media",l),x.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(e),t)}});return function(n,r,o){return e.apply(this,arguments)}})(),N=function(t,r){var e=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(r);e("fetch_thumbnail_blob_api_thumbnail_download_start");var a=o("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(t.plaintextHash);return a==null?(e("fetch_thumbnail_blob_api_thumbnail_download_fail_no_resolvable"),(D||(D=n("Promise"))).resolve(null)):o("MAWMaybeWithTimeout").maybeWithTimeout(a.promise,1e4,function(){throw x.mustfixThrow("timeout waiting for thumbnail to download")}).then(function(t){return e("fetch_thumbnail_blob_api_thumbnail_download_success"),t}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return x.MUSTFIX(E||(E=babelHelpers.taggedTemplateLiteralLoose(["Exception when waiting for thumbnail to download: ",""])),n),e("fetch_thumbnail_blob_api_thumbnail_download_fail_exception",{string:{wait_for_thumbnail_download_exception:n}}),null})},M=o("MAWIndexedDb").makeMsgrTransactor({chunk:(T=o("MAWTransactionMode")).READONLY,media:T.READONLY},"generateThumbnailFromMediaChunk",function(e){return function(t,n){var r=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);return r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_start"),o("MAWDbChunkTxns").maybeGetChunkFromHash(e,t.hashedPlaintextHash).then(function(e){if(e==null){x.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: unable to get a thumbnail as the media chunk is missing"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_fail_chunk_missing");return}return x.WARN(I||(I=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: using media chunk as the thumbnail"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_success"),new Blob([e.blobData],{type:e.mimetype})})}}),w=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t)}}),A=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,t)}}),F=function(t){var e=O(t);if(e.success===!1)return e;var n=e.value.jpegThumbnail;return n!=null?o("WAResultOrError").makeResult(new Blob([n],{type:"image/jpeg"})):o("WAResultOrError").makeError("missing_jpeg_thumbnail")},O=function(t){var e,n;switch(t.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return o("WAResultOrError").makeResult({jpegThumbnail:(e=t.validatedImageInfo)==null?void 0:e.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return o("WAResultOrError").makeResult({jpegThumbnail:(n=t.validatedVideoInfo)==null?void 0:n.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.PTT:case o("MAWDbMedia").MEDIA_TYPE.STICKER:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return o("WAResultOrError").makeError("invalid_media");default:return t.mediaType,o("WAResultOrError").makeError("invalid_media")}};l.getThumbnailBlobDataUrlByMediaId=$,l.getThumbnailBlobDataUrlByHashedPlaintextHash=P,l.getFullMediaWithPlaintextHash=A}),98);
__d("MAWMediaManager",["MAWGetMostRescentDecodedMediaEntry","MAWGetProtocolMsgIdAndSortOrderMsApi","MAWMpsGating","MpsMediaManager","WAMediaManager","memoize"],(function(t,n,r,o,a,i,l){"use strict";var e=r("memoize")(function(){return o("WAMediaManager").createCacheState()}),s=r("memoize")(function(){return o("MpsMediaManager").getMpsMediaManager(e)}),u=r("memoize")(function(){return o("WAMediaManager").createMediaManager({createCacheState:e,dbCallbacks:{getMediaEntries:o("MAWGetMostRescentDecodedMediaEntry").getMediaEntries,getProtocolMsgIdAndSortOrderMs:o("MAWGetProtocolMsgIdAndSortOrderMsApi").getProtocolMsgIdAndSortOrderMs}})}),c=function(){return o("MAWMpsGating").isMpsMessageRendering()?s():u()};l.getMpsMediaManager=s,l.getMawMediaManager=c}),98);
__d("WmiChunkApi",["CoalescingLoader","MAWDbChunkTxns","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWTransactionMode","asyncToGeneratorRuntime","emptyFunction","memoizeWithArgsLFUCache"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READONLY},"wms_getCachedChunkResult",function(e){return function(t){return o("MAWDbChunkTxns").maybeBulkGetChunksFromPlaintextHash(e,t)}}),a=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_storeChunk",function(t){return function(n){return n.map(function(t){return e(t[0])}),o("MAWDexieTable").dexieAll(n.map(function(e){return o("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(t,e[0],e[1],e[2],e[3])})).then(r("emptyFunction"))}}),i=new(o("CoalescingLoader")).CoalescingLoader((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var r=yield t(n);return n.map(function(t){var n=r.get(t);return n==null&&e(t),n})});return function(e){return r.apply(this,arguments)}})()),l=new(o("CoalescingLoader")).CoalescingLoader((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield a(e),[]});return function(t){return e.apply(this,arguments)}})()),s=r("memoizeWithArgsLFUCache")(function(e){return i.gen(e)},function(e){return e},1,function(t){e=t}),u=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_deleteChunk",function(t){return function(n){n.map(e);var r=n.map(o("MAWMediaUtils").genHMACPlaintextHash);return t.chunk.where("hashedPlaintextHash").anyOf(r).delete()}});return{delete:u,get:s,store:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.gen(t)}}}l.getChunkApi=e}),98);
__d("MediaServiceLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return r("FBLogger")("wmi_media_service",t)};l.MediaServiceLogger=e}),98);
__d("WmiMediaServiceSchema",["MAWWormOdsLogger","MediaServiceLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(t,n,r,o,a,i,l){"use strict";var e={autoIncrement:!0,indexes:{"[plaintextHash+updatedAtMs]":{fields:["plaintextHash","updatedAtMs"],unique:!1},"[threadId+messageId+plaintextHash]":{fields:["threadId","messageId","plaintextHash"],unique:!0}},nonEncryptedFields:["updatedAtMs","messageId"],primaryKey:"pk",secure:!0},s={messageChunk:e};function u(e){var t=e.blockingErrorThreshold,n=e.dbName,r=e.onBlockingError,a=e.qplEvent,i=e.strEncKey,l=o("WAHex").parseHex(i),u="wmi_media_service",c=new(o("WormEAR")).WormEAR(s,u,l),d=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(n,u,s,c,o("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:t,onBlockingError:r,onTransactionError:function(t){if(t instanceof o("WormEAR").DecryptionError){var e=t;o("MediaServiceLogger").MediaServiceLogger().mustfix("EAR decryption error in store: %s. Dropping corrupted entity %s",e.store,e.maybeHashedPk),d.runInTransaction([e.store],"readwrite",function(t){var n=t.stores[e.store];return e.maybeHashedPk!=null?n.delete(e.maybeHashedPk):n.clear()},"delete-corrupted-entity")}}}),a);return d}function c(e){return new(o("Worm")).WormDatabase(new(o("WormMemoryDriver")).WormMemoryDriver(s),e)}l.SCHEMA=s,l.makeSchema=u,l.makeInMemorySchema_TEST_ONLY=c}),98);
__d("WmiMediaServiceDb",["MediaServiceLogger","WAResolvable","WmiMediaServiceSchema","asyncToGeneratorRuntime","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{var n=o("WmiMediaServiceSchema").makeSchema(t);return e=n,yield n.init(),s.resolve(n),n}catch(e){throw o("MediaServiceLogger").MediaServiceLogger().catching(r("getErrorSafe")(e)).mustfix("Error performing Media Service init"),e}}),c.apply(this,arguments)}function d(){if(e==null)throw r("err")("DB is not initialized");return e}l.makeMediaServiceDb=u,l.getDb=d}),98);
__d("WmiMediaService",["MpsTypes","WmiChunkApi","WmiMediaServiceDb","asyncToGeneratorRuntime","err","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e,this.$2=o("WmiChunkApi").getChunkApi()}var t=e.prototype;return t.getChunk=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n=yield this.$2.get(e);return n==null?null:{blobData:n.blobData,isProgressivePreview:(t=n.isProgressivePreview)!=null?t:!1,mimetype:n.mimetype,plaintextHash:n.plaintextHash}});function t(t){return e.apply(this,arguments)}return t})(),t.getMessageChunkForHash=function(t){return this.$1.runInTransaction(["messageChunk"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.messageChunk.readIndexRange("[plaintextHash+updatedAtMs]",{only:[t]},{limit:1,order:"desc"});return n.at(0)});return function(t){return e.apply(this,arguments)}})(),"WmiGetMessagesForHash")},t.handleMessageDeletion=function(t,n){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t,n]})})},t.handleThreadDeletion=function(t){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t]})})},t.storeChunk=function(t){var e=t.blobData,n=t.isProgressivePreview,r=t.mimetype,o=t.plaintextHash;return this.$2.store(o,e,r,n)},t.storeMessageChunks=function(t){return this.$1.runInTransaction(["messageChunk"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield e.stores.messageChunk.bulkUpsert("[threadId+messageId+plaintextHash]",t.map(function(e){return{item:{messageId:e.messageId,plaintextHash:e.plaintextHash,threadId:e.threadId,updatedAtMs:o("MpsTypes").toTimestamp(Date.now())},selector:[e.threadId,e.messageId,e.plaintextHash]}}))});return function(t){return e.apply(this,arguments)}})(),"WmiMediaServiceStoreChunkMessage")},t.$3=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield this.$1.runInTransaction(["messageChunk"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield e(t);yield t.stores.messageChunk.bulkDelete(n.map(function(e){return e.pk}));var r=new Set(n.map(function(e){return e.plaintextHash})),o=yield t.stores.messageChunk.readIndexAnyOf("[plaintextHash+updatedAtMs]",Array.from(r).map(function(e){return[e]}));return o.forEach(function(e){return r.delete(e.plaintextHash)}),Array.from(r)});return function(e){return t.apply(this,arguments)}})(),"WmiMediaServiceDeleteMessageChunkEntries");t.length>0&&(yield this.$2.delete(Array.from(t)))});function t(t){return e.apply(this,arguments)}return t})(),e})(),s=null;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(s!=null)throw r("err")("Media Service already initialised");var n=yield o("WmiMediaServiceDb").makeMediaServiceDb(t);s=new e(n)}),c.apply(this,arguments)}function d(){return r("nullthrows")(s,"Media Service not initialised")}function m(){s=null}l.MediaService=e,l.wmiMediaServiceSetup=u,l.mediaService=d,l.wmiMediaServiceClear__TESTONLY=m}),98);
__d("MpsMediaManager",["MAWGetThumbnailBlobDataUrlByMediaIdApi","MpsMediaEntryCache","MpsMessageToBridgeWrapper","MpsToBridgeMessageId","Promise","WAIsPreviewSupported","WAJids","WAMediaManager","WAMediaManagerCache","WAMediaUtils","WAResultOrError","WAStanzaUtils","WAValidateMedia","WebMps","WmiMediaService","asyncToGeneratorRuntime","getErrorSafe","memoize","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=["kind"],s;function u(e){throw new TypeError('"'+e+'" is read-only')}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.fullSizePlaintextHash,n=e.mediaDownloadFlow,r=o("MpsMediaEntryCache").getEntry(t);if(r!=null)return n.addPoint("media_entry_cache_hit"),r;var a=yield o("WmiMediaService").mediaService().getMessageChunkForHash(t);if(a==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_message_chunk"}});return}var i=yield o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-only"},debug:{purpose:"MpsMediaManager-getEntryWithFallback"},messageId:a.messageId,threadId:a.threadId}),l=i.value;if(l==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_reverb_message"}});return}o("MpsMediaEntryCache").hydrateCache(l.toplevelProtobuf);var s=o("MpsMediaEntryCache").getEntry(t);return s==null?(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"unable_to_cache"}}),null):(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"success"}}),s)}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("MpsToBridgeMessageId").bridgeMsgIdToMps(e),n=t.messageId,r=t.threadId,a=yield o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-first"},debug:{purpose:"mps_media_manager"},messageId:n,threadId:r});if(a.value){var i=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.value.toplevelProtobuf),l=i.getAuthor();if(!o("WAJids").isAuthorSystem(l))return{protocolMsgId:{author:l,chat:i.getChatJid(),externalId:o("WAStanzaUtils").toStanzaId(i.getExternalId())},sortOrderMs:i.message.timestampMs}}}),p.apply(this,arguments)}var _=function(t){return o("WAMediaManager").createMediaManager({createCacheState:t,dbCallbacks:{getMediaEntries:function(t){var e=o("MpsMediaEntryCache").getEntry(t);if(e==null)return(s||(s=n("Promise"))).resolve(o("WAResultOrError").makeError("no-media-by-plaintext-hash"));var r=e.mediaEntry,a=e.message,i=o("MpsToBridgeMessageId").mpsToBridgeMsgId(a.threadId,a.messageId);return(s||(s=n("Promise"))).resolve(o("WAResultOrError").makeResult(new Map([[i,r]])))},getProtocolMsgIdAndSortOrderMs:m}})};function f(e){var t=o("WAIsPreviewSupported").checkPreviewSupport(e.decodedMediaEntry),n=t[0],r=t[1];return(function(t){if(Array.isArray(t)&&t.length===2&&t[0]===o("WAIsPreviewSupported").PjpegPreviewSupport.YES)return{kind:"progressive",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.YES)return e.thumbnailHash!=null?{kind:"withThumbnail",thumbnailHash:e.thumbnailHash}:{kind:"noPreview"};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return{kind:"duplicatedWithFullSize",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return{kind:"noPreview"};throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})([n,r])}function g(e,t,n){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(e!=null){var r=yield o("WAValidateMedia").validateMedia(e,t);if(r.value!=null)return o("WAResultOrError").makeResult({serverMediaType:n,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(n),validatedResult:r.value})}}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("WmiMediaService").mediaService().getChunk(e),a=yield g(r==null?void 0:r.blobData,t,n);if(!(r==null||a==null))return t.addAnnotations({bool:{from_chunk:!0}}),{chunk:r,result:a}}),C.apply(this,arguments)}function b(e,t,n,a){if(n.success===!0){var i;o("WmiMediaService").mediaService().storeChunk({blobData:n.value.validatedResult.validatedPlaintext,isProgressivePreview:a,mimetype:(i=n.value.validatedResult.mimeType)!=null?i:n.value.unvalidatedMimeType,plaintextHash:e}).then(function(){return t.addAnnotations({string:{chunk_store_result:"success"}})}).catch(function(e){var n=r("getErrorSafe")(e).message;t.addAnnotations({string:{chunk_store_result:n}})})}}function v(e,t,n){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a=n.fullSizePlaintextHash,i=n.mediaDownloadFlow;if(e.success||e.error!=="signature-expired")return e;var l=yield o("MAWGetThumbnailBlobDataUrlByMediaIdApi").getFullMediaWithPlaintextHash(a);if(l==null)return i.addAnnotations({string:{signature_expired_fallback:"media not found"}}),e;var s=(r=l.validatedAudioInfo)!=null?r:l.validatedVideoInfo,u=s==null?void 0:s.jpegThumbnail;if(u==null)return i.addAnnotations({string:{signature_expired_fallback:"thumbnail not found"}}),e;var c=yield o("WAValidateMedia").validateMedia(u,i);return c.value==null?(i.addAnnotations({string:{signature_expired_fallback:"validation failed"}}),e):(i.addAnnotations({string:{signature_expired_fallback:"success"}}),o("WAResultOrError").makeResult({serverMediaType:t.serverMediaType,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType("image"),validatedResult:c.value}))}),S.apply(this,arguments)}var R=function(a){var t=_(a),i=o("WAMediaManagerCache").createAttachmentCache(m,a),l={clearCache:t.clearCache,dequeueDownload:t.dequeueDownload,enqueueDownloadFullSize:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsize"}});var n=i.getFullsize(e);if(n.type==="cache-hit")return n.cache;var r=yield c(e);if(!r)return o("WAResultOrError").makeError("missing-media-entry");var a=yield y(e.fullSizePlaintextHash,e.mediaDownloadFlow,r.serverMediaType);if(a!=null&&!a.chunk.isProgressivePreview)return a.result;e.mediaDownloadFlow.addPoint("mps_actual_download");var l=yield t.enqueueDownloadFullSize(e);return b(e.fullSizePlaintextHash,e.mediaDownloadFlow,l,!1),l});function r(t){return e.apply(this,arguments)}return r})(),enqueueDownloadFullSizeAndPreview:function(l){l.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsizeAndPreview"}});var a=i.getFullsizeAndPreview(l),s=a.fullsizeCacheResult,u=a.previewCacheResult;if(s.type==="cache-hit"&&u.type==="cache-hit")return{fullsizePromise:s.cache,previewPromise:u.cache};var d=r("memoize")(function(){return c(l)}),m=r("memoize")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=r("nullthrows")(yield d()),t=y(l.fullSizePlaintextHash,l.mediaDownloadFlow,e.serverMediaType);return t}));l.mediaDownloadFlow.addPoint("mps_actual_download");var p=r("memoize")(function(){return t.enqueueDownloadFullSizeAndPreview(l)});return{fullsizePromise:n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield d();if(e==null)return o("WAResultOrError").makeError("missing-media-entry");var t=yield m();if(t!=null&&!t.chunk.isProgressivePreview)return t.result;var n=yield p().fullsizePromise;return b(l.fullSizePlaintextHash,l.mediaDownloadFlow,n,!1),n})(),previewPromise:n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield d();if(t==null)return o("WAResultOrError").makeError("missing-media-entry");var n=f(t);if(n.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var r=yield(function(n){if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="duplicatedWithFullSize"||(typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="progressive")return m();if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="withThumbnail"){var r=n.kind,o=babelHelpers.objectWithoutPropertiesLoose(n,e);return y(o.thumbnailHash,l.mediaDownloadFlow,t.serverMediaType)}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)})(n);if(r!=null)return r.result;var a=yield p().previewPromise,i=yield v(a,t,l);return n.kind==="withThumbnail"&&b(n.thumbnailHash,l.mediaDownloadFlow,i,!1),i})()}},enqueueDownloadPreview:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e.mediaDownloadFlow.addAnnotations({string:{downloadKind:"preview"}});var n=i.getPreview(e);if(n.type==="cache-hit")return n.cache;var r=yield c(e);if(r==null)return o("WAResultOrError").makeError("missing-media-entry");var a=f(r),l=a.kind==="progressive";if(a.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var s=a.thumbnailHash,u=yield y(s,e.mediaDownloadFlow,r.serverMediaType);if(u!=null)return u.result;e.mediaDownloadFlow.addPoint("mps_actual_download");var d=yield t.enqueueDownloadPreview(e),m=yield v(d,r,e);return b(s,e.mediaDownloadFlow,m,l),m});function r(t){return e.apply(this,arguments)}return r})(),enqueueUploadFullSize:function(){return t.enqueueUploadFullSize.apply(t,arguments)}};return l};l.getMpsMediaManager=R}),98);
__d("WACryptoAesGcm",["WABinary","WACryptoDependencies","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,o){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){a===void 0&&(a=16);var i={name:"AES-GCM",iv:m(t),tagLength:a*8};return r!=null&&(i.additionalData=m(r)),o("WACryptoDependencies").getCrypto().subtle.encrypt(i,yield d(e),n)}),s.apply(this,arguments)}function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){a===void 0&&(a=16);var i={name:"AES-GCM",iv:m(t),tagLength:a*8};return r!=null&&(i.additionalData=m(r)),o("WACryptoDependencies").getCrypto().subtle.decrypt(i,yield d(e),n)}),c.apply(this,arguments)}function d(e){return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}function m(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){var t=new(o("WABinary")).Binary;return t.writeString(e),t.readByteArrayView()}return new Uint8Array(e)}l.gcmEncrypt=e,l.gcmDecrypt=u}),98);
__d("WAUseCaseSecret",["$InternalEnum","WABinary","WACryptoHkdf"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({POLL_VOTE:"Poll Vote",ENC_REACTION:"Enc Reaction",ENC_COMMENT:"Enc Comment",REPORT_TOKEN:"Report Token",EVENT_RESPONSE:"Event Response",EVENT_EDIT_ENCRYPTED:"Event Edit",MESSAGE_EDIT:"Message Edit"}),s=32;function u(e){var t=e.messageSecret,n=e.stanzaId,r=e.parentMsgOriginalSender,a=e.modificationSender,i=e.modificationType,l=o("WABinary").Binary.build(n,r,a,i).readBuffer();return o("WACryptoHkdf").extractAndExpand(t instanceof ArrayBuffer?new Uint8Array(t):t,l,s)}l.UseCaseSecretModificationType=e,l.createUseCaseSecret=u}),98);
__d("MAWGroupPollsDualEncryptionUtils",["MAWDbPoll","WABase64","WAConsumerApplication.pb","WACryptoAesGcm","WACryptoSha256","WAResultOrError","WAUseCaseSecret","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(e.encIv==null||e.encPayload==null)return o("WAResultOrError").makeError("invalid_poll_enc_value");var a=e.encIv,i=e.encPayload;try{var l=yield o("WACryptoAesGcm").gcmDecrypt(t,a,i,n);return o("WAResultOrError").makeResult(l)}catch(e){return o("WAResultOrError").DEPRECATED_makeError("decryption_error",r("getErrorSafe")(e))}}),s.apply(this,arguments)}function u(e,t,n){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){try{var a=self.crypto.getRandomValues(new Uint8Array(12)),i=yield o("WACryptoAesGcm").gcmEncrypt(t,a,e,n);return o("WAResultOrError").makeResult({encIv:a.buffer,encPayload:i})}catch(e){return o("WAResultOrError").DEPRECATED_makeError("encryption_error",r("getErrorSafe")(e))}}),c.apply(this,arguments)}function d(e,t){var n=e+"\0"+t;return new TextEncoder().encode(n).buffer}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.pollCreationMessageKey,r=t.pollCreationSenderJid,a=t.pollCreationStanzaId,i=t.pollUpdateSenderJid,l=t.pollUpdateStanzaId,s=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:n,modificationSender:i,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:r,stanzaId:a}),c=d(l,i),m=o("encodeProtobuf").encodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,e).readBuffer();return u(m,s,c)}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=n.pollCreationMessageKey,i=n.pollCreationSenderJid,l=n.pollCreationStanzaId,s=n.pollUpdateSenderJid,u=n.pollUpdateStanzaId,c=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:a,modificationSender:s,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:i,stanzaId:l}),m=d(u,s),p=yield e(t,c,m);if(!p.success)return p;try{return o("WAResultOrError").makeResult(o("decodeProtobuf").decodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,p.value))}catch(e){return o("WAResultOrError").DEPRECATED_makeError("protobuf_decode_error",r("getErrorSafe")(e))}}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.pollCreationMessageKey,r=t.pollCreationSenderJid,a=t.pollCreationStanzaId,i=t.pollUpdateSenderJid,l=t.pollUpdateStanzaId,s=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:n,modificationSender:i,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:r,stanzaId:a}),c=d(l,i),m=o("encodeProtobuf").encodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,e).readBuffer();return u(m,s,c)}),h.apply(this,arguments)}function y(e,t){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var a=n.pollCreationMessageKey,i=n.pollCreationSenderJid,l=n.pollCreationStanzaId,s=n.pollUpdateSenderJid,u=n.pollUpdateStanzaId,c=yield o("WAUseCaseSecret").createUseCaseSecret({messageSecret:a,modificationSender:s,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:i,stanzaId:l}),m=d(u,s),p=yield e(t,c,m);if(!p.success)return p;try{return o("WAResultOrError").makeResult(o("decodeProtobuf").decodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,p.value))}catch(e){return o("WAResultOrError").DEPRECATED_makeError("protobuf_decode_error",r("getErrorSafe")(e))}}),C.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WACryptoSha256").sha256(new TextEncoder("utf8").encode(e));return S(t)}),v.apply(this,arguments)}function S(e){return o("MAWDbPoll").convertStringToOptionHash(o("WABase64").encodeB64(e))}l.encryptGroupPollVote=m,l.decryptGroupPollVote=_,l.encryptGroupPollAddOption=g,l.decryptGroupPollAddOption=y,l.getHashForOptionName=b,l.getBase64EncodedHash=S}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("24163")}l.default=e}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("MAWCurrentUser").isEmployee()&&r("isUseridAnnotationEnabled")()?o("WAJids").extractUserId(o("WAGlobals").getMyUserJid()).slice(-5):null}l.getUserHash=e}),98);
__d("MAWIncomingMsg",["MAWUserHash","MWFBLogger","WAGetPlatformFromStanzaId","WAHashStringToNumber","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWFBLogger").MWLogger().tags(["ServerRPC","HandleIncomingMsg"]),s=function(t){var e=t.encTypes,n=t.incomingType,r=t.msg,a=t.queueType,i=t.retryCount,l=t.taskSource,s=r.details,u=r.decrypted;return{int:{messageAge:o("WATimeUtils").unixTime()-s.ts,msgId:o("WAHashStringToNumber").hashStringToNumber(s.externalId.toString()),offlineDelivery:s.offline,retryCount:i,taskSource:l},string:{e2eePlatform:o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(s.externalId),incomingType:n,jid:s.from.chat,msgDecryptedDataType:u.type,msgType:s.type,queueType:a,threadType:s.from.type,userHash:o("MAWUserHash").getUserHash()},string_array:{encTypes:e}}};l.logger=e,l.prepareAnnotationsForIncomingMessage=s}),98);
__d("MAWIsQuotaExceededError",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return t.name==="QuotaExceededError"||t.inner!=null&&t.inner.name==="QuotaExceededError"};i.isQuotaExceededError=e}),66);
__d("MAWLegacyDownloadManager",[],(function(t,n,r,o,a,i){"use strict";var e=1e4,l=(function(){function t(){this.$1=[],this.$2=new Map}var n=t.prototype;return n.setToDownloadManager=function(t,n){this.$3(),this.$2.set(t,n),this.$1.push(t)},n.getFromDownloadManager=function(t){return this.$2.get(t)},n.removeFromMediaDownloadManager=function(t){this.$2.delete(t);var e=this.$1.filter(function(e){return e!==t});this.setDownloadManagerQueue(e)},n.setDownloadManagerQueue=function(t){this.$1=t},n.$3=function(){if(this.$1.length>=e){var t=this.$1.shift();this.$2.delete(t)}},t})();i.LegacyDownloadManager=l}),66);
__d("MAWLegacyMediaDownloadManager",["MAWLegacyDownloadManager"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("MAWLegacyDownloadManager")).LegacyDownloadManager,s=new(o("MAWLegacyDownloadManager")).LegacyDownloadManager;function u(t,n){e.setToDownloadManager(t,n)}function c(t){return e.getFromDownloadManager(t)}function d(t){e.removeFromMediaDownloadManager(t)}function m(e,t){s.setToDownloadManager(e,t)}function p(e){return s.getFromDownloadManager(e)}function _(e){s.removeFromMediaDownloadManager(e)}l.setToMediaDownloadManager=u,l.getFromMediaDownloadManager=c,l.removeFromMediaDownloadManager=d,l.setToMediaPlaintextDownloadManager=m,l.getFromMediaPlaintextDownloadManager=p,l.removeFromMediaPlaintextDownloadManager=_}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"NoteReply":case"BumpExistingMessage":return null;default:return o("WAServerMediaType").getMediaType(e)}}l.getMediaType=e}),98);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){switch(t){case o("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return r("RavenMessagingState").PERMANENT;case o("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return r("RavenMessagingState").UNSEEN;case o("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return r("RavenMessagingState").SEEN;case o("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return r("RavenMessagingState").REPLAYED;case o("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return r("RavenMessagingState").EXPIRED}},s=function(t){switch(t){case o("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return r("EphemeralMediaViewMode").PERMANENT;case o("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return r("EphemeralMediaViewMode").REPLAYABLE;case o("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return r("EphemeralMediaViewMode").READ_ONCE}},u=function(t,n){return{ephemeralMediaState:n,ephemeralMediaViewMode:s(t)}};function c(t,n){switch(n){case o("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return t===o("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?r("RavenMessagingState").SEEN:e(t);case o("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return t===o("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?r("RavenMessagingState").SEEN:t===o("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN?r("RavenMessagingState").REPLAYED:e(t);case o("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return e(t)}}l.getEphemeralMediaState=e,l.getEphemeralMediaViewMode=s,l.deriveRavenSettings=u,l.getNextRavenMessageEphemeralState=c}),98);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWDbMedia","MAWDexieTable","MAWIndexedDb","MAWMediaType","MAWMediaUtils","MAWMpsGating","MAWRavenUtils","MpsMediaEntryCache","MpsTypes","WAHashUtils","WAMediaUtils","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,u){return a.messages.where("msgId").anyOf(t.msgIds).toArray().then(function(c){var d=e.threadJid,m=o("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(c,d),p=o("MAWMediaUtils").createHdTypesForBridgeMedia(c),_=e.ravenEphemeralType!=null&&e.ravenEphemeralMediaState!=null?o("MAWBridgeTypesCreators").createBridgeMedia({chatJid:d,filteredMsgIds:m,hasMediaForUI:n,hdTypes:p,media:t,ravenSettings:o("MAWRavenUtils").deriveRavenSettings(e.ravenEphemeralType,e.ravenEphemeralMediaState),sortOrderMs:e.sortOrderMs,transportKey:l}):o("MAWBridgeTypesCreators").createBridgeMedia({chatJid:d,filteredMsgIds:m,hasMediaForUI:n,hdTypes:p,media:t,sortOrderMs:e.sortOrderMs,transportKey:l});if(o("MAWMpsGating").isMpsMessageRendering()&&u===!0){var f,g,h,y=r("nullthrows")(t.mediaEntries.get(e.msgId)),C=o("WAMediaUtils").decodeMediaEntryData(y),b=(f=(g=t.validatedImageInfo)==null?void 0:g.thumbnailPlaintextHash)!=null?f:(h=t.validatedVideoInfo)==null?void 0:h.thumbnailPlaintextHash;if(b==null){var v=C.downloadableThumbnail;(v==null?void 0:v.fileSha256)!=null&&(b=o("WAHashUtils").toPlaintextHash(v.fileSha256))}o("MpsMediaEntryCache").storeEntry({decodedMediaEntry:C,mediaEntry:y,mediaKeyTimestamp:t.ts,message:{messageId:o("MpsTypes").toMessageId(e.externalId),threadId:o("MpsTypes").toThreadId(e.threadJid)},plaintextHash:t.plaintextHash,serverMediaType:r("nullthrows")(o("MAWMediaType").getMediaType(t.mediaType)),thumbnailHash:b})}return s(a,babelHelpers.extends({},_,{skipShouldUpdateHasMore:i}),void 0,u)})}function s(e,t,n,r){return u(t)?o("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(e,t,n).then(function(e){o("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:e},r)}):(o("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:t},r),o("MAWDexieTable").dexieResolve())}function u(e){if(e.ephemeralMediaState!=null||e.ephemeralMediaViewMode!=null)return!1;switch(e.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:case o("MAWDbMedia").MEDIA_TYPE.VIDEO:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return!0;default:return!1}}l.handleNewMediaAfterTxn=e,l.handleNewMediaAfterTxnWithBridgeMedia=s}),98);
__d("MAWMediaDownloadStatusForUI",["MAWBridge","MAWLoggerUtils","MAWMediaDownloadStatus","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MWFBLogger").MWMediaLogger().tags([o("MAWLoggerUtils").Tag.MediaDownload,o("MAWLoggerUtils").Tag.MessageReceive]);function u(e){var t=e.details,n=e.hash,r=e.status,o=e.type,a=e.validationResult;c({details:t,hash:n,status:r,type:o,validationResult:a})}function c(e){var t=e.details,n=e.hash,r=e.status,a=e.type,i=e.validationResult;o("MAWBridge").getBridge().fireAndForget("event","updateMediaStatus",{details:t,key:n,status:r,type:a,validationResult:i})}function d(t){switch(t){case"disconnected":case"backoff":case"body-network-error":case"no-host":case"download-throttled":case"max-attempts-exceeded":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":return r("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE;case"request-error":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":case"signature-expired":return r("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;default:return s.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getStatusTypeFromWAAPIDownloadMediaError: Unknown error type ",""])),String(t)),r("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE}}l.sendMediaDownloadStatusToUI=u,l.getStatusFromWAAPIDownloadMediaError=d}),98);
__d("MAWMediaGalleryEBTaggingUtils",["LSThreadMediaGalleryGroup","MAWMpsGating","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("13725")}function s(e){return u(e)!=null}function u(e){return e===r("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS?r("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS:e===r("LSThreadMediaGalleryGroup").FILES_ONLY&&o("MAWMpsGating").isMpsMediaGalleryEnabled()?r("LSThreadMediaGalleryGroup").FILES_ONLY:void 0}l.isMediaGalleryEBTaggingRestoreEnabled=e,l.isMediaGalleryGroupSupportedForTaggedRestore=s,l.toMediaGalleryGroupForTaggedRestore=u}),98);
__d("MAWMessageReceiveReliabilityLogger",["WAHashStringToNumber","WAQPLProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("qpl")._(1056840931,"814"),s=r("qpl")._(521477947,"2395"),u=60*1e3;function c(t){return o("WAQPLProxy").waQPLProxyStart(t.incomingType==="ebrestore"?s:e,{int:{msgId:o("WAHashStringToNumber").hashStringToNumber(t.stanzaId)},string:{incomingType:t.incomingType,jid:t.jid,msgType:t.type}},o("WAHashStringToNumber").hashStringToNumber(t.stanzaId),u)}var d=300*1e3;l.logRRStartForMessage=c,l.RECEIVE_RELIABILITY_TIMEOUT=d}),98);
__d("MAWSharedCOPLogger",["MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWFBLogger").MWLogger().tags(["COP"]);l.default=e}),98);
__d("MAWSupportedDocumentTypes",[],(function(t,n,r,o,a,i){"use strict";var e=["apk","pyc","7z","z","gz","xz","rar","zip","zipx","ace","arc","zpaq","quad","balz","cab","arj","lzh","uue","bz","bz2","bzip2","jar","iso","tar","ade","adp","air","app","application","bas","bat","chm","cmd","com","command","cpl","crt","dll","dmg","dpkg","exe","hlp","hta","inf","ins","isp","jnlp","js","jse","lib","lnk","lua","mde","msc","msi","msp","mst","ocx","pcd","pif","pkg","ps1","reg","scr","sct","sh","shb","shs","sys","term","url","vb","vbe","vbs","vxd","webarchive","wsc","wsf","wsh","xbap"];function l(t){if(t==null)return!1;var n=t.includes(".")?t.split(".").pop():null;return n!=null&&!e.includes(n)}i.isAllowedType=l}),66);
__d("MAWTraceUtils",["LSDataTraceTag","LSRequestId","MAWMsgType"],(function(t,n,r,o,a,i,l){"use strict";var e="backup_upload",s="media_backup",u="vesta_registration",c="vesta_login";function d(){return r("LSRequestId").generate()}function m(e){return e}function p(e){switch(e){case o("MAWMsgType").MSG_TYPE.TEXT:return o("LSDataTraceTag").messageTypeText;case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:return o("LSDataTraceTag").messageTypeFutureproof;case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:return o("LSDataTraceTag").messageTypeCiphertext;case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:return o("LSDataTraceTag").messageTypeUnavailable;case o("MAWMsgType").MSG_TYPE.IMAGE:return o("LSDataTraceTag").messageTypeImage;case o("MAWMsgType").MSG_TYPE.VIDEO:return o("LSDataTraceTag").messageTypeVideo;case o("MAWMsgType").MSG_TYPE.PTT:return o("LSDataTraceTag").messageTypePtt;case o("MAWMsgType").MSG_TYPE.ADMIN:return o("LSDataTraceTag").messageTypeAdmin;case o("MAWMsgType").MSG_TYPE.REVOKED:return o("LSDataTraceTag").messageTypeRevoked;case o("MAWMsgType").MSG_TYPE.GIF:return o("LSDataTraceTag").messageTypeGif;case o("MAWMsgType").MSG_TYPE.STICKER:return o("LSDataTraceTag").messageTypeSticker;case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return o("LSDataTraceTag").messageTypeExpiredEphemeral;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return o("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return o("LSDataTraceTag").messageTypeEphemeralSyncResponse;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return o("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return o("LSDataTraceTag").messageTypeDeleteForMe;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return o("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:return o("LSDataTraceTag").messageTypeAlertICDC;case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:return o("LSDataTraceTag").messageTypeGroupInvite;case o("MAWMsgType").MSG_TYPE.XMA:return o("LSDataTraceTag").messageTypeXMA;case o("MAWMsgType").MSG_TYPE.REACTION:return o("LSDataTraceTag").messageTypeReaction;case o("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return o("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return o("LSDataTraceTag").messageTypeNone}}l.CONTEXT_BACKUP_UPLOAD=e,l.CONTEXT_MEDIA_BACKUP=s,l.CONTEXT_VESTA_REGISTRATION=u,l.CONTEXT_VESTA_LOGIN=c,l.createTraceId=d,l.stringToTraceId=m,l.getTagForMsgType=p}),98);
__d("MAWUnsafeCoerce",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.unsafeCoerce=e}),66);
__d("MAWXMALoggingUtils",["WAArmadilloXMA.pb","objectEntries"],(function(t,n,r,o,a,i,l){"use strict";var e=r("objectEntries")(o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE).reduce(function(e,t){var n=t[0],r=t[1];return e.set(r,n),e},new Map);function s(t){return t!=null?e.get(t):void 0}l.getXmaTargetTypeStringFromEnum=s}),98);
__d("MessageBackupSupplementalKeyGenerator",["$InternalEnum","MAWJids","WAGlobals","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({REACTION:"reaction",EDIT:"edit",RAVEN_ACTION_MESSAGE:"raven_action_message"}),s=":";function u(e,t){return""+e+s+t}function c(e){return e.split(s)[1]}function d(e,t){var n=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),r=new RegExp("^"+n,"i");return r.test(e)}function m(t){return d(t,e.REACTION)}function p(t){return d(t,e.EDIT)}function _(t){return d(t,e.RAVEN_ACTION_MESSAGE)}function f(t){var n=t.split(s);if(n.length===1)return{rawIdentifierString:t,type:"poll_update"};var r=n[0];if(n.length<2||n.length>3)return{prefix:r,rawIdentifierString:t,type:"unknown"};var a=n[1],i=o("MAWJids").toUserJid(a);if(r===e.REACTION)return{senderJid:i,type:"reaction"};var l=n.length===3?o("WATimeUtils").castToMillisTime(Number(n[2])):null;return r===e.RAVEN_ACTION_MESSAGE?{senderJid:i,type:"raven_action_message"}:l==null?{prefix:r,rawIdentifierString:t,type:"unknown"}:r===e.EDIT?{senderJid:i,ts:l,type:"edit"}:{prefix:r,rawIdentifierString:t,type:"unknown"}}function g(t){switch(t.type){case"edit":return""+e.EDIT+s+o("WAJids").extractUserId(t.senderJid)+s+t.ts.toString();case"reaction":return""+e.REACTION+s+o("WAJids").extractUserId(t.senderJid);case"raven_action_message":return""+e.RAVEN_ACTION_MESSAGE+s+o("WAJids").extractUserId(t.senderJid);case"poll_update":return t.rawIdentifierString}}function h(t){var n;if(o("WAJids").isAuthorMe(t))n=o("WAGlobals").getMyUserJid();else{var r=o("WAJids").interpretAndValidateJid(t);if(r.jidType==="msgrUser")n=r.userJid;else return null}var a=o("WAJids").userIdFromJid(n);return""+e.REACTION+s+a}function y(t,n){var r;if(o("WAJids").isAuthorMe(t))r=o("WAGlobals").getMyUserJid();else{var a=o("WAJids").interpretAndValidateJid(t);if(a.jidType==="msgrUser")r=a.userJid;else return null}var i=o("WAJids").userIdFromJid(r);return""+e.EDIT+s+i+s+n.toString()}l.SupplementalKeyPrefix=e,l.SUPPLEMENTAL_KEY_DELIMITER=s,l.createMessageSupplementalKey_DEPRECATED=u,l.getSupplementalSenderId_DEPRECATED=c,l.isSupplementalProtobufAReaction=m,l.isSupplementalProtobufAnEdit=p,l.isSupplementalProtobufARavenAction=_,l.parseIdentifierString=f,l.toIdentifierString=g,l.createReactionSupplementalKey=h,l.createEditSupplementalKey=y}),98);
__d("MessagesRangesV2ExternalIds",[],(function(t,n,r,o,a,i){"use strict";var e="",l="9999999999999999";i.MIN_EXTERNAL_ID=e,i.MAX_EXTERNAL_ID=l}),66);
__d("MpsFutureProofKey",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({WCEPlaintextPayloadFutureProofPlaceholder:0,WCEPlaintextPayloadFutureProofNoPlaceholder:1,WCEPlaintextPayloadFutureProofIgnore:2});i.WCEPlaintextPayloadFutureProof=e}),66);
__d("WAAPI",["cr:21048"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:21048")}),98);
__d("WAAppData",[],(function(t,n,r,o,a,i){"use strict";var e=1,l=2;i.EPOCH_STATUS_OPEN=e,i.EPOCH_STATUS_CLOSE=l}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="ICDCIdentityList",s.internalSpec={seq:[1,(e=o("WAProtoConst")).TYPES.INT32],timestamp:[2,e.TYPES.INT64],devices:[3,e.FLAGS.REPEATED|e.TYPES.BYTES],signingDeviceIndex:[4,e.TYPES.INT32]},u.name="SignedICDCIdentityList",u.internalSpec={details:[1,e.TYPES.BYTES],signature:[2,e.TYPES.BYTES]},l.ICDCIdentityListSpec=s,l.SignedICDCIdentityListSpec=u}),98);
__d("WAArrayChunk",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){n===void 0&&(n=!1);for(var o=0,a=[];o<e.length;){for(var i=[],l=0;o<e.length;){var s=e[o],u=r?r(s):1;if(!n&&l===0||l+u<=t)l+=u,i.push(s),o++;else{n&&u>t&&o++;break}}i.length>0&&a.push(i)}return a}i.chunk=e}),66);
__d("WACryptoPkcs7",["WACryptoDependencies","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=new Uint8Array(1);do o("WACryptoDependencies").getCrypto().getRandomValues(t);while(t[0]===0);u(e,t[0])}function s(e){var t=new Uint8Array(1);o("WACryptoDependencies").getCrypto().getRandomValues(t),u(e,(t[0]&15)+1)}function u(e,t){for(var n=0;n<t;n++)e.writeUint8(t)}function c(e){if(e.length===0)throw r("err")("unpadPkcs7 given empty bytes");var t=e[e.length-1];if(t>e.length)throw r("err")("unpadPkcs7 given "+e.length+" bytes, but pad is "+t);return new Uint8Array(e.buffer,e.byteOffset,e.length-t)}l.writeRandomPad=e,l.writeRandomPadMax16=s,l.writePad=u,l.unpadPkcs7=c}),98);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={};u.name="MessageTransport",u.internalSpec={payload:[1,(e=o("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,e.TYPES.MESSAGE,d]},c.name="MessageTransport$Payload",c.internalSpec={applicationPayload:[1,e.TYPES.MESSAGE,o("WACommon.pb").SubProtocolSpec],futureProof:[3,e.TYPES.ENUM,o("WACommon.pb").FUTURE_PROOF_BEHAVIOR]},d.name="MessageTransport$Protocol",d.internalSpec={integral:[1,e.TYPES.MESSAGE,h],ancillary:[2,e.TYPES.MESSAGE,m]},m.name="MessageTransport$Protocol$Ancillary",m.internalSpec={skdm:[2,e.TYPES.MESSAGE,g],deviceListMetadata:[3,e.TYPES.MESSAGE,C],icdc:[4,e.TYPES.MESSAGE,_],backupDirective:[5,e.TYPES.MESSAGE,p]},p.name="MessageTransport$Protocol$Ancillary$BackupDirective",p.internalSpec={messageId:[1,e.TYPES.STRING],actionType:[2,e.TYPES.ENUM,s],supplementalKey:[3,e.TYPES.STRING]},_.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices",_.internalSpec={senderIdentity:[1,e.TYPES.MESSAGE,f],recipientIdentities:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,f],recipientUserJids:[3,e.FLAGS.REPEATED|e.TYPES.STRING]},f.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescription",f.internalSpec={seq:[1,e.TYPES.INT32],signingDevice:[2,e.TYPES.BYTES],unknownDevices:[3,e.FLAGS.REPEATED|e.TYPES.BYTES],unknownDeviceIds:[4,e.FLAGS.REPEATED|e.TYPES.INT32]},g.name="MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessage",g.internalSpec={groupId:[1,e.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,e.TYPES.BYTES]},h.name="MessageTransport$Protocol$Integral",h.internalSpec={padding:[1,e.TYPES.BYTES],dsm:[2,e.TYPES.MESSAGE,y]},y.name="MessageTransport$Protocol$Integral$DeviceSentMessage",y.internalSpec={destinationJid:[1,e.TYPES.STRING],phash:[2,e.TYPES.STRING]},C.name="DeviceListMetadata",C.internalSpec={senderKeyHash:[1,e.TYPES.BYTES],senderTimestamp:[2,e.TYPES.UINT64],recipientKeyHash:[8,e.TYPES.BYTES],recipientTimestamp:[9,e.TYPES.UINT64]},l.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=s,l.MessageTransportSpec=u,l.MessageTransport$PayloadSpec=c,l.MessageTransport$ProtocolSpec=d,l.MessageTransport$Protocol$AncillarySpec=m,l.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=p,l.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=_,l.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=f,l.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=g,l.MessageTransport$Protocol$IntegralSpec=h,l.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=y,l.DeviceListMetadataSpec=C}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7","WAJids","WAMsgTransport.pb"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e.type){case"text":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.externalId,supplementalKey:null};case"media":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.externalId,supplementalKey:null};case"reaction":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.originalMsgExternalId,supplementalKey:"reaction:"+o("WAJids").extractChatId__DANGEROUS(e.chatJid)};case"edit":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.originalMsgExternalId,supplementalKey:"edit:"+o("WAJids").extractChatId__DANGEROUS(e.chatJid)+":"+(e.timestamp*1e3).toString()}}}function s(e,t,n,r,a,i){i===void 0&&(i=2);var l;t!=null&&(l={destinationJid:t});var s;e!=null&&(s={applicationPayload:{payload:e,version:i}});var u=new(o("WABinary")).Binary;return o("WACryptoPkcs7").writeRandomPadMax16(u),{payload:s,protocol:{integral:{padding:u.readBuffer(),dsm:l},ancillary:{skdm:n==null?void 0:n,icdc:r==null?void 0:r,backupDirective:a==null?void 0:{actionType:a.actionType,messageId:a.messageId,supplementalKey:a.supplementalKey}}}}}l.backupDirectiveActionType=o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE,l.constructBackupDirective=e,l.asMessageTransport=s}),98);
__d("WABuildMpsPayload",["MpsFutureProofKey","MpsTypes","WAArmadilloBackupMessage.pb","WAArmadilloMiTransportAdminMessage.pb","WAArmadilloTransportEvent.pb","WAGlobals","WAJids","WALogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n=o("WAJids").extractUserId(t.senderJid),r;t.hideDecryptionFailure!=null&&(r=t.hideDecryptionFailure?o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder:o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofPlaceholder);var a=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,babelHelpers.extends({},e,{metadata:{frankingMetadata:{frankingTag:t.frankingTag,reportingTag:t.reportingTag},messageId:t.externalId,payloadVersion:2,senderId:n,futureProofBehavior:r,timestampMs:t.timestampMs}})).readBuffer();return a}function d(e,t){var n=o("WAJids").extractUserId(t.senderJid),r=o("MpsTypes").toThreadId(t.threadId),a=t.millisServerTs!=null?t.millisServerTs:t.serverTs*1e3+o("WAGlobals").getDependencies().extractMsFromStanzaId(t.externalId),i=c(e,{senderJid:t.senderJid,externalId:t.externalId,frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:t.threadId,timestampMs:o("MpsTypes").toTimestamp(a)});return{messageId:o("MpsTypes").toMessageId(t.externalId),payload:o("MpsTypes").toBytes(i),senderId:n,threadId:r,timestampMs:o("MpsTypes").toTimestamp(a)}}function m(t,n,r){try{var a={};switch(r.type){case"message":a={encryptedTransportMessage:r.applicationPayload};break;case"ciphertext":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;case"unavailable":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;default:r.type}return d(a,{senderJid:o("WAJids").extractUserJid(n.from),externalId:t.stanzaId,serverTs:t.serverTs,frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:n.chat})}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["buildMpsMessagePayload: ",""])),t),null}}function p(e,t,n){if(n.payload==null)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: No appdata payload"]))),null;try{return d({encryptedTransportMessage:n.payload},{senderJid:o("WAJids").extractUserJid(e.from),externalId:e.stanzaId,serverTs:t,threadId:o("WAJids").extractUserJid(e.from)})}catch(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: ",""])),e),null}}function _(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupMembershipAddModeChanged:{mode:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function f(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupAdminChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function g(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupParticipantChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function h(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupNameChanged:{groupName:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function y(e,t,n){var r={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{icdcAlert:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$IcdcAlert$Type.DETECTED}}}).readBuffer(),version:3};return d({encryptedTransportEvent:r},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}function C(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{deviceChange:{type:r,devicePlatform:a,deviceModel:i}}}).readBuffer(),version:3};return d({encryptedTransportEvent:l},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}l.buildBackupProtobufBytes=c,l.buildMpsMessage=d,l.buildMpsMessageFromIncomingMessage=m,l.buildMpsAppdataPayload=p,l.buildMpsGroupMemberAddType=_,l.buildMpsGroupAdminChangedMsg=f,l.buildMpsGroupParticipantsChanged=g,l.buildMpsGroupNameChangedMsg=h,l.buildMpsIcdcAdminMessage=y,l.buildMpsDeviceChangeAdminMessage=C}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WAParsableXmlNode").convertBytesToUint(e.registrationElementValue,4)}l.registrationIdMixin=e}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{id:o("WAParsableXmlNode").convertBytesToUint(e.skeyIdKeyIDMixin.elementValue,3),pubkey:e.skeyValueKeyDataMixin.elementValue,signature:e.skeySignatureElementValue}}l.convertSignedPreKeyMixin=e}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"code",400,499);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFallbackClientMixin=e}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","not-acceptable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",406);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorNoValidJIDMixin=e}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:n.value});var r=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return r.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[t,n,r])}l.parseRequestErrorsFetch=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrorsFetch:i.value})):i}l.parseFetchKeyBundlesResponseRequestError=e}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"code",500,599);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFallbackServerMixin=e}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","service-unavailable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",503);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorServiceUnavailableMixin=e}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:t.value});var n=o("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[t,n])}l.parseServerErrors=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseFetchKeyBundlesResponseServerError=e}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e,s={validators:[(e=o("WAJids")).validateDeviceJid,e.validateDeviceJid],typeName:"DeviceJid|DeviceJid"},u={validators:[e.validateDeviceJid,e.validateDeviceJid,e.validateInteropDeviceJid,e.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"},c={validators:[e.validateDeviceJid,e.validateDomainJid],typeName:"DeviceJid|DomainJid"},d={validators:[e.validateUserJid,e.validateUserJid],typeName:"UserJid|UserJid"};l.DEVICEJID_DEVICEJID=s,l.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=u,l.DEVICEJID_DOMAINJID=c,l.USERJID_USERJID=d}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInPreKeysResponsePaddingMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"iq");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"padding");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(n.value,0,524288);return r.success?o("WAResultOrError").makeResult({paddingElementValue:r.value}):r}l.parseResponsePaddingMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(n.value,"text");if(!r.success)return r;var a=o("WASmaxParseUtils").attrIntRange(n.value,"code",500,599);return a.success?o("WAResultOrError").makeResult({errorText:r.value,errorCode:a.value}):a}l.parseFetchKeyBundlesUserErrorFallbackMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(n.value,"text");if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,n.value,"code",500);return a.success?o("WAResultOrError").makeResult({errorText:r.value,errorCode:a.value}):a}l.parseFetchKeyBundlesUserErrorMixin=e}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"device-identity");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytes(t.value);return n.success?o("WAResultOrError").makeResult({deviceIdentityElementValue:n.value}):n}l.parseDeviceIdentityMixin=e}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").contentBytesRange(e,32,32);return t.success?o("WAResultOrError").makeResult({elementValue:t.value}):t}l.parseKeyDataMixin=e}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"identity");if(!t.success)return t;var n=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(t.value);return n.success,n}l.parseIdentityKeyMixin=e}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"type");if(!t.success)return t;var n=o("WASmaxParseUtils").contentLiteralBytes(t.value,new Uint8Array([5]));return n.success?o("WAResultOrError").makeResult({typeElementValue:n.value}):n}l.parseKeyTypeMixin=e}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"id");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(e,3,3);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}l.parseKeyIDMixin=e}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"key");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"id");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"value");if(!r.success)return r;var a=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(n.value);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(r.value);return i.success?o("WAResultOrError").makeResult({keyIdKeyIDMixin:a.value,keyValueKeyDataMixin:i.value}):i}l.parsePreKeyMixin=e}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"registration");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(t.value,4,4);return n.success?o("WAResultOrError").makeResult({registrationElementValue:n.value}):n}l.parseRegistrationIDMixin=e}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"skey");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"id");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"value");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"signature");if(!a.success)return a;var i=o("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!i.success)return i;var l=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(n.value);if(!l.success)return l;var s=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(r.value);return s.success?o("WAResultOrError").makeResult({skeySignatureElementValue:i.value,skeyIdKeyIDMixin:l.value,skeyValueKeyDataMixin:s.value}):s}l.parseSignedPreKeyMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"t",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").optionalLiteral(o("WASmaxParseUtils").attrString,e,"is_cloud_api","true");if(!r.success)return r;var a=o("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(e);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(e),l=o("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(e);if(!l.success)return l;var s=o("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(e),u=o("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(e);if(!u.success)return u;var c=o("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({t:n.value,isCloudApi:r.value},a.value,{keyTypeMixin:i.success?i.value:null},l.value,{preKeyMixin:s.success?s.value:null},u.value,{deviceIdentityMixin:c.success?c.value:null}))}l.parseFetchKeyBundlesUserSuccessMixin=e}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:t.value});var n=o("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:n.value});var r=o("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(e);return r.success?o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["UserSuccess","UserError","UserErrorFallback"],[t,n,r])}l.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysResponsePaddingMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseJid").attrJidEnum(e,"jid",o("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!n.success)return n;var r=o("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(e);return r.success?o("WAResultOrError").makeResult({jid:n.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:r.value}):r}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"list");if(!a.success)return a;var i=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxInPreKeysResponsePaddingMixin").parseResponsePaddingMixin(t),s=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"user",0,1e5,e);return s.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{responsePaddingMixin:l.success?l.value:null,listUser:s.value})):s}l.parseFetchKeyBundlesResponseSuccessListUser=e,l.parseFetchKeyBundlesResponseSuccess=s}),98);
__d("WASmaxAttrs",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return t==null?o("WAWap").DROP_ATTR:e(t)}function s(e,t){return t?e:o("WAWap").DROP_ATTR}l.OPTIONAL=e,l.OPTIONAL_LITERAL=s}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return t==null?null:e(t)}function s(e,t){if(t==null)return null;if(t)return e()}function u(e,t){if(t){for(var n=1;n<t.length;n++)if(!o("WADeepEquals").deepEqual(t[n],t[0]))throw new Error("expected all homogeneous children to be equal, but they were not")}var r=d(e,t,0,1/0);return r}function c(e,t){return m(e,t,0,1/0)}function d(e,t,n,r){if(t==null){if(n>0)throw new Error("expected at least "+n+" children, but none provided");return[]}var o=t.length;if(o<n)throw new Error("expected at least "+n+" children, but found "+o);if(o>r)throw new Error("expected at most "+r+" children, but found "+o);return t.map(function(t){return e(t)})}function m(e,t,n,r){if(t===0){if(n>0)throw new Error("expected at least "+n+" children, but none provided");return[]}if(t<n)throw new Error("expected at least "+n+" children, but found "+t);if(t>r)throw new Error("expected at most "+r+" children, but found "+t);for(var o=[],a=0;a<t;a++)o.push(e());return o}l.OPTIONAL_CHILD=e,l.HAS_OPTIONAL_CHILD=s,l.HOMOGENEOUS_CHILD=u,l.HOMOGENEOUS_CHILD_COUNT=c,l.REPEATED_CHILD=d,l.REPEATED_CHILD_COUNT=m}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),xmlns:"encrypt",to:o("WAWap").S_WHATSAPP_NET});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeClientRequestMixin=s}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=e.hasUserReasonIdentity,r=o("WASmaxJsx").smax("user",{jid:o("WAWap").JID(t),reason:o("WASmaxAttrs").OPTIONAL_LITERAL("identity",n)});return r}function s(t){var n=t.userArgs,r=o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"get"},o("WASmaxJsx").smax("key",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,1e5))));return r}l.makeFetchKeyBundlesRequestKeyUser=e,l.makeFetchKeyBundlesRequest=s}),98);
__d("WASmaxParsingFailure",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,"SmaxParsingFailure: "+t)||this,n.name="SmaxParsingFailure",n.reason=t,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"SmaxParsingFailure: "+this.reason},t})(babelHelpers.wrapNativeSuper(Error));i.SmaxParsingFailure=e}),66);
__d("WASmaxRpcUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=Object.keys(t).map(function(e){var n=e==="Request"?"<request>":'<response name="'+e+'">';return"Tried "+n+", but failed with "+t[e].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+e+'">. '+n}i.errorMessageRpcParsing=e}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(r,n);if(a.success)return{name:"FetchKeyBundlesResponseSuccess",value:a.value};var i=o("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(r,n);if(i.success)return{name:"FetchKeyBundlesResponseRequestError",value:i.value};var l=o("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(r,n);if(l.success)return{name:"FetchKeyBundlesResponseServerError",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:a,RequestError:i,ServerError:l}))}),s.apply(this,arguments)}l.sendFetchKeyBundlesRPC=e}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){d.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."])),t.join(", "));var n=yield o("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:t.map(function(e){return{userJid:e,hasUserReasonIdentity:!1}})});switch(n.name){case"FetchKeyBundlesResponseSuccess":{d.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"])));var r=new Map;return n.value.listUser.map(function(e){var t=e.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;t.name==="FetchKeyBundlesUserSuccess"&&r.set(e.jid,_(t.value))}),o("WAResultOrError").makeResult(r)}case"FetchKeyBundlesResponseServerError":{var a=n.value.errorServerErrors.name;return d.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""])),a),o("WAResultOrError").makeError({type:"server-error",payload:a})}case"FetchKeyBundlesResponseRequestError":{var i=n.value.errorRequestErrorsFetch.name;return d.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""])),i),o("WAResultOrError").makeError({type:"request-error",payload:i})}}}),p.apply(this,arguments)}function _(e){var t=o("WAConvertRegistrationIdMixin").registrationIdMixin(e),n=o("WASignalKeys").serializeIdentity(e.elementValue),r=o("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(e),a=e.preKeyMixin?f(e.preKeyMixin):null,i=o("WATimeUtils").castToUnixTime(e.t||0);return{keys:{regId:t,identity:n,oneTimeKey:a,signedKey:{id:r.id,signature:r.signature,publicKey:o("WASignalKeys").serializeIdentity(r.pubkey)}},timestamp:i}}function f(e){return{id:o("WAParsableXmlNode").convertBytesToUint(e.keyIdKeyIDMixin.elementValue,3),publicKey:o("WASignalKeys").serializeIdentity(e.keyValueKeyDataMixin.elementValue)}}l.fetchPreKeyBundlesProtocol=m}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(e);return t.success?o("WAResultOrError").makeResult(t.value):o("WAResultOrError").makeError("errRequestKeysParsingFailed")}),s.apply(this,arguments)}l.bulkRequestKeys=e}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return{lock:function(a,i){var r=new(o("WAResolvable")).Resolvable,l=a.map(function(e){return[e,new(o("WAResolvable")).Resolvable]});return(s||(s=n("Promise"))).all(l.map(function(e){var n=e[0],o=e[1];return t.enqueue(n,function(){return o.resolve(),r.promise})})).catch(function(){o("WATagsLogger").TAGS(["WALock"]).ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""])),a)}),s.all(l.map(function(e){var t=e[0],n=e[1];return n.promise})).then(function(){return i()}).finally(function(){r.resolve()})},wait:function(n){return t.wait(n)}}}l.makeLock=u}),98);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(t,n,r,o,a,i,l){"use strict";function e(e){e===void 0&&(e=-1);var t=new(o("WAPromiseQueue")).PromiseQueueMap(e);return o("WALock").makeLock(t)}l.makeLockMap=e}),98);
__d("WACryptoCurveConstants",[],(function(t,n,r,o,a,i){"use strict";var e=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),l=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),s=BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),u=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),c=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989");i.P=e,i.I=l,i.D=s,i.A=u,i.L=c}),66);
__d("WACryptoCurveEncoding",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){for(var t=BigInt(0),n=0;n<e.length;n++)t|=BigInt(e[n])<<BigInt(8)*BigInt(n);return t}function s(e){for(var t=new Uint8Array(32),n=e,r=0;r<32;r++)t[r]=Number(n&BigInt(255)),n>>=BigInt(8);return t}function u(e){if(e.length%2)throw r("err")("hexToU8: odd string length");for(var t=new Uint8Array(e.length/2),n=0;n<t.length;n++)t[n]=parseInt(e.slice(2*n,2*n+2),16);return t}l.bytesToBigIntLE=e,l.bigIntTo32LE=s,l.hexToU8=u}),98);
__d("WACryptoCurveTransformations",["WACryptoCurveConstants","WACryptoCurveEncoding","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return(e%o("WACryptoCurveConstants").P+o("WACryptoCurveConstants").P)%o("WACryptoCurveConstants").P}function s(e){return u(e,o("WACryptoCurveConstants").P-BigInt(2))}function u(t,n){for(var r=e(t),o=n,a=BigInt(1);o>BigInt(0);)o&BigInt(1)&&(a=e(a*r)),r=e(r*r),o>>=BigInt(1);return a}function c(t,n){var a=e(t*s(n)),i=u(a,o("WACryptoCurveConstants").P+BigInt(3)>>BigInt(3)),l=e(i*i);if(l!==a&&(i=e(i*o("WACryptoCurveConstants").I),l=e(i*i),l!==a))throw r("err")("Montgomery u is on the twist (no sqrt for v)");return i}function d(t){var n=e(o("WACryptoCurveEncoding").bytesToBigIntLE(t));if(n===o("WACryptoCurveConstants").P-BigInt(1))throw r("err")("u == -1 (mod p): cannot convert");var a=e(e(n-BigInt(1))*s(e(n+BigInt(1))));return o("WACryptoCurveEncoding").bigIntTo32LE(a)}function m(t,n){return{X:t,Y:n,Z:BigInt(1),T:e(t*n)}}function p(t){var n=e(t.x),o=e(t.y),a=e(BigInt(1)-o);if(a===BigInt(0))throw r("err")("y == 1: map undefined");var i=e((BigInt(1)+o)*s(a)),l=n===BigInt(0)?void 0:e(i*s(n));return{u:i,v:l}}function _(e){var t=e.x,n=e.y,r=o("WACryptoCurveEncoding").bigIntTo32LE(n),a=(t&BigInt(1))===BigInt(1)?128:0;return r[31]|=a,r}function f(t){if(!(t instanceof Uint8Array)||t.length!==32)throw r("err")("Compressed Ed25519 key is not 32 bytes");var n=t[31],a=(n&128)!==0,i=t.slice();i[31]&=127;var l=e(o("WACryptoCurveEncoding").bytesToBigIntLE(i)),s=e(l*l),u=e(s-BigInt(1)),d=e(o("WACryptoCurveConstants").D*s+BigInt(1)),m=c(u,d);if((m&BigInt(1))!==(a?BigInt(1):BigInt(0))&&(m=e(-m)),m===BigInt(0)&&a)throw r("err")("Error during decompression of Ed25519: x coord is 0 but sign bit set");return{x:m,y:l}}l.mod=e,l.toEdwardsCompressed=d,l.affineToExtended=m,l.fromAffineToMontgomeryUV=p,l.compressEd25519=_,l.decompressEd25519=f}),98);
__d("WACryptoCurveEd25519PointOps",["WACryptoCurveConstants","WACryptoCurveTransformations","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=e.X,a=e.Y,i=e.Z,l=e.T,s=t.X,u=t.Y,c=t.Z,d=t.T,m=(n=o("WACryptoCurveTransformations")).mod(r*s),p=n.mod(a*u),_=n.mod(l*o("WACryptoCurveConstants").D*d),f=n.mod(i*c),g=n.mod((r+a)*(s+u)-m-p),h=n.mod(f-_),y=n.mod(f+_),C=n.mod(p-o("WACryptoCurveConstants").A*m),b=n.mod(g*h),v=n.mod(y*C),S=n.mod(h*y),R=n.mod(g*C);return{X:b,Y:v,Z:S,T:R}}function s(e){var t,n=e.X,r=e.Y,a=e.Z,i=(t=o("WACryptoCurveTransformations")).mod(n*n),l=t.mod(r*r),s=t.mod(BigInt(2)*t.mod(a*a)),u=t.mod(o("WACryptoCurveConstants").A*i),c=n+r,d=t.mod(t.mod(c*c)-i-l),m=t.mod(u+l),p=t.mod(m-s),_=t.mod(u-l);return{X:t.mod(d*p),Y:t.mod(m*_),Z:t.mod(p*m),T:t.mod(d*_)}}function u(e,t){var n,r=e.X,a=e.Y,i=e.Z,l=t.X,s=t.Y,u=t.Z,c=(n=o("WACryptoCurveTransformations")).mod(r*u),d=n.mod(l*i),m=n.mod(a*u),p=n.mod(s*i);return c===d&&m===p}function c(t,n){for(var r={X:BigInt(0),Y:BigInt(1),Z:BigInt(1),T:BigInt(0)},o=t,a=n;a>BigInt(0);)a&BigInt(1)&&(r=e(r,o)),o=s(o),a>>=BigInt(1);return r}function d(e){var t,n=e.X,a=e.Y,i=e.Z,l=e.T,s=(t=o("WACryptoCurveTransformations")).mod(n*n),u=t.mod(a*a),c=t.mod(i*i),d=t.mod(c*c),m=t.mod(s*o("WACryptoCurveConstants").A),p=t.mod(c*t.mod(m+u)),_=t.mod(d+t.mod(o("WACryptoCurveConstants").D*t.mod(s*u)));if(p!==_)throw r("err")("bad point: equation left != right (1)");var f=o("WACryptoCurveTransformations").mod(n*a),g=o("WACryptoCurveTransformations").mod(i*l);if(f!==g)throw r("err")("bad point: equation left != right (2)");return!0}l.addPoints=e,l.doublePoint=s,l.equalPoints=u,l.scalarMult=c,l.isPointValid=d}),98);
__d("WACryptoCurveKeyCanonicalCheck",["WACryptoCurveConstants","WACryptoCurveEd25519PointOps","WACryptoCurveEncoding","WACryptoCurveTransformations"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WACryptoCurveEd25519PointOps").equalPoints(e,{X:BigInt(0),Y:BigInt(1),Z:BigInt(1),T:BigInt(0)})}function s(e){var t=o("WACryptoCurveEncoding").bytesToBigIntLE(e);return t<o("WACryptoCurveConstants").P}function u(t){try{var n=o("WACryptoCurveTransformations").toEdwardsCompressed(t),r=o("WACryptoCurveTransformations").decompressEd25519(n),a=r.x,i=r.y,l=o("WACryptoCurveTransformations").affineToExtended(a,i),s=o("WACryptoCurveEd25519PointOps").scalarMult(l,o("WACryptoCurveConstants").L);return e(s)}catch(e){return!1}}function c(e){return u(e)&&s(e)}l.isIdentity=e,l.isInRange=s,l.isTorsionFree=u,l.isCanonical=c}),98);
__d("WACryptoLibraryConfig",[],(function(t,n,r,o,a,i){"use strict";var e={signalFutureMessagesMax:2e3,S508658PreventOldSessionLookupAndPromote:!1,S508658AutoAcknowledgeStaleSessions:!1,baseKeyCanonicalCheck:!1};function l(){return e}function s(t){e=t}i.getCryptoLibraryConfig=l,i.setCryptoLibraryConfig=s}),66);
__d("WASignalSessions",["WABinary","WACryptoLibraryConfig","WASignalKeys","WASignalOther","err"],(function(t,n,r,o,a,i,l){"use strict";var e=3;function s(e){return!o("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658AutoAcknowledgeStaleSessions||e.initialExchangeInfo==null?e:y(e.local,e.remote,e.rootKey,e.recvChains,e.sendChain,null,e.prevSendChainHighestIndex,e.prevSessions,e.aliceBaseKey)}function u(e,t){return c(e,0,t,[])}function c(e,t,n,r){return{ratchetPubKey:e,nextMsgIndex:t,chainKey:n,unusedMsgKeys:r}}function d(e,t){return m(e,0,t)}function m(e,t,n){return{ratchetKey:e,nextMsgIndex:t,chainKey:n}}function p(e,t,n){return{remoteOneTimeId:e,remoteSignedId:t,localOneTimePubKey:n}}function _(e,t){return y(e.local,e.remote,e.rootKey,e.recvChains,e.sendChain,e.initialExchangeInfo,e.prevSendChainHighestIndex,t,e.aliceBaseKey)}function f(e,t,n){return y(e.local,e.remote,e.rootKey,t,n,e.initialExchangeInfo,e.prevSendChainHighestIndex,e.prevSessions,e.aliceBaseKey)}function g(e,t,n,r){return n===void 0&&(n=e.sendChain),y(e.local,e.remote,r,t,n,null,Math.max(e.sendChain.nextMsgIndex-1,0),e.prevSessions,e.aliceBaseKey)}function h(e,t,n,r,o,a,i){return y(e,t,n,r,o,a,0,[],i)}function y(e,t,n,r,o,a,i,l,s){return{local:e,remote:t,rootKey:n,sendChain:o,recvChains:r,initialExchangeInfo:a,prevSendChainHighestIndex:i,prevSessions:l,aliceBaseKey:s}}function C(e,t){var n=new(o("WABinary")).Binary(t),r=o("WASignalOther").readBytes(n,32),a=o("WASignalOther").readBytes(n,32),i=o("WASignalOther").readBytes(n,16);return b(e,r,a,i)}function b(e,t,n,r){return{index:e,cipherKey:t,macKey:n,iv:r}}function v(e){return{senderRatchetKey:e.ratchetPubKey,chainKey:{index:e.nextMsgIndex,key:e.chainKey},messageKeys:e.unusedMsgKeys}}function S(e){var t=e.ratchetKey;return{senderRatchetKey:t.serializedPubKey,senderRatchetKeyPrivate:t.privateKey,chainKey:{index:e.nextMsgIndex,key:e.chainKey}}}function R(t){var n=t.local,r=t.remote,o=t.initialExchangeInfo,a=void 0;if(o){var i=o.remoteOneTimeId;a={preKeyId:i!=null?i:void 0,signedPreKeyId:o.remoteSignedId,baseKey:o.localOneTimePubKey}}return{currentSession:{sessionVersion:e,localIdentityPublic:n.pubKey,remoteIdentityPublic:r.pubKey,rootKey:t.rootKey,previousCounter:t.prevSendChainHighestIndex,senderChain:S(t.sendChain),receiverChains:t.recvChains.map(v),pendingPreKey:a,remoteRegistrationId:r.regId,localRegistrationId:n.regId,aliceBaseKey:t.aliceBaseKey},previousSessions:t.prevSessions}}function L(t){var n=t.local,r=t.remote,a=t.sendChain,i=t.initialExchangeInfo,l=void 0;if(i){var s=i.remoteOneTimeId;l={preKeyId:s!=null?s:void 0,signedPreKeyId:i.remoteSignedId,baseKey:o("WASignalOther").toBuffer(i.localOneTimePubKey)}}return{sessionVersion:e,localIdentityPublic:o("WASignalOther").toBuffer(n.pubKey),remoteIdentityPublic:o("WASignalOther").toBuffer(r.pubKey),rootKey:o("WASignalOther").toBuffer(t.rootKey),previousCounter:t.prevSendChainHighestIndex,senderChain:{senderRatchetKey:o("WASignalOther").toBuffer(a.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:o("WASignalOther").toBuffer(a.ratchetKey.privateKey),chainKey:{index:a.nextMsgIndex,key:o("WASignalOther").toBuffer(a.chainKey)},messageKeys:[]},receiverChains:t.recvChains.map(function(e){return{senderRatchetKey:o("WASignalOther").toBuffer(e.ratchetPubKey),chainKey:{index:e.nextMsgIndex,key:o("WASignalOther").toBuffer(e.chainKey)},messageKeys:e.unusedMsgKeys.map(function(e){return{index:e.index,cipherKey:o("WASignalOther").toBuffer(e.cipherKey),macKey:o("WASignalOther").toBuffer(e.macKey),iv:o("WASignalOther").toBuffer(e.iv)}})}}),pendingPreKey:l,remoteRegistrationId:r.regId,localRegistrationId:n.regId,aliceBaseKey:t.aliceBaseKey==null?void 0:o("WASignalOther").toBuffer(t.aliceBaseKey)}}function E(e){var t=$(e.currentSession,"currentSession");return I(t,e.previousSessions)}function k(e){return I(e,[])}function I(t,n){var a=$(t.sessionVersion,"sessionVersion");if(a!==e)throw r("err")("Signal: bad session version "+a);var i=$(t.senderChain,"senderChain"),l=$(i.chainKey,"senderChain.chainKey"),s=m(o("WASignalKeys").makeSerializedKeyPairFrom(x(i.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),D(i.senderRatchetKey,"senderRatchetKey")),$(l.index,"senderChain.chainKey.index"),x(l.key,32,"senderChain.chainKey.key")),u=$(t.receiverChains,"receiverChains").map(function(e){var t=$(e.chainKey,"receiverChains[].chainKey");return c(D(e.senderRatchetKey,"receiverChains[].senderRatchetKey"),$(t.index,"receiverChains[].chainKey.index"),x(t.key,32,"receiverChains[].chainKey.key"),T(e.messageKeys))}),d={regId:o("WASignalOther").castRegistrationId($(t.localRegistrationId,"localRegistrationId")),pubKey:D(t.localIdentityPublic,"localIdentityPublic")},_={regId:o("WASignalOther").castRegistrationId($(t.remoteRegistrationId,"remoteRegistrationId")),pubKey:D(t.remoteIdentityPublic,"remoteIdentityPublic")},f=t.pendingPreKey,g=null;if(f){var h=f.preKeyId;g=p(h!=null?o("WASignalKeys").castToPreKeyId(h):null,o("WASignalKeys").castToSignedPreKeyId($(f.signedPreKeyId,"pendingPreKey.signedPreKeyId")),D(f.baseKey,"pendingPreKey.baseKey"))}var C=t.aliceBaseKey==null?null:D(t.aliceBaseKey,"aliceBaseKey");return y(d,_,x(t.rootKey,32,"rootKey"),u,s,g,t.previousCounter||0,n,C)}function T(e){return e.map(function(e){return{index:$(e.index,"messageKeys[].index"),cipherKey:x(e.cipherKey,32,"messageKeys[].cipherKey"),macKey:x(e.macKey,32,"messageKeys[].macKey"),iv:x(e.iv,16,"messageKeys[].iv")}})}function D(e,t){return o("WASignalKeys").castToSerializedPubKey(new Uint8Array($(e,t)))}function x(e,t,n){return o("WASignalOther").toBytes($(e,n),t)}function $(e,t){if(e==null)throw r("err")("Signal: protobuf is missing "+t);return e}l.FORMAT_VERSION=e,l.maybeClearPendingPreKey=s,l.makeFreshRecvChain=u,l.makeRecvChain=c,l.makeFreshSendChain=d,l.makeSendChain=m,l.makeInitialExchangeInfo=p,l.setPrevSessions=_,l.updateChains=f,l.ratchetSession=g,l.makeFreshSession=h,l.makeSession=y,l.splitMsgKey=C,l.serializeSession=R,l.detachSession=L,l.parseSessionFromRecord=E,l.parseSession=k,l._parseSession=I,l.bytesOrThrow=x,l.definedOrThrow=$}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){var n=e;e=[];try{return t()}finally{(e!=null?e:[]).forEach(function(e){return void e.fill(0)}),e=n}}function u(t,n){if(e==null)throw r("err")("allocate called outside of active scope");return new t(n)}function c(e,t,n){o("WACryptoPrimitives").lowlevel.crypto_hash(e,t,n)}function d(e,t){for(var n=0;n<64;++n)t[n]=e[n],e[n]=0;_(e,t),t.fill(0)}function m(e,t){var n=[p(),p(),p(),p()];o("WACryptoPrimitives").lowlevel.scalarbase(n,t),j(e,n)}function p(e){var t=u(Float64Array,16);if(e){if(e.length>16)throw r("err")("Incorrect initialiser array provided to the fieldElement");for(var n=0;n<e.length;n++)t[n]=e[n]}return t}function _(e,t){o("WACryptoPrimitives").lowlevel.modL(e,t)}var f=function(){return p([0])},g=function(){return p([1])},h=function(){return p([2])},y=function(){return p([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function C(){return[p(),p(),p(),p()]}function b(){return[p(),p(),p(),p()]}function v(){return[p(),p(),p()]}function S(e,t){for(var n=0,r=t;r>0;){var o=r%65536;e[n]=o,r=(r-o)/65536,n++}}function R(e,t){return Q(e,t)?0:1}function L(e){var t=o("WACryptoPrimitives").lowlevel.pack25519,n=u(Uint8Array,32);return t(n,e),n[0]&1}function E(e,t){var n=o("WACryptoPrimitives").lowlevel.S,r=o("WACryptoPrimitives").lowlevel.M,a=h(),i=p();n(i,t),r(e,a,i)}function k(e,t){var n=o("WACryptoPrimitives").lowlevel.S,r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.A,i=f(),l=g(),s=p(),u=p(),c=p(),d=p();S(i,486662),n(s,t),r(u,i,t),a(c,s,u),a(d,c,l),r(e,t,d)}function I(e,t,n){n===1&&e.set(t)}var T=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function D(e,t){var n,r=(n=o("WACryptoPrimitives")).lowlevel.unpack25519,a=n.lowlevel.pow2523,i=n.lowlevel.M,l=n.lowlevel.S,s=p();r(s,T);var u=p();a(u,t);var c=p();i(c,t,u);var d=p();l(d,c);var m=p();i(m,c,s),I(c,m,1^R(d,t)),e.set(c)}function x(e,t){var n=o("WACryptoPrimitives").lowlevel.Z,r=o("WACryptoPrimitives").lowlevel.A,a=o("WACryptoPrimitives").lowlevel.M,i=g(),l=p(),s=p(),u=p();n(l,t,i),r(s,t,i),K(u,s),a(e,l,u)}function $(e,t){var n=o("WACryptoPrimitives").lowlevel.Z,r=f();n(e,r,t)}function P(e,t){var n=o("WACryptoPrimitives").lowlevel.M;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3])}function N(e,t){var n=o("WACryptoPrimitives").lowlevel.M;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3]),n(e[3],t[0],t[1])}function M(e,t){var n=o("WACryptoPrimitives").lowlevel.S,r=o("WACryptoPrimitives").lowlevel.A,a=o("WACryptoPrimitives").lowlevel.Z;n(e[0],t[0]),n(e[2],t[1]),E(e[3],t[2]),r(e[1],t[0],t[1]);var i=p();n(i,e[1]),r(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],i,e[1]),a(e[3],e[3],e[2])}var w=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function A(e,t,n){var r=o("WACryptoPrimitives").lowlevel.unpack25519,a=o("WACryptoPrimitives").lowlevel.M,i=p();r(i,w);var l=p();x(l,t);var s=p();k(s,t);var u=p();D(u,s);var c=p();a(c,t,i);var d=p();K(d,u);var m=p();a(m,c,d);var _=p();$(_,m),I(m,_,L(m)^n),e[0].set(m),e[1].set(l),e[2].set(g()),a(e[3],e[0],e[1])}function F(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])}function O(e,t){var n=v();F(n,t),M(e,n)}function B(e,t){var n=b(),r=v();O(n,t),P(r,n),M(n,r),P(r,n),M(n,r),N(e,n)}function W(e){var t,n=(t=o("WACryptoPrimitives")).lowlevel.S,r=t.lowlevel.M,a=t.lowlevel.pow2523,i=t.lowlevel.pack25519,l=p(),s=p(),u=p(),c=p(),d=p();a(l,e),n(s,l),n(u,s),r(c,u,e),r(d,c,e);var m=new Uint8Array(32);return i(m,d),1&m[31]}function q(e,t){$(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),$(e[3],t[3])}function U(e,t){var n=C(),r=X(n,t);return r!==0?-1:(q(e,n),0)}function V(e,t){var n=o("WACryptoPrimitives").lowlevel.M,r=o("WACryptoPrimitives").lowlevel.A,a=t,i=g(),l=f();S(l,486662);var s=p();E(s,a);var u=p();r(u,s,i);var c=p();K(c,u);var d=p();n(d,c,l);var m=p();$(m,d);var _=p();k(_,m);var h=W(_),y=p([0]);I(y,l,h);var C=p();r(C,m,y);var b=p();$(b,C),I(C,b,h),e.set(C)}function H(e){var t=o("WACryptoPrimitives").lowlevel.unpack25519,n=o("WACryptoPrimitives").hash(e),r=(n[31]&128)>>7;n[31]&=127;var a=p();t(a,n);var i=p();G(i,a);var l=C();A(l,i,r);var s=C();return B(s,l),s}function G(e,t){return s(function(){return V(e,t)})}function z(e){return s(function(){return H(e)})}function j(e,t){var n=p(),r=p(),a=p(),i=o("WACryptoPrimitives").lowlevel.M,l=o("WACryptoPrimitives").lowlevel.pack25519;K(a,t[2]),i(n,t[0],a),i(r,t[1],a),l(e,r);var s=new Uint8Array(32);l(s,n),e[31]^=(s[0]&1)<<7}function K(e,t){var n=p();n.set(t);for(var r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.S,i=253;i>=0;--i)a(n,n),i!==2&&i!==4&&r(n,n,t);e.set(n)}function Q(e,t){var n=o("WACryptoPrimitives").lowlevel.pack25519,r=o("WACryptoPrimitives").lowlevel.crypto_verify_32,a=new Uint8Array(32),i=new Uint8Array(32);return n(a,e),n(i,t),r(a,0,i,0)}function X(e,t){var n,r=(n=o("WACryptoPrimitives")).lowlevel.set25519,a=n.lowlevel.S,i=n.lowlevel.M,l=n.lowlevel.Z,s=n.lowlevel.A,u=n.lowlevel.D,c=n.lowlevel.unpack25519,d=n.lowlevel.pow2523,m=p(),_=p(),h=p(),C=p(),b=p(),v=p(),S=p();return r(e[2],g()),c(e[1],t),a(h,e[1]),i(C,h,u),l(h,h,e[2]),s(C,e[2],C),a(b,C),a(v,b),i(S,v,b),i(m,S,h),i(m,m,C),d(m,m),i(m,m,h),i(m,m,C),i(m,m,C),i(e[0],m,C),a(_,e[0]),i(_,_,C),Q(_,h)&&i(e[0],e[0],y()),a(_,e[0]),i(_,_,C),Q(_,h)?-1:(Y(e[0])===t[31]>>7&&l(e[0],f(),e[0]),i(e[3],e[0],e[1]),0)}function Y(e){var t=o("WACryptoPrimitives").lowlevel.pack25519,n=new Uint8Array(32);return t(n,e),n[0]&1}l.runInAllocationScope=s,l.allocate=u,l.hashSha512=c,l.reduce=d,l.scalarmultBase=m,l.fieldElement=p,l.modL=_,l.p3Element=C,l.unpack=U,l.elligator=G,l.hashToPoint=z,l.pack=j,l.inv25519=K,l.unpackneg=X}),98);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAHex","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return o("WACryptoEd25519").runInAllocationScope(function(){var r,a=t.length,i=e.privateKey,l=new Uint8Array(32);(r=o("WACryptoEd25519")).scalarmultBase(l,i);var s=l[31]&128,u=new Uint8Array(a+128);u[0]=254,u.fill(255,1,32),u.set(i,32),u.set(t,64),u.set(n,a+64);var c=r.allocate(Uint8Array,64);r.hashSha512(c,u,a+128),u.set(l,32);var d=r.allocate(Float64Array,64);r.reduce(c,d),r.scalarmultBase(u,c);var m=r.allocate(Uint8Array,64);r.hashSha512(m,u,a+64),r.reduce(m,d);var p,_;for(p=0;p<32;++p)d[p]=c[p];for(p=0;p<32;++p)for(_=0;_<32;++_)d[p+_]+=m[p]*i[_];return r.modL(u.subarray(32,64),d),{pubKeyNegative:s!==0,signedMsg:u}})}function u(t,r){return(e||(e=n("Promise"))).resolve().then(function(){var e=o("WASignalOther").makeBytes(64);return o("WACryptoDependencies").getCrypto().getRandomValues(e),d(t,r,e)})}function c(e,t,n){var r=n[63];return r&96?!1:o("WACryptoEd25519").runInAllocationScope(function(){var a,i,l=(a=o("WACryptoPrimitives")).lowlevel.A,s=a.lowlevel.M,u=a.lowlevel.Z,c=a.lowlevel.pack25519,d=a.lowlevel.unpack25519,m=(i=o("WACryptoEd25519")).allocate(Uint8Array,64);m.set(n),m[63]=r&127;var p=i.fieldElement(),_=i.fieldElement(),f=i.fieldElement(),g=i.fieldElement(),h=i.fieldElement(),y=i.allocate(Uint8Array,32),C=i.fieldElement();return C[0]=1,d(p,e.subarray(1)),u(_,p,C),l(f,p,C),i.inv25519(g,f),s(h,_,g),c(y,h),y[31]=y[31]&127|r&128,a.signDetachedVerify(t,m,y)})}function d(e,t,n){var r=s(e,t,n),a=o("WASignalOther").sliceBytes(r.signedMsg,0,64);return a[63]=a[63]&127|(r.pubKeyNegative?128:0),a}function m(e,t,n){var a=o("WASignalKeys").makeKeyPair(),i=o("WASignalOther").makeBytes(64);o("WACryptoDependencies").getCrypto().getRandomValues(i);var l=d(n,o("WASignalKeys").serializePubKey(a),i);if(!Number.isSafeInteger(t))throw r("err")("Expected timestamp to be a safe integer, given "+String(t));return{id:o("WASignalKeys").castToPreKeyId(e),ts:t,keyPair:a,signature:l}}function p(e,t){var n=o("WASignalOther").makeBytes(64);return o("WACryptoDependencies").getCrypto().getRandomValues(n),d(e,t,n)}function _(e){var t=e.id,n=e.keyPair;return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:t,publicKey:o("WASignalKeys").serializePubKey(n),privateKey:n.privateKey,signature:e.signature,timestamp:e.ts})}function f(e){try{var t=o("decodeProtobuf").decodeProtobuf(o("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,e),n=t.id,r=t.publicKey,a=t.privateKey,i=t.signature,l=t.timestamp;return n==null||r==null||a==null||i==null||l==null?null:{id:o("WASignalKeys").castToSignedPreKeyId(n),ts:o("WALongInt").numberOrThrowIfTooLarge(l),keyPair:o("WASignalKeys").makeKeyPairFromSerialized(o("WASignalOther").toBytes(a,32),o("WASignalKeys").castToSerializedPubKey(new Uint8Array(r))),signature:o("WASignalOther").toBytes(i,64)}}catch(e){return null}}function g(e){return new Uint8Array(o("WAHex").parseHex(e))}function h(e){if(e.length===33)return o("WASignalKeys").castToSerializedPubKey(e);if(e.length===32)return o("WASignalKeys").serializeIdentity(e);throw r("err")("verifyCertificate publicKey incorrect length")}function y(t,r,o){return(e||(e=n("Promise"))).resolve().then(function(){var e=m(t,r,o),n=_(e);return{plainObject:e,record:n}})}l.signMsg=u,l.verifyMsgSignalVariant=c,l.makeSignature=d,l.makeSignedPreKey=m,l.signSenderKeyMessage=p,l.serializeSignedPreKeyForPrivateStorage=_,l.deserializeSignedPreKey=f,l.convertPublicKeyHexToUint8Array=g,l.convertPublicKeyToSerializedPubKey=h,l.generateSignedPreKey=y}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={};s.internalSpec={ratchetKey:[1,(e=o("WAProtoConst")).TYPES.BYTES],counter:[2,e.TYPES.UINT32],previousCounter:[3,e.TYPES.UINT32],ciphertext:[4,e.TYPES.BYTES]},u.internalSpec={registrationId:[5,e.TYPES.UINT32],preKeyId:[1,e.TYPES.UINT32],signedPreKeyId:[6,e.TYPES.UINT32],baseKey:[2,e.TYPES.BYTES],identityKey:[3,e.TYPES.BYTES],message:[4,e.TYPES.BYTES]},c.internalSpec={id:[1,e.TYPES.UINT32],baseKey:[2,e.TYPES.BYTES],ratchetKey:[3,e.TYPES.BYTES],identityKey:[4,e.TYPES.BYTES],baseKeySignature:[5,e.TYPES.BYTES]},d.internalSpec={id:[1,e.TYPES.UINT32],iteration:[2,e.TYPES.UINT32],ciphertext:[3,e.TYPES.BYTES]},m.internalSpec={id:[1,e.TYPES.UINT32],iteration:[2,e.TYPES.UINT32],chainKey:[3,e.TYPES.BYTES],signingKey:[4,e.TYPES.BYTES]},p.internalSpec={generation:[1,e.TYPES.UINT32],signature:[2,e.TYPES.BYTES]},l.SignalMessageSpec=s,l.PreKeySignalMessageSpec=u,l.KeyExchangeMessageSpec=c,l.SenderKeyMessageSpec=d,l.SenderKeyDistributionMessageSpec=m,l.DeviceConsistencyCodeMessageSpec=p}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(t,n,r,o,a,i,l){"use strict";var e=5,s=3;function u(e){var t=o("WASignalSessions").definedOrThrow(e.senderSigningKey,"senderSigningKey"),n=o("WASignalSessions").definedOrThrow(e.senderMessageKeys,"senderMessageKeys"),r=o("WASignalSessions").definedOrThrow(e.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:S(t.public,"public"),senderSigningKeyPrivate:t.private?o("WASignalSessions").bytesOrThrow(t.private,32,"private"):void 0,senderKeyId:o("WASignalSessions").definedOrThrow(e.senderKeyId,"senderKeyId"),unusedMsgKeys:n.map(function(e){return _(o("WASignalSessions").definedOrThrow(e.iteration,"iteration"),o("WASignalSessions").bytesOrThrow(e.seed,50,"seed"))}),senderKeyChainKey:f(o("WASignalSessions").definedOrThrow(r.iteration,"iteration"),o("WASignalSessions").bytesOrThrow(r.seed,32,"seed"))}}function c(e,t,n,r,o){return{senderSigningKeyPublic:e,senderSigningKeyPrivate:t,senderKeyChainKey:n,senderKeyId:r,unusedMsgKeys:o==null?[]:o}}function d(e,t){var n=e.senderKeyStates.findIndex(function(e){return e.senderKeyId===t.senderKeyId});return{senderKeyStates:e.senderKeyStates.map(function(e,r){return r===n?t:e})}}function m(t,n){var r=t.senderKeyStates.slice(t.senderKeyStates.length>e-1?1:0);return r.push(n),{senderKeyStates:r}}function p(e){return{senderKeyStates:[e]}}function _(e,t){return{iteration:e,seed:t}}function f(e,t){return{nextMsgIndex:e,chainKey:t}}function g(e){var t=o("WASignalSessions").definedOrThrow(e.senderKeyStates,"senderKeyStates");return h(t)}function h(e){return y(e)}function y(e){var t=e.map(function(e){return u(e)});return{senderKeyStates:t}}function C(e,t){var n=e.senderKeyStates.findIndex(function(e){return e.senderKeyId===t});if(n!==-1)return e.senderKeyStates[n]}function b(e){return{senderKeyStates:e.senderKeyStates.map(function(e){return v(e)})}}function v(e){return{senderKeyId:e.senderKeyId,senderChainKey:{iteration:e.senderKeyChainKey.nextMsgIndex,seed:e.senderKeyChainKey.chainKey},senderSigningKey:{public:e.senderSigningKeyPublic,private:e.senderSigningKeyPrivate},senderMessageKeys:e.unusedMsgKeys.map(function(e){var t=e.iteration,n=e.seed;return{iteration:t,seed:n}})}}function S(e,t){return o("WASignalKeys").castToSerializedPubKey(new Uint8Array(o("WASignalSessions").definedOrThrow(e,t)))}function R(e){return e}l.FORMAT_VERSION=s,l.makeSenderKeyState=c,l.updateSessionWithUpdatedSenderKeyState=d,l.updateSessionWithNewSenderKeyState=m,l.makeNewSenderKeySession=p,l.makeSenderKeyMsgKey=_,l.makeSenderKeyChainKey=f,l.parseSessionFromRecord=g,l._parseSession=h,l.makeSenderKeySessionFromRecord=y,l.findSenderKeyState=C,l.serializeSession=b,l.serializeSenderKeyState=v,l.convertFromRawToSenderKeyState=R}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Uint8Array(32);s.fill(255);var u=new Uint8Array([1]),c=new Uint8Array([2]);function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a=e.regId,i=e.staticKeyPair,l=t.identity,u=t.signedKey.publicKey,c=n.privateKey,d=i.privateKey,m=(r=t.oneTimeKey)==null?void 0:r.publicKey,p=o("WABinary").Binary.build(s,E(d,u),E(c,l),E(c,u),m&&E(c,m)).readByteArrayView(),_=yield R(p,"WhisperText"),f=_[0],g=_[1],h=t.ratchetKey,y=o("WASignalSessions").makeFreshRecvChain(h,g),C=o("WASignalKeys").makeSerializedKeyPair(),b=yield v(f,C,h),S=o("WASignalSessions").makeInitialExchangeInfo(t.oneTimeKey==null?null:t.oneTimeKey.id,t.signedKey.id,o("WASignalKeys").serializePubKey(n));return o("WASignalSessions").makeFreshSession({regId:a,pubKey:o("WASignalKeys").serializePubKey(i)},{regId:t.regId,pubKey:l},b.rootKey,[y],o("WASignalSessions").makeFreshSendChain(C,b.chainKey),S,o("WASignalKeys").serializePubKey(n))}),m.apply(this,arguments)}function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a,i=e.regId,l=e.staticKeyPair,u=l.privateKey,c=r.signed.privateKey,d=n,m=t.pubKey,p=(a=r.oneTime)==null?void 0:a.privateKey,_=o("WABinary").Binary.build(s,k(m,c),k(d,u),k(d,c),p&&k(d,p)).readByteArrayView(),f=yield R(_,"WhisperText"),g=f[0],h=f[1],y=r.ratchet,C=o("WASignalSessions").makeFreshSendChain(y,h);return o("WASignalSessions").makeSession({regId:i,pubKey:o("WASignalKeys").serializePubKey(l)},t,g,[],C,null,0,[],n)}),_.apply(this,arguments)}function f(t){var r=o("WASignalGroupSession").makeSenderKeyState(o("WASignalKeys").serializePubKey(t),t.privateKey,o("WASignalGroupSession").makeSenderKeyChainKey(0,o("WASignalKeys").makeRawSenderKey()),o("WASignalOther").makeSenderKeyId(),[]);return(e||(e=n("Promise"))).resolve(o("WASignalGroupSession").makeNewSenderKeySession(r))}function g(t,r,a,i,l){var s=o("WASignalGroupSession").makeSenderKeyState(a,void 0,o("WASignalGroupSession").makeSenderKeyChainKey(r,i),t,[]),u=null;return l?u=o("WASignalGroupSession").updateSessionWithNewSenderKeyState(l,s):u=o("WASignalGroupSession").makeNewSenderKeySession(s),(e||(e=n("Promise"))).resolve(u)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield o("WASignalOther").makeCryptoKey(r,"hmac-sha256"),i=function(t){return o("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},a,t)},l=i(u).then(function(e){return o("WASignalOther").hkdf(new Uint8Array(e),null,"WhisperMessageKeys",80)}).then(function(e){return o("WASignalSessions").splitMsgKey(t,e)}),s=i(c).then(function(e){return o("WASignalOther").toBytes(e,32)});return(e||(e=n("Promise"))).all([s,l])}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield o("WASignalOther").makeCryptoKey(r,"hmac-sha256"),i=function(t){return o("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},a,t)},l=i(u).then(function(e){return o("WASignalOther").hkdf(new Uint8Array(e),null,"WhisperGroup",50)}).then(function(e){return o("WASignalGroupSession").makeSenderKeyMsgKey(t,e)}),s=i(c).then(function(e){return o("WASignalOther").toBytes(e,32)});return(e||(e=n("Promise"))).all([s,l])}),b.apply(this,arguments)}function v(e,t,n){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=t.privateKey,a=n,i=o("WASignalKeys").ecdh(r,a),l=yield R(new Uint8Array(i),"WhisperRatchet",e),s=l[0],u=l[1];return{rootKey:s,chainKey:u}}),S.apply(this,arguments)}function R(e,t,n){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){n===void 0&&(n=null);var r=yield o("WASignalOther").hkdf(e,n,t,64);return[o("WASignalOther").sliceBytes(r,0,32),o("WASignalOther").sliceBytes(r,32,32)]}),L.apply(this,arguments)}function E(e,t){return new Uint8Array(o("WASignalKeys").ecdh(e,t))}function k(e,t){return E(t,e)}l.initiateSessionOutgoing=d,l.initiateSessionIncoming=p,l.initiateSenderKeySessionOutgoing=f,l.initiateSenderKeySessionIncoming=g,l.deriveMsgKey=h,l.deriveSenderKeyMsgKey=C,l.calculateRatchet=v}),98);
__d("WASignalCipher",["Promise","WABinary","WACryptoCurveKeyCanonicalCheck","WACryptoDependencies","WACryptoLibraryConfig","WACryptoUtils","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s=40,u=8,c=2e3;function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.sendChain,r=yield o("WASignalWhitepaper").deriveMsgKey(n.nextMsgIndex,n.chainKey),a=r[0],i=r[1],l=yield T(i),s=l.cipherKey,c=l.macKey,d=yield o("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:i.iv},s,t),m=new(o("WABinary")).Binary;m.writeByteArray(e.local.pubKey),m.writeByteArray(e.remote.pubKey);var p=m.size();m.writeUint8(E(o("WASignalSessions").FORMAT_VERSION,o("WASignalSessions").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:n.ratchetKey.serializedPubKey,counter:i.index,previousCounter:e.prevSendChainHighestIndex,ciphertext:d},m);var _=m.readByteArrayView(),f=yield I(c,_),g=_.subarray(p),h=o("WABinary").Binary.build(g,new Uint8Array(f,0,u)).readByteArrayView(),y,C,b=e.initialExchangeInfo;if(b!=null){var v,S=new(o("WABinary")).Binary;S.writeUint8(E(o("WASignalSessions").FORMAT_VERSION,o("WASignalSessions").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:e.local.regId,preKeyId:(v=b.remoteOneTimeId)!=null?v:void 0,signedPreKeyId:b.remoteSignedId,baseKey:b.localOneTimePubKey,identityKey:e.local.pubKey,message:h},S),y="pkmsg",C=S.readByteArrayView()}else y="msg",C=h;var R=o("WASignalSessions").makeSendChain(n.ratchetKey,i.index+1,a),L=o("WASignalSessions").updateChains(e,e.recvChains,R);return[L,{type:y,ciphertext:C}]}),m.apply(this,arguments)}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e==null)return o("WAResultOrError").makeError("errSignalNoSession");var n=yield b(e,t);if(n.success){var r=n.value,a=r[0],i=r[1];return o("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:a,plaintext:i})}else{for(var l=e.prevSessions,s=n,u=0;!s.success&&u<l.length;u++){var c=o("WASignalSessions").maybeClearPendingPreKey(o("WASignalSessions").parseSession(l[u])),d=yield b(c,t);if(d.success){var m=d.value,p=m[0],_=m[1],f=o("WASignalSessions").setPrevSessions(p,[o("WASignalSessions").detachSession(e)].concat(l.slice(0,u),l.slice(u+1))),g=!e||!o("WACryptoUtils").serializedPubKeysEqual(f.remote.pubKey,e.remote.pubKey)?f.remote.pubKey:null;s=o("WAResultOrError").makeResult({newSessionInfo:{newIdentity:g,baseSession:c,usedPreKey:null},updatedSession:f,plaintext:_})}}return s}}),_.apply(this,arguments)}function f(e,t){if(e==null)return o("WAResultOrError").makeResult(null);var n=e;if(D(n,t))return o("WAResultOrError").makeResult(n);for(var r=n.prevSessions,a=0;a<r.length;a++){var i=o("WASignalSessions").parseSession(r[a]);if(D(i,t))return o("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658PreventOldSessionLookupAndPromote===!0?o("WAResultOrError").makeError("errSignalInvalidMsg"):o("WAResultOrError").makeResult(o("WASignalSessions").setPrevSessions(i,[o("WASignalSessions").detachSession(n)].concat(r.slice(0,a),r.slice(a+1))))}return o("WAResultOrError").makeResult(null)}function g(e,t,n,r){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a,i=r.localSignedPreKey;if(i==null)return o("WAResultOrError").makeError("errSignalInvalidSignedPreKey");var l=o("WASignalSignatures").deserializeSignedPreKey(i);if(l==null)return o("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization");if(l.id!==n.localSignedPreKeyId)return o("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch");var u=null;if(n.localOneTimeKeyId!=null){var c=r.localOneTimeKey;if(c==null)return o("WAResultOrError").makeError("errSignalInvalidOneTimeKey");if(u=o("WASignalKeys").deserializePreKey(c),u==null)return o("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization");if(u.id!==n.localOneTimeKeyId)return o("WAResultOrError").makeError("errSignalOneTimeKeyMismatch")}if(o("WACryptoLibraryConfig").getCryptoLibraryConfig().baseKeyCanonicalCheck&&!o("WACryptoCurveKeyCanonicalCheck").isCanonical(n.sessionBaseKey.subarray(1)))return o("WAResultOrError").makeError("errSignalBaseKeyIsNotCanonical");var d=yield o("WASignalWhitepaper").initiateSessionIncoming(e,n.remote,n.sessionBaseKey,{signed:l.keyPair,oneTime:(a=u)==null?void 0:a.keyPair,ratchet:o("WASignalKeys").toSerializedKeyPair(l.keyPair)}),m=d.remote.pubKey,p=!t||!o("WACryptoUtils").serializedPubKeysEqual(m,t.remote.pubKey)?m:null;t&&!p&&(d=o("WASignalSessions").setPrevSessions(d,[o("WASignalSessions").detachSession(t)].concat(t.prevSessions.slice(0,s-1))));var _=yield b(d,n);if(!_.success)return _;var f=_.value,g=f[0],h=f[1];return o("WAResultOrError").makeResult({newIdentity:p,baseSession:d,updatedSession:g,plaintext:h})}),h.apply(this,arguments)}function y(e){var t,n,r=null;try{var a=L(e,o("WASignalSessions").FORMAT_VERSION,u);if(!a.success)return a;var i=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SignalMessageSpec,a.value),l=i.ratchetKey;if(r=i.counter,n=i.ciphertext,l==null||r==null||n==null)return o("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");t=o("WASignalKeys").castToSerializedPubKey(new Uint8Array(l))}catch(e){return o("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}var s={ratchetPubKey:t,counter:r,ciphertext:new Uint8Array(n),versionContentMac:e};return o("WAResultOrError").makeResult(s)}function C(e){var t=L(e,o("WASignalSessions").FORMAT_VERSION,0);if(!t.success)return t;var n,r,a,i,l;try{var s=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,t.value),u=s.registrationId,c=s.preKeyId,d=s.signedPreKeyId,m=s.baseKey,p=s.identityKey,_=s.message;if(u==null||d==null||m==null||p==null||_==null)return o("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");i=o("WASignalKeys").castToSerializedPubKey(new Uint8Array(m)),n={regId:o("WASignalOther").castRegistrationId(u),pubKey:o("WASignalKeys").castToSerializedPubKey(new Uint8Array(p))},a=c!=null?o("WASignalKeys").castToPreKeyId(c):null,r=o("WASignalKeys").castToSignedPreKeyId(d),l=new Uint8Array(_)}catch(e){return o("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}var f=y(l);return f.success?o("WAResultOrError").makeResult(babelHelpers.extends({},f.value,{remote:n,sessionBaseKey:i,localSignedPreKeyId:r,localOneTimeKeyId:a})):f}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.ratchetPubKey,r=t.counter,a=t.ciphertext,i=t.versionContentMac,l=e.recvChains,s=e.recvChains.findIndex(function(e){return o("WACryptoUtils").serializedPubKeysEqual(e.ratchetPubKey,n)}),c,d;if(s===-1){var m=yield o("WASignalWhitepaper").calculateRatchet(e.rootKey,e.sendChain.ratchetKey,n),p=o("WASignalSessions").makeFreshRecvChain(n,m.chainKey),_=yield S(p,r);if(!_.success)return _;var f=_.value,g=o("WASignalKeys").makeSerializedKeyPair(),h=yield o("WASignalWhitepaper").calculateRatchet(m.rootKey,g,n),y=l.slice(-4);y.push(f.updatedChain),d=f.msgKey,c=o("WASignalSessions").ratchetSession(e,y,o("WASignalSessions").makeFreshSendChain(g,h.chainKey),h.rootKey)}else{var C=yield S(l[s],r);if(!C.success)return C;var b=C.value,v=l.slice();v[s]=b.updatedChain,d=b.msgKey,c=o("WASignalSessions").updateChains(e,v,e.sendChain)}var R=yield T(d),L=R.cipherKey,E=R.macKey,k=o("WABinary").Binary.build(e.remote.pubKey,e.local.pubKey,i.subarray(0,-u)).readByteArrayView(),D=yield I(E,k),x=i.subarray(-u),$=!o("WACryptoUtils").uint8ArraysEqual(new Uint8Array(D,0,u),x),P=null;try{P=yield o("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:d.iv},L,a)}catch(e){}return $&&P==null?s===-1?o("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"):o("WAResultOrError").makeError("errInvalidMacInvalidCipherKey"):$?o("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext"):P==null?o("WAResultOrError").makeError("errUnknownInvalidCipherKey"):o("WAResultOrError").makeResult([c,P])}),v.apply(this,arguments)}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t-e.nextMsgIndex,r=o("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(n>r)return o("WAResultOrError").makeError("errSignalTooManyMessagesInFuture");var a=e.unusedMsgKeys;if(n<0){var i=a.findIndex(function(e){return e.index===t});return i===-1?o("WAResultOrError").makeError("errDuplicateMsg"):o("WAResultOrError").makeResult({msgKey:a[i],updatedChain:o("WASignalSessions").makeRecvChain(e.ratchetPubKey,e.nextMsgIndex,e.chainKey,k(a,i))})}var l=e.nextMsgIndex,s=yield o("WASignalWhitepaper").deriveMsgKey(l,e.chainKey),u=s[0],d=s[1],m=null;if(n>0){var p=n+a.length-c;p>0?(m=a.slice(p),p-=a.length):m=a.slice();for(var _=l+1;_<=t;_++){p>0?p--:m.push(d);var f=yield o("WASignalWhitepaper").deriveMsgKey(_,u);u=f[0],d=f[1]}}return o("WAResultOrError").makeResult({msgKey:d,updatedChain:o("WASignalSessions").makeRecvChain(e.ratchetPubKey,t+1,u,m||a)})}),R.apply(this,arguments)}function L(e,t,n){if(e.length<1)return o("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var r=e[0]>>>4;if(r!==t)return r<t?o("WAResultOrError").makeError("errSignalLegacyMsg"):o("WAResultOrError").makeError("errSignalInvalidVersion");var a=e.length-n;return a<1?o("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):o("WAResultOrError").makeResult(e.subarray(1,a))}function E(e,t){return(e<<4|t)&255}function k(e,t){for(var n=[],r=0;r<e.length;r++)r!==t&&n.push(e[r]);return n}function I(e,t){return o("WACryptoDependencies").getCrypto().subtle.sign(o("WASignalOther").HMAC_SHA256,e,t)}function T(t){return(e||(e=n("Promise"))).all([o("WASignalOther").makeCryptoKey(t.cipherKey,"aes-cbc"),o("WASignalOther").makeCryptoKey(t.macKey,"hmac-sha256")]).then(function(e){var t=e[0],n=e[1];return{cipherKey:t,macKey:n}})}function D(e,t){var n=e.aliceBaseKey;return n?o("WACryptoUtils").serializedPubKeysEqual(n,t):!1}l.MAX_UNUSED_KEYS=c,l.encryptMsg=d,l.decryptMsg=p,l.findMatchingSession=f,l.decryptPkMsgWithNewSession=g,l.deserializeMsg=y,l.deserializePkMsg=C,l.decryptMsgFromSession=b,l.readContent=L,l.versionByte=E}),98);
__d("WASignalGroupCipher",["WABinary","WACryptoDependencies","WACryptoLibraryConfig","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s=64;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=g(e);if(!n.success)return n;var r=n.value,a=r.senderKeyId,i=r.iteration,l=r.signingKeyPublic,s=r.chainKey,u=yield o("WASignalWhitepaper").initiateSenderKeySessionIncoming(a,i,l,s,t);return o("WAResultOrError").makeResult(u)}),c.apply(this,arguments)}function d(e){var t=o("WASignalGroupSession").serializeSenderKeyState(e),n=new(o("WABinary")).Binary;return n.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:t.senderKeyId,iteration:o("WASignalSessions").definedOrThrow(t.senderChainKey,"senderChainKey").iteration,chainKey:o("WASignalSessions").definedOrThrow(t.senderChainKey,"senderChainKey").seed,signingKey:o("WASignalSessions").definedOrThrow(t.senderSigningKey,"senderSigningKey").public},n),n.readByteArrayView()}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(!e.senderKeyStates||e.senderKeyStates.length===0)return o("WAResultOrError").makeError("errSignalNoSession");var n=e.senderKeyStates[e.senderKeyStates.length-1],r=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(n.senderKeyChainKey.nextMsgIndex,n.senderKeyChainKey.chainKey),a=r[0],i=r[1],l=yield y(i.seed),s=l[0],u=l[1],c=yield o("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:u},s,t),d=new(o("WABinary")).Binary;o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:n.senderKeyId,iteration:i.iteration,ciphertext:c},d);var m=new(o("WABinary")).Binary;m.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),m.writeBinary(d);var p=o("WASignalKeys").makeKeyPairFromSerialized(o("WASignalSessions").definedOrThrow(n.senderSigningKeyPrivate,"senderSigningKeyPrivate"),n.senderSigningKeyPublic),_=o("WASignalSignatures").signSenderKeyMessage(p,m.readByteArrayView()),f=new(o("WABinary")).Binary;f.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),f.writeBinary(d),f.writeByteArray(_);var g=o("WASignalGroupSession").makeSenderKeyChainKey(i.iteration+1,a),h=o("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(e,o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,g,n.senderKeyId,n.unusedMsgKeys));return o("WAResultOrError").makeResult([h,f.readByteArrayView()])}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.senderKeyMessageId,r=t.iteration,a=t.ciphertext,i=t.versionContentMac,l=o("WASignalGroupSession").findSenderKeyState(e,n);if(l==null)return o("WAResultOrError").makeError("errSignalNoSession");var s=l.senderSigningKeyPublic,u=b(i,s);if(!u)return o("WAResultOrError").makeError("errSignalInvalidKey");var c=yield v(l,r);if(!c.success)return c;var d=c.value,m=d.msgKey,p=o("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(e,d.updatedSenderKeyState),_=yield y(m.seed),f=_[0],g=_[1],h=yield o("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:g},f,a);return o("WAResultOrError").makeResult([p,h])}),f.apply(this,arguments)}function g(e){var t,n,r,a,i;try{if(i=o("WASignalCipher").readContent(e,o("WASignalGroupSession").FORMAT_VERSION,0),!i.success)return i;var l=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,i.value);t=l.id,n=l.iteration;var s=o("WASignalSessions").bytesOrThrow(l.signingKey,33,"signingKey");if(r=o("WASignalKeys").castToSerializedPubKey(s),a=o("WASignalSessions").bytesOrThrow(l.chainKey,32,"chainKey"),t==null||n==null)return o("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(e){return o("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return o("WAResultOrError").makeResult({senderKeyId:t,iteration:n,signingKeyPublic:r,chainKey:a})}function h(t){if(t.length<1)return o("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var n=t[0]>>>4;if(n!==o("WASignalGroupSession").FORMAT_VERSION)return n<o("WASignalGroupSession").FORMAT_VERSION?o("WAResultOrError").makeError("errSignalLegacyMsg"):o("WAResultOrError").makeError("errSignalInvalidVersion");if(t.length<1+s)return o("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var r,a,i;try{var l=t.subarray(1,-s),u=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,l);if(r=u.id,a=u.iteration,i=u.ciphertext,r==null||a==null||i==null)return o("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""])),t),o("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return o("WAResultOrError").makeResult({senderKeyMessageId:r,iteration:a,ciphertext:new Uint8Array(i),versionContentMac:t})}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new(o("WABinary")).Binary(e),n=o("WASignalOther").readBytes(t,16),r=o("WASignalOther").readBytes(t,32);return[yield o("WASignalOther").makeCryptoKey(r,"aes-cbc"),n]}),C.apply(this,arguments)}function b(e,t){var n=e.subarray(e.length-s),r=e.subarray(0,e.length-s);return o("WASignalSignatures").verifyMsgSignalVariant(t,r,o("WASignalOther").toBytes(o("WASignalOther").toBuffer(n),64))}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e,r=t-n.senderKeyChainKey.nextMsgIndex,a=o("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(r>a)return o("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture");var i=e.unusedMsgKeys||[];if(r<0){var l=i.findIndex(function(e){return e.iteration===t});return l===-1?o("WAResultOrError").makeError("errDuplicateMsg"):o("WAResultOrError").makeResult({msgKey:i[l],updatedSenderKeyState:o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,n.senderKeyChainKey,n.senderKeyId,R(i,l))})}var s=n.senderKeyChainKey.nextMsgIndex,u=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(s,n.senderKeyChainKey.chainKey),c=u[0],d=u[1],m=null;if(r>0){var p=r+i.length-o("WASignalCipher").MAX_UNUSED_KEYS;p>0?(m=i.slice(p),p-=i.length):m=i.slice();for(var _=s+1;_<=t;_++){p>0?p--:m.push(d);var f=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(_,c);c=f[0],d=f[1]}}return o("WAResultOrError").makeResult({msgKey:d,updatedSenderKeyState:o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,o("WASignalGroupSession").makeSenderKeyChainKey(t+1,c),e.senderKeyId,m||i)})}),S.apply(this,arguments)}function R(e,t){for(var n=[],r=0;r<e.length;r++)r!==t&&n.push(e[r]);return n}l.processSenderKeyDistributionMsg=u,l.createSenderKeyDistributionProto=d,l.encryptSenderKeyMsgWithSession=m,l.decryptSenderKeyMsgFromSession=_,l.deserializeSenderKeyMsg=h}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WALockMap").makeLockMap(6e4),u=[],c=300;function d(e){u.push(e),u.length>=c&&u.shift()}function m(e){e(u),u=[]}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){d("createOutgoingSession");var n=I(t),r=n.signedKey,a=yield o("WASignalSignatures").verifyMsgSignalVariant(n.identity,r.publicKey,r.signature);if(!a)return d("createOutgoingSession: errSignalInvalidKey"),o("WAResultOrError").makeError("errSignalInvalidKey");var i=yield o("WASignalWhitepaper").initiateSessionOutgoing(e,n,o("WASignalKeys").makeKeyPair());return o("WAResultOrError").makeResult(i)}),_.apply(this,arguments)}function f(e,t,n,r,o){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,o){var a=e.handleNewSession;d("establishOutgoingSession");var i=yield p(t,r);if(!i.success)return i;var l=i.value;return a(n,l,l.remote.pubKey,null,o)}),g.apply(this,arguments)}function h(e,t,r,a){var i=e.loadSession,l=e.handleNewSession;return d("encryptContent"),s.lock([o("WAJids").extractUserJid(t)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;do{var n=yield i(t,"cryptoLibraryEncryptContent");if(n==null)return d("encryptContent: errSignalInvalidKey"),o("WAResultOrError").makeError("errSignalInvalidKey");if(a!=null&&!o("WACryptoUtils").uint8ArraysEqual(a,n.remote.pubKey))return d("encryptContent: identity-mismatch"),o("WAResultOrError").makeError("identity-mismatch");var s=yield o("WASignalCipher").encryptMsg(n,r),u=s[0],c=s[1],m=yield l(t,u,u.remote.pubKey);m.success?e=o("WAResultOrError").makeResult(babelHelpers.extends({},c,{baseKey:u.aliceBaseKey})):m.error}while(e==null);return e}))}function y(e,t,r,a,i){var l=e.loadSession,u=e.handleNewSession,c=e.loadSignedPreKey,m=e.loadOneTimePreKey;return d("decryptContent"),s.lock([o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=!1,n=yield l(r,"decryptContent"),s;if(a.type==="pkmsg"){var p=o("WASignalCipher").deserializePkMsg(a.ciphertext);if(!p.success)return d("decryptContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var _=p.value,f=yield C({loadSignedPreKey:c,loadOneTimePreKey:m},t,_,n);if(!f.success)return f;s=f.value}else{a.type;var g=o("WASignalCipher").deserializeMsg(a.ciphertext);if(!g.success)return d("decryptContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var h=g.value,y=yield o("WASignalCipher").decryptMsg(n,h);if(!y.success)return y;s=y.value}var b=s,v=b.newSessionInfo;if(v&&(v.newIdentity!=null||v.usedPreKey!=null)&&(yield u(r,v.baseSession,v.newIdentity,v.usedPreKey)),!e){var S=v==null?void 0:v.baseSession.remote.pubKey;yield i(new Uint8Array(s.plaintext),S),e=!0}return yield u(r,s.updatedSession,s.updatedSession.remote.pubKey),o("WAResultOrError").makeResult()}))}function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=e.loadSignedPreKey,i=e.loadOneTimePreKey;d("decryptPkMsg");var l=o("WASignalCipher").findMatchingSession(r,n.sessionBaseKey);if(!l.success)return l;var s=l.value;if(s){var u=yield o("WASignalCipher").decryptMsgFromSession(s,n);if(!u.success)return u;var c=u.value,m=c[0],p=c[1];return o("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:m,plaintext:p})}else{var _=n.localOneTimeKeyId,f=yield a(n.localSignedPreKeyId),g=_==null?null:yield i(_),h=yield o("WASignalCipher").decryptPkMsgWithNewSession(t,r,n,{localSignedPreKey:f,localOneTimeKey:g});if(!h.success)return h;var y=h.value,C=y.newIdentity,b=y.baseSession,v=y.updatedSession,S=y.plaintext;return o("WAResultOrError").makeResult({newSessionInfo:{newIdentity:C,baseSession:b,usedPreKey:_},updatedSession:v,plaintext:S})}}),b.apply(this,arguments)}function v(e,t,r,a){var i=e.loadSenderKeySession,l=e.saveSenderKeySession;return d("encryptGroupContent"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;do{var n=yield i(t,r);if(!n.success)return o("WAResultOrError").makeError(n.error);var s=n.value,u=yield o("WASignalGroupCipher").encryptSenderKeyMsgWithSession(s,a);if(u.success){var c=u.value,m=c[0],p=c[1];yield l(t,r,m);var _=s.senderKeyStates[s.senderKeyStates.length-1];e=o("WAResultOrError").makeResult({ciphertext:{ciphertext:p,type:"skmsg"},senderKeyId:_.senderKeyId,senderKeyDistributionProto:o("WASignalGroupCipher").createSenderKeyDistributionProto(o("WASignalGroupSession").convertFromRawToSenderKeyState(_))})}else return d("encryptGroupContent: sender-key-no-session"),o("WAResultOrError").makeError("sender-key-no-session")}while(e==null);return e}))}function S(t,r,a,i,l){var u=t.loadSenderKeySession,c=t.saveSenderKeySession;return d("decryptGroupContent"),s.lock([r,o("WAJids").extractUserJid(a)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=!1,n=yield u(r,a);if(!n.success)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[WACryptoLibrary] Unable to load sender key session for group during decryptGroupContent: ",", author: ",""])),r,a),o("WAResultOrError").makeError(n.error);var s=o("WASignalGroupCipher").deserializeSenderKeyMsg(i);if(!s.success)return d("decryptGroupContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var m=n.value,p=yield o("WASignalGroupCipher").decryptSenderKeyMsgFromSession(m,s.value);if(!p.success)return p;var _=p.value,f=_[0],g=_[1];return t||(yield l(new Uint8Array(g)),t=!0),yield c(r,a,f),o("WAResultOrError").makeResult()}))}function R(e,t,r,a){var i=e.loadSenderKeySession,l=e.saveSenderKeySession;return d("saveSenderKeySession"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;if(i){var n=yield i(t,r);e=n.success?n.value:null}var s=yield o("WASignalGroupCipher").processSenderKeyDistributionMsg(a,e);if(!s.success)return s;var u=s.value;return yield l(t,r,u),o("WAResultOrError").makeResult()}))}function L(e,t,r,a){var i=e.saveSenderKeySession;return d("rotateGroupSenderKey"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WASignalWhitepaper").initiateSenderKeySessionOutgoing(a),n=e.senderKeyStates[0].senderKeyId;return yield i(t,r,e),{senderKeyId:n}}))}function E(e,t,n){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.loadSenderKeySession,a=e.saveSenderKeySession;d("createSenderKeyDistributionMsg");var i=yield r(t,n),l=i.error;if(!i.success&&l==="errLoadSenderKeySession"){var s=yield o("WASignalKeys").makeKeyPair();yield L({saveSenderKeySession:a},t,n,s),i=yield r(t,n)}if(i.success){var u=i.value.senderKeyStates.slice(-1);if(u.length>0)return o("WAResultOrError").makeResult(o("WASignalGroupCipher").createSenderKeyDistributionProto(o("WASignalGroupSession").convertFromRawToSenderKeyState(u[0])))}return d("createSenderKeyDistributionMsg: errGetSenderKeyProto"),o("WAResultOrError").makeError("errGetSenderKeyProto")}),k.apply(this,arguments)}function I(e){var t=e.regId,n=e.identity,r=e.signedKey,a=e.oneTimeKey;d("sanitizeInitialSessionInfo");var i=o("WASignalKeys").castToSerializedPubKey(r.publicKey);return{regId:o("WASignalOther").castRegistrationId(t),identity:o("WASignalKeys").castToSerializedPubKey(n),signedKey:{id:o("WASignalKeys").castToSignedPreKeyId(r.id),publicKey:i,signature:o("WASignalOther").ensureSize(r.signature,64)},oneTimeKey:a&&{id:o("WASignalKeys").castToPreKeyId(a.id),publicKey:o("WASignalKeys").castToSerializedPubKey(a.publicKey)},ratchetKey:i}}l.publishLogs=m,l.createOutgoingSession=p,l.establishOutgoingSession=f,l.encryptContent=h,l.decryptContent=y,l.encryptGroupContent=v,l.decryptGroupContent=S,l.saveSenderKeySession=R,l.rotateGroupSenderKey=L,l.createSenderKeyDistributionMsg=E}),98);
__d("WACryptoManager",["Promise","WABridge","WACryptoLibrary","WACryptoUtils","WAGlobals","WAJids","WALogger","WALoggerTag","WANullthrows","WAOdsEnums","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS([r("WALoggerTag").CryptoManager]),f={type:"default"};function g(e){return{flush:function(){return e.storage.savePendingToDatabase().then(function(){})}}}function h(e){return{regInfo:e.regInfo,network:e.network,storage:e.storage}}function y(e,t,n,r,o){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){var i=yield r(t,a);if(i!=null&&n.type!=="requestNewSession"){var l=i;if(n.type==="default")return o("WAResultOrError").makeResult(l);if(l.aliceBaseKey!=null&&n.session.baseKey!=null&&(n.type,!o("WACryptoUtils").uint8ArraysEqual(n.session.baseKey,l.aliceBaseKey)))return o("WAResultOrError").makeResult(l)}var s;if(n.type==="useSession")s=n.session.keys;else{n.type;var u=yield e.network.requestKeys(t);if(!u.success)return u;s=u.value.keys,n.type==="compareTSAndUseSession"&&n.session.timestamp>=u.value.timestamp&&(s=n.session.keys)}var c=yield o("WACryptoLibrary").createOutgoingSession(e.regInfo,s);return c.success?o("WAResultOrError").makeResult(c.value):c}),C.apply(this,arguments)}function b(e,t,n,r){return o("WACryptoLibrary").establishOutgoingSession({handleNewSession:e.storage.handleNewSession},e.regInfo,t,n,r)}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.storage.loadSessions(t),r=t.filter(function(e){return!n.has(e)});if(r.length===0)return n;var a=yield e.network.bulkRequestKeys(r);if(!a.success)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"]))),n;for(var i of n.entries()){var l=i[0],s=i[1];s.sendChain.nextMsgIndex>=o("WAGlobals").getConfig().sessionDropIfTooOld()&&(n.delete(l),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.WA_LONG_SESSION_DROP,key:"decryption"}))}var u=a.value,m=new(o("WAPromiseQueue")).PromiseQueue;return u.forEach(function(t,r){m.enqueue(function(){return o("WACryptoLibrary").createOutgoingSession(e.regInfo,t.keys).then(function(e){e.success===!1?o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]))):n.set(r,e.value)})})}),yield m.wait(),n}),S.apply(this,arguments)}function R(e,t){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=Array.from(t.keys());o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"])));var i=yield v(e,a),l=new Map;return(p||(p=n("Promise"))).all(Array.from(i.entries()).map((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a,i=n[0],s=n[1],u=yield o("WASignalCipher").encryptMsg(s,r("WANullthrows")((a=t.get(i))==null?void 0:a.plaintext)),c=u[0],d=u[1];return l.set(i,babelHelpers.extends({},d,{baseKey:null})),e.storage.handleNewSession(i,c,c.remote.pubKey)});return function(e){return a.apply(this,arguments)}})())).then(function(){return o("WAResultOrError").makeResult(l)})}),L.apply(this,arguments)}function E(e,t,n,r,a){return o("WACryptoLibrary").encryptContent({loadSession:function(n){return y(e,n,r,e.storage.loadSession,"cryptoManagerEncryptContent").then(function(e){return e.success===!0?e.value:null})},handleNewSession:e.storage.handleNewSession},t,n,a)}function k(e,t,n,r){return o("WACryptoLibrary").decryptContent({loadSession:e.storage.loadSession,handleNewSession:e.storage.handleNewSession,loadSignedPreKey:e.storage.loadSignedPreKey,loadOneTimePreKey:e.storage.loadOneTimePreKey},e.regInfo,t,n,r)}function I(e,t){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.storage.loadSession(t,"getParticipantInfo");return n==null?void 0:n.remote}),T.apply(this,arguments)}function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,a=yield e.storage.getLastPreKeyGenerationId(),i=((t=a==null?void 0:a.lastPreKeyId)!=null?t:0)+1,l=o("WASignalKeys").makePreKeys(i,1)[0],s=yield e.storage.saveOneTimePreKey({keyId:l.plainObject.id,encoded:l.record});if(s.success)return l.plainObject;throw r("err")("Cannot save one time prekey: "+s.error+", LastPreKeyId: "+((n=a==null?void 0:a.lastPreKeyId)!=null?n:0))}),x.apply(this,arguments)}function $(e,t){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n;t===void 0&&(t=o("WAGlobals").getConfig().maxPrekeysToUpload());var r=yield e.storage.getLastPreKeyGenerationId(),a=o("WASignalKeys").makePreKeys(((n=r==null?void 0:r.lastPreKeyId)!=null?n:0)+1,t);return e.storage.savePreKeysGeneration(a.map(function(e){var t=e.plainObject,n=e.record;return{keyId:t.id,encoded:n}}))}),P.apply(this,arguments)}function N(t){return t.storage.loadLatestSignedPreKey().then(function(n){if(n.success===!1){var a,i,l;throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""])),n==null||(a=n.payload)==null?void 0:a.toString()),r("err")("Failed to generate signed prekey: "+((i=n==null||(l=n.payload)==null?void 0:l.message)!=null?i:""))}var u=n.value,c=o("WASignalSignatures").deserializeSignedPreKey(u);if(c==null)throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""])),n),r("err")("failed to deserialize signed prekey");return M(t,c.id+1)})}function M(e,t){var n=o("WASignalSignatures").makeSignedPreKey(t,o("WATimeUtils").unixTimeMs(),e.regInfo.staticKeyPair),a=o("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(n);return e.storage.saveSignedPreKeyIfNew(n.id,a).then(function(e){return e.type==="success"?o("WAResultOrError").makeResult(n):(e.type,o("WAResultOrError").makeResult(e.key))}).then(function(e){if(!e.success){var t,n;throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""])),e),r("err")("Unexpected error when generateSignedPreKeyWithId: "+((t=e==null||(n=e.payload)==null?void 0:n.message)!=null?t:e.error))}return e.value})}function w(e,t,n,r){return o("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:e.storage.loadSenderKeySession,saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r)}function A(e,t,n,r,a){return o("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:e.storage.loadSenderKeySession,saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r,a)}function F(e,t,n,r){return o("WACryptoLibrary").saveSenderKeySession({saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r)}function O(e,t,n){return B.apply(this,arguments)}function B(){return B=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield D(e);return o("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r.keyPair)}),B.apply(this,arguments)}function W(e){return(p||(p=n("Promise"))).resolve().then(function(){return{regId:o("WASignalOther").makeRegistrationId(e),staticKeyPair:o("WASignalKeys").makeKeyPair(),authKeyPair:o("WASignalKeys").makeKeyPair()}})}function q(e){return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").RecordStructureSpec,o("WASignalSessions").serializeSession(e))}function U(e){return o("WASignalOther").decodeSignalProto(o("WASignalLocalStorageProtocol.pb").RecordStructureSpec,e,o("WASignalSessions").parseSessionFromRecord)}function V(e){return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,o("WASignalGroupSession").serializeSession(e))}function H(e){return o("WASignalOther").decodeSignalProto(o("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,e,o("WASignalGroupSession").parseSessionFromRecord)}function G(e){return e}function z(e,t){return e+"|"+t}function j(e){var t=e.split("|");if(t.length!==2)throw r("err")("Incorrect ComplexSenderKey");return{groupId:o("WAJids").unsafeCoerceToGroupJid(t[0]),deviceId:o("WAJids").unsafeCoerceToDeviceJid(t[1])}}l.DEFAULT_SESSION_REQUEST=f,l.cryptoManagerFlushable=g,l.initCryptoManager=h,l.getSessionForRecipient=y,l.establishOutgoingSession=b,l.ensureSessionsExists=v,l.bulkEncryptContent=R,l.encryptContent=E,l.decryptContent=k,l.getParticipantInfo=I,l.generateOneTimePreKey=D,l.generatePreKeys=$,l.generateSignedPreKey=N,l.generateSignedPreKeyWithId=M,l.encryptGroupContent=w,l.decryptGroupContent=A,l.saveSenderKeySession=F,l.rotateGroupSenderKey=O,l.generateRegistrationInfo=W,l.encodeSession=q,l.decodeSession=U,l.encodeSenderKeySession=V,l.decodeSenderKeySession=H,l.castToPreKeyGenerationId=G,l.encodeSenderKey=z,l.decodeSenderKey=j}),98);
__d("WADbSignal",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e,t,n){return e+"_"+t+"_"+n}var s={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"},u={msgrDeviceId:"msgrDeviceId"},c={registrationHistory:"registrationHistory"};i.unsafeCoerceToSenderKeySessionId=e,i.buildSenderKeySessionId=l,i.MetaKeysEnum=s,i.PlainTextMetaKeysEnum=c}),66);
__d("WABulkSaveSignalDataApi",["Promise","WACryptoManager","WADbSignal","WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=t.dhashUpdate,a=t.icdcUpdate,i=t.identityRemove,l=t.identityUpdate,s=t.preKeyRemove,c=t.senderKeySessionUpdate,m=t.sessionRemove,p=t.sessionUpdate,_=t.lastSyncTsUpdate,f=p.map(function(e){var t=e.id,n=e.updated;return{id:t,session:o("WACryptoManager").encodeSession(n)}}),g=[];c.forEach(function(e){var t=e.author,n=e.groupId,r=e.updated,a=o("WAJids").extractUserJid(t),i=o("WAJids").extractDeviceId(t),l=o("WADbSignal").buildSenderKeySessionId(n,a,i);g.push({deviceId:i,groupJid:n,id:l,record:o("WACryptoManager").encodeSenderKeySession(r),userJid:a})}),yield o("WASignalDB").getDb().runInTransaction(["contacts","identity","prekey","senderKeySessions","session"],"readwrite",function(t){var o=t.stores,c=o.session,p=o.identity,h=o.senderKeySessions,y=o.prekey;return(e||(e=n("Promise"))).all([c.bulkDelete(m),p.bulkDelete(i),c.bulkPut(f),h.bulkPut(g),d(t.stores,l),u(t.stores,a,l,r,_),y.bulkDelete(s.map(function(e){var t=e.id;return t}))])},o("WASignalDB").signalOp("bulkSaveSignalData"))});return function(n){return t.apply(this,arguments)}})();function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){var i=new Set;for(var l of n)i.add(o("WAJids").extractUserJid(l.id));var s=Array.from(i);for(var u of t)i.add(u.id);var c=yield e.contacts.bulkGet(Array.from(i)),d=new Map;for(var m of c)m!=null&&d.set(m.contactJid,m);for(var p of s){var _=d.get(p);_==null?(_={contactJid:p,dhash:null},d.set(p,_)):_.dhash=null}for(var f of t){var g=d.get(f.id);g==null?(g={contactJid:f.id,dhash:null,icdcInfo:f.icdc},d.set(f.id,g)):g.icdcInfo=f.icdc}for(var h of r){var y=d.get(h.id);y==null?(y={contactJid:h.id,dhash:h.dhash},d.set(h.id,y)):y.dhash=h.dhash}for(var C of a){var b=d.get(C.id);b==null?(b={contactJid:C.id,dhash:null,lastSyncTs:C.lastSyncTs},d.set(C.id,b)):b.lastSyncTs=C.lastSyncTs}yield e.contacts.bulkPut(Array.from(d.values()))}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.length!==0){var n=t.map(function(e){var t=e.id,n=e.identity;return{deviceJid:t,identity:n,userJid:o("WAJids").extractUserJid(t)}});yield e.identity.bulkPut(n)}}),m.apply(this,arguments)}l.bulkSaveSignalData=s}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.length===33&&e[0]===5;return t?e.slice(1):e}function s(e,t){for(var n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length}function u(t){var n=t.map(function(t){return e(t)}),r=new(o("WABinary")).Binary;n.sort(s).forEach(function(e){return r.writeByteArray(e)});var a=o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",r.readByteArrayView());return a.then(function(e){var t=new Uint8Array(e);return o("WASignalOther").sliceBytes(t,0,10)})}l.removeKeyTypeIfNeeded=e,l.computeIdentitiesHash=u}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WAIdentityUtils","WALogger","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(t,n,r,a){if(t!==a.details.seq)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"]))),null;if(r!==a.details.timestamp)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"]))),null;if(a.details.signingDeviceIndex==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"]))),null;var i=a.details.signingDeviceIndex;return{dirty:n,sequence:t,timestamp:r,signingDeviceIndex:i,devices:a.details.devices.map(function(e){return new Uint8Array(e)})}}function p(e){return e.signingDeviceIndex<0||e.signingDeviceIndex>=e.devices.length}function _(e){var t=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e),n=t.signature,r=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloICDC.pb").ICDCIdentityListSpec,t.details);return{signature:n,details:r}}function f(e){return e.map(function(e){return o("WASignalKeys").serializeIdentity(new Uint8Array(o("WABase64").decodeB64UrlSafe(e)))})}function g(e,t,n,a,i){var l=o("WAIdentityUtils").removeKeyTypeIfNeeded(e.publicKey),s=n.map(function(e){return o("WAIdentityUtils").removeKeyTypeIfNeeded(e)}),u=s.findIndex(function(e){return o("WACryptoUtils").uint8ArraysEqual(e,l)});if(u===-1)throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""])),a,i),r("err")("signingDeviceIndex not found");var m=t==null?1:t+1,p=o("WATimeUtils").unixTime();p<0&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""])),Date.now(),o("WATimeUtils").getClockSkew());var _={seq:m,timestamp:p,devices:s,signingDeviceIndex:u},f=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloICDC.pb").ICDCIdentityListSpec,_).readBuffer(),g=h(e,o("WABinary").Binary.build(f).readByteArrayView()),y={details:f,signature:g},C=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,y).readBuffer();return{icdcInfo:_,encodedSignedICDC:C}}function h(e,t){var n=o("WASignalOther").makeBytes(64);o("WACryptoDependencies").getCrypto().getRandomValues(n);var r=new Uint8Array(64);o("WACryptoEd25519").hashSha512(r,t,t.length);var a=o("WASignalSignatures").makeSignature(e,t,n);return o("WABinary").Binary.build(a).readBuffer()}var y=4*o("WATimeUtils").HOUR_SECONDS;function C(e){return e==null?!0:!o("WATimeUtils").happenedWithin(e,y)}l.validateAndPrepareICDCFromNotification=m,l.isICDCIndexInvalid=p,l.decodeICDCInfo=_,l.base64DeviceIdentitiesToSerializedPubKeys=f,l.computeICDCInfoForUpload=g,l.isLastSyncTsExpired=C}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WAGetDevices","WAGlobals","WAICDCUtils","WAIdentityUtils","WALogger","WAPromiseBackoffs","WAWap","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=new(r("WADeprecatedWapParser"))("parseUploadICDCInfoResponse",function(e){e.assertTag("iq"),e.assertFromServer(),e.assertAttr("type","result")}),m=0,p=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var i=a.reason,l=a.caller,p=a.sequence;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""])),p);var _;try{_=yield o("WAGlobals").getWaOneQueue().enqueue((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.cryptoManager,n=yield t.storage.loadIdentities(o("WAGlobals").getMyUserJid()),r=t.regInfo;return{regInfo:r,identities:Array.from(n.values())}});return function(t){return e.apply(this,arguments)}})(),{operationType:"icdc_load_identities",flush:!1,afterInit:!0})}catch(e){var f=r("getErrorSafe")(e);o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Loading identities fails with error: ",""])),f.toString())}if(_!=null){var g=_,h=g.regInfo,y=g.identities,C=o("WAICDCUtils").computeICDCInfoForUpload(h.staticKeyPair,p,y,i,l),b=C.icdcInfo,v=C.encodedSignedICDC,S=yield o("WAIdentityUtils").computeIdentitiesHash(y),R=o("WAWap").wap("iq",{id:o("WAWap").generateId(),to:o("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"fbid:devices"},o("WAWap").wap("icdc",{ihash:o("WAWap").CUSTOM_STRING(o("WABase64").encodeB64(S)),seq:o("WAWap").INT(b.seq),ts:o("WAWap").INT(b.timestamp)},v)),L=yield o("WADeprecatedSendIq").deprecatedSendIq(R,d);L.success?(m=0,yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.saveICDC(o("WAGlobals").getMyUserJid(),{sequence:b.seq,timestamp:b.timestamp,devices:b.devices,signingDeviceIndex:b.signingDeviceIndex,dirty:!1})},{operationType:"save_icdc",flush:!0,afterInit:!0})):(m+=1,L.errorCode===406||L.errorCode===500?setTimeout(function(){o("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"compute-Upload-icdc",users:new Set().add(o("WAGlobals").getMyUserJid())}).catch(function(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed getting devices ",""])),e.toString())})},o("WAPromiseBackoffs").getDelay(m,{jitter:.1,max:3e4,algo:{type:"fibonacci",first:1e3,second:1e3}})):o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"])),L.errorCode))}});return function(n,r){return t.apply(this,arguments)}})();l.computeAndUploadICDCInfo=p}),98);
__d("WAFetchAndSaveDevices",["Promise","WAComputeAndUploadICDCInfo","WAGlobals","WAICDCUtils","WALogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length!==0){var r=[];yield o("WAGlobals").getWaOneQueue().enqueue(function(a){var i=a.cryptoManager;return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Update user devices signal and DB"]))),(s||(s=n("Promise"))).all(t.map(function(e){var t;return r.push({contactJid:e.jid,dhash:e.dhash,lastSyncTs:e.lastSyncTs,icdcInfo:(t=e.icdcInfo)!=null?t:void 0}),i.storage.updateUserDevicesInfo([e])}))},{operationType:"get_devices",flush:!0,afterInit:!0});var a=o("WAGlobals").getMyUserJid(),i=t.find(function(e){return e.jid===a});if(i!=null){var l=i.icdcInfo;if(l==null||o("WAICDCUtils").isICDCIndexInvalid(l)||l!=null&&l.dirty){var u;l==null?u="empty":l.dirty?u="dirty":u="invalidIndex",o("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo(null,{reason:u,caller:"get_devices",sequence:l==null?void 0:l.sequence}).catch(function(e){})}}}}),c.apply(this,arguments)}l.updateUsersDevicesSignalAndDB=u}),98);
__d("WAPushSafeTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.unsafeNotNullable=e}),66);
__d("WAGetDevices",["WADevicesState","WALogger","WAPushSafeTypes","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){var r=o("WAPushSafeTypes").unsafeNotNullable(n),a=r.users,i=r.reason,l=r.ignoreDhash,s=l===void 0?!1:l;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""])),i),s&&o("WADevicesState").getDevicesState().reset(Array.from(a)),yield o("WADevicesState").getDevicesState().waitForUserDevices(Array.from(a),"getDevices job: "+i,s)}),u.apply(this,arguments)}l.getDevices=s}),98);
__d("WAHandleFbDeviceChangeNotificationProtocol",["WAICDCUtils","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.dhash}function s(e){var t,n=((t=e.iCDCDirtyMixin)==null?void 0:t.dirty)==="true",r=o("WATimeUtils").castToUnixTime(e.ts),a=e.seq,i=o("WAICDCUtils").decodeICDCInfo(e.elementValue),l=o("WAICDCUtils").validateAndPrepareICDCFromNotification(a,n,r,i);return l==null?o("WAResultOrError").makeError("icdc-validation-failure"):o("WAResultOrError").makeResult(l)}l.parseDhash=e,l.parseICDCFromServer=s}),98);
__d("WALoadContactsApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet(t).then(function(e){return new Map(e.filter(Boolean).map(function(e){return[e.contactJid,{contactJid:e.contactJid,dhash:e.dhash,icdcFails:e.icdcFails,icdcInfo:e.icdcInfo,lastSyncTs:e.lastSyncTs}]}))})},o("WASignalDB").signalOp("loadContacts"))};l.loadContacts=e}),98);
__d("WARPCAbortController",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l="rpc-timeout";function s(t,r){var o,a=new(e||(e=n("Promise")))(function(e,t){o=setTimeout(function(){t(l)},r)});return e.race([t,a]).finally(function(){clearTimeout(o)})}i.RPC_TIMEOUT=l,i.rpcAbortController=s}),66);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);return n.success,n}l.parseNonRetryableIQErrorMixin=e}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","service-unavailable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",503);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorServiceUnavailableMixin=e}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:t.value});var n=o("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[t,n])}l.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=e}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"backoff",0,86400);if(!n.success)return n;var r=o("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(e);return r.success?o("WAResultOrError").makeResult({backoff:n.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:r.value}):r}l.parseRetryableIQErrorMixin=e}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"RetryableIQError",value:t.value});var n=o("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"NonRetryableIQError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableIQError","NonRetryableIQError"],[t,n])}l.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=e}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseFetchResponseError=e}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","item-not-found");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",404);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorItemNotFoundMixin=e}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);return n.success,n}l.parseFetchNonRetryableUserErrorMixin=e}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(e);return n.success?o("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:n.value}):n}l.parseFetchRetryableUserErrorMixin=e}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:t.value});var n=o("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableUserError","NonRetryableUserError"],[t,n])}l.parseFetchOrFetchNonRetryableUserErrorMixinGroup=e}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseJid").attrUserJid(e,"jid");if(!r.success)return r;var a=o("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(n.value);return a.success?o("WAResultOrError").makeResult({jid:r.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:a.value}):a}l.parseFetchUserResponseFailureMixin=e}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"platform");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"model");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(t){var n=o("WASmaxParseUtils").optionalChildWithTag(t,"platform",e);if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"model",s);return r.success?o("WAResultOrError").makeResult({platform:n.value,model:r.value}):r}l.parseDeviceModelInfoPlatform=e,l.parseDeviceModelInfoModel=s,l.parseDeviceModelInfoMixin=u}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").attrString(e,"dhash");return t.success?o("WAResultOrError").makeResult({dhash:t.value}):t}l.parseDhashMixin=e}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").contentBytesRange(e,32,32);return t.success?o("WAResultOrError").makeResult({elementValue:t.value}):t}l.parseKeyDataMixin=e}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"identity");if(!t.success)return t;var n=o("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(t.value);return n.success,n}l.parseIdentityKeyMixin=e}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"device");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"id",1,999);if(!n.success)return n;var r=o("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(e);if(!r.success)return r;var a=o("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({id:n.value},r.value,{deviceModelInfoMixin:a.success?a.value:null}))}function s(t){var n=o("WASmaxParseUtils").assertTag(t,"devices");if(!n.success)return n;var r=o("WASmaxInDevicesDhashMixin").parseDhashMixin(t),a=o("WASmaxParseUtils").mapChildrenWithTag(t,"device",0,25,e);return a.success?o("WAResultOrError").makeResult({dhashMixin:r.success?r.value:null,device:a.value}):a}l.parseDeviceListDevice=e,l.parseDeviceListMixin=s}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"dirty","true");return n.success?o("WAResultOrError").makeResult({dirty:n.value}):n}l.parseICDCDirtyMixin=e}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").attrIntRange(e,"seq",0,2147483647);return t.success?o("WAResultOrError").makeResult({seq:t.value}):t}l.parseICDCSeqMixin=e}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"ts",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(e,1,40072);if(!r.success)return r;var a=o("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(e);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({ts:n.value,elementValue:r.value},a.value)):a}l.parseICDCSignedListMixin=e}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(e);if(!n.success)return n;var r=o("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({},n.value,{iCDCDirtyMixin:r.success?r.value:null}))}l.parseICDCFromServerMixin=e}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"devices");if(!t.success)return t;var n=o("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(e);return n.success,n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(e);return n.success,n}function u(t){var n=o("WASmaxParseUtils").assertTag(t,"user");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"devices",e);if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"icdc",s);if(!a.success)return a;var i=o("WASmaxParseJid").attrUserJid(t,"jid");return i.success?o("WAResultOrError").makeResult({jid:i.value,devices:r.value,icdc:a.value}):i}l.parseFetchUserResponseSuccessDevices=e,l.parseFetchUserResponseSuccessIcdc=s,l.parseFetchUserResponseSuccessMixin=u}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:t.value});var n=o("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(e);return n.success?o("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["UserResponseFailure","UserResponseSuccess"],[t,n])}l.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=e}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(e);return n.success?o("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:n.value}):n}l.parseFetchUserResponseMixin=e}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(e);return n.success,n}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"users");if(!a.success)return a;var i=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"user",0,25,e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{usersUser:l.value})):l}l.parseFetchResponseSuccessUsersUser=e,l.parseFetchResponseSuccess=s}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyDhash,n=o("WASmaxJsx").smax("smax$any",{dhash:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDhashMixin=s}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anySeq,n=o("WASmaxJsx").smax("smax$any",{seq:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeICDCSeqMixin=s}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=e.dhashMixinArgs,r=e.iCDCSeqMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutDevicesDhashMixin").mergeDhashMixin,o("WASmaxJsx").smax("user",{jid:o("WAWap").USER_JID(t)}),n),r);return a}function s(t){var n=t.userArgs,r=o("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("users",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,25))));return r}l.makeFetchRequestUsersUser=e,l.makeFetchRequest=s}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutDevicesFetchRequest").makeFetchRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(r,n);if(a.success)return{name:"FetchResponseSuccess",value:a.value};var i=o("WASmaxInDevicesFetchResponseError").parseFetchResponseError(r,n);if(i.success)return{name:"FetchResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:a,Error:i}))}),s.apply(this,arguments)}l.sendFetchRPC=e}),98);
__d("WAFetchFbDevicesProtocolV2",["Promise","WAArrayChunk","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WARPCAbortController","WASignalKeys","WASmaxDevicesFetchRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=25,d=1e4,m=o("WATagsLogger").TAGS(["wa-devices-protocol"]);function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.length===0)return new Map;var r=yield f(e,t),a=o("WAArrayChunk").chunk(e.map(function(e){var t=r.get(e),n=t!=null?{anyDhash:t}:null;return{userJid:e,dhashMixinArgs:n}}),c),i=new Map;return yield(u||(u=n("Promise"))).allSettled(a.map(function(e){return h(i,e)})),i}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t)return new Map;var n=yield o("WALoadContactsApi").loadContacts(e),r=new Map;return n.forEach(function(e){e&&e.dhash!=null&&r.set(e.contactJid,e.dhash)}),r}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var a=new Set(n.map(function(e){return e.userJid})),i=yield o("WARPCAbortController").rpcAbortController(o("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:n}),d);if(i.name==="FetchResponseError")throw r("err")("Failed to fetch user devices");i.value.usersUser.map(function(e){var n=e.userResponseFetchFailureOrFetchSuccessMixinGroup;if(n.name!=="FetchUserResponseFailure"){var r=n.value,i=r.jid,l=r.devices,s=r.icdc;a.delete(i),t.set(i,{newState:C(i,l,s,o("WATimeUtils").unixTime()),stateIsUpToDate:!1})}}),a.forEach(function(e){t.set(e,{stateIsUpToDate:!0})})}catch(t){if(t===o("WARPCAbortController").RPC_TIMEOUT){m.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"])));return}m.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)}}),y.apply(this,arguments)}function C(e,t,n,r){r===void 0&&(r=null);var a=[],i=null;if(t){var l;a=t.device.map(function(e){var t,n;return{id:o("WAJids").interpretAsDeviceId(e.id),identity:o("WASignalKeys").serializeIdentity(e.elementValue),platform:(t=e.deviceModelInfoMixin)==null||(t=t.platform)==null?void 0:t.elementValue,model:(n=e.deviceModelInfoMixin)==null||(n=n.model)==null?void 0:n.elementValue}}),i=(l=t.dhashMixin)==null?void 0:l.dhash}var s=null;if(n){var u=o("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(n);s=u.success?u.value:null}return{jid:e,devices:a,lastSyncTs:o("WATimeUtils").unixTime(),dhash:i,icdcInfo:s,notificationTs:r}}l.fetchFbDevicesProtocol=p}),98);
__d("WADevicesState",["Promise","WAFetchAndSaveDevices","WAFetchFbDevicesProtocolV2","WAPREList","WAPREMetrics","WAResolvable","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=3e4,p=1e3*60*60,_=o("WATagsLogger").TAGS(["WADevicesState"]),f=(function(){function t(){this.$1=new Map}var r=t.prototype;return r.$2=function(t){var e=this;setTimeout(function(){t.forEach(function(t){var n=t[0],r=t[1];r.resolveWasCalled()||(r.resolve(o("WAResultOrError").makeError()),e.$1.get(n)===r&&e.$1.delete(n))})},m),setTimeout(function(){t.forEach(function(t){var n=t[0],r=t[1];e.$1.get(n)===r&&e.$1.delete(n)})},p)},r.waitForUserDevices=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){var i=this;a===void 0&&(a=!1);var l=[],m=[];a===!0&&t.forEach(function(e){i.$1.delete(e)}),t.forEach(function(e){var t=i.$1.get(e);if(t==null){var n=new(o("WAResolvable")).Resolvable;l.push([e,n]),i.$1.set(e,n)}else m.push([e,t.promise])}),this.$2(l),_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",", reason: ",""])),Array.from(t),r);var p=o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.GET_DEVICES,{string:{reason:r}});p.addPoint("fetch_start");var f=yield o("WAFetchFbDevicesProtocolV2").fetchFbDevicesProtocol(l.map(function(e){var t=e[0];return t}),a).catch(function(e){return p.addPoint("fetch_fail"),_.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["fetchFBDevicesProtocol failed: ",""])),e),new Map});p.addPoint("fetch_end");var g=!0;_.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"]))),p.addPoint("signal_update_start"),yield o("WAFetchAndSaveDevices").updateUsersDevicesSignalAndDB(Array.from(f.values()).map(function(e){return e.newState}).filter(Boolean)).catch(function(e){g=!1,_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["updateDevicesSignalAndDB failed: ",""])),e)}),p.addPoint("signal_update_end"),l.forEach(function(e){var t=e[0],n=e[1];if(!g){n.resolve(o("WAResultOrError").makeError()),i.$1.delete(t);return}f.has(t)?n.resolve(o("WAResultOrError").makeResult()):(n.resolve(o("WAResultOrError").makeError()),i.$1.delete(t))}),p.endSuccess(),yield(d||(d=n("Promise"))).allSettled(m.map(function(e){var t=e[0],n=e[1];return n}))});function r(e,n,r){return t.apply(this,arguments)}return r})(),r.reset=function(t){var e=this;t.forEach(function(t){return e.$1.delete(t)})},t})(),g=new f;function h(){return g}l.DeviceStateClassV2=f,l.getDevicesState=h}),98);
__d("WAComputeICDC",["Promise","WAGetDevices","WAICDCUtils","WAIdentityUtils","WAJids","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("WATagsLogger").TAGS(["WAComputeICDC"]);function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=new Set,p=[].concat(t),_=t.find(function(e){return e.user===r});if(_==null){var f=yield i.cryptoManager.storage.loadIdentities(r),g=f.get(a);if(g==null){m.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Sender does not have identity"])));return}p.push({user:r,devicesInfo:[{identity:g,jid:a}]})}var h=void 0,y=[],C=[];return yield(d||(d=n("Promise"))).all(p.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield(d||(d=n("Promise"))).all([i.cryptoManager.storage.loadICDC(e.user),i.cryptoManager.storage.loadLastSyncTs(e.user)]),a=t[0],u=t[1];o("WAICDCUtils").isLastSyncTsExpired(u)&&l.add(e.user);var c=new Set;if(a==null)l.add(e.user);else if(o("WAICDCUtils").isICDCIndexInvalid(a))l.add(e.user),m.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ICDC has invalid index"]))),a=null;else for(var p of a.devices)c.add(p.toString());var _=[],f=[];for(var g of e.devicesInfo){var b=o("WAJids").extractDeviceId(g.jid),v=o("WAIdentityUtils").removeKeyTypeIfNeeded(g.identity);c.has(v.toString())||(_.push(b),f.push(v.buffer))}var S={unknownDevices:f,unknownDeviceIds:_};a!=null&&(S.seq=a.sequence,S.signingDevice=a.devices[a.signingDeviceIndex].buffer),e.user===r?h=S:(y.push(S),C.push(e.user))});return function(t){return e.apply(this,arguments)}})())),l.size>0&&(m.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing or incorrect icdc info."]))),o("WAGetDevices").getDevices(null,{ignoreDhash:!0,reason:"missing-icdc-info",users:l}).catch(function(e){m.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices for users with missing icdc info: ",""])),e)})),{senderIdentity:h,recipientIdentities:y,recipientUserJids:C}}),_.apply(this,arguments)}l.computeICDC=p}),98);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={};s.name="MultiDevice",s.internalSpec={payload:[1,(e=o("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,e.TYPES.MESSAGE,u]},u.name="MultiDevice$Metadata",u.internalSpec={},c.name="MultiDevice$Payload",c.internalSpec={applicationData:[1,e.TYPES.MESSAGE,d],signal:[2,e.TYPES.MESSAGE,y],__oneofs__:{payload:["applicationData","signal"]}},d.name="MultiDevice$ApplicationData",d.internalSpec={appStateSyncKeyShare:[1,e.TYPES.MESSAGE,p],appStateSyncKeyRequest:[2,e.TYPES.MESSAGE,m],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}},m.name="MultiDevice$ApplicationData$AppStateSyncKeyRequestMessage",m.internalSpec={keyIds:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,h]},p.name="MultiDevice$ApplicationData$AppStateSyncKeyShareMessage",p.internalSpec={keys:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_]},_.name="MultiDevice$ApplicationData$AppStateSyncKey",_.internalSpec={keyId:[1,e.TYPES.MESSAGE,h],keyData:[2,e.TYPES.MESSAGE,f]},f.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData",f.internalSpec={keyData:[1,e.TYPES.BYTES],fingerprint:[2,e.TYPES.MESSAGE,g],timestamp:[3,e.TYPES.INT64]},g.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprint",g.internalSpec={rawId:[1,e.TYPES.UINT32],currentIndex:[2,e.TYPES.UINT32],deviceIndexes:[3,e.FLAGS.REPEATED|e.FLAGS.PACKED|e.TYPES.UINT32]},h.name="MultiDevice$ApplicationData$AppStateSyncKeyId",h.internalSpec={keyId:[1,e.TYPES.BYTES]},y.name="MultiDevice$Signal",y.internalSpec={},l.MultiDeviceSpec=s,l.MultiDevice$MetadataSpec=u,l.MultiDevice$PayloadSpec=c,l.MultiDevice$ApplicationDataSpec=d,l.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=m,l.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=p,l.MultiDevice$ApplicationData$AppStateSyncKeySpec=_,l.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=f,l.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=g,l.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=h,l.MultiDevice$SignalSpec=y}),98);
__d("WAParseAppStateSyncKeyRequest",["WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[];for(var n of e.keyIds)n.keyId!=null&&t.push(o("WASyncdKeyTypes").toSyncKeyId(n.keyId));return{keyIds:t}}l.parseAppStateSyncKeyRequest=e}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new DataView(o("WASyncdKeyTypes").fromSyncKeyId(e)).getUint16(0)}function s(e){return new DataView(o("WASyncdKeyTypes").fromSyncKeyId(e)).getUint32(2)}function u(e){return s(e)+1}l.getKeyDeviceId=e,l.getKeyEpoch=s,l.generateNewKeyEpoch=u}),98);
__d("WAParseAppStateSyncKeyShare",["WALogger","WALongInt","WASyncdKeyManagementUtils","WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=[],n=[];for(var r of e.keys){var o=u(r);o!=null&&(o.type==="orphan"?n.push(o.keyId):(o.type,t.push(o.keyData)))}return{keys:t,orphanKeys:n}}function u(t){var n,r,a,i,l,s;if(((n=t.keyId)==null?void 0:n.keyId)==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"]))),null;var u=o("WASyncdKeyTypes").toSyncKeyId(t.keyId.keyId),c=(r=t.keyData)==null?void 0:r.keyData,d=o("WALongInt").maybeNumberOrThrowIfTooLarge((a=t.keyData)==null?void 0:a.timestamp),m=(i=t.keyData)==null||(i=i.fingerprint)==null?void 0:i.currentIndex,p=(l=t.keyData)==null||(l=l.fingerprint)==null?void 0:l.deviceIndexes,_=(s=t.keyData)==null||(s=s.fingerprint)==null?void 0:s.rawId;return t.keyData==null||c==null||d==null||m==null||p==null||_==null?{keyId:u,type:"orphan"}:{keyData:{fingerprint:{currentIndex:m,deviceIndexes:p,rawId:_},keyData:o("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:o("WASyncdKeyManagementUtils").getKeyEpoch(u),keyId:u,timestamp:d},type:"key"}}l.parseAppStateSyncKeyShare=s}),98);
__d("WAConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAJids","WALogger","WAMultiDevice.pb","WAParseAppStateSyncKeyRequest","WAParseAppStateSyncKeyShare","WAStanzaUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b;function v(e){var t=o("WAJids").interpretAndValidateJid(e);if(t.jidType==="msgrUser")return t.userJid;if(t.jidType==="group")return t.groupJid;throw t.jidType,r("err")("Incorrect jid type: "+t.jidType)}function S(e){var t=o("WAJids").interpretAndValidateJid(e);if(t.jidType==="msgrUser")return t.userJid;if(t.jidType==="msgrDevice")return o("WAJids").extractUserJid(t.deviceJid);throw t.jidType,r("err")("Incorrect jid type: "+t.jidType)}function R(e){return e!=null?typeof e=="number"&&e>o("WATimeUtils").MAX_INT?o("WATimeUtils").castMilliSecondsToUnixTime(e):o("WATimeUtils").castLongIntToUnixTime(e):void 0}function L(e){return e==null?void 0:{lastMessageTimestamp:R(e.lastMessageTimestamp),lastSystemMessageTimestamp:R(e.lastSystemMessageTimestamp),messages:e.messages==null?[]:e.messages.map(function(e){return{key:e.key==null?void 0:{fromMe:e.key.fromMe,id:e.key.id},ts:R(e.timestamp)}})}}function E(t,n){var r=t.chatId;if(r==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""])),t),null;if(t.chatArchive!=null){var a=t.chatArchive,i=L(a.messageRange);return{chatJid:v(r),messageRange:i,ts:n,type:"chat_archive"}}else if(t.chatDelete!=null){var l=t.chatDelete,u=L(l.messageRange);return{chatJid:v(r),messageRange:u,ts:n,type:"chat_delete"}}else if(t.chatRead!=null){var c=t.chatRead,d=L(c.messageRange);return{chatJid:v(r),messageRange:d,read:c.read,ts:n,type:"chat_read"}}else return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),t),null}function k(e){var t=e.key,n=t==null?void 0:t.remoteJid,r=t==null?void 0:t.id,a=t==null?void 0:t.fromMe;if(t==null||n==null||a==null||r==null)return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""])),e),null;var i=v(n),l=o("WAJids").interpretAsGroupJid(i)!=null,s;if(l&&!a){if((t==null?void 0:t.participant)==null)return o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""])),e),null;s=S(t.participant)}else a?s=o("WAJids").AUTHOR_ME:s=S(n);var m={author:s,chat:i,externalId:o("WAStanzaUtils").toStanzaId(r)};return e.messageDelete!=null?{protocolMsgId:m,type:"delete_for_me"}:(o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),e),null)}function I(e){var t=[];for(var n of e){var r=R(n.actionTimestamp);if(n.chatAction!=null){var a=E(n.chatAction,r);a!=null&&t.push({chatAction:a})}else if(n.messageAction!=null){var i=k(n.messageAction);i!=null&&t.push({messageAction:i})}else o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),n)}return t}function T(e){var t=e.anonId,n=e.id,r=e.rootKey,a=e.status;if(a==null||n==null||t==null||r==null)return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"]))),null;var i;if(a===o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)i=o("WAAppData").EPOCH_STATUS_OPEN;else if(a===o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)i=o("WAAppData").EPOCH_STATUS_CLOSE;else return o("WALogger").WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"]))),null;return{anonId:t,id:n,rootKey:r,status:i}}function D(e){var t=e.backupId,n=e.epoch,r=e.mailboxRootKey,a=e.obliviousValidationToken,i=e.serverDataId,l=e.tempOcmfClientState;return t==null||i==null||l==null||r==null||a==null?(o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"]))),null):{backupId:t,epoch:n.map(T).reduce(function(e,t){return t!=null?e.concat([t]):e},[]),mailboxRootKey:r,obliviousValidationToken:a,serverDataId:i,tempOcmfClientState:l}}function x(e){var t,n;if(((t=e.applicationData)==null||(t=t.metadataSync)==null?void 0:t.actions)!=null){var r;return{actions:I((r=e.applicationData)==null||(r=r.metadataSync)==null?void 0:r.actions),type:"meta_sync"}}else if(((n=e.signal)==null?void 0:n.encryptedBackupsSecrets)!=null){var a=D(e.signal.encryptedBackupsSecrets);return a==null?null:{encryptedBackupsSecrets:a,type:"backups_secrets"}}else return o("WALogger").WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e),null}function $(e){var t,n;if(((t=e.applicationData)==null?void 0:t.appStateSyncKeyShare)!=null){var r;return{syncKeyShare:o("WAParseAppStateSyncKeyShare").parseAppStateSyncKeyShare((r=e.applicationData)==null?void 0:r.appStateSyncKeyShare),type:"sync_key_share"}}else if(((n=e.applicationData)==null?void 0:n.appStateSyncKeyRequest)!=null){var a;return{syncKeyRequest:o("WAParseAppStateSyncKeyRequest").parseAppStateSyncKeyRequest((a=e.applicationData)==null?void 0:a.appStateSyncKeyRequest),type:"sync_key_request"}}else return o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e),null}function P(e){if(e.subprotocolType==="armadillo"){var t=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAArmadilloApplication.pb").ArmadilloSpec,e.payload);if(t.payload==null)throw r("err")("Appdata contains unparseable armadillo data.");return x(t.payload)}else if(e.subprotocolType==="multiDevice"){var n=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMultiDevice.pb").MultiDeviceSpec,e.payload);if(n.payload==null)throw r("err")("Appdata contains unparseable armadillo data.");return $(n.payload)}else throw r("err")("Appdata contains unexpected message application: "+e.subprotocolType)}function N(e){return e==null?void 0:{lastMessageTimestamp:e.lastMessageTimestamp,lastSystemMessageTimestamp:e.lastSystemMessageTimestamp,messages:e.messages.map(function(e){return{key:e.key==null?void 0:{fromMe:e.key.fromMe,id:e.key.id},timestamp:e.ts}})}}function M(e){switch(e.type){case"meta_sync":return{payload:{applicationData:V(e)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:q(e.encryptedBackupsSecrets)}}};default:return e.type,o("WALogger").WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),{}}}function w(e){return{keyId:o("WASyncdKeyTypes").fromSyncKeyId(e)}}function A(e){return{keyData:{fingerprint:{currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes,rawId:e.fingerprint.rawId},keyData:o("WASyncdKeyTypes").fromSyncKeyData(e.keyData),timestamp:e.timestamp},keyId:w(e.keyId)}}function F(e){var t=e.keys.map(A),n=e.orphanKeys==null?[]:e.orphanKeys.map(function(e){return{keyId:w(e)}});return t.push.apply(t,n),{keys:t}}function O(e){return{keyIds:e.keyIds.map(w)}}function B(e){switch(e.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:F(e.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:O(e.syncKeyRequest)}}};default:return e.type,o("WALogger").WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),{}}}function W(e){var t;switch(e.type){case"meta_sync":case"backups_secrets":{var n=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloApplication.pb").ArmadilloSpec,M(e));t={armadillo:{payload:n.readByteArrayView(),version:1}};break}case"sync_key_share":case"sync_key_request":{var r=o("encodeProtobuf").encodeProtobuf(o("WAMultiDevice.pb").MultiDeviceSpec,B(e));t={multiDevice:{payload:r.readByteArrayView(),version:1}};break}default:e.type,o("WALogger").WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),t={}}return{payload:{subProtocol:t}}}function q(e){return{backupId:e.backupId,epoch:e.epoch.map(U),mailboxRootKey:e.mailboxRootKey,obliviousValidationToken:e.obliviousValidationToken,serverDataId:e.serverDataId,tempOcmfClientState:e.tempOcmfClientState}}function U(e){var t;return e.status===o("WAAppData").EPOCH_STATUS_OPEN?t=o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:e.status===o("WAAppData").EPOCH_STATUS_CLOSE&&(t=o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE),{anonId:e.anonId,id:e.id,rootKey:e.rootKey,status:t}}function V(e){return{metadataSync:{actions:e.actions.map(function(e){return e.chatAction?{actionTimestamp:e.chatAction.ts,chatAction:H(e.chatAction)}:{messageAction:G(e.messageAction)}})}}}function H(e){var t=N(e.messageRange),n=e.chatJid;switch(e.type){case"chat_archive":return{chatArchive:{archived:e.archived,messageRange:t},chatId:n};case"chat_delete":return{chatDelete:{messageRange:t},chatId:n};default:return e.type,{chatId:n,chatRead:{messageRange:t,read:e.read}}}}function G(e){if(e.type==="delete_for_me"){var t=e.protocolMsgId.chat,n=o("WAJids").interpretAsGroupJid(t)!=null;return{key:{fromMe:o("WAJids").isAuthorMe(e.protocolMsgId.author),id:e.protocolMsgId.externalId,participant:!o("WAJids").isAuthorMe(e.protocolMsgId.author)&&n?e.protocolMsgId.author:void 0,remoteJid:t},messageDelete:{}}}else throw r("err")("No other available type")}function z(e){if(e.type!=="meta_sync")return[];var t=e.actions.map(function(e){var t,n=e.chatAction,r=e.messageAction;return(t=r==null?void 0:r.protocolMsgId.chat)!=null?t:n==null?void 0:n.chatJid}).filter(Boolean);return Array.from(new Set(t))}l.parseArmadilloAppData=x,l.parseMultiDeviceAppData=$,l.parseAppData=P,l.convertArmadilloAppData=M,l.convertMultiDeviceAppData=B,l.convertAppData=W,l.getChatJidForAppData=z}),98);
__d("WADbPersonalSenderKeyStatusTxns",["WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["groupJid","senderKeyTs"],s=["groupJid","senderKeyTs"],u={hasSenderKey:new Set,rotateSenderKey:!0,senderKeyId:null,senderKeyTs:o("WATimeUtils").castToUnixTime(0)},c=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(e){return e.stores.personalSenderKeyStatuses.bulkPut(t.map(function(e){return babelHelpers.extends({},u,{groupJid:e})}))},o("WASignalDB").signalOp("bulkPutNewPersonalSenderKeyStatus")).then(function(){})},d=function(t,r,a){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.get(t);yield e.stores.personalSenderKeyStatuses.bulkPut([babelHelpers.extends({},n||u,{groupJid:t,rotateSenderKey:!1,senderKeyId:r,senderKeyTs:a})])});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("markSenderKeyAsRotated"))},m=function(r){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t.stores.personalSenderKeyStatuses.get(r);if(n!=null){var o=n.groupJid,a=n.senderKeyTs,i=babelHelpers.objectWithoutPropertiesLoose(n,e);return babelHelpers.extends({},i,{ts:a})}var l=babelHelpers.extends({},u,{groupJid:r});yield t.stores.personalSenderKeyStatuses.bulkPut([l]);var c=l.groupJid,d=l.senderKeyTs,m=babelHelpers.objectWithoutPropertiesLoose(l,s);return babelHelpers.extends({},m,{ts:d})});return function(e){return t.apply(this,arguments)}})(),"Signal - getSenderKeyStatus")},p=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.bulkGet(t);yield e.stores.personalSenderKeyStatuses.bulkPut(n.filter(function(e){return e!=null}).map(function(e){return babelHelpers.extends({},e,{rotateSenderKey:!0})}))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("bulkSetRotateSenderKeyToTrue"))},_=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(e){return e.stores.personalSenderKeyStatuses.bulkDelete(t)},o("WASignalDB").signalOp("deletePersonalSenderKeyStatus"))};l.bulkPutNewPersonalSenderKeyStatus=c,l.markSenderKeyAsRotated=d,l.getSenderKeyStatus=m,l.bulkSetRotateSenderKeyToTrue=p,l.deletePersonalSenderKeyStatus=_}),98);
__d("WACreateGroup",["WADbPersonalSenderKeyStatusTxns","WAGlobals","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAGlobals").getDependencies().createGroups(e),yield o("WADbPersonalSenderKeyStatusTxns").bulkPutNewPersonalSenderKeyStatus(e.map(function(e){return e.groupToCreate.jid}))});return function(n){return e.apply(this,arguments)}})();l.createGroups=e}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return(e||(e=n("Promise"))).resolve().then(function(){return o("WASignalKeys").makeKeyPair()})}function u(t,r){return(e||(e=n("Promise"))).resolve().then(function(){return o("WACryptoPrimitives").scalarMult(o("WASignalOther").ensureSize(r,32),o("WASignalOther").ensureSize(t,32)).buffer})}var c={generateIdentityKeyPair:s,calculateAgreement:u};l.calculateAgreement=u,l.CURVE25519_SIGNAL_DEPENDENCIES=c}),98);
__d("WAGetPrekeyIdsInRange",["WASignalKeys"],(function(t,n,r,o,a,i,l){"use strict";var e=16777215;function s(e){return e}function u(t,n){var r=[],a=t,i=n;if(a<=i)for(var l=a;l<=n;l++)r.push(o("WASignalKeys").castToPreKeyId(l));else{for(var u=a;u<e;u++)r.push(o("WASignalKeys").castToPreKeyId(u));for(var c=1;c<=i;c++)r.push(o("WASignalKeys").castToPreKeyId(c))}return r}l.PRE_KEY_MAX_ID=e,l.getPrekeyIdsInRange=u}),98);
__d("WADeletePreKeyGenerationsApi",["Promise","WAGetPrekeyIdsInRange","WALogger","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(r){return o("WASignalDB").getDb().runInTransaction(["prekey","prekeyGeneration"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield t.stores.prekeyGeneration.bulkGet(r),i=[];for(var l of a){if(l==null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"])));continue}for(var u of o("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(l.startingId,l.endingId))i.push(u)}yield(s||(s=n("Promise"))).all([t.stores.prekeyGeneration.bulkDelete(r),t.stores.prekey.bulkDelete(i)])});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("deletePreKeyGenerations"))};l.deletePreKeyGenerations=u}),98);
__d("WAGetLastPreKeyGenerationIdApi",["Promise","WADbSignal","WASignalDB","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(t){return(e||(e=n("Promise"))).all([t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyId).then(function(e){return e==null?void 0:e.value.lastPrekeyId}),t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(e){return e==null?void 0:e.value.lastPrekeyGenerationId})])},o("WASignalDB").signalOp("getLastPreKeyGenerationId")),a=t[0],i=t[1];if(a==null&&i!=null||a!=null&&i==null)throw r("err")("Last prekey id and Last prekey generation id should both be non-null");return a!=null&&i!=null?{lastGenerationId:i,lastPreKeyId:a}:null});return function(){return t.apply(this,arguments)}})();l.getLastPreKeyGenerationId=s}),98);
__d("WAGetPreKeyGenerationsTimestampsApi",["WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WASignalDB").getDb().runInTransaction(["prekeyGeneration"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.prekeyGeneration.readAll();return t.map(function(e){return{id:e.generationId,timestamp:e.createdTs}})});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("getPreKeyGenerationsTimestamps"))};l.getPreKeyGenerationsTimestamps=e}),98);
__d("WALoadICDCApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet([t]).then(function(e){var t,n=e.filter(Boolean).length>0?e[0]:null;return(t=n==null?void 0:n.icdcInfo)!=null?t:null})},o("WASignalDB").signalOp("loadICDC"))};l.loadICDC=e}),98);
__d("WALoadIdentitiesApi",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(t){return o("WASignalDB").getDb().runInTransaction(["identity"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.identity.readIndex("userJid",[t]);return new Map(n.filter(Boolean).map(function(e){return[e.deviceJid,e.identity]}))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadIdentities"))},u=function(r){return o("WASignalDB").getDb().runInTransaction(["identity"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var o=yield(e||(e=n("Promise"))).all(r.map(function(e){return t.stores.identity.readIndex("userJid",[e])})),a=new Map;for(var i of o)for(var l of i)if(l!=null){var s=a.get(l.userJid);s==null&&(s=new Map),s.set(l.deviceJid,l.identity),a.set(l.userJid,s)}return a});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("bulkLoadIdentities"))};l.loadIdentities=s,l.bulkLoadIdentities=u}),98);
__d("WALoadLastSyncTsApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet([t]).then(function(e){var t,n=e.filter(Boolean).length>0?e[0]:null;return(t=n==null?void 0:n.lastSyncTs)!=null?t:null})},o("WASignalDB").signalOp("loadLastSyncTs"))};l.loadLastSyncTs=e}),98);
__d("WADbMetaTxns",["WADbSignal","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.meta.bulkGet([o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,o("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(e){var t=e[0],n=e[1],r=t==null?void 0:t.value.lastSignedPrekeyId,o=n==null?void 0:n.value.identityKeyPair;return{identityPair:o,keyId:r}})}var s=function(t){return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield e.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.cat,value:{cat:t}}]),t});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveCAT"))};l.maybeGetLastSignedPrekeyIdAndIdentity=e,l.saveCAT=s}),98);
__d("WADbSignedPrekeyTxns",["WADbMetaTxns","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WADbMetaTxns").maybeGetLastSignedPrekeyIdAndIdentity(e),n=t.identityPair,r=t.keyId;if(r==null)return n==null?o("WAResultOrError").makeError("missing-last-signed-prekey-id-and-registration"):o("WAResultOrError").makeError("missing-last-signed-prekey-id");var a=yield e.signedPrekey.get(r);return a==null?o("WAResultOrError").makeError("missing-last-signed-prekey"):o("WAResultOrError").makeResult(a.encoded)}),s.apply(this,arguments)}l.getLatestSignedPreKey=e}),98);
__d("WALoadLatestSignedPreKeyApi",["WADbSignedPrekeyTxns","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readonly",function(e){return o("WADbSignedPrekeyTxns").getLatestSignedPreKey(e.stores)},o("WASignalDB").signalOp("loadLatestSignedPreKey"))};l.loadLatestSignedPreKey=e}),98);
__d("WALoadOneTimePreKeyApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["prekey"],"readonly",function(e){return e.stores.prekey.get(t).then(function(e){return e==null?void 0:e.encoded})},o("WASignalDB").signalOp("loadOneTimePreKey"))};l.loadOneTimePreKey=e}),98);
__d("WADbPrekeyTxns",["WAGetPrekeyIdsInRange","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.prekeyGeneration.get(t);if(n==null)throw r("err")("Expected a prekey generation row");var a=o("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(n.startingId,n.endingId),i=yield e.prekey.bulkGet(a);return i.filter(Boolean).map(function(e){return e.encoded})}),s.apply(this,arguments)}l.getPrekeysForGeneration=e}),98);
__d("WALoadPreKeysApi",["WADbPrekeyTxns","WADbSignal","WADbSignedPrekeyTxns","WALoggerTag","WASignalDB","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS([r("WALoggerTag").SignedPrekey]),d=function(a){return o("WASignalDB").getDb().runInTransaction(["identity","meta","prekey","prekeyGeneration","signedPrekey"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WADbSignedPrekeyTxns").getLatestSignedPreKey(t.stores);if(!n.success){var i;throw c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to get latest signed prekey"]))),(i=n.error)!=null?i:r("err")("Failed to get latest signed prekey")}var l=o("WASignalSignatures").deserializeSignedPreKey(n.value);if(l==null)throw c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey"]))),r("err")("Failed to deserialize signed prekey");var d=a!=null?a:yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(e){return e==null?void 0:e.value.lastPrekeyGenerationId});if(d==null)throw c.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No last prekey generation id"]))),r("err")("No last prekey generation id");return o("WADbPrekeyTxns").getPrekeysForGeneration(t.stores,d).then(function(e){return{preKeys:e,signedPreKey:l}})});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadPreKeys"))};l.loadPreKeys=d}),98);
__d("WALoadSenderKeySessionApi",["WACryptoManager","WADbSignal","WAJids","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,r){var e=o("WAJids").extractUserJid(r),a=o("WAJids").extractDeviceId(r),i=o("WADbSignal").buildSenderKeySessionId(t,e,a);return o("WASignalDB").getDb().runInTransaction(["senderKeySessions"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.senderKeySessions.get(i);if(t==null)return o("WAResultOrError").makeError("errLoadSenderKeySession");var n=o("WACryptoManager").decodeSenderKeySession(t.record);return o("WAResultOrError").makeResult(n)});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadSenderKeySession"))};l.loadSenderKeySession=e}),98);
__d("WALoadSignedPreKeyApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(e){return e.stores.signedPrekey.get(t).then(function(e){return e==null?void 0:e.encoded})},o("WASignalDB").signalOp("loadSignedPreKey"))};l.loadSignedPreKey=e}),98);
__d("WASaveOneTimePreKeyApi",["Promise","WADbSignal","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r){return o("WASignalDB").getDb().runInTransaction(["meta","prekey"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyId),i=a==null?void 0:a.value.lastPrekeyId;return i==null?o("WAResultOrError").makeError("missing_last_prekey"):(yield(e||(e=n("Promise"))).all([t.stores.prekey.bulkPut([babelHelpers.extends({},r,{isDeleted:!1})]),t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:r.keyId}}])]),o("WAResultOrError").makeResult())});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveOneTimePreKey"))};l.saveOneTimePreKey=s}),98);
__d("WASavePreKeysGenerationApi",["Promise","WACryptoManager","WADbSignal","WAResultOrError","WASignalDB","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length===0)throw r("err")("Keys provided to savePreKeysGeneration cannot be empty");var a=yield o("WASignalDB").getDb().runInTransaction(["meta","prekey","prekeyGeneration"],"readwrite",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a,i=yield r.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId),l=o("WACryptoManager").castToPreKeyGenerationId(((a=i==null?void 0:i.value.lastPrekeyGenerationId)!=null?a:0)+1),s=t[0].keyId,u=t[t.length-1].keyId,c=t.map(function(e){return babelHelpers.extends({},e,{isDeleted:!1})});return yield(e||(e=n("Promise"))).all([r.stores.prekey.bulkPut(c),r.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:u}},{key:o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:l}}]),r.stores.prekeyGeneration.bulkPut([{createdTs:o("WATimeUtils").unixTime(),endingId:u,generationId:l,startingId:s}])]),o("WAResultOrError").makeResult(l)});return function(e){return r.apply(this,arguments)}})(),o("WASignalDB").signalOp("savePreKeysGeneration"));return a});return function(n){return t.apply(this,arguments)}})();l.savePreKeysGeneration=s}),98);
__d("WASaveSignedPreKeyIfNewApi",["Promise","WADbSignal","WASignalDB","WASignalSignatures","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var i=yield t.stores.signedPrekey.get(r);if(i!=null){var l=o("WASignalSignatures").deserializeSignedPreKey(i.encoded);if(l!=null)return{key:l,type:"duplicate"}}return yield(e||(e=n("Promise"))).all([t.stores.signedPrekey.bulkPut([{encoded:a,keyId:r}]),t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:r}}])]),{type:"success"}});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveSignedPreKeyIfNew"))};l.saveSignedPreKeyIfNew=s}),98);
__d("WASessionApi",["WACryptoManager","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().store("session").get(t).then(function(e){return e==null?null:o("WACryptoManager").decodeSession(e.session)})},s=function(t){return o("WASignalDB").getDb().store("session").bulkGet(t).then(u)};function u(e){var t=new Map;for(var n of e)if(n!=null){var r=o("WACryptoManager").decodeSession(n.session);t.set(n.id,r)}return t}l.loadSession=e,l.bulkLoadSession=s}),98);
__d("WACryptoDbCallbacks",["WABulkSaveSignalDataApi","WADeletePreKeyGenerationsApi","WAGetLastPreKeyGenerationIdApi","WAGetPreKeyGenerationsTimestampsApi","WALoadICDCApi","WALoadIdentitiesApi","WALoadLastSyncTsApi","WALoadLatestSignedPreKeyApi","WALoadOneTimePreKeyApi","WALoadPreKeysApi","WALoadSenderKeySessionApi","WALoadSignedPreKeyApi","WASaveOneTimePreKeyApi","WASavePreKeysGenerationApi","WASaveSignedPreKeyIfNewApi","WASessionApi"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return{bulkLoadIdentities:o("WALoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:o("WABulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:o("WADeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:o("WAGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:o("WAGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:o("WALoadICDCApi").loadICDC,loadIdentities:o("WALoadIdentitiesApi").loadIdentities,loadLastSyncTs:o("WALoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:o("WALoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:o("WALoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:o("WALoadPreKeysApi").loadPreKeys,loadSenderKeySession:o("WALoadSenderKeySessionApi").loadSenderKeySession,loadSession:o("WASessionApi").loadSession,loadSessions:o("WASessionApi").bulkLoadSession,loadSignedPreKey:o("WALoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:o("WASaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:o("WASavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:o("WASaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew}};l.getCryptoDbCallbacks=e}),98);
__d("WAMPSFlushable",["MpsTypes","WebMps","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=[],this.$2=new Map,this.$3=new Set}var t=e.prototype;return t.enqueue=function(t,n,r){t!=null&&(this.$1.push(t),this.$2.set(t.messageId,n),this.$3.add(r))},t.flush=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i){if(this.$1.length!==0){var l=this.$1,s=Array.from(this.$3).join(", "),u=this.$2;this.$1=[],this.$2=new Map,this.$3=new Set;try{var c=yield o("WebMps").mps().saveNewMessages(l.map(function(e){return{directive:null,message:e,insertionSource:o("MpsTypes").InsertionSource.Receive}}),{source:s});u.forEach(function(e,t){e(c.get(t))})}catch(e){var d=r("getErrorSafe")(e);n==null||n.addPoint("mps_persistance_fail"),u.forEach(function(e){e(d)})}}});function t(t,n,r,o,a){return e.apply(this,arguments)}return t})(),e})(),s=new e;l.MPSFlushable=e,l.mpsFlushable=s}),98);
__d("WAMapContentTypeToFbType",[],(function(t,n,r,o,a,i){"use strict";function e(e){switch(e){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:return"text"}}i.mapContentTypeToFbType=e}),66);
__d("WAProtocolQueue",["PersistedQueueApi","WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue"],(function(t,n,r,o,a,i,l){"use strict";var e,s=5e3,u=null;function c(t){if(u!=null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"]))),u;var n=o("WAPersistedQueue").initPersistedQueue("stanzaQueue",t,{cacheSize:null,maxDelay:s});return u=n,u}function d(){return u||c(o("PersistedQueueApi").persistedQueueApi())}var m=(function(){function e(){this.$1=[],this.$2=[],this.$3=[]}var t=e.prototype;return t.enqueue=function(t,n,r){this.$1.push(t),n&&this.$2.push(n),r&&this.$3.push(r)},t.flush=function(t,n,r,o,a){var e=this.$1,i=this.$2,l=this.$3;return this.$1=[],this.$2=[],this.$3=[],d().addAndCommit(e).then(function(){return i.forEach(function(e){return e()})}).catch(function(e){return l.forEach(function(t){return t(e)})})},e})(),p=new m;function _(e){return e.map(function(e){return e.type==="message"?f(e):babelHelpers.extends({},e)})}function f(e){switch(e.subtype){case"unavailable":{var t=e,n=o("WAJids").extractUserJid(t.from),r={id:{author:o("WAGlobals").getMyUserJid()===n?"@me":n,chat:t.jid,externalId:t.stanzaId},ts:t.serverTs,type:"UnavailableMsg"};return{incomingType:"wa-incoming",jid:t.jid,message:{decrypted:r,details:{count:null,externalId:t.stanzaId,from:o("WAJids").switchOnMsgrChatJidType(t.jid,{group:function(n){return{author:t.from,chat:n,groupJid:n,type:"group"}},user:function(n){return{author:t.from,chat:n,deviceJid:t.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:t.offline,recipient:t.recipient,reportingMeta:t.reportingMeta,retryCount:t.retryCount,ts:t.serverTs,type:o("WAMapContentTypeToFbType").mapContentTypeToFbType(t.contentType)}},priority:t.priority,stanzaId:t.stanzaId,stanzaQueueId:e.stanzaQueueId,type:t.type}}case"armadillo":{var a=e,i=o("WAJids").extractUserJid(a.from),l={folder:a.fbFolderId,id:{author:o("WAGlobals").getMyUserJid()===i?"@me":i,chat:a.jid,externalId:a.stanzaId},msg:a.message,recipientsCount:null,reportingMeta:a.reportingMeta,ts:a.serverTs,type:"IncomingMsg"};return{incomingType:e.incomingType,jid:a.jid,message:{decrypted:l,details:{count:null,externalId:a.stanzaId,from:o("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(t){return{author:a.from,chat:t,groupJid:t,type:"group"}},user:function(t){return{author:a.from,chat:t,deviceJid:a.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:a.offline,recipient:a.recipient,reportingMeta:a.reportingMeta,retryCount:a.retryCount,ts:a.serverTs,type:o("WAMapContentTypeToFbType").mapContentTypeToFbType(a.contentType)}},priority:a.priority,stanzaId:a.stanzaId,stanzaQueueId:e.stanzaQueueId,type:a.type,ebTimestampMs:a.ebTimestampMs}}case"instamadillo":{var s=e,u=o("WAJids").extractUserJid(s.from),c={folder:s.fbFolderId,id:{author:o("WAGlobals").getMyUserJid()===u?"@me":u,chat:s.jid,externalId:s.stanzaId},msg:s.message,recipientsCount:null,reportingMeta:s.reportingMeta,ts:s.serverTs,type:"InstamadilloMsg"};return{incomingType:"wa-incoming",jid:s.jid,message:{decrypted:c,details:{count:null,externalId:s.stanzaId,from:o("WAJids").switchOnMsgrChatJidType(s.jid,{group:function(t){return{author:s.from,chat:t,groupJid:t,type:"group"}},user:function(t){return{author:s.from,chat:t,deviceJid:s.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!0,offline:s.offline,recipient:s.recipient,reportingMeta:s.reportingMeta,retryCount:s.retryCount,ts:s.serverTs,type:o("WAMapContentTypeToFbType").mapContentTypeToFbType(s.contentType)}},priority:s.priority,stanzaId:s.stanzaId,stanzaQueueId:e.stanzaQueueId,type:s.type}}case"ciphertext":{var d=function(){return!(m.contentType==="reaction"||m.hideDecryptionFailure===!0)},m=e,p=o("WAJids").extractUserJid(m.from),_={createPlaceholder:d(),id:{author:o("WAGlobals").getMyUserJid()===p?"@me":p,chat:m.jid,externalId:m.stanzaId},ts:m.serverTs,type:"IncomingCiphertextMsg"};return{incomingType:"wa-incoming",jid:m.jid,message:{decrypted:_,details:{count:null,type:o("WAMapContentTypeToFbType").mapContentTypeToFbType(m.contentType),externalId:m.stanzaId,from:o("WAJids").switchOnMsgrChatJidType(m.jid,{group:function(t){return{author:m.from,chat:t,groupJid:t,type:"group"}},user:function(t){return{author:m.from,chat:t,deviceJid:m.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:m.offline,recipient:m.recipient,reportingMeta:m.reportingMeta,retryCount:m.retryCount,ts:m.serverTs}},priority:m.priority,stanzaId:m.stanzaId,stanzaQueueId:e.stanzaQueueId,type:m.type}}default:return babelHelpers.extends({},e)}}var g=9,h=7,y=5,C=2;function b(e){return e}function v(e){return e}function S(e){return e}l.initProtocolQueue=c,l.protocolQueue=d,l.PQFlushable=m,l.pqFlushable=p,l.mapProtocolEntriesV2toV1=_,l.mapProcolQueueMessageV2toV1=f,l.WAProtocolQueuePriorityHigh=g,l.WAProtocolQueuePriorityMid=h,l.WAProtocolQueuePriorityLow=y,l.WAProtocolQueuePriorityBackground=C,l.appdataApplicationProtocol=b,l.extractSubProtocolFromAppdataProtocol=v,l.numberToStanzaQueueId=S}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]),l=(function(){function t(){this.$1=new Map}var r=t.prototype;return r.TEST_ONLY_LOAD_FROM_MEMORY=function(t){return this.$2(t)},r.$2=function(t){var e=this.$1.get(t);return e!=null?{entity:e.entity,deleted:e.deleted}:null},r.load=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=this.$2(e);if(n!=null&&n.deleted)return null;if(n!=null&&n.entity!=null)return n.entity;var r=yield t(e);return this.$3(e,r),r});function t(t,n){return e.apply(this,arguments)}return t})(),r.bulkLoad=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=[],r=new Map;for(var o of e){var a=this.$2(o);if(a==null){n.push(o);continue}a.deleted||(a.entity!=null?r.set(o,a.entity):n.push(o))}var i=yield t(n);for(var l of i.entries()){var s=l[0],u=l[1];r.set(s,u),this.$3(s,u)}return r});function t(t,n){return e.apply(this,arguments)}return t})(),r.$3=function(n,r){this.$1.set(n,{entity:r,status:e.PERSISTED,deleted:!1})},r.store=function(n,r){this.$1.set(n,{entity:r,status:e.NOT_PERSISTED,deleted:!1})},r.remove=function(n){this.$1.set(n,{entity:null,status:e.NOT_PERSISTED,deleted:!0})},r.pureSnapshot=function(){var t=[],n=Array.from(this.$1.entries()).filter(function(t){var n=t[0],r=t[1];return r.status===e.NOT_PERSISTED}).filter(function(e){var n=e[0],r=e[1];return r.deleted&&t.push({id:n}),!r.deleted}).filter(function(e){var t=e[0],n=e[1];return n.entity!=null}).map(function(e){var t=e[0],n=e[1];return{id:t,cachedEntity:n.entity}});return{update:n,remove:t}},r.snapshot=function(){var t=this,n=this.pureSnapshot();return n.remove.forEach(function(n){var r=n.id,o=t.$1.get(r);o&&(o.status=e.PERSIST_IN_PROGRESS)}),n.update.forEach(function(n){var r=n.id,o=t.$1.get(r);o&&(o.status=e.PERSIST_IN_PROGRESS)}),n},r.markSnapshotAsCommitted=function(){this.$1.forEach(function(t){t.status===e.PERSIST_IN_PROGRESS&&(t.status=e.PERSISTED)})},r.markSnapshotAsFailed=function(){this.$1.forEach(function(t){t.status===e.PERSIST_IN_PROGRESS&&(t.status=e.NOT_PERSISTED)})},r.clear=function(){this.$1=new Map},t})();i.PersistStatus=e,i.SignalEntityStore=l}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(){function t(){this.$1=new Map,this.$2=new(o("WASignalEntityStoreV2")).SignalEntityStore}var r=t.prototype;return r.bulkLoadIdentities=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,r=function*(){var e=o[0],r=o[1];yield t.loadIdentitiesByUser(e,function(){return(s||(s=n("Promise"))).resolve(r)})};for(var o of e)yield*r();return e});function t(t){return e.apply(this,arguments)}return t})(),r.loadIdentitiesByUser=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=this.$1.get(t);if(a==null){var i=this.$3(t,yield r(t)),l=Array.from(i.keys());return this.$1.set(t,new Set(l)),this.$2.bulkLoad(l,function(){return(s||(s=n("Promise"))).resolve(i)})}else return this.$2.bulkLoad(Array.from(a),function(t){return t.length>0&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."]))),(s||(s=n("Promise"))).resolve(new Map)})});function r(e,n){return t.apply(this,arguments)}return r})(),r.$3=function(t,n){var e=new Map(n),r=this.$2.pureSnapshot(),a=r.remove,i=r.update;for(var l of a){var s=l.id;e.delete(s)}for(var u of i){var c=u.id,d=u.cachedEntity;d!=null&&o("WAJids").extractUserJid(c)===t&&e.set(c,d)}return e},r.store=function(t,n){this.$2.store(t,n);var e=o("WAJids").extractUserJid(t),r=this.$1.get(e);r!=null&&r.add(t)},r.remove=function(t){this.$2.remove(t);var e=o("WAJids").extractUserJid(t),n=this.$1.get(e);n!=null&&n.delete(t)},r.clear=function(){this.$2.clear(),this.$1=new Map},r.load=function(t,n){return this.$2.load(t,n)},r.bulkLoad=function(t,n){return this.$2.bulkLoad(t,n)},r.snapshot=function(){return this.$2.snapshot()},r.pureSnapshot=function(){return this.pureSnapshot()},r.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()},r.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()},t})();l.SignalIdentityStore=u}),98);
__d("WAInMemorySignalStore",["MAWMpsGating","Promise","WAArmadilloTransportEvent.pb","WABuildMpsPayload","WACryptoManager","WACryptoUtils","WAGlobals","WAIdentityUtils","WAJids","WAMPSFlushable","WAProtocolQueue","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b=o("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]),v=(function(){function t(e,t){var r=this,a;this.loadSession=function(e,t){return r.$1.load(e,function(e){return r.$9.loadSession(e,t)})},this.loadSessions=function(e){return r.$1.bulkLoad(e,function(e){return r.$9.loadSessions(e).then(function(e){return new Map(Array.from(e.entries()).map(function(e){return[e[0],e[1]]}))})}).then(function(e){return new Map(Array.from(e.entries()).map(function(e){return[e[0],e[1]]}))})},this.loadSignedPreKey=function(e){return r.$7.load(e,function(){return r.$9.loadSignedPreKey(e)})},this.bulkLoadIdentities=function(e){var t=new Map;return(C||(C=n("Promise"))).all(e.map(function(e){return r.loadIdentities(e).then(function(n){t.set(e,n)})})).then(function(){return t})},this.loadIdentities=function(e){return r.$5.loadIdentitiesByUser(e,function(){return r.$9.loadIdentities(e)})},this.saveIdentity=function(e,t){return(C||(C=n("Promise"))).resolve(r.storeIdentity(e,t))},this.loadOneTimePreKey=function(e){return r.$6.load(e,function(){return r.$9.loadOneTimePreKey(e)})},this.saveSenderKeySession=function(e,t,o){return r.storeSenderKeySession(e,t,o),(C||(C=n("Promise"))).resolve()},this.saveSignedPreKeyIfNew=function(e,t){return r.$9.saveSignedPreKeyIfNew(e,t)},this.loadSenderKeySession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=yield r.$8.load(o("WACryptoManager").encodeSenderKey(e,t),n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield r.$9.loadSenderKeySession(e,t);return n.success?n.value:null}));return a==null?o("WAResultOrError").makeError("errLoadSenderKeySession"):o("WAResultOrError").makeResult(a)});return function(t,n){return e.apply(this,arguments)}})(),this.handleNewSession=function(e,t,a,i,l){return r.storeSession(e,t),a!=null&&r.storeIdentity(e,a),i!=null&&r.removeOneTimePreKey(i),(C||(C=n("Promise"))).resolve(o("WAResultOrError").makeResult())},this.saveICDC=function(e,t){return r.$3.store(e,t),(C||(C=n("Promise"))).resolve()},this.loadICDC=function(e){return r.$3.load(e,function(){return r.$9.loadICDC(e)})},this.saveLastSyncTs=function(e,t){return r.$4.store(e,t),(C||(C=n("Promise"))).resolve()},this.loadLastSyncTs=function(e){return r.$4.load(e,function(){return r.$9.loadLastSyncTs(e)})},this.saveDhash=function(e,t){return r.$2.store(e,t),(C||(C=n("Promise"))).resolve()},this.getLastPreKeyGenerationId=function(){return r.$9.getLastPreKeyGenerationId()},this.savePreKeysGeneration=function(e){return r.$9.savePreKeysGeneration(e)},this.getPreKeyGenerationsTimestamps=function(){return r.$9.getPreKeyGenerationsTimestamps()},this.deletePreKeyGenerations=function(e){return r.$9.deletePreKeyGenerations(e)},this.saveOneTimePreKey=function(e){return r.$9.saveOneTimePreKey(e)},this.loadPreKeys=function(e){return r.$9.loadPreKeys(e)},this.loadLatestSignedPreKey=function(){return r.$9.loadLatestSignedPreKey()},this.$9=e,this.$10=t,this.$5=new(o("WASignalIdentityStore")).SignalIdentityStore,this.$1=new(a=o("WASignalEntityStoreV2")).SignalEntityStore,this.$2=new a.SignalEntityStore,this.$3=new a.SignalEntityStore,this.$4=new a.SignalEntityStore,this.$6=new a.SignalEntityStore,this.$7=new a.SignalEntityStore,this.$8=new a.SignalEntityStore}var r=t.prototype;return r.storeSession=function(t,n){this.$1.store(t,n)},r.storeIdentity=function(t,n){n&&this.$5.store(t,n)},r.removeOneTimePreKey=function(t){this.$6.remove(t)},r.storeSenderKeySession=function(t,n,r){this.$8.store(o("WACryptoManager").encodeSenderKey(t,n),r)},r.updateUserDevicesInfo=function(r){var t=this;return(C||(C=n("Promise"))).all(r.map((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=yield t.loadIdentities(r.jid),i=r.devices,l=r.jid,_=r.notificationTs,f=r.dhash,g=r.icdcInfo,h=r.lastSyncTs;b.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"])),l,i.map(function(e){var t=e.id;return o("WAJids").toDeviceJid(r.jid,t)}).join(","),Array.from(a.keys()).join(","));var y=new Set(a.keys()),v=[],S=[];for(var R of i){var L=R.id,E=R.identity,k=R.model,I=R.platform,T=o("WAJids").toDeviceJid(r.jid,L),D=a.get(T);if(o("WAGlobals").getMyDeviceJid()===T){var x=o("WACryptoUtils").uint8ArraysEqual(o("WAIdentityUtils").removeKeyTypeIfNeeded(t.$10.staticKeyPair.publicKey),o("WAIdentityUtils").removeKeyTypeIfNeeded(E));x||b.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"])))}if(y.delete(T),D==null)S.push({instruction:"identityAdded",jid:o("WAJids").extractUserJid(T),type:"instruction",device:T,identity:E,model:k,platform:I,notificationTs:_,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow});else if(!o("WACryptoUtils").uint8ArraysEqual(D,E)){if(o("WAJids").extractUserJid(T)!==l){b.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"])));continue}v.push(T),b.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""])),T),S.push({instruction:"identityChanged",jid:o("WAJids").extractUserJid(T),type:"instruction",device:T,identity:E,model:k,platform:I,notificationTs:_,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow})}}var $=[];for(var P of y){if(o("WAJids").extractUserJid(P)!==l){b.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "])));continue}$.push(P),o("WAGlobals").getMyDeviceJid()===P&&b.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"]))),b.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""])),P),S.push({instruction:"identityRemoved",jid:o("WAJids").extractUserJid(P),type:"instruction",device:P,notificationTs:_,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow})}return(C||(C=n("Promise"))).all([f!=null?t.saveDhash(l,f):(C||(C=n("Promise"))).resolve(),h!=null?t.saveLastSyncTs(l,h):(C||(C=n("Promise"))).resolve(),g!=null?t.saveICDC(l,g):(C||(C=n("Promise"))).resolve()].concat(Array.from($).map(function(e){return t.deleteIdentity(e)}),[$.concat(v).map(function(e){return t.$11(e)})],i.map(function(e){var n=e.id,r=e.identity;return t.saveIdentity(o("WAJids").toDeviceJid(l,n),r)}))).then(function(){return S})});return function(e){return r.apply(this,arguments)}})())).then(function(e){var t=e.flat();t.forEach(function(e){var t,n;switch(e.instruction){case"identityAdded":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED;break;case"identityChanged":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED;break;case"identityRemoved":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED;break;default:return}var r=o("WAGlobals").getDependencies().generateExternalId();o("WAMPSFlushable").mpsFlushable.enqueue(o("WABuildMpsPayload").buildMpsDeviceChangeAdminMessage(e.jid,(t=e.notificationTs)!=null?t:o("WATimeUtils").unixTime(),r,n,e.platform,e.model),function(e){if(e!=null){b.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to save device change admin message: ",""])),e);return}},"handle_device_change"),o("MAWMpsGating").isFullMpsEnabled()||o("WAProtocolQueue").pqFlushable.enqueue(e)}),o("MAWMpsGating").isFullMpsEnabled()&&o("WAGlobals").getDependencies().recordDeviceChangeHistory(t.map(function(e){var t,n,r;if(e.device==null)return null;var a=e.device;switch(e.instruction){case"identityAdded":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED,platform:e.platform,model:e.model,device:a,identity:e.identity,ts:(t=e.notificationTs)!=null?t:o("WATimeUtils").unixTime()};case"identityChanged":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED,platform:e.platform,model:e.model,device:a,identity:e.identity,ts:(n=e.notificationTs)!=null?n:o("WATimeUtils").unixTime()};case"identityRemoved":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED,device:a,ts:(r=e.notificationTs)!=null?r:o("WATimeUtils").unixTime()};default:return null}}).filter(Boolean)).catch(function(e){b.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failed to record device change history: ",""])),e)})}).then(function(){})},r.savePendingToDatabase=function(){var e=this,t=this.$12();return t==null?(C||(C=n("Promise"))).resolve():(b.DEV(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""])),t),b.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"]))),this.$9.bulkSaveSignalData(t).then(function(){b.LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]))),e.$13()},function(t){return e.$14(),(C||(C=n("Promise"))).reject(t)}))},r.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()},r.deleteIdentity=function(t){return this.$5.remove(t),(C||(C=n("Promise"))).resolve()},r.$11=function(t){return this.$1.remove(t),(C||(C=n("Promise"))).resolve()},r.$13=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$4.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()},r.$14=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$4.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()},r.$12=function(){var e=this.$1.snapshot(),t=[],n=e.remove.map(function(e){return e.id});e.update.forEach(function(e){var n=e.id,r=e.cachedEntity;r!=null&&t.push({id:n,updated:r})});var r=[];this.$8.snapshot().update.forEach(function(e){var t=o("WACryptoManager").decodeSenderKey(e.id),n=t.groupId,a=t.deviceId;e.cachedEntity!=null&&n&&a&&r.push({groupId:n,author:a,updated:e.cachedEntity})});var a=this.$5.snapshot(),i=a.remove.map(function(e){return e.id}),l=[];a.update.forEach(function(e){var t=e.id,n=e.cachedEntity;n!=null&&l.push({id:t,identity:n})});var s=this.$6.snapshot().remove,u=this.$2.snapshot(),c=[];for(var d of u.update){var m=d.cachedEntity,p=d.id;m!=null&&c.push({id:p,dhash:m})}var _=this.$4.snapshot(),f=[];for(var g of _.update){var h=g.cachedEntity,y=g.id;h!=null&&f.push({id:y,lastSyncTs:h})}var C=this.$3.snapshot(),b=[];for(var v of C.update){var S=v.cachedEntity,R=v.id;S!=null&&b.push({id:R,icdc:S})}return t.length===0&&n.length===0&&l.length===0&&r.length===0&&s.length===0&&b.length===0&&c.length===0&&f.length===0&&i.length===0?null:{dhashUpdate:c,icdcUpdate:b,identityRemove:i,identityUpdate:l,preKeyRemove:s,senderKeySessionUpdate:r,sessionRemove:n,sessionUpdate:t,lastSyncTsUpdate:f}},r.warmCache=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,n=e.map(o("WAJids").interpretAsUserJid).filter(Boolean),r=yield this.$9.bulkLoadIdentities(n).then(function(e){return t.$5.bulkLoadIdentities(e)}),a=Array.from(r.values()).reduce(function(e,t){return e.concat(Array.from(t.keys()))},[]);yield this.loadSessions(a)});function t(t){return e.apply(this,arguments)}return t})(),t})();l.InMemorySignalStoreImpl=v}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(t,n,r,o,a,i,l){"use strict";var e={delayMs:50,maxSize:100};function s(t,n){var r=n===void 0?e:n,a=r.delayMs,i=r.maxSize,l=null;function s(e){return l&&l.args===e&&(l=null),t(e)}return function(e){if(l!=null)l.args.push(e);else{var t=[e],n=new(o("WAResolvable")).Resolvable,r=n.promise.then(s),u=function(){return void n.resolve(t)},c=setTimeout(u,a);l={args:t,batchPromise:r,run:u,timer:c}}var d=l,m=d.args,p=d.batchPromise,_=m.length-1;if(m.length>=i){var f;clearTimeout((f=l)==null?void 0:f.timer),l.run(),l=null}return p.then(function(e){return e[_]})}}l.makeSimpleBatcher=s}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WARequestKeysBatcher").makeSimpleBatcher((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WABulkRequestKeys").bulkRequestKeys(e);return t.success===!1?e.map(function(){return t}):e.map(function(e){var n=t.value.get(e);return n?o("WAResultOrError").makeResult(n):o("WAResultOrError").makeError("errRequestKeysNoKeys")})});return function(t){return e.apply(this,arguments)}})()),s=o("WAPromiseManagement").cacheWhilePending(function(e){return e},e);l.requestKeys=s}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoDbCallbacks","WACryptoManager","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WALoggerTag","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=o("WATagsLogger").TAGS([r("WALoggerTag").SignedPrekey]);function h(e){var t=new(o("WAInMemorySignalStore")).InMemorySignalStoreImpl(o("WACryptoDbCallbacks").getCryptoDbCallbacks(),e),n=y();return{manager:o("WACryptoManager").initCryptoManager({regInfo:e,storage:t,network:n}),storage:t}}function y(){return{requestKeys:o("WARequestKeys").requestKeys,bulkRequestKeys:o("WABulkRequestKeys").bulkRequestKeys}}function C(t,r,a,i){var l=null;return o("WACryptoManager").decryptContent(i.cryptoManager,r,{ciphertext:a,type:t},function(e,t){return l={plaintext:e,remoteIdentity:t},(f||(f=n("Promise"))).resolve()}).then(function(e){return e.success?o("WAResultOrError").makeResult(l):e}).catch(function(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),t),t})}function b(e,t,r,a){var i=null;return o("WACryptoManager").decryptGroupContent(a.cryptoManager,e,t,r,function(e){return i={plaintext:e},(f||(f=n("Promise"))).resolve()}).then(function(e){return e.success?o("WAResultOrError").makeResult(i):e}).catch(function(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),e),e})}function v(e,t){return o("WACryptoManager").getParticipantInfo(t,e)}function S(e){return e.storage.getPreKeyGenerationsTimestamps()}function R(e,t){return t.storage.deletePreKeyGenerations(e)}function L(e,t,n,r){return o("WACryptoManager").saveSenderKeySession(r.cryptoManager,e,t,n)}function E(e){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.storage.loadLatestSignedPreKey();if(t.success===!1)throw g.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing signed prekey: ",", triggering reregistration"])),t.error),yield o("WAHandleFailureUtils").reregisterPhone(),r("err")("No signed prekey: "+t.error);var a=o("WASignalSignatures").deserializeSignedPreKey(t.value);if(a==null)throw g.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"]))),r("err")("Cannot deserialize signed prekey");var i=yield o("WACryptoManager").generateOneTimePreKey(e);if(i==null)throw o("WATagsLogger").TAGS([r("WALoggerTag").OneTimePrekey]).ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"]))),r("err")("Cannot generate one time prekey");var l=e.regInfo,s=l.regId,u=l.staticKeyPair;return(f||(f=n("Promise"))).resolve({regId:s,keyType:o("WASignalKeys").KEY_TYPE,publicKey:u.publicKey,signedPreKey:a,preKey:i})}),k.apply(this,arguments)}function I(e,t,n){var r=o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group",jid:e}},void 0);return o("WACryptoManager").encryptGroupContent(n.cryptoManager,e,o("WAGlobals").getMyDeviceJid(),t).then(function(e){return e.success?r.endSuccess():(o("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to encrypt group content: ",""])),e.error),r.endFail(e.error)),e}).catch(function(e){return o("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Runtime excpetion when encrypting group content: ",""])),e),r.endFail("runtime-exception"),o("WAResultOrError").makeError("runtime-exception")})}function T(e,t,n,r,a,i){var l=o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:n},string_array:{node_types:r,message_types:a,media_types:i}},void 0);return o("WACryptoManager").bulkEncryptContent(t.cryptoManager,e).then(function(e){if(e.success)l.endSuccess();else{var t=e.error;switch(t){case"missing":case"mismatch":case"runtime-exception":break;default:break}l.endFail(t)}return e})}function D(e,t,n,r,a,i){var l=o("WAPREMetrics").startMetric(o("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1",jid:i}},void 0);return o("WACryptoManager").encryptContent(n.cryptoManager,e,t,r||o("WACryptoManager").DEFAULT_SESSION_REQUEST,a).then(function(e){if(e.success)l.endSuccess();else{var t=e.error;switch(t){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}l.endFail(t)}return e})}function x(e,t){return o("WACryptoManager").bulkEncryptContent(t.cryptoManager,e).then(function(e){return e.success===!1?(o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"]))),new Map):e.value})}function $(e,t){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r=yield o("WACryptoManager").ensureSessionsExists(t.cryptoManager,e);yield(f||(f=n("Promise"))).all(Array.from(r.entries()).map(function(e){var n=e[0],r=e[1];return t.cryptoManager.storage.handleNewSession(n,r,r.remote.pubKey)}))}),P.apply(this,arguments)}l.createCryptoManager=h,l.decryptMsg=C,l.decryptGroupMsg=b,l.getParticipantInfo=v,l.getPreKeyGenerationsTimestamps=S,l.deletePreKeyGenerations=R,l.saveSenderKeySession=L,l.getSignalInfoForRetry=E,l.encryptGroupContentWithMetrics=I,l.bulkEncryptMsgWithMetrics=T,l.encryptMsgWithMetrics=D,l.bulkEncrypt=x,l.bulkPreEstablishOutgoingSession=$}),98);
__d("WADbRegistrationApi",["Promise","WADbSignal","WAJids","WALogger","WASignalDB","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t,r){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.contacts.get(t);return n!=null?e.stores.contacts.bulkPut([babelHelpers.extends({},n,{icdcInfo:r})]):e.stores.contacts.bulkPut([{contactJid:t,dhash:null,icdcInfo:r}])});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveICDC")).then(function(){})};function c(e){return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(t){return t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:e}}])},o("WASignalDB").signalOp("saveDeviceId")).then(function(){})}function d(e,t){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){yield(s||(s=n("Promise"))).all([r.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.deviceUUID,value:{deviceUUID:t.deviceUUID}},{key:o("WADbSignal").MetaKeysEnum.fbid,value:{fbid:e}},{key:o("WADbSignal").MetaKeysEnum.regId,value:{regId:t.signalRegInfo.regId}},{key:o("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:t.signalRegInfo.identityKeyPair}},{key:o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:t.signalRegInfo.signedPreKey.keyId}},{key:o("WADbSignal").MetaKeysEnum.registrationVersion,value:{registrationVersion:t.registrationVersion}},{key:o("WADbSignal").MetaKeysEnum.authKeyPair,value:{authKeyPair:t.signalRegInfo.authKeyPair}},{key:o("WADbSignal").MetaKeysEnum.deviceRegUnixTime,value:{deviceRegUnixTime:t.registrationUnixTime}}]),r.stores.signedPrekey.bulkPut([t.signalRegInfo.signedPreKey])])});return function(e){return r.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveRegistrationMeta"))}var m=function(t,n){var e=n.sessionId;return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(t){return t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,value:{lastSessionDeviceWasLinkedTo:e}}])},o("WASignalDB").signalOp("saveLastSessionDeviceWasLinkedTo")).then(function(){})};function p(){return o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,a=yield t.stores.meta.bulkGet([(n=o("WADbSignal")).MetaKeysEnum.fbid,n.MetaKeysEnum.deviceId,n.MetaKeysEnum.cat,n.MetaKeysEnum.regId,n.MetaKeysEnum.identityKeyPair,n.MetaKeysEnum.authKeyPair]),i=a[0],l=a[1],s=a[2],u=a[3],c=a[4],d=a[5];o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"])));var m=i==null?void 0:i.value.fbid,p=l==null?void 0:l.value.deviceId,_=s==null?void 0:s.value.cat,f=u==null?void 0:u.value.regId,g=c==null?void 0:c.value.identityKeyPair,h=d==null?void 0:d.value.authKeyPair;if(m==null)throw r("err")("fbid not set");if(p==null)throw r("err")("deviceId not set");if(_==null)throw r("err")("fbCat not set");if(f==null||g==null)throw r("err")("regInfo not set");return{deviceJid:o("WAJids").toDeviceJid(o("WAJids").toMsgrUserJid(m),p),fbCat:_.encrypted_serialized_cat,regInfo:{authKeyPair:h,regId:f,staticKeyPair:g},userJid:o("WAJids").toMsgrUserJid(m)}});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadAllRegistrationMeta"))}l.saveICDC=u,l.saveDeviceId=c,l.saveRegistrationMeta=d,l.saveLastSessionDeviceWasLinkedTo=m,l.loadAllRegistrationMetaInTransaction=p}),98);
__d("WAMapUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return new Map(Array.from(e.entries()).map(function(e){return[e[0],t(e[1],e[0])]}))}i.mapValues=e}),66);
__d("WAProtocolMediaType",[],(function(t,n,r,o,a,i){"use strict";function e(e){switch(e){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":return e;case"xma-image":return"document";default:return null}}i.castToProtocolMediaType=e}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n,a,i){var l=new Set,s=new Set,u=new Set,c=o("WAMapUtils").mapValues(t,function(e,t){var n=e.params,r=e.icdc,o;switch(l.add(n.type),n.type){case"message":{o=d({messageBytes:n.messageBytes,to:t,icdc:r,chat:n.chat,backupDirective:n.backupDirective,applicationPayloadVersion:n.applicationPayloadVersion}),s.add(n.messageType.type),n.messageType.mediaType!=null&&u.add(n.messageType.mediaType);break}case"appdata":{o=m({messageBytes:n.messageBytes});break}default:n.type,o=p({skdm:n.skdm,icdc:r})}return{plaintext:o}});return o("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(c,n,a,Array.from(l),Array.from(s),Array.from(u)).then(function(n){return n.success?o("WAMapUtils").mapValues(n.value,function(e,n){var a,l,s=e.type,u=e.ciphertext,c=e.baseKey,d=r("WANullthrows")((a=t.get(n))==null?void 0:a.params),m=d.type==="message"&&d.messageType.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(d.messageType.mediaType):null;return{encType:"device",to:n,v:((l=d.messageBytes)==null?void 0:l.version)==="v2"?"2":"3",type:s,mediaType:m,count:i,ciphertext:u,baseKey:c}}):(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),n.error),null)})}function c(e,t,n,r,a,i,l,u){var c;switch(t.type){case"message":{c=d({messageBytes:t.messageBytes,to:e,icdc:l,chat:t.chat,backupDirective:u,applicationPayloadVersion:t.applicationPayloadVersion});break}case"appdata":{c=m({messageBytes:t.messageBytes});break}default:t.type,c=p({skdm:t.skdm,icdc:l})}var _=o("WACryptoManagerUtils").encryptMsgWithMetrics(e,c,n,a,i,t==null?void 0:t.chat);return _.then(function(n){var a;if(!n.success)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),n.error),null;var i=t.type==="message"&&t.messageType.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(t.messageType.mediaType):null,l=n.value,u=l.type,c=l.ciphertext;return{encType:"device",to:e,v:((a=t.messageBytes)==null?void 0:a.version)==="v2"?"2":"3",type:u,mediaType:i,count:r,ciphertext:c,baseKey:n.value.baseKey}})}function d(e){var t=e.messageBytes,n=e.to,r=e.icdc,a=e.chat,i=e.backupDirective,l=e.applicationPayloadVersion;if(t.version==="v3"){var s=null;o("WAGlobals").isPeerDevice(n)&&(s=a);var u=o("WAAsMessageTransport").asMessageTransport(t.bytes,s,null,r,i,l);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,u).readByteArrayView()}else return o("WAGlobals").isPeerDevice(n)?t.bytesForPeer:t.bytes}function m(e){var t=e.messageBytes;if(t.version==="v3"){var n=o("WAAsMessageTransport").asMessageTransport(t.bytes);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,n).readByteArrayView()}else throw r("err")("Plaintext v2 not supported yet")}function p(e){var t=e.skdm,n=e.icdc,r=o("WAAsMessageTransport").asMessageTransport(null,null,t,n);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,r).readByteArrayView()}l.getEncNodes=u,l.getEncNode=c}),98);
__d("WASortedLists",[],(function(t,n,r,o,a,i){"use strict";function e(){return[]}function l(){return[]}function s(e,t){return e.filter(t)}function u(e,t){return g(e.map(t))}function c(e,t){for(var n=e.length===t.length,r=0;n&&r<e.length;r++)e[r]!==t[r]&&(n=!1);return n}function d(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return e;return e.concat([t]).sort()}function m(e,t){if(e.length<t.length)return!1;for(var n=!0,r=0,o=0;n&&o<t.length;o++)do n=e[r]===t[o];while(!n&&++r<e.length);return n}function p(e,t){for(var n=[],r=0,o=0;r<e.length;r++){for(var a=e[r];o<t.length&&a>t[o];)o++;(o===t.length||a<t[o])&&n.push(a)}return n}function _(e,t){for(var n=[],r=0,o=0;r<e.length&&o<t.length;){var a=e[r],i=t[o];a<i?r++:(a===i&&(n.push(a),r++),o++)}return n}function f(e,t){for(var n=[],r=0,o=0;r<e.length&&o<t.length;)e[r]<t[o]?n.push(e[r++]):e[r]===t[o]?(n.push(e[r++]),o++):n.push(t[o++]);for(;r<e.length;)n.push(e[r++]);for(;o<t.length;)n.push(t[o++]);return n}function g(e){return h(e.slice().sort())}function h(e){for(var t=!1,n=0;n<e.length-1;n++)e[n]===e[n+1]&&(t=!0);if(!t)return e;for(var r=[],o=0;o<e.length-1;o++)e[o]!==e[o+1]&&r.push(e[o]);return r.push(e[e.length-1]),r}function y(e){return Array.from(e).sort()}function C(e){return e.slice().sort()}function b(e,t,n){for(var r=null,o=0;!r&&o<e.length;o++)e[o]===t&&(r=e.slice(),r[o]=n,r=h(r.sort()));return r||e}function v(e){return[e]}function S(e){return e.length<1}function R(e,t,n){return e.slice(t,n)}i.emptySet=e,i.emptyList=l,i.filter=s,i.map=u,i.areEqual=c,i.addToSet=d,i.contains=m,i.subtract=p,i.intersect=_,i.joinUniq=f,i.sortAndDedupe=g,i.asSortedSet=y,i.sort=C,i.swapIn=b,i.singleElement=v,i.isEmpty=S,i.slice=R}),66);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"])));for(var r=o("WASortedLists").sortAndDedupe(t),a=new(o("WABinary")).Binary,i=0;i<r.length;i++)a.writeString(r[i]);return(u||(u=n("Promise"))).resolve(o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",a.readByteArrayView()).then(function(e){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"])));var t=new Uint8Array(e,0,6);return"2:"+o("WABase64").encodeB64(t)}))}l.calculatePHash=c}),98);
__d("WAEncUserMsg",["Promise","WAComputeICDC","WAEncNode","WAGlobals","WAJids","WAPhash","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y=o("WATagsLogger").TAGS(["WAEncUserMsg"]);function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){y.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"]))),e.length===0&&y.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"]))),y.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"])));var l=e.flatMap(function(e){return e.devicesInfo}).map(function(e){return e.jid});E(e)&&y.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"])));var s;return t.type==="message"&&!r("gkx")("3176")&&(s=yield k(e,a,i)),(h||(h=n("Promise"))).all([S(l,t,a,s,i),o("WAPhash").calculatePHash(l.concat(o("WAGlobals").getMyDeviceJid()))]).then(function(e){var t=e[0],n=e[1];return y.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"]))),{participants:t,phash:n}})}),b.apply(this,arguments)}function v(e,t,n){return S(e,t,n)}function S(t,n,r,o,a){return L(t,n,r,o,a).then(function(t){if(t.length===0){y.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"]))),a==null||a.addPoint("getParticipantNodes_empty_node");return}return t})}function R(e,t,n,r,a,i){return o("WAEncNode").getEncNode(e,t,n,r,a,i)}function L(e,t,n,r,a){var i=!1;y.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"]))),(t.type!=="message"||o("WAJids").interpretAsGroupJid(t.chat)!=null)&&(i=!0);var l=o("WAEncNode").getEncNodes(new Map(e.map(function(e){return[e,{params:t,icdc:r}]})),n).then(function(e){return e==null?(y.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"]))),a==null||a.addPoint("getParticipantNodes_empty_device_jids"),[]):(t.type==="message"&&(i=i||Array.from(e.keys()).some(function(e){return o("WAJids").extractUserJid(e)===t.chat})),Array.from(e==null?void 0:e.values()))});return l.then(function(e){return i?e:(y.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"]))),a==null||a.addPoint("getParticipantNodes_receiverEncypted_false"),[])}).then(function(e){return e.filter(Boolean)})}function E(e){return e.filter(function(e){return e.user!==o("WAGlobals").getMyUserJid()}).flatMap(function(e){return e.devicesInfo}).length===0}function k(e,t,n){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r;try{n==null||n.addPoint("icdc_start"),r=yield o("WAComputeICDC").computeICDC(e,o("WAGlobals").getMyUserJid(),o("WAGlobals").getMyDeviceJid(),t),n==null||n.addPoint("icdc_end",{bool:{isICDCEmpty:r==null}})}catch(e){n==null||n.addPoint("icdc-error"),y.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- ICDC calc error: ",""])),e)}return r}),I.apply(this,arguments)}l.encryptUserMsg=C,l.encryptGroupFanoutMsg=v,l.encryptDeviceJidMessage=R}),98);
__d("WAGetUserDevices",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e,t){return l.apply(this,arguments)}function l(){return l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield t.storage.bulkLoadIdentities(e);return Array.from(n).flatMap(function(e){var t=e[1];return Array.from(t.keys())})}),l.apply(this,arguments)}i.getUserDevices=e}),66);
__d("WAEncGroupMsg",["WAAsMessageTransport","WABridge","WACryptoManager","WACryptoManagerUtils","WADbPersonalSenderKeyStatusTxns","WAEncUserMsg","WAGetUserDevices","WAGlobals","WAHex","WAMsgTransport.pb","WAOdsEnums","WAPhash","WAPromiseQueue","WAProtocolMediaType","WAResultOrError","WASortedLists","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WAEncGroupMsg"]),f=30*o("WATimeUtils").DAY_SECONDS,g=new(o("WAPromiseQueue")).PromiseQueue;function h(e,t,n){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.senderKeyId;if(r==null||e.rotateSenderKey||!o("WATimeUtils").happenedWithin(e.ts,f))return o("WAResultOrError").makeError("sender-key-invalid");var a=yield n.cryptoManager.storage.loadSenderKeySession(t,o("WAGlobals").getMyDeviceJid());if(a.success===!1||a.value.senderKeyStates.length===0)return o("WAResultOrError").makeError("sender-key-missing");var i=a.value.senderKeyStates.at(-1);return i==null?o("WAResultOrError").makeError("sender-key-missing"):i.senderKeyId!==e.senderKeyId?o("WAResultOrError").makeError("sender-key-id-mismatch"):o("WAResultOrError").makeResult({senderKeyId:r})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WACryptoManager").rotateGroupSenderKey(t.cryptoManager,e,o("WAGlobals").getMyDeviceJid());return yield o("WADbPersonalSenderKeyStatusTxns").markSenderKeyAsRotated(e,n.senderKeyId,o("WATimeUtils").unixTime()),{senderKeyId:n.senderKeyId}}),b.apply(this,arguments)}function v(t,r,a,i){return g.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield o("WADbPersonalSenderKeyStatusTxns").getSenderKeyStatus(t),l=yield h(n,t,a),s=yield o("WAGetUserDevices").getUserDevices(r,a.cryptoManager),u=new Set(s);if(l.success===!1){_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Rotating sender key for group "," because ",""])),t,l.error),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.GROUP_SKS_INVALID,key:l.error}),i.addPoint("sender_key_rotation_start");var c=yield C(t,a);return i.addPoint("sender_key_rotation_end"),{senderKeyId:c.senderKeyId,needsSenderKey:u,groupParticipants:new Set(s)}}else{var d;return((d=n.hasSenderKey)!=null?d:[]).forEach(function(e){return u.delete(e)}),i.addPoint("no_sk_rotation",{int:{noRotationNeedsSK:u.size}}),{senderKeyId:l.value.senderKeyId,needsSenderKey:u,groupParticipants:new Set(s)}}}))}function S(e,t,n,r,o,a,i){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a,i,l){l.addPoint("enc_group_start");var f=yield v(e,t.map(function(e){return e.user}),a,l),g=f.senderKeyId,h=f.needsSenderKey,y=f.groupParticipants;_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finish rotate participant info"]))),l.addPoint("rotated_participant_info");var C=null,b,S,R=t.flatMap(function(e){return e.devicesInfo}).map(function(e){return e.jid});y.delete(o("WAGlobals").getMyDeviceJid());var E=!o("WASortedLists").areEqual(o("WASortedLists").asSortedSet(y),o("WASortedLists").sortAndDedupe(R)),k=r.type==="text"&&r.isRevoked,I=r.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(r.mediaType):null;if(E||k){var T=yield o("WAEncUserMsg").encryptGroupFanoutMsg(R,{type:"message",messageBytes:n,messageType:r,chat:e,backupDirective:i},a);T&&!(r.type==="text"&&r.isInvisible===!0)&&(b=T,S={encType:"group",to:e,v:n.version==="v3"?"3":"2",type:"skmsg",mediaType:I,ciphertext:null}),_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Finish group fanout msg"]))),l.addPoint("finish_group_fanout_msg")}else{var D;if(n.version==="v3"){var x=o("WAAsMessageTransport").asMessageTransport(n.bytes);D=o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,x).readByteArrayView()}else D=n.bytes;var $=yield o("WACryptoManagerUtils").encryptGroupContentWithMetrics(e,D,a);if(_.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Finish encrypt group content"]))),l.addPoint("finish_encrypt_group_content"),$.success){_.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Encrypt success"])));var P=$.value;if(g!==P.senderKeyId&&y.forEach(function(e){return h.add(e)}),h.size>0){var N={groupId:e,axolotlSenderKeyDistributionMessage:o("WAHex").bytesToBuffer(P.senderKeyDistributionProto)};_.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start key distribution"])));var M=R.filter(function(e){return h.has(e)}),w=yield L(M,N,a);_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["end key distribution"]))),l.addPoint("finish_skdm_enc_node"),w.length>0&&(b=w,C={group:e,senderKeyId:P.senderKeyId,knowsSenderKey:new Set(M)})}S={encType:"group",to:e,v:n.version==="v2"?"2":"3",type:P.ciphertext.type,mediaType:I,ciphertext:P.ciphertext.ciphertext},r.type==="text"&&r.isInvisible===!0&&(S={encType:"group",to:e,v:n.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null})}}var A=yield o("WAPhash").calculatePHash(R.concat(o("WAGlobals").getMyDeviceJid()));return l.addPoint("phash_finish"),{phash:A,participants:b,encNode:S,senderKeyDistributionInfo:C}}),R.apply(this,arguments)}function L(e,t,n){var r=o("WAAsMessageTransport").asMessageTransport(null,null,t,null),a=o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,r).readByteArrayView();return o("WACryptoManagerUtils").bulkEncrypt(new Map(e.map(function(e){return[e,{plaintext:a}]})),n).then(function(e){var t=[];return e.forEach(function(e,n){t.push({encType:"device",to:n,v:"3",type:e.type,ciphertext:e.ciphertext,mediaType:null,count:null,baseKey:null})}),t})}l.encryptGroupMsg=S}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,r,a){return r==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]))),(u||(u=n("Promise"))).resolve(null)):a!=null&&a!==0?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""])),a),(u||(u=n("Promise"))).resolve(null)):o("WAFranking").genFrankingTag(r,t)}l.genFrankingTagFromMessageApplicationEncode=c}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(e,t,n);return{frankingKey:t,frankingTag:r,frankingVersion:o("WAFranking").getFrankingVersion(n),reportingContent:o("WAByteArray").uint8ArrayToBuffer(e),reportingTag:null}}),s.apply(this,arguments)}l.genReportingMeta=e}),98);
__d("WAGetKeysForUpload",["WALoggerTag","WAResultOrError","WASignalKeys","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS([r("WALoggerTag").PrekeyGenerateAndUpload,r("WALoggerTag").SignedPrekey]);function u(t,n){return t.storage.loadPreKeys(n).then(function(n){var r=n.preKeys,a=n.signedPreKey,i=[];return r.forEach(function(t){var n=o("WASignalKeys").deserializePreKey(t);n==null?s.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]))):i.push(n)}),o("WAResultOrError").makeResult({regInfo:t.regInfo,keyType:o("WASignalKeys").KEY_TYPE,preKeys:i,signedPreKey:a})})}l.getKeysForUpload=u}),98);
__d("WAMakeSignedPreKeyMixin",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={idElementValue:o("WAWap").BIG_ENDIAN_CONTENT(e.id,3)},n={anyElementValue:e.keyPair.publicKey},r=e.signature;return{keyIDMixinArgs:t,keyDataMixinArgs:n,signatureElementValue:r}}l.makeSignedPreKeyMixin=e}),98);
__d("WARandomJitter",[],(function(t,n,r,o,a,i){"use strict";function e(){return Math.round(Math.random()*500-250)}i.getRandomJitter=e}),66);
__d("WARetryUtils",["WARandomJitter"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e?{algo:{backoff:{first:1,second:1,type:"fibonacci"},toMs:function(t){return(1+t)*1e3+o("WARandomJitter").getRandomJitter()},type:"adjust"},relativeDelay:!0,max:6e5}:{algo:{type:"adjust",backoff:{type:"fibonacci",first:1,second:1},toMs:function(t){return(9+t)*1e3}},max:62e4}}l.fibonacciBackoff=e}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureBadRequestMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureFallbackMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureInternalServerErrorMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"violation");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","not-acceptable");if(!r.success)return r;var a=o("WASmaxParseUtils").attrString(n.value,"reason");if(!a.success)return a;var i=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrInt,n.value,"max");if(!i.success)return i;var l=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrInt,n.value,"length");return l.success?o("WAResultOrError").makeResult({text:r.value,violationReason:a.value,violationMax:i.value,violationLength:l.value}):l}l.parseSetVnameFailureNotAcceptableMixin=e}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:n.value});var r=o("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(e);if(r.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:r.value});var a=o("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(e);return a.success?o("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:a.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[t,n,r,a])}l.parseVnameFailures=e}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(r.value,"error");if(!a.success)return a;var i=o("WASmaxParseUtils").attrString(r.value,"text");if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,r.value,"code",207);if(!l.success)return l;var s=o("WASmaxParseUtils").attrIntRange(a.value,"code",400,599);if(!s.success)return s;var u=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!u.success)return u;var c=o("WASmaxInPreKeysVnameFailures").parseVnameFailures(a.value);return c.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorText:i.value,errorCode:l.value,errorErrorCode:s.value},u.value,{errorErrorVnameFailures:c.value})):c}l.parseSetResponsePreKeySuccessVnameFailure=e}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"field");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"name");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"reason");return r.success?o("WAResultOrError").makeResult({name:n.value,reason:r.value}):r}function s(t){var n=o("WASmaxParseUtils").assertTag(t,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"field",e);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,t,"text","not-acceptable");if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,t,"code",406);return i.success?o("WAResultOrError").makeResult({text:a.value,code:i.value,field:r.value}):i}l.parseIQErrorNotAcceptableField=e,l.parseIQErrorNotAcceptableMixin=s}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorNotAcceptable","IQErrorFallbackClient"],[t,n])}l.parseRequestErrors=e}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrors").parseRequestErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrors:i.value})):i}l.parseSetResponseRequestError=e}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseSetResponseServerError=e}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseSetResponseSuccess=e}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyDataMixin=s}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("identity",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyMixin=s}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("type",null,new Uint8Array([5])));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeKeyTypeMixin=s}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.idElementValue,n=o("WASmaxJsx").smax("id",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyIDMixin=s}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.keyIDMixinArgs,n=e.keyDataMixinArgs,r=o("WASmaxJsx").smax("key",null,o("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(o("WASmaxJsx").smax("id",null),t),o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("value",null),n));return r}function s(t){var n=t.keyArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("list",null,o("WASmaxChildren").REPEATED_CHILD(e,n,0,2e4)));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makePreKeyListListKey=e,l.mergePreKeyListMixin=u}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.registrationElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("registration",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRegistrationIDMixin=s}),98);
__d("WASmaxOutPreKeysRequestPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paddingElementValue,n=o("WASmaxJsx").smax("iq",null,o("WASmaxJsx").smax("padding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestPaddingMixin=s}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.keyIDMixinArgs,r=e.keyDataMixinArgs,a=e.signatureElementValue,i=(t=o("WASmaxJsx")).smax("smax$any",null,t.smax("skey",null,o("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(t.smax("id",null),n),o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(t.smax("value",null),r),t.smax("signature",null,a)));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSignedPreKeyMixin=s}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.verifiedNameElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("verified_name",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeVerifiedNameMixin=s}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysRequestPaddingMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.verifiedNameMixinArgs,n=e.requestPaddingMixinArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutPreKeysRequestPaddingMixin").mergeRequestPaddingMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,o("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(o("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(o("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(o("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(o("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(o("WASmaxJsx").smax("iq",null),e),e),e),e)),t),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyBundleMixin=s}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"set"})),e);return t}l.makeSetRequest=e}),98);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutPreKeysSetRequest").makeSetRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(r,n);if(a.success)return{name:"SetResponseSuccess",value:a.value};var i=o("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(r,n);if(i.success)return{name:"SetResponsePreKeySuccessVnameFailure",value:i.value};var l=o("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(r,n);if(l.success)return{name:"SetResponseRequestError",value:l.value};var s=o("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(r,n);if(s.success)return{name:"SetResponseServerError",value:s.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:a,PreKeySuccessVnameFailure:i,RequestError:l,ServerError:s}))}),s.apply(this,arguments)}l.sendSetRPC=e}),98);
__d("WAGenerateAndUploadPreKeysProtocol",["WACryptoManager","WAGetKeysForUpload","WAGlobals","WAMakeSignedPreKeyMixin","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WASmaxPreKeysSetRPC","WATagsLogger","WAWap","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("WATagsLogger").TAGS(["generateAndUploadPreKeysProtocol"]);function p(){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WAGlobals").getWaOneQueue().enqueue((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.cryptoManager,r=yield o("WACryptoManager").generatePreKeys(n);return r.success?(m.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["About to upload pre keys"]))).devConsole("generation "+r.value),o("WAGetKeysForUpload").getKeysForUpload(n,r.value)):r});return function(e){return t.apply(this,arguments)}})(),{operationType:"generate_prekeys",flush:!0,afterInit:!0}),r=t.value,a=r.regInfo,i=r.preKeys,l=r.signedPreKey,p=babelHelpers.extends({registrationElementValue:o("WAWap").BIG_ENDIAN_CONTENT(a.regId),anyElementValue:a.staticKeyPair.publicKey,keyArgs:i.map(f)},o("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(l)),_=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"uploadKeys",timer:o("WARetryUtils").fibonacciBackoff(!1),code:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){m.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Attempt to upload keys"])));var t=yield o("WASmaxPreKeysSetRPC").sendSetRPC(p);switch(t.name){case"SetResponseSuccess":{m.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Keys are successfully uploaded"]))),e(o("WAResultOrError").makeResult({preKeys:i}));return}case"SetResponseRequestError":{m.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Got Malformed upload keys IQ on upload pre keys attempt"]))),e(o("WAResultOrError").makeError("request-error"));return}default:t.name,m.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Got unexpected error: ",", will retry after backoff"])),t.name)}});function t(t){return e.apply(this,arguments)}return t})()});return _.start(),_.promise()}),_.apply(this,arguments)}function f(e){var t={idElementValue:o("WAWap").BIG_ENDIAN_CONTENT(e.id,3)},n={anyElementValue:e.keyPair.publicKey};return{keyIDMixinArgs:t,keyDataMixinArgs:n}}l.generateAndUploadPreKeysProtocol=p}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WAGenerateAndUploadPreKeysProtocol","WALoggerTag","WAOdsEnums","WATagsLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS([r("WALoggerTag").PrekeyGenerateAndUpload,r("WALoggerTag").SignedPrekey]);function c(t,n){var a=n.reason;return u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["About to generate and upload pre keys with reason: ",""])),a),o("WAGenerateAndUploadPreKeysProtocol").generateAndUploadPreKeysProtocol().then(function(e){var t;if(e.success){o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:e.value.preKeys.length},!0);return}var n=e.error;if(n==="request-error")throw o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0),r("err")("Malformed upload keys IQ");u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",": ","}"])),n,(t=e.payload)==null?void 0:t.message)})}l.generateAndUploadPreKeys=c}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGetMetaApi","WASignalKeys"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WAGetMetaApi").getMeta().then(function(e){var t=e==null?void 0:e.deviceId,n=e==null?void 0:e.identityKeyPair;if(t==null||n==null)return null;var r=o("WASignalKeys").serializePubKey(n);return{deviceId:t,identityKey:r}})},s=function(){return o("WAGetMetaApi").getMeta().then(function(e){return(e==null?void 0:e.deviceId)==null?null:{deviceId:e==null?void 0:e.deviceId}})};l.getCurrentUserDeviceInfo=e,l.getCurrentUserDeviceId=s}),98);
__d("WAGetDeviceIdentityMixin",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e!=null?{deviceIdentityElementValue:e}:null}i.getDeviceIdentityMixin=e}),66);
__d("WAGetLocalPublicPrivateIdentityKeyApi",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,a=yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.identityKeyPair);if((a==null||(n=a.value)==null?void 0:n.identityKeyPair)==null){var i="[Remote Presence Error] Identity key pair was null";throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),i),r("err")(i)}return o("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};l.getLocalPublicPrivateIdentityKey=s}),98);
__d("WAGetIdentityKeys",["WAGetLocalPublicPrivateIdentityKeyApi","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAGetLocalPublicPrivateIdentityKeyApi").getLocalPublicPrivateIdentityKey(),n=t.privateKey,r=t.serializedPubKey;return{identityPrivateKey:n,identityPublicKey:r}}),s.apply(this,arguments)}l.getIdentityKeysInWorker=e}),98);
__d("WALoadReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({receipts:o("MAWTransactionMode").READONLY},"loadReceipt",function(e){return(function(t){var n=o("WAMsg").craftWAMsgIdString(t);return e.receipts.get({waMsgId:n}).then(function(e){var n;return e==null?o("WAResultOrError").makeError("missing-receipt"):o("WAResultOrError").makeResult({id:t,permittedIdentitiesPerDevice:(n=e.permittedIdentitiesPerDevice)!=null?n:new Map,recipientDevices:e.recipientDevices})})})});l.loadReceipt=e}),98);
__d("WAMarkSenderKeyAsSentApi",["WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,r,a){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.get(t);n!=null&&n.senderKeyId===r&&(a.forEach(function(e){n.hasSenderKey.add(e)}),yield e.stores.personalSenderKeyStatuses.bulkPut([n]))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("markSenderKeyAsSent"))};l.markSenderKeyAsSent=e}),98);
__d("WAMessageKey",["WAGlobals","WAJids","WAStanzaUtils","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e===o("WAJids").AUTHOR_ME||e==o("WAGlobals").getMyUserJid()}function s(t,n,a){if(a==null)throw r("err")("messageKey is null");var i=a.id,l=a.remoteJid;if(i==null)throw r("err")("messageKey.id is null");if(l==null)throw r("err")("messageKey.remoteJid is null");var s=o("WAJids").interpretAndValidateJid(l);if(s.jidType==="unknown")throw r("err")("messageKey.remoteJid is invalid");var u,c=o("WAJids").AUTHOR_ME;if(s.jidType==="group")if(u=s.groupJid,e(n)&&a.fromMe===!0)c=o("WAJids").AUTHOR_ME;else if(a.fromMe==!0)c=n;else{var d=a.participant;if(d==null)throw r("err")("key.participant is null");var m=o("WAJids").interpretAndValidateJid(d);if(m.jidType==="msgrUser")c=m.userJid;else throw r("err")("key.participant is invalid")}else if(s.jidType==="msgrUser"||s.jidType==="msgrDevice"){var p=o("WAJids").interpretAndValidateJid(t);if(p.jidType!=="msgrUser")throw r("err")("expected user type jid.");u=p.userJid,e(n)?a.fromMe===!0?c=o("WAJids").AUTHOR_ME:c=p.userJid:a.fromMe===!0&&(c=p.userJid)}else throw r("err")("Unsupported jidtype type");return{chat:u,author:e(c)?o("WAJids").AUTHOR_ME:c,externalId:o("WAStanzaUtils").toStanzaId(i)}}l.extractProtocolMessageId=s}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseNotifyResponseError=e}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseNotifyResponseSuccess=e}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"set"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQSetRequestMixin=s}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=o("WASmaxJsx").smax("user",{jid:o("WAWap").USER_JID(t)});return n}function s(t){var n=t.userArgs,r=o("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("users",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,25))));return r}l.makeNotifyRequestUsersUser=e,l.makeNotifyRequest=s}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(r,n);if(a.success)return{name:"NotifyResponseSuccess",value:a.value};var i=o("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(r,n);if(i.success)return{name:"NotifyResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:a,Error:i}))}),s.apply(this,arguments)}l.sendNotifyRPC=e}),98);
__d("WANotifyDeviceChange",["Promise","WAGlobals","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,r){var a=r.users;if(a.size===0)return(s||(s=n("Promise"))).resolve();var i=o("WAGlobals").getConfig().maxUsersForNotifyDeviceChange(),l=Array.from(a);return a.size>i&&(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""])),i),l=l.slice(0,i)),c(l)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:e.map(function(e){return{userJid:e}})});if(t.name!=="NotifyResponseSuccess"){t.name;var n=t.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(n.name==="RetryableIQError"){var a=n.value.backoff;throw a!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"constant",delay:a},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"exponential",first:o("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}throw r("err")("Failed with an unexpected error code "+n.value.code)}}),d.apply(this,arguments)}l.notifyDeviceChange=u}),98);
__d("WAOfflineUtils",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["INIT","OFFLINE_RESUME","ONLINE"]),l=n("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});i.ServerRPCMode=e,i.WAClientInfraOfflineProgress=l}),66);
__d("WAParseConsumerMessagePollCreation",["WAGlobals","WAHex","WAMsgType"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){var a={unstoredMsg:{type:o("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:o("WAHex").bytesToBuffer(e),subtype:"pollCreationMessage"},id:t.id,ts:t.ts,sentTs:t.sentTs,serverTs:t.serverTs,ack:t.ack,reportingMeta:n},unstoredMedia:null,unstoredQuotedMedia:null};if(!r||!o("WAGlobals").getConfig().isPollsEnabled())return a;var i=r.encKey,l=r.options,s=r.name,u=r.selectableOptionsCount,c=t.id,d=t.ts,m=t.ack;if(i==null||s==null||u==null)return a;var p=l.map(function(e){return e.optionName}).filter(Boolean);return{unstoredMsg:{ack:m,id:c,ts:d,type:o("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE},unstoredGroupPollCreateInfo:{encKey:i,name:s,selectableOptionsCount:u,options:p},unstoredMedia:null,unstoredQuotedMedia:null}}l.default=e}),98);
__d("WAParseConsumerMessagePollUpdate",["WAGlobals","WAMsgType"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){var a=t.id,i=t.ts,l=t.ack;return r==null||!o("WAGlobals").getConfig().isPollsEnabled()?{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}:{unstoredMsg:{ack:l,id:a,ts:i,type:o("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredGroupPollUpdateInfo:{pollUpdateMessage:r,type:o("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredMedia:null,unstoredQuotedMedia:null}}l.default=e}),98);
__d("WAParseProtocolUtils",["WAGlobals","WALogger","WALongInt","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){var n=c(t,e.serverTs),r=n==null?void 0:n.expirationTs,o=n==null?void 0:n.deleteTs,a=n==null?void 0:n.ephemeralSetting;return{expirationTs:r,deleteTs:o,ephemeralSetting:a}}function u(e,t){var n=d(t);return n!=null&&(e.reportingMeta=n),n}function c(e,t){var n,r,a=e==null||(n=e.chatEphemeralSetting)==null?void 0:n.ephemeralExpiration,i=e==null||(r=e.chatEphemeralSetting)==null?void 0:r.ephemeralSettingTimestamp;if(a==null||i==null||a===0)return null;var l=o("WATimeUtils").castToUnixTime(t+o("WAGlobals").getDependencies().ephemeralMaxDeletionWindowForUnseenMessage()),s=l,u=null;try{var c=o("WALongInt").numberOrThrowIfTooLarge(i)/1e3;u=o("WATimeUtils").castToUnixTime(c)}catch(e){return null}return{expirationTs:l,deleteTs:s,ephemeralSetting:{expirationTs:a,updatedTs:u}}}function d(t){var n=t==null?void 0:t.frankingVersion;return n!=null&&n!==0&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""])),n),{frankingKey:void 0,frankingTag:void 0,frankingVersion:n,reportingContent:void 0,reportingTag:void 0}}l.parseEphemerality=s,l.enhanceReportingMeta=u}),98);
__d("WAParseConsumerMessageProtocol",["WACommon.pb","WAConsumerApplication.pb","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseConsumerMessagePollCreation","WAParseConsumerMessagePollUpdate","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassUtils","WAResultOrError","WAStanzaUtils","WATimeUtils","decodeProtobuf","err","maybeConvertMessageTextMentionsV2ToV1"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=90*o("WATimeUtils").DAY_SECONDS,c=1,d=0,m=1,p=o("WAGlobals").getConfig().armadilloWebProcessFutureproof()?m+1:m;function _(t,n,a,i,l,c){var d,m,p,_,f=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAConsumerApplication.pb").ConsumerApplicationSpec,n),g=(d=f.payload)==null||(d=d.applicationData)==null||(d=d.revoke)==null||(d=d.key)==null?void 0:d.id;if(g!=null)return{unstoredMsg:{type:o("WAMsgType").MSG_TYPE.REVOKED,id:a.id,ts:a.ts,sentTs:a.sentTs,serverTs:a.serverTs,ack:a.ack,reportingMeta:a.reportingMeta,revokedExternalId:o("WAStanzaUtils").toStanzaId(g),unsendMsgContentDeleteTs:null,msgContent:null,ebTimestampMs:c},unstoredMedia:null,unstoredQuotedMedia:null};var h=(l==null?void 0:l.isForwarded)||!1,k=o("WAParseProtocolUtils").parseEphemerality(a,l),I=k.expirationTs,T=k.deleteTs,D=k.ephemeralSetting;if(D!=null&&(D.expirationTs<0||D.expirationTs>u)){var x=o("WAJids").interpretAndValidateJid(t),$=x.jidType,P=D.expirationTs;o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""])),P,$)}var N=o("WAParseProtocolUtils").enhanceReportingMeta(a,l),M=(m=C(l))!=null?m:void 0,w=(p=f.payload)==null?void 0:p.content;if(!w)return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};var A=(_=f.metadata)==null?void 0:_.specialTextSize,F=L(w),O={contentTypeForLogging:F,unstoredMsg:{type:o("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:o("WAHex").bytesToBuffer(i),subtype:null},id:a.id,ts:a.ts,sentTs:a.sentTs,serverTs:a.serverTs,ack:a.ack,reportingMeta:N},unstoredMedia:null,unstoredQuotedMedia:null},B=function(t){return babelHelpers.extends({},O,{unstoredMsg:babelHelpers.extends({},O.unstoredMsg,{msgContent:babelHelpers.extends({},O.unstoredMsg.msgContent,{subtype:t})})})},W=(function(){try{switch(F){case"messageText":{var e,n=w[F]&&r("maybeConvertMessageTextMentionsV2ToV1")(w[F]);if(n==null)throw r("err")("consumerMessage has no messageText");var u=((e=n.commands)==null?void 0:e.some(function(e){return e.commandType===o("WACommon.pb").COMMAND_COMMAND_TYPE.AI}))===!0;if(u&&!o("WAGlobals").getConfig().isMetaAiInvocationMessageRenderEnabled())return B("metaAiMessage");if(o("WAParseReadOnlyMetadataDataclassUtils").isNoteMention(l))return B("noteMention");if(n.text==null)throw r("err")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:n.text,mentionedJids:n.mentionedJid.map(o("WAJids").validateUserJid).filter(Boolean),commands:n.commands},quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h},a,{specialTextSize:A,ebTimestampMs:c}),unstoredMedia:null,unstoredQuotedMedia:null}}case"reactionMessage":return{unstoredMsg:y(t,a,w[F]),unstoredMedia:null,unstoredQuotedMedia:null};case"imageMessage":{var d=b(w,a.ts);return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.IMAGE,quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,mediaId:d.plaintextHash},a,{ebTimestampMs:c}),unstoredMedia:d,unstoredQuotedMedia:null}}case"videoMessage":{var m,p,_,f,g=w[F];if(g==null)throw r("err")("consumerMessage has no videoMessage");var C=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").VideoTransportSpec,g==null||(m=g.video)==null?void 0:m.payload),L=C==null||(p=C.integral)==null||(p=p.transport)==null||(p=p.ancillary)==null?void 0:p.mimetype,k=(C==null||(_=C.ancillary)==null?void 0:_.gifPlayback)===!0&&L==="image/gif",x=o("WAParseMediaTransportProtocol").parseVideoMsg(C,a.ts,k);if(x==null)throw r("err")("consumerMessage has no video media info");if(o("WAParseReadOnlyMetadataDataclassUtils").isPowerUp(l)&&((f=g.caption)==null?void 0:f.text)!=null){var $;return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:($=g.caption)==null?void 0:$.text,mentionedJids:g.caption.mentionedJid.map(o("WAJids").validateUserJid).filter(Boolean)},quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h},a,{specialTextSize:A,ebTimestampMs:c}),unstoredMedia:null,unstoredQuotedMedia:null}}return{unstoredMsg:k?babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.GIF},a,{quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,reportingMeta:N,mediaId:x.plaintextHash}):babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.VIDEO},a,{quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,mediaId:x.plaintextHash}),unstoredMedia:x,unstoredQuotedMedia:null}}case"audioMessage":{var P=v(w,a.ts);return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.PTT,quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,mediaId:P.plaintextHash},a,{ebTimestampMs:c}),unstoredMedia:P,unstoredQuotedMedia:null}}case"stickerMessage":{var W,q,U=S(w),V=o("WAParseMediaTransportProtocol").parseStickerMsg(U,a.ts),H=((W=U.integral)==null?void 0:W.receiverFetchId)!=null||((q=U.ancillary)==null?void 0:q.receiverFetchId)!=null;if(V==null){if(H){var G=o("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(U);if(G==null)throw r("err")("consumerMessage has no sticker receiver fetch info");return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.RECEIVER_FETCH,quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,reportingMeta:N},a,{ebTimestampMs:c}),unstoredMedia:null,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:G}}throw r("err")("consumerMessage has no sticker media info")}return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.STICKER,quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,reportingMeta:N,mediaId:V.plaintextHash},a,{ebTimestampMs:c}),unstoredMedia:V,unstoredQuotedMedia:null}}case"documentMessage":{if(o("WAGlobals").getConfig().isDocumentReceiveEnabled()){var z=R(w,a.ts);return{unstoredMsg:babelHelpers.extends({type:o("WAMsgType").MSG_TYPE.DOCUMENT_FILE,quote:M,expirationTs:I,deleteTs:T,ephemeralSetting:D,isForwarded:h,reportingMeta:N,mediaId:z.plaintextHash},a,{ebTimestampMs:c}),unstoredMedia:z,unstoredQuotedMedia:null}}return O}case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null,unstoredIncomingGroupInvite:E(a,w)};case"editMessage":{var j,K=w[F],Q=K==null?void 0:K.message,X=Q==null?void 0:Q.text,Y=K==null||(j=K.key)==null?void 0:j.id;if(K==null||Q==null||X==null)throw r("err")("consumerMessage with editMessage type has no editMessage");if(Y==null)throw r("err")("consumerMessage with editMessage type has no original Msg External Id.");var J=o("WAStanzaUtils").toStanzaId(Y);return{unstoredEditMsg:{type:o("WAMsgType").MSG_TYPE.EDIT_ACTION,editMsgContent:{content:X,mentionedJids:Q.mentionedJid.map(o("WAJids").validateUserJid).filter(Boolean),commands:Q.commands},originalMsgExternalId:J,id:a.id,ts:a.ts,sentTs:a.sentTs,serverTs:a.serverTs,ack:a.ack,reportingMeta:N,specialTextSize:A},unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}case"pollCreationMessage":return r("WAParseConsumerMessagePollCreation")(i,a,N,w[F]);case"pollUpdateMessage":return r("WAParseConsumerMessagePollUpdate")(i,a,N,w[F]);case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return O}}catch(e){return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["parseConsumerMessageProtocol error :",""])),e),{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}})();return babelHelpers.extends({},W,{contentTypeForLogging:F})}function f(e){if(o("WAJids").isAuthorSystem(e))throw r("err")("Got system author");return e}var g=30;function h(e){return e==null?o("WAResultOrError").makeResult(null):e.length>g?o("WAResultOrError").makeError("invalid-reaction-text-length"):o("WAResultOrError").makeResult(e)}function y(e,t,n){if(n==null)throw r("err")("consumerMessage has no reactionMessage");var a=f(t.id.author),i=o("WAMessageKey").extractProtocolMessageId(e,a,n.key),l=n.text,s=n.groupingKey,u=n.senderTimestampMs,c=h(l);if(!c.success)throw r("err")('"'+(l!=null?l:"")+'" is not a valid reaction ['+c.error+"]");return{type:o("WAMsgType").MSG_TYPE.REACTION,ack:t.ack,id:t.id,reactToExternalId:i.externalId,reactToAuthor:i.author,reaction:c.value,groupingKey:s,ts:t.ts,senderTimestampMs:u}}function C(e){var t,n,a,i=e==null||(t=e.quotedMessage)==null?void 0:t.stanzaId,l=e==null||(n=e.quotedMessage)==null?void 0:n.participant,s=e==null||(a=e.quotedMessage)==null?void 0:a.remoteJid,u=l!=null?o("WAJids").interpretAndValidateJid(l):null,c;if((u==null?void 0:u.jidType)==="msgrUser"&&u.userJid===o("WAGlobals").getMyUserJid()?c=o("WAJids").AUTHOR_ME:(u==null?void 0:u.jidType)==="msgrUser"?c=u.userJid:c=o("WAJids").AUTHOR_ME,i==null)return null;var d={type:o("WAMsgType").MSG_TYPE.UNAVAILABLE,author:c,externalId:o("WAStanzaUtils").toStanzaId(i),ts:null};if(s!=null){var m=o("WAJids").interpretAndValidateJid(s);if(m.jidType==="group")return{remoteJid:m.groupJid,content:d};throw r("err")("not supported")}else return{remoteJid:null,content:d}}function b(e,t){var n,a=e.imageMessage;if(a==null)throw r("err")("consumerMessage has no imageMessage");return o("WAParseMediaTransportProtocol").decodeImageTransport(a==null||(n=a.image)==null?void 0:n.payload,t,"image")}function v(e,t){var n,a=e.audioMessage;if(a==null)throw r("err")("consumerMessage has no audioMessage");var i=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").AudioTransportSpec,a==null||(n=a.audio)==null?void 0:n.payload),l=o("WAParseMediaTransportProtocol").parseAudioMsg(i,(a==null?void 0:a.ptt)||!1,t);if(l==null)throw r("err")("consumerMessage has no audio media info");return l}function S(e){var t,n=e.stickerMessage;if(n==null)throw r("err")("consumerMessage has no stickerMessage");return o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").StickerTransportSpec,n==null||(t=n.sticker)==null?void 0:t.payload)}function R(e,t){var n,a=e.documentMessage;if(a==null)throw r("err")("consumerMessage has no documentMessage");var i=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").DocumentTransportSpec,a==null||(n=a.document)==null?void 0:n.payload),l=a==null?void 0:a.fileName,s=o("WAParseMediaTransportProtocol").parseDocumentMsg(i,l,t);if(s==null)throw r("err")("consumerMessage has no document media info");return s}function L(e){var t=Object.keys(e).filter(function(e){return e!=="$$unknownFieldCount"});if(t.length!==1)throw r("err")(JSON.stringify(e)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(t));return t[0]}function E(e,t){var n=t.groupInviteMessage;if(n==null)throw r("err")("consumerMessage has no GroupInvite Data");return babelHelpers.extends({ack:e.ack,author:e.id.author,externalId:e.id.externalId,ts:e.ts},n)}l.MINIMAL_MEDIA_DURATION=c,l.DEFAULT_FILE_SIZE=d,l.SUPPORTED_TYPES_VERSION=p,l.parseConsumerMessageProtocol=_,l.interpretAsNonSystemAuthor=f,l.validReactionMessageText=h,l.parseReactionMessage=y,l.parsedQuotedConsumerMessage=C,l.parseOneOfContentType=L}),98);
__d("WAParseMediaTransportProtocol",["WAHashUtils","WALogger","WALongInt","WAMedia","WAMediaHdType","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WAProgressiveJpegGetScanLengths","WATimeUtils","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,n,r,a){var i,l,c,d,m,p,_,f,g,h,y,C,b,v;if(!((i=t.integral)!=null&&i.transport))return null;var S=(l=t.integral)==null?void 0:l.transport;if(o("decodeProtobuf").getUnknownFields(S.integral)!=null)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"]))),null;var R=(c=S.integral)==null?void 0:c.fileSha256;if(!R)return r||o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]))),null;var L=null;if(((d=t.ancillary)==null?void 0:d.scansSidecar)!=null&&((m=t.ancillary)==null?void 0:m.scanLengths)!=null){var E,k;L={sidecar:(E=t.ancillary)==null?void 0:E.scansSidecar,scanLengths:(k=t.ancillary)==null||(k=k.scanLengths)==null?void 0:k.map(o("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength)}}if(((p=S.integral)==null?void 0:p.fileSha256)==null||((_=S.integral)==null?void 0:_.fileEncSha256)==null||((f=S.integral)==null?void 0:f.mediaKey)==null||((g=S.integral)==null?void 0:g.directPath)==null||((h=S.integral)==null?void 0:h.mediaKeyTimestamp)==null||((y=S.ancillary)==null?void 0:y.objectId)==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]))),null;var I=(C=S.ancillary)==null?void 0:C.fileLength,T=(b=S.ancillary.thumbnail)==null?void 0:b.downloadableThumbnail,D=o("WAMediaUtils").rawDataToMediaEntry({fileSha256:S.integral.fileSha256,fileEncSha256:S.integral.fileEncSha256,mediaKey:S.integral.mediaKey,directPath:S.integral.directPath,mediaKeyTimestamp:o("WATimeUtils").castLongIntToUnixTime(S.integral.mediaKeyTimestamp),serverMediaType:n,objectId:(v=S.ancillary)==null?void 0:v.objectId,fbid:void 0,downloadableThumbnail:{directPath:T==null?void 0:T.directPath,fileEncSha256:T==null?void 0:T.fileEncSha256,fileSha256:T==null?void 0:T.fileSha256,mediaKey:T==null?void 0:T.mediaKey,mediaKeyTimestamp:(T==null?void 0:T.mediaKeyTimestamp)==null?null:o("WATimeUtils").castLongIntToUnixTime(T==null?void 0:T.mediaKeyTimestamp),objectId:T==null?void 0:T.objectId},filename:a,progressiveJpegDetails:L,size:I==null?I:o("WALongInt").numberOrThrowIfTooLarge(I)});return{size:I==null?o("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE:o("WALongInt").numberOrThrowIfTooLarge(I),plaintextHash:o("WAHashUtils").toPlaintextHash(new Uint8Array(R)),mediaEntry:D}}function d(e){switch(e){case o("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.NONE:return o("WAMediaHdType").HD_TYPE_NONE;case o("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.LQ_4K:return o("WAMediaHdType").HD_TYPE_LQ_4K;case o("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.HQ_4K:return o("WAMediaHdType").HD_TYPE_HQ_4K;default:return o("WAMediaHdType").HD_TYPE_NONE}}function m(e,t,n){var r,a,i,l,s,u,m=c(e,n,!1);if(!m)return null;var p=C(m,t),_=(r=e.ancillary)==null?void 0:r.width,f=(a=e.ancillary)==null?void 0:a.height;e.ancillary!=null&&(e.ancillary.width!=null&&e.ancillary.width===4294967295&&(_=void 0),e.ancillary.height!=null&&e.ancillary.height===4294967295&&(f=void 0));var g=babelHelpers.extends({},p,{mediaType:o("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:_,height:f,jpegThumbnail:(i=e.integral)==null||(i=i.transport)==null||(i=i.ancillary)==null||(i=i.thumbnail)==null?void 0:i.jpegThumbnail,jpegThumbnailHeight:(l=e.integral)==null||(l=l.transport)==null||(l=l.ancillary)==null||(l=l.thumbnail)==null?void 0:l.thumbnailHeight,jpegThumbnailWidth:(s=e.integral)==null||(s=s.transport)==null||(s=s.ancillary)==null||(s=s.thumbnail)==null?void 0:s.thumbnailWidth,hdType:d((u=e.ancillary)==null?void 0:u.hdType)},validatedAudioInfo:null,validatedDocumentFileInfo:null});return g}function p(e,t,n){var a=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").ImageTransportSpec,e),i=m(a,t,n);if(i==null)throw r("err")("consumerMessage has no image media info");return i}function _(e,t,n){var r,a,i,l,s,u,d,m,p,_,f,g,h,y,b,v,S;if(!((r=e.integral)!=null&&r.transport))return null;var R=c(e,n?"gif":"video",!1);if(!R)return null;var L=C(R,t),E=babelHelpers.extends({},L,{accessibilitySummaryText:(a=e.ancillary)==null?void 0:a.accessibilityLabel,mediaType:n?o("WAMedia").MEDIA_TYPE.GIF:o("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:n?null:{duration:(e==null||(i=e.ancillary)==null?void 0:i.seconds)!=null&&(e==null||(l=e.ancillary)==null?void 0:l.seconds)>o("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?e==null||(s=e.ancillary)==null?void 0:s.seconds:o("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:e==null||(u=e.ancillary)==null?void 0:u.width,height:e==null||(d=e.ancillary)==null?void 0:d.height,mimetype:e==null||(m=e.integral)==null||(m=m.transport)==null||(m=m.ancillary)==null?void 0:m.mimetype,jpegThumbnail:(p=e.integral)==null||(p=p.transport)==null||(p=p.ancillary)==null||(p=p.thumbnail)==null?void 0:p.jpegThumbnail,jpegThumbnailHeight:(_=e.integral)==null||(_=_.transport)==null||(_=_.ancillary)==null||(_=_.thumbnail)==null?void 0:_.thumbnailHeight,jpegThumbnailWidth:(f=e.integral)==null||(f=f.transport)==null||(f=f.ancillary)==null||(f=f.thumbnail)==null?void 0:f.thumbnailWidth,gifPlayback:(g=e.ancillary)==null?void 0:g.gifPlayback},validatedImageInfo:n?{width:(h=e.ancillary)==null?void 0:h.width,height:(y=e.ancillary)==null?void 0:y.height,jpegThumbnail:(b=e.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null||(b=b.thumbnail)==null?void 0:b.jpegThumbnail,jpegThumbnailHeight:(v=e.integral)==null||(v=v.transport)==null||(v=v.ancillary)==null||(v=v.thumbnail)==null?void 0:v.thumbnailHeight,jpegThumbnailWidth:(S=e.integral)==null||(S=S.transport)==null||(S=S.ancillary)==null||(S=S.thumbnail)==null?void 0:S.thumbnailWidth}:null,validatedAudioInfo:null,validatedDocumentFileInfo:null});return E}function f(e,t,n){var r,a,i,l,s,u;if(!((r=e.integral)!=null&&r.transport))return null;var d=c(e,"ptt",!1);if(!d)return null;var m=C(d,n),p=babelHelpers.extends({},m,{mediaType:o("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedDocumentFileInfo:null,validatedAudioInfo:{duration:(e==null||(a=e.ancillary)==null?void 0:a.seconds)!=null&&(e==null||(i=e.ancillary)==null?void 0:i.seconds)>o("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?e==null||(l=e.ancillary)==null?void 0:l.seconds:o("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:e==null||(s=e.integral)==null||(s=s.transport)==null||(s=s.ancillary)==null?void 0:s.mimetype,played:!1,waveform:e==null||(u=e.ancillary)==null?void 0:u.waveform}});return p}function g(e,t){var n,r,a,i,l,s,u,d;if(!((n=e.integral)!=null&&n.transport))return null;var m=((r=e.integral)==null?void 0:r.receiverFetchId)!=null,p=c(e,"sticker",m);if(!p)return null;var _=C(p,t),f=babelHelpers.extends({},_,{accessibilitySummaryText:(a=e.ancillary)==null?void 0:a.accessibilityLabel,mediaType:o("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(i=e.ancillary)==null?void 0:i.width,height:(l=e.ancillary)==null?void 0:l.height,jpegThumbnail:(s=e.integral)==null||(s=s.transport)==null||(s=s.ancillary)==null||(s=s.thumbnail)==null?void 0:s.jpegThumbnail,jpegThumbnailHeight:(u=e.integral)==null||(u=u.transport)==null||(u=u.ancillary)==null||(u=u.thumbnail)==null?void 0:u.thumbnailHeight,jpegThumbnailWidth:(d=e.integral)==null||(d=d.transport)==null||(d=d.ancillary)==null||(d=d.thumbnail)==null?void 0:d.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return f}function h(e){var t,n,r,o,a,i,l;if(!((t=e.integral)!=null&&t.transport))return null;var s=(n=e.ancillary)==null?void 0:n.width,u=(r=e.ancillary)==null?void 0:r.height,c=(o=(a=e.integral)==null?void 0:a.receiverFetchId)!=null?o:(i=e.ancillary)==null?void 0:i.receiverFetchId,d=e==null||(l=e.integral)==null||(l=l.transport)==null||(l=l.ancillary)==null?void 0:l.mimetype;if(s==null||u==null||c==null||d==null)return null;var m={receiverFetchId:c,previewWidth:s,previewHeight:u,mimetype:d,type:"sticker"};return m}function y(e,t,n){var r,a;if(!((r=e.integral)!=null&&r.transport))return null;var i=c(e,"document",!1,t);if(!i)return null;var l=C(i,n);return babelHelpers.extends({},l,{mediaType:o("WAMedia").MEDIA_TYPE.DOCUMENT_FILE,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:null,validatedDocumentFileInfo:{mimetype:e==null||(a=e.integral)==null||(a=a.transport)==null||(a=a.ancillary)==null?void 0:a.mimetype,filename:t!=null?t:void 0}})}function C(e,t){return{mediaEntry:e.mediaEntry,plaintextHash:e.plaintextHash,size:e.size,msgIds:[],mediaEntries:new(o("WAMsgMap")).MsgMap,ts:t}}l.getMediaMeta=c,l.decodeImageTransport=p,l.parseVideoMsg=_,l.parseAudioMsg=f,l.parseStickerMsg=g,l.parseStickerReceiverFetchInfo=h,l.parseDocumentMsg=y}),98);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n;if(e==null)return null;var r=(t=e.maybeChild("franking_tag"))==null?void 0:t.contentBytes(),a=(n=e.maybeChild("reporting_tag"))==null?void 0:n.contentBytes();return{frankingKey:null,frankingTag:r!=null?o("WAFrankingTypes").castToFrankingTag(r):null,reportingTag:a!=null?o("WAFrankingTypes").castToReportingTag(a):null,frankingVersion:o("WAFranking").getFrankingVersion(),reportingContent:null}}l.parseFrankingNode=e}),98);
__d("WAQueryGroupsAndSync",["FBLogger","Promise","WACreateGroup","WAGetDevices","WAGlobals","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t,n){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,o){if(o===void 0&&(o=!1),n!=null){if(n.type==="all"){r("FBLogger")("wmi").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsAndSync: unsupported input type: all"])));return}var a=n.groups;if(a==null||a.length===0){r("FBLogger")("wmi").MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsAndSync: empty groups list"])));return}yield m({groupJids:a,ignoreDhash:o})}}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupJids,n=e.ignoreDhash,r=n===void 0?!1:n,a=yield _({groupJids:t});if(a.length!==0){yield o("WACreateGroup").createGroups(a.map(function(e){return{groupStatus:"queried",groupToCreate:e,serverTs:o("WATimeUtils").unixTime(),extras:void 0,folder:void 0,key:void 0}}));var i=g(a);i.size!==0&&(yield o("WAGetDevices").getDevices(null,{users:i,reason:"query-groups",ignoreDhash:r}))}}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupJids,r=yield(u||(u=n("Promise"))).all(t.map(function(e){return o("WAGlobals").getDependencies().queryGroup({groupJid:e})})),a=[];for(var i of r)i.success&&a.push(i.value);return a}),f.apply(this,arguments)}function g(e){var t=new Set;for(var n of e)for(var r of n.participants)r.success?t.add(r.value.user):t.add(r.error.user);return t}l.queryGroupsLegacyWAAPI=c,l.queryGroupsAndSync=m}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","item-not-found");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",404);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorItemNotFoundMixin=e}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:n.value});var r=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return r.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[t,n,r])}l.parseRequestErrorsFetchDigest=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrorsFetchDigest:i.value})):i}l.parseFetchDigestResponseRequestError=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseFetchDigestResponseServerError=e}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"hash");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(t.value,20,20);return n.success?o("WAResultOrError").makeResult({hashElementValue:n.value}):n}l.parseKeysHashMixin=e}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"id");if(!t.success)return t;var n=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(e);return n.success,n}function s(t){var n=o("WASmaxParseUtils").flattenedChildWithTag(t,"list");if(!n.success)return n;var r=o("WASmaxParseUtils").mapChildrenWithTag(n.value,"id",0,2e4,e);return r.success?o("WAResultOrError").makeResult({listId:r.value}):r}l.parsePreKeyIDListListId=e,l.parsePreKeyIDListMixin=s}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(e);if(!t.success)return t;var n=o("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(e);if(!n.success)return n;var r=o("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(e);if(!r.success)return r;var a=o("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(e);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(e),l=o("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},t.value,n.value,r.value,a.value,{keyTypeMixin:i.success?i.value:null},l.value)):l}l.parseIdentityDigestBundleMixin=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"digest");if(!r.success)return r;var a=o("WASmaxParseReference").optionalAttrStringFromReference(t,["digest","identity_type"]);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalLiteral(o("WASmaxParseUtils").attrString,r.value,"identity_type",a.value);if(!i.success)return i;var l=o("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(r.value);if(!l.success)return l;var s=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(e,t);return s.success?o("WAResultOrError").makeResult(babelHelpers.extends({hasDigestIdentityType:i.value!=null,digestIdentityDigestBundleMixin:l.value},s.value)):s}l.parseFetchDigestResponseSuccess=e}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"get"},o("WASmaxJsx").smax("digest",null)));return e}l.makeFetchDigestRequest=e}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=o("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest(),n=yield o("WAComms").sendSmaxStanza(t,e),r=o("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(n,t);if(r.success)return{name:"FetchDigestResponseSuccess",value:r.value};var a=o("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(n,t);if(a.success)return{name:"FetchDigestResponseRequestError",value:a.value};var i=o("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(n,t);if(i.success)return{name:"FetchDigestResponseServerError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:r,RequestError:a,ServerError:i}))}),s.apply(this,arguments)}l.sendFetchDigestRPC=e}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function c(t){return o("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(n){switch(n.name){case"FetchDigestResponseServerError":{var r=n.value.errorServerErrors.name;return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),n.name,r),o("WAResultOrError").makeError({type:"server-error",payload:r})}case"FetchDigestResponseRequestError":{var a=n.value.errorRequestErrorsFetchDigest.name;return u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),n.name,a),o("WAResultOrError").makeError({type:"request-error",payload:a})}default:{n.name;var i=d(n.value.digestIdentityDigestBundleMixin);return m(i,t).then(function(e){return e==="ok"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError({type:"compare-error",payload:e})})}}})}function d(e){var t=o("WAConvertRegistrationIdMixin").registrationIdMixin(e),n=o("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(e),r=e.listId.map(function(e){return o("WASignalKeys").castToPreKeyId(o("WAParsableXmlNode").convertBytesToUint(e.elementValue,3))}),a=e.hashElementValue;return{regId:t,skeyId:n.id,preKeyIds:r,hash:a}}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.regId!==t.regInfo.regId)return"RegIdMismatch";if(e.skeyId!==t.signedPreKey.id)return"SignedPreKeyIdMismatch";var n=new Map;t.preKeys.forEach(function(e){return n.set(e.id,e)});var r=e.preKeyIds.some(function(e){return!n.has(e)});if(r)return"UnknownPreKey";var a=e.preKeyIds.map(function(e){return n.get(e)}).filter(Boolean),i=yield _(t,a);return o("WACryptoUtils").uint8ArraysEqual(i,e.hash)?"ok":"HashMismatch"}),p.apply(this,arguments)}function _(e,t){var n=new(o("WABinary")).Binary;return n.writeByteArray(e.regInfo.staticKeyPair.publicKey),n.writeByteArray(e.signedPreKey.keyPair.publicKey),n.writeByteArray(e.signedPreKey.signature),t.forEach(function(e){n.writeByteArray(e.keyPair.publicKey)}),o("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",n.readByteArrayView()).then(function(e){return new Uint8Array(e)})}l.requestPreKeyDigestProtocol=c}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t(function(e){var t=e.cryptoManager;return o("WAGetKeysForUpload").getKeysForUpload(t)}),a=yield o("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(n.value);if(a.success===!1){if(o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"}),a.error.type==="compare-error"){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""])),a.error.payload),o("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"}).catch(function(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),e)});return}throw r("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success,o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})}),c.apply(this,arguments)}function d(e){return u(function(e){return o("WAGlobals").getWaOneQueue().enqueue(e,{operationType:"request_prekey_digest",flush:!1})})}l.requestPreKeyDigestFn=u,l.requestPreKeyDigest=d}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","3");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckAdminEditMixin=e}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","8");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckAdminRevokeMixin=e}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","1");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckMessageEditMixin=e}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","2");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckMessagePinMixin=e}),98);
__d("WASmaxInMessagePublishEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e,s={CBP:"CBP",NBP:"NBP",PMP:"PMP"},u={delivery:"delivery",no_optimization:"no_optimization"},c={false:"false",true:"true"},d={free_customer_service:"free_customer_service",free_entry_point:"free_entry_point",regular:"regular"},m={lid:"lid",pn:"pn"},p={validators:[(e=o("WAJids")).validateDeviceJid,e.validateDeviceJid,e.validateUserJid,e.validateUserJid],typeName:"DeviceJid|DeviceJid|UserJid|UserJid"},_={validators:[e.validateUserJid,e.validateUserJid],typeName:"UserJid|UserJid"};l.ENUM_CBP_NBP_PMP=s,l.ENUM_DELIVERY_NOOPTIMIZATION=u,l.ENUM_FALSE_TRUE=c,l.ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR=d,l.ENUM_LID_PN=m,l.DEVICEJID_DEVICEJID_USERJID_USERJID=p,l.USERJID_USERJID=_}),98);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"delivery_context");if(!t.success)return t;var n=o("WASmaxParseUtils").attrStringEnum(e,"optimization_goal",o("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return n.success?o("WAResultOrError").makeResult({optimizationGoal:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"source_url");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(e){var t=o("WASmaxParseUtils").assertTag(e,"referral");if(!t.success)return t;var n=o("WASmaxParseUtils").optionalChildWithTag(e,"source_url",s);if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"source_type");return r.success?o("WAResultOrError").makeResult({sourceType:r.value,sourceUrl:n.value}):r}function c(e){var t=o("WASmaxParseUtils").assertTag(e,"origin");if(!t.success)return t;var n=o("WASmaxParseUtils").optionalChildWithTag(e,"referral",u);if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"type");return r.success?o("WAResultOrError").makeResult({type:r.value,referral:n.value}):r}function d(e){var t=o("WASmaxParseUtils").assertTag(e,"pricing");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"consumer_country_code");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"business_country_code");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"conversation_status",0,void 0);if(!a.success)return a;var i=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"latest_c2b_timestamp",0,void 0);if(!i.success)return i;var l=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"analytics_conversation_id");if(!l.success)return l;var s=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"b2c_timestamp",0,void 0);return s.success?o("WAResultOrError").makeResult({consumerCountryCode:n.value,businessCountryCode:r.value,conversationStatus:a.value,latestC2bTimestamp:i.value,analyticsConversationId:l.value,b2cTimestamp:s.value}):s}function m(t){var n=o("WASmaxParseUtils").assertTag(t,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t,"biz");if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(r.value,"delivery_context",e);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(r.value,"origin",c);if(!i.success)return i;var l=o("WASmaxParseUtils").optionalChildWithTag(r.value,"pricing",d);if(!l.success)return l;var s=o("WASmaxParseUtils").attrString(r.value,"paid_convo_id");if(!s.success)return s;var u=o("WASmaxParseUtils").attrStringEnum(r.value,"pricing_model",o("WASmaxInMessagePublishEnums").ENUM_CBP_NBP_PMP);if(!u.success)return u;var m=o("WASmaxParseUtils").attrStringEnum(r.value,"billable",o("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!m.success)return m;var p=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,r.value,"expiration_timestamp",0,void 0);if(!p.success)return p;var _=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,r.value,"pricing_category");if(!_.success)return _;var f=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrStringEnum,r.value,"pricing_type",o("WASmaxInMessagePublishEnums").ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR);return f.success?o("WAResultOrError").makeResult({bizPaidConvoId:s.value,bizPricingModel:u.value,bizBillable:m.value,bizExpirationTimestamp:p.value,bizPricingCategory:_.value,bizPricingType:f.value,bizDeliveryContext:a.value,bizOrigin:i.value,bizPricing:l.value}):f}l.parseAckPaidConversationBizDeliveryContext=e,l.parseAckPaidConversationBizOriginReferralSourceUrl=s,l.parseAckPaidConversationBizOriginReferral=u,l.parseAckPaidConversationBizOrigin=c,l.parseAckPaidConversationBizPricing=d,l.parseAckPaidConversationMixin=m}),98);
__d("WASmaxInMessagePublishAckPaidGroupConversationMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"biz");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(n.value,"pricing");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,r.value,"business_country_code");return a.success?o("WAResultOrError").makeResult({bizPricingBusinessCountryCode:a.value}):a}l.parseAckPaidGroupConversationMixin=e}),98);
__d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup",["WAResultOrError","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckPaidGroupConversationMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"AckPaidConversation",value:t.value});var n=o("WASmaxInMessagePublishAckPaidGroupConversationMixin").parseAckPaidGroupConversationMixin(e);return n.success?o("WAResultOrError").makeResult({name:"AckPaidGroupConversation",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["AckPaidConversation","AckPaidGroupConversation"],[t,n])}l.parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup=e}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","7");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckRevokeMixin=e}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"franking");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"reporting_tag");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(n.value,9,128);return r.success?o("WAResultOrError").makeResult({frankingReportingTagElementValue:r.value}):r}l.parseServerFrankingTagMixin=e}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",r.value);if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"class","message");if(!i.success)return i;var l=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",l.value);if(!s.success)return s;var u=o("WASmaxParseUtils").attrIntRange(e,"t",0,void 0);if(!u.success)return u;var c=o("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(e),d=o("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(e),m=o("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(e),p=o("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(e),_=o("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(e),f=o("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(e),g=o("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup").parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup(e);return o("WAResultOrError").makeResult({class:i.value,t:u.value,ackMessageEditMixin:c.success?c.value:null,ackAdminEditMixin:d.success?d.value:null,ackMessagePinMixin:m.success?m.value:null,ackAdminRevokeMixin:p.success?p.value:null,ackRevokeMixin:_.success?_.value:null,serverFrankingTagMixin:f.success?f.value:null,ackPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup:g.success?g.value:null})}l.parseAckMixin=e}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"application_error",0,void 0);return n.success?o("WAResultOrError").makeResult({applicationError:n.value}):n}l.parseApplicationNegativeAckMixin=e}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"backoff",0,86400);return n.success?o("WAResultOrError").makeResult({backoff:n.value}):n}l.parseMessageNackRetryAttributesMixin=e}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"error");if(!r.success)return r;var a=o("WASmaxInMessagePublishAckMixin").parseAckMixin(e,t);if(!a.success)return a;var i=o("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(e),l=o("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({error:r.value},a.value,{applicationNegativeAckMixin:i.success?i.value:null,messageNackRetryAttributesMixin:l.success?l.value:null}))}l.parseNegativeAckMixin=e}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrUserJid,e,"recipient");if(!r.success)return r;var a=o("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(e,t);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({recipient:r.value},a.value)):a}l.parseIndividualResponseNegative=e}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"rcat");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytes(n.value);return r.success?o("WAResultOrError").makeResult({rcatElementValue:r.value}):r}l.parseAckRcatMixin=e}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"phash");return n.success?o("WAResultOrError").makeResult({phash:n.value}):n}l.parseDeviceListStaleMixin=e}),98);
__d("WASmaxInMessagePublishRefreshLIDMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrStringEnum(e,"refresh_lid",o("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);return n.success?o("WAResultOrError").makeResult({refreshLid:n.value}):n}l.parseRefreshLIDMixin=e}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxInMessagePublishEnums","WASmaxInMessagePublishRefreshLIDMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrUserJid,e,"recipient");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrJidEnum,e,"participant",o("WASmaxInMessagePublishEnums").USERJID_USERJID);if(!a.success)return a;var i=o("WASmaxInMessagePublishAckMixin").parseAckMixin(e,t);if(!i.success)return i;var l=o("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(e),s=o("WASmaxInMessagePublishRefreshLIDMixin").parseRefreshLIDMixin(e),u=o("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({recipient:r.value,participant:a.value},i.value,{deviceListStaleMixin:l.success?l.value:null,refreshLIDMixin:s.success?s.value:null,ackRcatMixin:u.success?u.value:null}))}l.parseIndividualResponseSuccess=e}),98);
__d("WASmaxOutMessagePublishAppdataMetaAttributeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaAppdata,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{appdata:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAppdataMetaAttributeMixin=s}),98);
__d("WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOriginalMsgT,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{original_msg_t:o("WAWap").INT(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeArmadilloOriginalMessageTimestampMixin=s}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("automated",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeAutomatedMixin=s}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.authVerificationTimestamp,n=e.authDisableIosAutofill,r=e.authEnableRiskCheck,a=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("auth",{verification_timestamp:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t),disable_ios_autofill:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n),enable_risk_check:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)})));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAuthMixin=s}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizAcceptTs,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{accept_ts:o("WAWap").INT(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizAcceptTsMixin=s}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizAutoResponse,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{auto_response:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizAutoResponseMixin=s}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizCampaignId,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{campaign_id:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizCampaignMixin=s}),98);
__d("WASmaxOutMessagePublishBizEngagementDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.engagementConversationState,n=e.engagementCustomerServiceState,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("engagement",{conversation_state:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),customer_service_state:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)})));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizEngagementDataMixin=s}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.metadataAppOwner,a=e.metadataCsidBm,i=e.metadataPaymentBm,l=e.metadataCustomerCategory,s=e.metadataDidBepRun,u=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("metadata",{app_owner:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).CUSTOM_STRING,r),csid_bm:t.OPTIONAL(n.CUSTOM_STRING,a),payment_bm:t.OPTIONAL(n.CUSTOM_STRING,i),customer_category:t.OPTIONAL(n.CUSTOM_STRING,l),did_bep_run:t.OPTIONAL(n.CUSTOM_STRING,s)})));return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishBizPricingDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.pricingConsumerCountryCode,n=e.pricingBusinessCountryCode,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("pricing",{consumer_country_code:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),business_country_code:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)})));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizPricingDataMixin=s}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizHostStorage,n=e.bizActualActors,r=e.bizPrivacyModeTs,a=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{host_storage:o("WAWap").INT(t),actual_actors:o("WAWap").INT(n),privacy_mode_ts:o("WAWap").INT(r)}));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizRolesMixin=s}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="SmaxMixinGroupExhaustiveError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.SmaxMixinGroupExhaustiveError=e}),66);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("buttons",null)));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeButtonsMixin=s}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.capabilityArgs,n=o("WASmaxJsx").smax("capabilities",null,o("WASmaxChildren").REPEATED_CHILD(s,t,1,50));return n}function s(e){var t=e.capabilityName,n=o("WASmaxJsx").smax("capability",{name:o("WAWap").CUSTOM_STRING(t)});return n}function u(t){var n=t.capabilitiesArgs,r=t.extensionsMetadataWellVersion,a=t.extensionsMetadataDataApiVersion,i=t.extensionsMetadataFlowMessageVersion,l=o("WASmaxJsx").smax("native_flow",null,o("WASmaxJsx").smax("extensions_metadata",{well_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,r),data_api_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,a),flow_message_version:o("WAWap").INT(i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return l}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeExtensionsMetadataExtensionsMetadataCapabilities=e,l.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=s,l.mergeExtensionsMetadataMixin=c}),98);
__d("WASmaxOutMessagePublishMixedMetadataMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paymentsMetadataVersion,n=o("WASmaxJsx").smax("native_flow",null,o("WASmaxJsx").smax("mixed_metadata",null,o("WASmaxJsx").smax("payments_metadata",{version:o("WAWap").INT(t)})));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMixedMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WASmaxOutMessagePublishMixedMetadataMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.nativeFlowName,n=e.nativeFlowV,r=e.extensionsMetadataMixinArgs,a=e.mixedMetadataMixinArgs,i=o("WASmaxJsx").smax("interactive",{type:"native_flow"},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishMixedMetadataMixin").mergeMixedMetadataMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,o("WASmaxJsx").smax("native_flow",{name:o("WAWap").CUSTOM_STRING(t),v:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)}),r),a));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeNativeFlowMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasInteractiveV1,n=e.nativeFlowMessageTypeMixinArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(o("WASmaxJsx").smax("interactive",{v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)}),n)));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInteractiveMixin=s}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizNativeFlowName,n=e.bizNativeFlowVersion,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{native_flow_name:o("WAWap").CUSTOM_STRING(t),native_flow_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)}));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeNativeFlowMixin=s}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isButtons)return o("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(e);if(t.nativeFlow)return o("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(e,t.nativeFlow);if(t.interactive)return o("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(e,t.interactive);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=e}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.conversionRecipientStatus,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("conversion",{recipient_status:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeConversionRecipientStatusMixin=s}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.ctwaAttributionElementValue,n=o("WASmaxJsx").smax("ctwa_attribution",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClickToWhatsAppAttributionMixin=s}),98);
__d("WASmaxOutMessagePublishCtwaAttributionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppAttributionMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin").mergeClickToWhatsAppAttributionMixin(o("WASmaxJsx").smax("ctwa_attribution",null),e);return t}function s(t){var n=t.ctwaAttributionArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCtwaAttributionCtwaAttribution=e,l.mergeCtwaAttributionMixin=u}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.sourceUrlElementValue,n=o("WASmaxJsx").smax("source_url",null,t);return n}function s(t){var n,r,a=t.sourceUrlArgs,i=t.ctwaConversionSource,l=t.ctwaConversionData,s=t.ctwaSourceType,u=t.ctwaEntryPointConversionSource,c=t.ctwaEntryPointConversionApp,d=t.ctwaSignals,m=o("WASmaxJsx").smax("ctwa",{conversion_source:(n=o("WASmaxAttrs")).OPTIONAL((r=o("WAWap")).CUSTOM_STRING,i),conversion_data:n.OPTIONAL(r.CUSTOM_STRING,l),source_type:n.OPTIONAL(r.CUSTOM_STRING,s),entry_point_conversion_source:n.OPTIONAL(r.CUSTOM_STRING,u),entry_point_conversion_app:n.OPTIONAL(r.CUSTOM_STRING,c),signals:n.OPTIONAL(r.CUSTOM_STRING,d)},o("WASmaxChildren").OPTIONAL_CHILD(e,a));return m}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeClickToWhatsAppTypeSourceUrl=e,l.mergeClickToWhatsAppTypeMixin=u}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(o("WASmaxJsx").smax("ctwa",null),e);return t}function s(t){var n=t.ctwaArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCtwaConversionCtwa=e,l.mergeCtwaConversionMixin=u}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.deliveryContextHsmMaxBid,a=e.deliveryContextOptimizationGoal,i=e.deliveryContextTemplateId,l=e.deliveryContextCampaignId,s=e.deliveryContextSourceType,u=e.deliveryContextTierType,c=e.deliveryContextDeliveryType,d=e.deliveryContextClientToken,m=e.deliveryContextPrice,p=e.deliveryContextWabaId,_=e.deliveryContextQualityFlag,f=e.deliveryContextIsZeroRatedTemplate,g=e.deliveryContextPartnerId,h=e.deliveryContextAppId,y=e.deliveryContextVertical,C=e.deliveryContextBmMessageLimitStatus,b=e.deliveryContextDisableIosAutofill,v=e.deliveryContextAuthBlockRecentRegisters,S=e.deliveryContextEncryptedDeterministicTemplateId,R=e.deliveryContextShouldBypassIntegrityPhoneLimit,L=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).INT,r),optimization_goal:t.OPTIONAL(n.CUSTOM_STRING,a),template_id:t.OPTIONAL(n.CUSTOM_STRING,i),campaign_id:t.OPTIONAL(n.CUSTOM_STRING,l),source_type:t.OPTIONAL(n.CUSTOM_STRING,s),tier_type:t.OPTIONAL(n.CUSTOM_STRING,u),delivery_type:t.OPTIONAL(n.CUSTOM_STRING,c),client_token:t.OPTIONAL(n.CUSTOM_STRING,d),price:t.OPTIONAL(n.INT,m),waba_id:t.OPTIONAL(n.CUSTOM_STRING,p),quality_flag:t.OPTIONAL(n.CUSTOM_STRING,_),is_zero_rated_template:t.OPTIONAL(n.CUSTOM_STRING,f),partner_id:t.OPTIONAL(n.CUSTOM_STRING,g),app_id:t.OPTIONAL(n.CUSTOM_STRING,h),vertical:t.OPTIONAL(n.INT,y),bm_message_limit_status:t.OPTIONAL(n.CUSTOM_STRING,C),disable_ios_autofill:t.OPTIONAL(n.CUSTOM_STRING,b),auth_block_recent_registers:t.OPTIONAL(n.CUSTOM_STRING,v),encrypted_deterministic_template_id:t.OPTIONAL(n.CUSTOM_STRING,S),should_bypass_integrity_phone_limit:t.OPTIONAL(n.CUSTOM_STRING,R)})));return L}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeliveryContextMixin=s}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasFeatureV1,n=o("WASmaxJsx").smax("feature",{name:"full_catalog",v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)});return n}function s(t){var n=t.featureArgs,r=o("WASmaxJsx").smax("hsm",null,o("WASmaxJsx").smax("capabilities",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCapabilitiesCapabilitiesFeature=e,l.mergeCapabilitiesMixin=u}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.anyCategory,a=e.anyTag,i=e.anyId,l=e.anySubTag,s=e.anyLibraryTemplateId,u=e.anyIsTemplateFromLibraryEdited,c=o("WASmaxJsx").smax("smax$any",{category:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).CUSTOM_STRING,r),tag:t.OPTIONAL(n.CUSTOM_STRING,a),id:t.OPTIONAL(n.CUSTOM_STRING,i),sub_tag:t.OPTIONAL(n.CUSTOM_STRING,l),library_template_id:t.OPTIONAL(n.CUSTOM_STRING,s),is_template_from_library_edited:t.OPTIONAL(n.CUSTOM_STRING,u)});return c}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeHSMReviewMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishQualityTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasQualityTokenV1,n=e.qualityTokenElementValue,r=o("WASmaxJsx").smax("hsm",null,o("WASmaxJsx").smax("quality_token",{v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)},n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeQualityTokenMixin=s}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WASmaxOutMessagePublishQualityTokenMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageTtl,r=e.hasHsmV1,a=e.hasHsmButtons1,i=e.hsmObjective,l=e.hSMReviewMetadataMixinArgs,s=e.capabilitiesMixinArgs,u=e.qualityTokenMixinArgs,c=o("WASmaxJsx").smax("message",{ttl:(t=o("WASmaxAttrs")).OPTIONAL(o("WAWap").INT,n)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishQualityTokenMixin").mergeQualityTokenMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,o("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(o("WASmaxJsx").smax("hsm",{v:t.OPTIONAL_LITERAL("1",r),buttons:t.OPTIONAL_LITERAL("1",a),objective:t.OPTIONAL(o("WAWap").CUSTOM_STRING,i)}),l),s),u));return c}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeHsmMixin=s}),98);
__d("WASmaxOutMessagePublishQualityControlMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.decisionSourceValue,n=o("WASmaxJsx").smax("decision_source",{value:o("WAWap").CUSTOM_STRING(t)});return n}function s(t){var n=t.decisionSourceArgs,r=t.qualityControlSourceType,a=t.qualityControlDecisionId,i=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("quality_control",{source_type:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r),decision_id:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,a)},o("WASmaxChildren").REPEATED_CHILD(e,n,0,1/0))));return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeQualityControlBizQualityControlDecisionSource=e,l.mergeQualityControlMixin=u}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizEngagementDataMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizPricingDataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaAttributionMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin","WASmaxOutMessagePublishQualityControlMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.hsmMixinArgs,r=e.bizRolesMixinArgs,a=e.bizAutoResponseMixinArgs,i=e.bizAcceptTsMixinArgs,l=e.bizCampaignMixinArgs,s=e.deliveryContextMixinArgs,u=e.qualityControlMixinArgs,c=e.authMixinArgs,d=e.conversionRecipientStatusMixinArgs,m=e.ctwaConversionMixinArgs,p=e.bizMetadataMixinArgs,_=e.ctwaAttributionMixinArgs,f=e.bizEngagementDataMixinArgs,g=e.bizPricingDataMixinArgs,h=e.buttonsOrNativeFlowOrInteractiveMixinGroupArgs,y=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,t.optionalMerge(o("WASmaxOutMessagePublishBizPricingDataMixin").mergeBizPricingDataMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizEngagementDataMixin").mergeBizEngagementDataMixin,t.optionalMerge(o("WASmaxOutMessagePublishCtwaAttributionMixin").mergeCtwaAttributionMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,t.optionalMerge(o("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,t.optionalMerge(o("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,t.optionalMerge(o("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,t.optionalMerge(o("WASmaxOutMessagePublishQualityControlMixin").mergeQualityControlMixin,t.optionalMerge(o("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,t.optionalMerge(o("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,o("WASmaxJsx").smax("message",null),n),r),a),i),l),s),u),c),d),m),p),_),f),g),h);return y}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizMixin=s}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.frankingTagElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("franking",null,o("WASmaxJsx").smax("franking_tag",null,t)));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClientFrankingTagMixin=s}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.reportingTokenV,n=e.reportingTokenElementValue,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("reporting",null,o("WASmaxJsx").smax("reporting_token",{v:o("WAWap").INT(t)},n)));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClientReportingTokenMixin=s}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.deviceIdentityElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("device-identity",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeviceIdentityMixin=s}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.testConfig,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("test",{config:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInternalTestMixin=s}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaDeprecatedLidSession,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{deprecated_lid_session:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLIDSessionDeprecationMixin=s}),98);
__d("WASmaxOutMessagePublishMessageAssociationTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaMessageAssociationType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{message_association_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMessageAssociationTypeMixin=s}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMetaHideDecryptionPlaceholderMixin=s}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("multicast",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMulticastMixin=s}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{device_fanout:"false"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeNoExtraFanoutMixin=s}),98);
__d("WASmaxOutMessagePublishAnonPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.taPadElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("ta_pad",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAnonPaddingMixin=s}),98);
__d("WASmaxOutMessagePublishWireSizePaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paddingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("padding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWireSizePaddingMixin=s}),98);
__d("WASmaxOutMessagePublishPaddingMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAnonPaddingMixin","WASmaxOutMessagePublishWireSizePaddingMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anonPaddingMixinArgs,n=e.wireSizePaddingMixinArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishWireSizePaddingMixin").mergeWireSizePaddingMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAnonPaddingMixin").mergeAnonPaddingMixin,o("WASmaxJsx").smax("message",null),t),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePaddingMixin=s}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("url_number",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergePreFilledNumberMixin=s}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("url_text",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergePreFilledTextMixin=s}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeSenderIntentMixin=s}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestIdElementValue,n=o("WASmaxJsx").smax("trace",null,o("WASmaxJsx").smax("request_id",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestIDMixin=s}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.edgeIdElementValue,n=o("WASmaxJsx").smax("edge_id",null,t);return n}function s(e){var t=e.deviceArgs,n=e.correlationIdType,r=e.idElementValue,a=o("WASmaxJsx").smax("correlation_id",{type:o("WAWap").CUSTOM_STRING(n)},o("WASmaxJsx").smax("id",null,r),o("WASmaxChildren").OPTIONAL_CHILD(c,t));return a}function u(e){var t=e.observabilityFlagsId,n=o("WASmaxJsx").smax("observability_flags",{id:o("WAWap").INT(t)});return n}function c(e){var t=e.deviceId,n=o("WASmaxJsx").smax("device",{id:o("WAWap").INT(t)});return n}function d(t){var n=t.edgeIdArgs,r=t.correlationIdArgs,a=t.observabilityFlagsArgs,i=t.traceIdElementValue,l=o("WASmaxJsx").smax("trace",null,[o("WASmaxJsx").smax("trace_id",null,i),o("WASmaxChildren").OPTIONAL_CHILD(e,n)].concat(o("WASmaxChildren").REPEATED_CHILD(s,r,0,10),[o("WASmaxChildren").OPTIONAL_CHILD(u,a)]));return l}function m(e,t){var n=d(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeTraceIDEdgeId=e,l.makeTraceIDCorrelationId=s,l.makeTraceIDObservabilityFlags=u,l.makeTraceIDCorrelationIdDevice=c,l.mergeTraceIDMixin=m}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.requestID)return o("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(e,t.requestID);if(t.traceID)return o("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(e,t.traceID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRequestOrTraceIDMixinGroup=e}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestOrTraceIDMixinGroupArgs,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(o("WASmaxJsx").smax("trace",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTraceContextMixin=s}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageVerifiedName,n=o("WASmaxJsx").smax("message",{verified_name:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeVerifiedNameNameMixin=s}),98);
__d("WASmaxOutMessagePublishWebDriverConfigMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaWebdriverConfig,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{webdriver_config:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWebDriverConfigMixin=s}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMessageAssociationTypeMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPaddingMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin","WASmaxOutMessagePublishWebDriverConfigMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.deviceIdentityMixinArgs,r=e.hasNoExtraFanout,a=e.hasMulticast,i=e.hasPreFilledText,l=e.hasPreFilledNumber,s=e.hasAutomated,u=e.bizMixinArgs,c=e.verifiedNameNameMixinArgs,d=e.clientFrankingTagMixinArgs,m=e.clientReportingTokenMixinArgs,p=e.internalTestMixinArgs,_=e.hasMetaHideDecryptionPlaceholder,f=e.traceContextMixinArgs,g=e.hasSenderIntent,h=e.lIDSessionDeprecationMixinArgs,y=e.paddingMixinArgs,C=e.webDriverConfigMixinArgs,b=e.messageAssociationTypeMixinArgs,v=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishMessageAssociationTypeMixin").mergeMessageAssociationTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishWebDriverConfigMixin").mergeWebDriverConfigMixin,t.optionalMerge(o("WASmaxOutMessagePublishPaddingMixin").mergePaddingMixin,t.optionalMerge(o("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,t.optionalMerge(o("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,t.optionalMerge(o("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,t.optionalMerge(o("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,t.optionalMerge(o("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,t.optionalMerge(o("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,t.optionalMerge(o("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,t.optionalMerge(o("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizMixin").mergeBizMixin,t.optionalMerge(o("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,t.optionalMerge(o("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,t.optionalMerge(o("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,t.optionalMerge(o("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,t.optionalMerge(o("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,t.optionalMerge(o("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,o("WASmaxJsx").smax("message",null),n),r),a),i),l),s),u),c),d),m),p),_),f),g),h),y),C),b);return v}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBaseMixin=s}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaGroupInvite,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{group_invite:o("WAWap").GROUP_JID(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeGroupInviteTargetMixin=s}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("bot",{type:"feedback"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBotFeedbackMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encCount,n=o("WASmaxJsx").smax("enc",{count:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncRetryMixin=s}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeAvatarStickerTypeMixin=s}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=o("WASmaxJsx").smax("enc",{mediatype:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMediaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encNativeFlowName,n=e.hasAvatarStickerType,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,o("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(o("WASmaxJsx").smax("enc",{native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}),e),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncMediaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encElementValue,n=o("WASmaxJsx").smax("enc",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncPayloadMixin=s}),98);
__d("WASmaxOutMessagePublishEncStateMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encState,n=o("WASmaxJsx").smax("enc",{state:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncStateMixin=s}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeMixin","WASmaxOutMessagePublishEncPayloadMixin","WASmaxOutMessagePublishEncStateMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encType,n=e.encStateMixinArgs,r=e.encMediaTypeMixinArgs,a=o("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncStateMixin").mergeEncStateMixin,o("WASmaxJsx").smax("enc",{type:o("WAWap").CUSTOM_STRING(t)}),n),r),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeIndividualMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{v:"2"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncVersion2Mixin=s}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encV,n=o("WASmaxJsx").smax("enc",{v:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncVersionFutureproofMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersionBot",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isEncVersion2)return o("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(e);if(t.encVersionFutureproof)return o("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(e,t.encVersionFutureproof);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncVersionBot=e}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encRetryMixinArgs,r=e.encTypeIndividualMixinArgs,a=e.mediaTypeMixinArgs,i=e.encVersionBotArgs,l=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,o("WASmaxJsx").smax("enc",null),n),r),a),i));return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotRequestMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"media"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeMediaMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"text"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeTextMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.isContentTypeMedia)return o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeTextOrMediaMixinGroup=e}),98);
__d("WASmaxOutMessagePublishBotMetricsEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMetricsEntryPointMixin=s}),98);
__d("WASmaxOutMessagePublishBotClientMultiThreadIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botClientThreadId,n=o("WASmaxJsx").smax("bot",{client_thread_id:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotClientMultiThreadIDMixin=s}),98);
__d("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishBotClientMultiThreadIDMixin").mergeBotClientMultiThreadIDMixin(o("WASmaxJsx").smax("bot",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotClientMultiThreadIDMessageMixin=s}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botLocalAutomatedType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{local_automated_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotLocalAutomatedTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{thread_origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMetricsThreadEntryPointMixin=s}),98);
__d("WASmaxOutMessagePublishBotPersonaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botPersonaType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{persona_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotPersonaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botFeedbackRequested,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{feedback_requested:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBusinessBotMessageFeedbackRequestedMixin=s}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botBizBot,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{biz_bot:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBusinessBotMessageMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeEventMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaEventType,n=o("WASmaxJsx").smax("message",{type:"event"},o("WASmaxJsx").smax("meta",{event_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeEventMixin=s}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("list",{type:"product_list"})));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeProductListMixin=s}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.listV,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("list",{type:"single_select",v:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)})));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSingleSelectListMixin=s}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.singleSelectList)return o("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(e,t.singleSelectList);if(t.isProductList)return o("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeSingleSelectOrProductListMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"list"}));return e}function s(t){var n=t.toCount,r=t.singleSelectOrProductListMixinGroupArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(e,n)))),r);return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeListFanoutParticipantsTo=e,l.mergeContentTypeListFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaLivelocMode,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{liveloc_mode:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLiveLocationModeMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)}));return n}function s(t){var n=t.toArgs,r=t.liveLocationModeMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n)))),r);return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeLiveLocationFanoutParticipantsTo=e,l.mergeContentTypeLiveLocationFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"medianotify"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeMedianotifyMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeMedia)return o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(e);if(t.isContentTypeMedianotify)return o("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeMediaOrMedianotifyMixinGroup=e}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.senderContentBindingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("sender_content_binding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSenderContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.hasEncStickerTypeAvatar,r=e.encNativeFlowName,a=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),sticker_type:o("WASmaxAttrs").OPTIONAL_LITERAL("avatar",n),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}));return a}function s(t){var n=t.toArgs,r=t.senderContentBindingMixinArgs,a=t.contentTypeMediaOrMedianotifyMixinGroupArgs,i=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n))),r),a);return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeMediaFanoutDeprecatedParticipantsTo=e,l.mergeContentTypeMediaFanoutDeprecatedMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.hasEncStickerTypeAvatar,r=e.encNativeFlowName,a=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:o("WAWap").CUSTOM_STRING(t),sticker_type:o("WASmaxAttrs").OPTIONAL_LITERAL("avatar",n),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}));return a}function s(t){var n=t.toArgs,r=t.senderContentBindingMixinArgs,a=t.contentTypeMediaOrMedianotifyMixinGroupArgs,i=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n))),r),a);return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeMediaFanoutParticipantsTo=e,l.mergeContentTypeMediaFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaContenttype,n=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"creation",contenttype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypePollCreationMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"result_snapshot"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypePollResultSnapshotMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaContenttype,n=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"vote",contenttype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypePollVoteMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"reaction"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeReactionMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"pay"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypePayMixin=s}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payType,n=o("WASmaxJsx").smax("pay",{type:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePayNodeTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payCountry,n=e.payVersion,r=e.payIsFirstSend,a=o("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(o("WASmaxJsx").smax("pay",{country:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n),is_first_send:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBasePayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payCurrency,n=e.payAmount,r=o("WASmaxJsx").smax("pay",{currency:o("WAWap").CUSTOM_STRING(t),amount:o("WAWap").CUSTOM_STRING(n)});return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLegacyAmountMixin=s}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.moneyValue,n=e.moneyOffset,r=e.moneyCurrency,a=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("money",{value:o("WAWap").CUSTOM_STRING(t),offset:o("WAWap").CUSTOM_STRING(n),currency:o("WAWap").CUSTOM_STRING(r)}));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMoneyMixin=s}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("amount",null),e);return t}function s(t){var n=t.amountArgs,r=t.payCredentialId,a=t.payDeviceId,i=t.payRequestId,l=t.legacyAmountMixinArgs,s=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,o("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(o("WASmaxJsx").smax("pay",{"credential-id":o("WAWap").CUSTOM_STRING(r),"device-id":o("WAWap").CUSTOM_STRING(a),"request-id":o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n)),t),l);return s}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeBaseIndividualPublishSendPayNodeAmount=e,l.mergeBaseIndividualPublishSendPayNodeMixin=u}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("due_amount",null),e);return t}function s(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("interest",null),e);return t}function u(t){var n=t.dueAmountArgs,r=t.interestArgs,a=t.installmentMaxCount,i=t.installmentSelectedCount,l=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("installment",{max_count:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,a),selected_count:o("WAWap").INT(i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n),o("WASmaxChildren").OPTIONAL_CHILD(s,r)));return l}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeInstallmentInstallmentDueAmount=e,l.makeInstallmentInstallmentInterest=s,l.mergeInstallmentMixin=c}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.beneficiaryName,a=e.beneficiaryAddressLine1,i=e.beneficiaryAddressLine2,l=e.beneficiaryCity,s=e.beneficiaryState,u=e.beneficiaryPhoneNumber,c=e.beneficiaryCountry,d=e.beneficiaryPostalCode,m=o("WASmaxJsx").smax("beneficiary",{name:(t=o("WAWap")).CUSTOM_STRING(r),address_line1:t.CUSTOM_STRING(a),address_line2:(n=o("WASmaxAttrs")).OPTIONAL(t.CUSTOM_STRING,i),city:n.OPTIONAL(t.CUSTOM_STRING,l),state:n.OPTIONAL(t.CUSTOM_STRING,s),phone_number:n.OPTIONAL(t.CUSTOM_STRING,u),country:t.CUSTOM_STRING(c),postal_code:t.CUSTOM_STRING(d)});return m}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBeneficiaryMixin=s}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(o("WASmaxJsx").smax("beneficiary",null),e);return t}function s(t){var n=t.beneficiaryArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,5));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeBeneficiariesBeneficiary=e,l.mergeBeneficiariesMixin=u}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(o("WASmaxJsx").smax("beneficiaries",null),e);return t}function s(t){var n,r=t.beneficiariesArgs,a=t.orderId,i=t.orderMessageId,l=t.orderPaymentConfigId,s=t.orderType,u=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("order",{id:(n=o("WAWap")).CUSTOM_STRING(a),message_id:o("WASmaxAttrs").OPTIONAL(n.STANZA_ID,i),payment_config_id:o("WASmaxAttrs").OPTIONAL(n.CUSTOM_STRING,l),type:o("WASmaxAttrs").OPTIONAL(n.CUSTOM_STRING,s)},o("WASmaxChildren").OPTIONAL_CHILD(e,r)));return u}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeOrderInPaymentOrderBeneficiaries=e,l.mergeOrderInPaymentMixin=u}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPaymentInitiator,n=o("WASmaxJsx").smax("smax$any",{payment_initiator:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePaymentInitiatorMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.orderInPaymentMixinArgs,n=e.paymentInitiatorMixinArgs,r=e.installmentMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,o("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),t),n),r);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRPublishSendPayNodeP2MMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBRPublishSendPayNodeP2PMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isBRPublishSendPayNodeP2P)return o("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(e);if(t.bRPublishSendPayNodeP2M)return o("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(e,t.bRPublishSendPayNodeP2M);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeBRPublishSendPayNodeP2POrMMixinGroup=e}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.eloDeviceSignature,r=e.eloWalletSignature,a=e.eloChallengeId,i=e.eloCardholderVerificationMethod,l=o("WASmaxJsx").smax("pay",null,o("WASmaxJsx").smax("elo",{device_signature:(t=o("WAWap")).CUSTOM_STRING(n),wallet_signature:t.CUSTOM_STRING(r),challenge_id:t.CUSTOM_STRING(a),cardholder_verification_method:t.CUSTOM_STRING(i)}));return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRSendPayEloNodeMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.payId,r=e.payPaymentRails,a=e.payTrustedDeviceInfo,i=e.payNonce,l=e.bRSendPayEloNodeMixinArgs,s=e.bRPublishSendPayNodeP2POrMMixinGroupArgs,u=o("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,o("WASmaxJsx").smax("pay",{id:(t=o("WAWap")).CUSTOM_STRING(n),"payment-rails":t.CUSTOM_STRING(r),"trusted-device-info":t.CUSTOM_STRING(a),nonce:t.CUSTOM_STRING(i)}),l),s);return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishUPILiteDetailsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.upiLiteDetailsLiteReferenceNumber,r=e.upiLiteDetailsLiteArqc,a=e.upiLiteDetailsLiteTimestamp,i=e.upiLiteDetailsLitePurpose,l=o("WASmaxJsx").smax("upi_lite_details",{lite_reference_number:(t=o("WAWap")).CUSTOM_STRING(n),lite_arqc:t.CUSTOM_STRING(r),lite_timestamp:t.INT(a),lite_purpose:t.CUSTOM_STRING(i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeUPILiteDetailsMixin=s}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.orderOrderId,a=e.orderOrderMessageId,i=e.orderExpiryTs,l=e.orderOrderType,s=e.orderDiscountProgramName,u=o("WASmaxJsx").smax("order",{"order-id":(t=o("WAWap")).CUSTOM_STRING(r),"order-message-id":(n=o("WASmaxAttrs")).OPTIONAL(t.CUSTOM_STRING,a),"expiry-ts":n.OPTIONAL(t.INT,i),"order-type":n.OPTIONAL(t.CUSTOM_STRING,l),"discount-program-name":n.OPTIONAL(t.CUSTOM_STRING,s)});return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeOrderMessageMixin=s}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.orderArgs,n=e.paymentLinkArgs,r=o("WASmaxJsx").smax("upi",null,o("WASmaxChildren").OPTIONAL_CHILD(s,t),o("WASmaxChildren").OPTIONAL_CHILD(u,n));return r}function s(e){var t=o("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(o("WASmaxJsx").smax("order",null),e);return t}function u(e){var t=e.paymentLinkOrderId,n=e.paymentLinkMessageId,r=o("WASmaxJsx").smax("payment_link",{order_id:o("WAWap").CUSTOM_STRING(t),message_id:o("WAWap").CUSTOM_STRING(n)});return r}function c(t){var n=t.upiArgs,r=t.paymentInitiatorMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,o("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},o("WASmaxChildren").OPTIONAL_CHILD(e,n)),r);return a}function d(e,t){var n=c(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeUPIPublishSendPayNodeP2MUpi=e,l.makeUPIPublishSendPayNodeP2MUpiOrder=s,l.makeUPIPublishSendPayNodeP2MUpiPaymentLink=u,l.mergeUPIPublishSendPayNodeP2MMixin=d}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasPayTransactionTypeP2P,n=o("WASmaxJsx").smax("pay",{"transaction-type":o("WASmaxAttrs").OPTIONAL_LITERAL("p2p",t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeUPIPublishSendPayNodeP2PMixin=s}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.uPIPublishSendPayNodeP2P)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(e,t.uPIPublishSendPayNodeP2P);if(t.uPIPublishSendPayNodeP2M)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(e,t.uPIPublishSendPayNodeP2M);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeUPIPublishSendPayNodeP2POrMMixinGroup=e}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPILiteDetailsMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.upiLiteDetailsArgs,n=e.upiToken,r=o("WASmaxJsx").smax("upi",{token:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)},o("WASmaxChildren").OPTIONAL_CHILD(s,t));return r}function s(e){var t=o("WASmaxOutMessagePublishUPILiteDetailsMixin").mergeUPILiteDetailsMixin(o("WASmaxJsx").smax("upi_lite_details",null),e);return t}function u(t){var n,r,a=t.upiArgs,i=t.payId,l=t.payMpin,s=t.payReceiverVpa,u=t.payReceiverVpaId,c=t.payReceiverName,d=t.paySenderVpa,m=t.paySenderVpaId,p=t.paySenderName,_=t.paySeqNo,f=t.payUpiBankInfo,g=t.payMode,h=t.payPurposeCode,y=t.payMcc,C=t.payRefId,b=t.payDeviceSsid,v=t.payNote,S=t.uPIPublishSendPayNodeP2POrMMixinGroupArgs,R=o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(o("WASmaxJsx").smax("pay",{id:(n=o("WASmaxAttrs")).OPTIONAL((r=o("WAWap")).CUSTOM_STRING,i),mpin:n.OPTIONAL(r.CUSTOM_STRING,l),"receiver-vpa":r.CUSTOM_STRING(s),"receiver-vpa-id":n.OPTIONAL(r.CUSTOM_STRING,u),"receiver-name":n.OPTIONAL(r.CUSTOM_STRING,c),"sender-vpa":r.CUSTOM_STRING(d),"sender-vpa-id":n.OPTIONAL(r.CUSTOM_STRING,m),"sender-name":n.OPTIONAL(r.CUSTOM_STRING,p),"seq-no":r.CUSTOM_STRING(_),"upi-bank-info":r.CUSTOM_STRING(f),mode:n.OPTIONAL(r.CUSTOM_STRING,g),"purpose-code":n.OPTIONAL(r.CUSTOM_STRING,h),mcc:n.OPTIONAL(r.CUSTOM_STRING,y),"ref-id":n.OPTIONAL(r.CUSTOM_STRING,C),device_ssid:n.OPTIONAL(r.CUSTOM_STRING,b),note:n.OPTIONAL(r.CUSTOM_STRING,v)},o("WASmaxChildren").OPTIONAL_CHILD(e,a)),S);return R}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeUPIPublishSendPayNodeUpi=e,l.makeUPIPublishSendPayNodeUpiUpiLiteDetails=s,l.mergeUPIPublishSendPayNodeMixin=c}),98);
__d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.bRPublishSendPayNode)return o("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(e,t.bRPublishSendPayNode);if(t.uPIPublishSendPayNode)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(e,t.uPIPublishSendPayNode);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeBRPublishOrUPIPublishSendPayNodeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bRPublishOrUPIPublishSendPayNodeMixinGroupArgs,n=o("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishOrUPIPublishSendPayNodeMixinGroup(o("WASmaxJsx").smax("pay",null),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIntegrationPublishPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(o("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(o("WASmaxJsx").smax("pay",null),e),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualNonNoviPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(o("WASmaxJsx").smax("pay",null),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paySender,n=e.payExpiryTs,r=e.payRequestId,a=o("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(o("WASmaxJsx").smax("pay",{sender:o("WASmaxAttrs").OPTIONAL(o("WAWap").USER_JID,t),"expiry-ts":o("WAWap").CUSTOM_STRING(n),"request-id":o("WAWap").CUSTOM_STRING(r)}),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualRequestPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payService,n=o("WASmaxJsx").smax("pay",{type:"invite",service:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePayInviteNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualPublishSendPayNode)return o("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(e,t.individualPublishSendPayNode);if(t.individualRequestPayNode)return o("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(e,t.individualRequestPayNode);if(t.payInviteNode)return o("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(e,t.payInviteNode);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs,n=o("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(o("WASmaxJsx").smax("pay",null),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualPublishPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(o("WASmaxJsx").smax("pay",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualPublishPayNodeMessageMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualIndividualPublishPayNodeMessageMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,o("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(o("WASmaxJsx").smax("message",null)),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualContentTypePayIndividualMixin=s}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.contentTypeMediaFanout)return o("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(e,t.contentTypeMediaFanout);if(t.contentTypeMediaFanoutDeprecated)return o("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(e,t.contentTypeMediaFanoutDeprecated);if(t.contentTypeLiveLocationFanout)return o("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(e,t.contentTypeLiveLocationFanout);if(t.individualContentTypePayIndividual)return o("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(e,t.individualContentTypePayIndividual);if(t.contentTypeListFanout)return o("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(e,t.contentTypeListFanout);if(t.isContentTypeReaction)return o("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(e);if(t.contentTypePollCreation)return o("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(e,t.contentTypePollCreation);if(t.contentTypePollVote)return o("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(e,t.contentTypePollVote);if(t.isContentTypePollResultSnapshot)return o("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(e);if(t.isContentTypeMedianotify)return o("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(e);if(t.contentTypeEvent)return o("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(e,t.contentTypeEvent);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentFanoutMixins=e}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:"ctwa"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeLidChatOriginMixin=s}),98);
__d("WASmaxOutMessagePublishMsgMetaOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMsgMetaOriginMixin=s}),98);
__d("WASmaxOutMessagePublishPeripheralOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaPeripheral,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{peripheral:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeripheralOriginMixin=s}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageT,n=o("WASmaxJsx").smax("message",{t:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.contentBindingElementValue,r=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxJsx").smax("content_binding",null,n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeToContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.encNativeFlowName,r=e.hasAvatarStickerType,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,o("WASmaxJsx").smax("enc",{mediatype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)}),r);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncMediaTypeDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{v:"3"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncVersion3Mixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isEncVersion2)return o("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(e);if(t.isEncVersion3)return o("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(e);if(t.encVersionFutureproof)return o("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(e,t.encVersionFutureproof);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncVersion=e}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encTypeIndividualMixinArgs,r=e.encMediaTypeDeprecatedMixinArgs,a=e.encVersionArgs,i=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxOutMessagePublishEncVersion").mergeEncVersion(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxJsx").smax("enc",null),n),r),a));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeToDeviceMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toContentBindingMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,o("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(o("WASmaxJsx").smax("to",null),e),t);return n}function s(){var e=o("WASmaxJsx").smax("enc",null);return e}function u(t){var n,r=t.toArgs,a=t.messageTo,i=t.tDeprecatedMixinArgs,l=t.botMessageTypeMixinArgs,s=t.businessBotMessageMixinArgs,u=t.botMetricsEntryPointMixinArgs,c=t.botMetricsThreadEntryPointMixinArgs,d=t.msgMetaOriginMixinArgs,m=t.hasLidChatOrigin,p=t.botLocalAutomatedTypeMixinArgs,_=t.businessBotMessageFeedbackRequestedMixinArgs,f=t.botPersonaTypeMixinArgs,g=t.botClientMultiThreadIDMessageMixinArgs,h=t.peripheralOriginMixinArgs,y=t.contentFanoutMixinsArgs,C=o("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((n=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin").mergeBotClientMultiThreadIDMessageMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,n.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,o("WASmaxJsx").smax("message",{to:o("WAWap").JID(a)},o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(e,r,1,1997))),i),l),s),u),c),d),m),p),_),f),g),h),y);return C}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualIndividualFanoutParticipantsTo=e,l.makeIndividualIndividualFanoutEnc=s,l.mergeIndividualIndividualFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{mediatype:"list"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncListMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.singleSelectOrProductListMixinGroupArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(o("WASmaxJsx").smax("enc",null)))),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeListMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncLiveLocationDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncLiveLocationMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.encLiveLocation)return o("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(e,t.encLiveLocation);if(t.encLiveLocationDeprecated)return o("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(e,t.encLiveLocationDeprecated);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.liveLocationModeMixinArgs,n=e.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(o("WASmaxJsx").smax("enc",null),n))),t);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeLiveLocationSingleMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.encMediaType)return o("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(e,t.encMediaType);if(t.encMediaTypeDeprecated)return o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(e,t.encMediaTypeDeprecated);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.senderContentBindingMixinArgs,n=e.contentTypeMediaOrMedianotifyMixinGroupArgs,r=e.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs,a=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(o("WASmaxJsx").smax("enc",null),r)),t),n);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeMediaSingleMixin=s}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.contentTypeMediaSingle)return o("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(e,t.contentTypeMediaSingle);if(t.contentTypeLiveLocationSingle)return o("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(e,t.contentTypeLiveLocationSingle);if(t.individualContentTypePayIndividual)return o("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(e,t.individualContentTypePayIndividual);if(t.contentTypeList)return o("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(e,t.contentTypeList);if(t.isContentTypeReaction)return o("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(e);if(t.contentTypePollCreation)return o("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(e,t.contentTypePollCreation);if(t.contentTypePollVote)return o("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(e,t.contentTypePollVote);if(t.isContentTypePollResultSnapshot)return o("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(e);if(t.contentTypeEvent)return o("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(e,t.contentTypeEvent);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentMixins=e}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipient,n=o("WASmaxJsx").smax("message",{recipient:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualRetryToPeerMixin=s}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageT,n=e.encRetryMixinArgs,r=o("WASmaxJsx").smax("message",{t:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,o("WASmaxJsx").smax("enc",null),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRetryMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualIndividualRetryToPeerMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,o("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(o("WASmaxJsx").smax("message",null),e),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualRetryMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.contentBindingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("content_binding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualSingleContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishReceiverAccountKindMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaReceiverAccountKind,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{receiver_account_kind:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeReceiverAccountKindMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishReceiverAccountKindMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageTo,r=e.individualIndividualRetryMixinArgs,a=e.individualSingleContentBindingMixinArgs,i=e.botMessageTypeMixinArgs,l=e.businessBotMessageMixinArgs,s=e.botMetricsEntryPointMixinArgs,u=e.botMetricsThreadEntryPointMixinArgs,c=e.msgMetaOriginMixinArgs,d=e.hasLidChatOrigin,m=e.botLocalAutomatedTypeMixinArgs,p=e.businessBotMessageFeedbackRequestedMixinArgs,_=e.botPersonaTypeMixinArgs,f=e.botClientMultiThreadIDMessageMixinArgs,g=e.peripheralOriginMixinArgs,h=e.receiverAccountKindMixinArgs,y=e.contentMixinsArgs,C=e.encTypeIndividualMixinArgs,b=e.encMediaTypeDeprecatedMixinArgs,v=e.encVersionArgs,S=o("WASmaxOutMessagePublishContentMixins").mergeContentMixins((t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishReceiverAccountKindMixin").mergeReceiverAccountKindMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin").mergeBotClientMultiThreadIDMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,t.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualSingleContentBindingMixin").mergeIndividualSingleContentBindingMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,o("WASmaxJsx").smax("message",{to:o("WAWap").JID(n)},o("WASmaxOutMessagePublishEncVersion").mergeEncVersion(t.optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxJsx").smax("enc",null),C),b),v)),r),a),i),l),s),u),c),d),m),p),_),f),g),h),y);return S}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualSingleMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualIndividualSingle)return o("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(e,t.individualIndividualSingle);if(t.individualIndividualFanout)return o("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(e,t.individualIndividualFanout);if(t.botMetricsEntryPoint)return o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin(e,t.botMetricsEntryPoint);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageTo,n=e.contentTypeTextOrMediaMixinGroupArgs,r=e.individualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroupArgs,a=e.hasBotFeedbackMessageType,i=e.botRequestMixinArgs,l=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup").mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup,o("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(o("WASmaxJsx").smax("message",{to:o("WAWap").USER_JID(t)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,o("WASmaxJsx").smax("bot",null,o("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(o("WASmaxJsx").smax("to",null),i)),a)),n),r);return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualBotRequestMessageMixin=s}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.botEditTargetId,r=e.botSenderTimestampMs,a=e.botEdit,i=e.hasBotTypeVoice,l=o("WASmaxJsx").smax("bot",{edit_target_id:(t=o("WASmaxAttrs")).OPTIONAL(o("WAWap").CUSTOM_STRING,n),sender_timestamp_ms:t.OPTIONAL(o("WAWap").INT,r),edit:t.OPTIONAL(o("WAWap").CUSTOM_STRING,a),type:t.OPTIONAL_LITERAL("voice",i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotResponseMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toCount,n=o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD_COUNT(s,t,2,2));return n}function s(){var e=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"image"}));return e}function u(t){var n=t.participantsArgs,r=o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return r}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualContentTypeBotResponseMediaFanoutParticipants=e,l.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=s,l.mergeIndividualContentTypeBotResponseMediaFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.individualContentTypeBotResponseMediaFanout)return o("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(e,t.individualContentTypeBotResponseMediaFanout);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=e}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxJsx").smax("enc",{type:"msmsg"}),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeMessageSecretMessageMixin=s}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.metaTargetId,r=e.metaTargetSenderJid,a=e.metaTargetChatJid,i=e.metaTargetChatJidLid,l=o("WASmaxJsx").smax("meta",{target_id:(t=o("WAWap")).STANZA_ID(n),target_sender_jid:o("WASmaxAttrs").OPTIONAL(t.USER_JID,r),target_chat_jid:o("WASmaxAttrs").OPTIONAL(t.JID,a),target_chat_jid_lid:o("WASmaxAttrs").OPTIONAL(t.JID,i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMessageTargetMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toArgs,n=o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(s,t,2,2));return n}function s(e){var t=e.toJid,n=o("WASmaxJsx").smax("to",{jid:o("WAWap").USER_JID(t)});return n}function u(t){var n,r=t.participantsArgs,a=t.messageTo,i=t.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,l=t.botResponseMixinArgs,s=t.messageTargetMixinArgs,u=t.encTypeMessageSecretMessageMixinArgs,c=t.encVersionBotArgs,d=o("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((n=o("WASmaxJsx")).smax("message",{to:o("WAWap").USER_JID(a)},o("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(n.smax("bot",null),l),o("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(n.smax("meta",null),s),o("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(o("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(n.smax("enc",null),u),c),o("WASmaxChildren").OPTIONAL_CHILD(e,r)),i);return d}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualBotResponseFanoutParticipants=e,l.makeIndividualBotResponseFanoutParticipantsTo=s,l.mergeIndividualBotResponseFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualBotResponseFanout)return o("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(e,t.individualBotResponseFanout);if(t.individualBotRequestMessage)return o("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(e,t.individualBotRequestMessage);if(t.individualIndividualSingle)return o("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(e,t.individualIndividualSingle);if(t.individualIndividualFanout)return o("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(e,t.individualIndividualFanout);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipient,n=o("WASmaxJsx").smax("message",{recipient:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualRecipientDeprecaredMixin=s}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"1"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMessageEditMixin=s}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"2"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMessagePinMixin=s}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"7"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeRevokeMixin=s}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isMessageEdit)return o("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(e);if(t.isMessagePin)return o("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(e);if(t.isRevoke)return o("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeMessageEditOrMessagePinOrRevokeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishMetaDestinationIdMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaDestinationId,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{destination_id:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMetaDestinationIdMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientUsername,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_username:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientUsernameMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientLIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientLid,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_lid:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientLIDMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientPn,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_pn:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientPNMixin=s}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipientPn,n=o("WASmaxJsx").smax("message",{recipient_pn:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRecipientPNMixin=s}),98);
__d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishPeerRecipientLIDMixin","WASmaxOutMessagePublishPeerRecipientPNMixin","WASmaxOutMessagePublishRecipientPNMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.recipientPN)return o("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(e,t.recipientPN);if(t.peerRecipientPN)return o("WASmaxOutMessagePublishPeerRecipientPNMixin").mergePeerRecipientPNMixin(e,t.peerRecipientPN);if(t.peerRecipientLID)return o("WASmaxOutMessagePublishPeerRecipientLIDMixin").mergePeerRecipientLIDMixin(e,t.peerRecipientLID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup=e}),98);
__d("WASmaxOutMessagePublishStatusMentionMessageMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{is_status_mention:"true"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeStatusMentionMessageMixin=s}),98);
__d("WASmaxOutMessagePublishPrivacyTokenContentsMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePrivacyTokenContentsMixin=s}),98);
__d("WASmaxOutMessagePublishTCTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPrivacyTokenContentsMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.tctokenT,n=e.privacyTokenContentsMixinArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutMessagePublishPrivacyTokenContentsMixin").mergePrivacyTokenContentsMixin(o("WASmaxJsx").smax("tctoken",{t:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)}),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTCTokenMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadType,n=o("WASmaxJsx").smax("meta",{thread_type:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagEnumMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadType,n=o("WASmaxJsx").smax("meta",{thread_type:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagLegacyMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.threadTypeTagEnum)return o("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(e,t.threadTypeTagEnum);if(t.threadTypeTagLegacy)return o("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(e,t.threadTypeTagLegacy);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeThreadTypeTagEnumOrLegacyMixinGroup=e}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.threadTypeTagEnumOrLegacyMixinGroupArgs,n=o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(o("WASmaxJsx").smax("meta",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagMixin=s}),98);
__d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{view_once:"true"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeViewOnceMetaAttributeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAppdataMetaAttributeMixin","WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishMetaDestinationIdMixin","WASmaxOutMessagePublishPeerRecipientUsernameMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup","WASmaxOutMessagePublishStatusMentionMessageMixin","WASmaxOutMessagePublishTCTokenMixin","WASmaxOutMessagePublishThreadTypeTagMixin","WASmaxOutMessagePublishViewOnceMetaAttributeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageId,r=e.groupInviteTargetMixinArgs,a=e.threadTypeTagMixinArgs,i=e.peerRecipientUsernameMixinArgs,l=e.individualRecipientDeprecaredMixinArgs,s=e.appdataMetaAttributeMixinArgs,u=e.hasStatusMentionMessage,c=e.tCTokenMixinArgs,d=e.hasViewOnceMetaAttribute,m=e.metaDestinationIdMixinArgs,p=e.peripheralOriginMixinArgs,_=e.armadilloOriginalMessageTimestampMixinArgs,f=e.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,g=e.messageEditOrMessagePinOrRevokeMixinGroupArgs,h=e.recipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroupArgs,y=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup").mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup,t.optionalMerge(o("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,o("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(t.optionalMerge(o("WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin").mergeArmadilloOriginalMessageTimestampMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishMetaDestinationIdMixin").mergeMetaDestinationIdMixin,t.optionalMerge(o("WASmaxOutMessagePublishViewOnceMetaAttributeMixin").mergeViewOnceMetaAttributeMixin,t.optionalMerge(o("WASmaxOutMessagePublishTCTokenMixin").mergeTCTokenMixin,t.optionalMerge(o("WASmaxOutMessagePublishStatusMentionMessageMixin").mergeStatusMentionMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishAppdataMetaAttributeMixin").mergeAppdataMetaAttributeMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeerRecipientUsernameMixin").mergePeerRecipientUsernameMixin,t.optionalMerge(o("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,t.optionalMerge(o("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,o("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(o("WASmaxJsx").smax("message",{id:o("WAWap").STANZA_ID(n)}),e),r),a),i),l),s),u),c),d),m),p),_),f),g),h);return y}l.makeIndividualRequest=e}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(r,n);if(a.success)return{name:"IndividualResponseNegative",value:a.value};var i=o("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(r,n);if(i.success)return{name:"IndividualResponseSuccess",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:a,Success:i}))}),s.apply(this,arguments)}l.sendIndividualRPC=e}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAFrankingTypes","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){a===void 0&&(a=!1);var i=o("WAJids").interpretAsGroupJid(e.protocolMsgId.chat),l=e.messageType.type==="text"&&e.messageType.invitedParticipantUserJid!=null;if(t.type==="direct_user"){var s={individualIndividualSingle:{messageTo:t.message.to,individualIndividualRetryMixinArgs:_(e.count,t.recipient),contentMixinsArgs:p(e,t.message),encTypeIndividualMixinArgs:f(t.message),encVersionArgs:g(t.message)}},u={messageId:e.externalId,deviceIdentityMixinArgs:o("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(e.deviceIdentity),hasNoExtraFanout:e.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:h(e.messageType),clientFrankingTagMixinArgs:n!=null&&n.frankingTag?{frankingTagElementValue:n.frankingTag}:null,hasMetaHideDecryptionPlaceholder:e.messageType.isInvisible===!0?!0:null,groupInviteTargetMixinArgs:l&&i!=null?{metaGroupInvite:i}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:s,internalTestMixinArgs:a?{testConfig:"armadillo_express"}:null};r==null||r.addPoint("send_individual_rpc");var c=yield o("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(u);if(c.name==="IndividualResponseSuccess"){var C,b=((C=c.value.deviceListStaleMixin)==null?void 0:C.phash)!=null?{type:"mismatch",local:null,server:c.value.deviceListStaleMixin.phash}:{type:"ok"},v=c.value.serverFrankingTagMixin!=null&&n!=null?babelHelpers.extends({},n,{reportingTag:o("WAFrankingTypes").castToReportingTag(c.value.serverFrankingTagMixin.frankingReportingTagElementValue)}):null;return{type:"success",ts:o("WATimeUtils").castToUnixTime(c.value.t),phash:b,count:null,reportingMeta:v}}else{var S,R;return c.name,{type:"error",errorCode:parseInt(c.value.error,10),backoff:parseInt((S=c.value.messageNackRetryAttributesMixin)==null?void 0:S.backoff,10),applicationError:(R=c.value.applicationNegativeAckMixin)==null?void 0:R.applicationError}}}var L=e.messageType.isInvisible===!0?"false":o("WAWap").DROP_ATTR,E=t.participant!=null?o("WAWap").JID(t.participant):o("WAWap").DROP_ATTR,k=t.phash!=null&&t.type==="group"?o("WAWap").CUSTOM_STRING(t.phash):o("WAWap").DROP_ATTR;function I(){return e.messageType.type==="text"&&e.messageType.isRevoked?"7":e.messageType.type==="text"&&e.messageType.isEdit===!0?"1":o("WAWap").DROP_ATTR}var T=I();function D(){return l&&i!=null?o("WAWap").wap("meta",{"decrypt-fail":"hide",group_invite:o("WAWap").CUSTOM_STRING(i)}):e.messageType.isInvisible===!0||e.messageType.isEdit===!0?o("WAWap").wap("meta",{"decrypt-fail":"hide"}):null}var x=D(),$=a?o("WAWap").wap("test",{config:o("WAWap").CUSTOM_STRING("armadillo_express")}):null,P=e.deviceIdentity!=null?o("WAWap").wap("device-identity",null,e.deviceIdentity):null,N=(n==null?void 0:n.frankingTag)!=null?o("WAWap").wap("franking",null,o("WAWap").wap("franking_tag",null,n.frankingTag)):null,M=null;t.participants!=null&&(M=o("WAWap").wap("participants",null,t.participants.map(function(e){return d(e)})));var w=null;t.message!=null&&(w=d(t.message,!0));var A=o("WAWap").wap("message",{device_fanout:L,edit:T,id:o("WAWap").CUSTOM_STRING(e.externalId),participant:E,phash:k,to:o("WAWap").JID(t.messageTo),type:e.messageType.type},x,N,M,w,P,$);y(e.externalId),r==null||r.addPoint("send_stanza_and_return_ack");var F=yield o("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(A,{id:e.externalId,class:"message",from:t.messageTo,participant:t.participant!=null?t.participant:null});r==null||r.addPoint("send_msg_ack_parser");var O=m.parse(F);if(O.success){r==null||r.addPoint("send_msg_ack_parser_success");var B=O.success,W=B.errorCode,q=B.applicationError,U=B.backoff;if(W==null){var V,H=O.success,G=H.ts,z=H.phash,j=H.count,K=n!=null?babelHelpers.extends({},n,{reportingTag:(V=O.success.reportingMeta)==null?void 0:V.reportingTag}):null;return{type:"success",ts:G,phash:z==null||z===t.phash?{type:"ok"}:{type:"mismatch",local:t.phash,server:z},count:j,reportingMeta:K}}else return r==null||r.addPoint("send_msg_ack_parser_failed",{int:{errorCode:W,applicationError:q}}),{type:"error",errorCode:W,applicationError:q,backoff:U}}else return{type:"parsing_error"}}),c.apply(this,arguments)}function d(e,t){t===void 0&&(t=!1);var n=o("WAWap").wap("enc",{count:e.count!=null?o("WAWap").INT(e.count):o("WAWap").DROP_ATTR,mediatype:e.mediaType!=null?o("WAWap").CUSTOM_STRING(e.mediaType):o("WAWap").DROP_ATTR,type:o("WAWap").CUSTOM_STRING(e.type),v:o("WAWap").CUSTOM_STRING(e.v)},e.ciphertext);return t||e.encType==="group"?n:o("WAWap").wap("to",{jid:o("WAWap").DEVICE_JID(e.to)},n)}var m=new(r("WADeprecatedWapParser"))("sendMsgAck",function(e){return e.assertTag("ack"),{count:e.maybeAttrInt("count"),errorCode:e.maybeAttrInt("error"),phash:e.maybeAttrString("phash"),applicationError:e.maybeAttrInt("application_error"),ts:e.attrTime("t"),reportingMeta:o("WAParseFranking").parseFrankingNode(e.maybeChild("franking")),backoff:e.maybeAttrInt("backoff")}});function p(t,n){if(t.messageType.type==="reaction")return{isContentTypeReaction:!0};if(t.messageType.type==="text")return{isContentTypeText:!0};if(t.messageType.type,n.mediaType!=null){var r={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:n.mediaType}}};return{contentTypeMediaSingle:r}}return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""])),t.messageType.mediaType),{isContentTypeText:!0}}function _(e,t){var n=e!=null?{encCount:e}:null,r=t!=null?{messageRecipient:t}:null;return{encRetryMixinArgs:n,individualIndividualRetryToPeerMixinArgs:r}}function f(e){return{encType:e.type,encElementValue:e.ciphertext}}function g(e){return e.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function h(e){return e.type==="text"&&e.isRevoked?{isRevoke:!0}:null}function y(e){try{var t=BigInt(e)}catch(t){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[WASendMsgRPC] Sending message with not allowed stanzaId: ",", error: ",""])),e,t)}}l.sendStanza=u,l.createEncWapNode=d}),98);
__d("WASendMsgInternal",["FBLogger","Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WALogger","WAMarkSenderKeyAsSentApi","WAOdsEnums","WAQueryGroupsAndSync","WAResultOrError","WASendMsgRPC","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=10002,f=10009;function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l;t.addPoint("encrypt_start",{string:{sentMessageType:e.messageType.isRevoked===!0?"revoke":e.messageType.type},bool:{isInvisibleMsg:e.messageType.type==="text"&&e.messageType.isInvisible===!0}});var s=yield o("WAGlobals").getWaOneQueue().enqueue(function(n){var r=n.cryptoManager;return e.type==="chat"?L(e,t,2,{cryptoManager:r}):S(e,{cryptoManager:r},2)},{operationType:"encrypt",flush:!0});if(t.addPoint("finish_encrypt",{string:{chatType:s.success?s.value.type:s.error}}),s.success===!1)throw r("FBLogger")("wmi").mustfixThrow("Encryption failed %s",s.error);var u=s.value;t.addPoint("sending_stanza_start",{string:{encryptionType:u.type},int:{ciphertextByteLength:(n=(a=(i=u.message)==null||(i=i.ciphertext)==null?void 0:i.length)!=null?a:(l=u.participants)==null||(l=l[0].ciphertext)==null?void 0:l.length)!=null?n:0}});var c=yield o("WASendMsgRPC").sendStanza(e,u,e.reportingMeta,t);return t.addPoint("sending_stanza_end",{bool:{wai:c.type==="success"}}),{serverResponse:c,encryption:u}}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){var a,i,l,s;r===void 0&&(r=!1),D(e,t);var u=r?3:2,c=function(r){return e.type==="chat"?L(e,t,u,{cryptoManager:r}):S(e,{cryptoManager:r},u)},m=yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return c(t)},{operationType:"encrypt",flush:!0}),f=m.success?m.value.type:m.error;if(t.addPoint("finish_encrypt",{string:{chatType:f}}),m.success===!1)return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"])),f),o("WAResultOrError").makeError({type:"encryption-error",isRetriable:!1});var g=m.value;t.addPoint("sending_stanza_start",{string:{encryptionType:g.type},int:{ciphertextByteLength:(a=(i=(l=g.message)==null||(l=l.ciphertext)==null?void 0:l.length)!=null?i:(s=g.participants)==null||(s=s[0].ciphertext)==null?void 0:s.length)!=null?a:0}});var h=yield o("WASendMsgRPC").sendStanza(e,g,e.reportingMeta,t,r);if(t.addPoint("sending_stanza_end"),h.type==="success"){t.addPoint("send_stanza_success");try{var y,C=yield(p||(p=n("Promise"))).all([E(e,g,h,t),I(g)]),b=C[0];return t.addPoint("mark_sender_key_sent"),o("WAResultOrError").makeResult({baseKey:(y=g.message)==null?void 0:y.baseKey,reportingMeta:h.reportingMeta,serverTs:h.ts,meta:{pOrDhashMismatch:b}})}catch(e){throw t.addPoint("send_stanza_failed"),e}}if(h.type,x(h,f,t),h.applicationError===_&&(yield o("WAGlobals").getDependencies().handleReachabilityErrorAdminMsg(e.chat)),h.type==="parsing_error")return o("WAResultOrError").makeError({type:"result-parsing-error",isRetriable:!0});if(h.type==="error"){var v=h.errorCode!=null&&h.errorCode>=500;return v?o("WAResultOrError").makeError({type:"retryable-error",backoff:h.backoff,isRetriable:!0}):o("WAResultOrError").makeError({type:"non-retryable-error",applicationErrorCode:h.applicationError,errorCode:h.errorCode,isRetriable:!1})}return o("WAResultOrError").makeError({type:"unexpected-message-codepath",details:"impossible-server-error-result",isRetriable:!0,applicationErrorCode:h.applicationError})}),C.apply(this,arguments)}function b(e){return o("WADevicesState").getDevicesState().reset([e]),o("WADevicesState").getDevicesState().waitForUserDevices([e],"SendMsgUtil_recoverUser",!0)}function v(e){return o("WAJids").switchOnChatJidType(e,{interopUser:b,msgrUser:b,lidUser:b,phoneUser:b,group:function(t){return o("WAQueryGroupsAndSync").queryGroupsAndSync({groupJids:[t],ignoreDhash:!0})}})}function S(e,t,n){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.chat,a=e.to,i=e.messageBytes,l=e.messageType,s=e.count,u=e.sessionInfo,c=e.identityKey,d=e.backupDirective,m=yield o("WAEncUserMsg").encryptDeviceJidMessage(a,{type:"message",chat:r,messageBytes:i,messageType:l,applicationPayloadVersion:n,backupDirective:d},t,s,u,c);return o("WAJids").switchOnUserChatJidType(r,{user:function(n){return m!=null?o("WAResultOrError").makeResult({type:"direct_user",messageTo:e.to,message:m,recipient:o("WAGlobals").isPeerDevice(e.to)?n:null}):o("WAResultOrError").makeError("direct_user")},group:function(n){return m!=null?o("WAResultOrError").makeResult({type:"direct_group",messageTo:n,participant:e.to,message:m}):o("WAResultOrError").makeError("direct_group")}})}),R.apply(this,arguments)}function L(t,r,a,i){var l=t.recipients,u=t.messageBytes,c=t.messageType,d=t.chat,m=t.backupDirective;return o("WAJids").switchOnUserChatJidType(d,{user:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAEncUserMsg").encryptUserMsg(l,{type:"message",messageBytes:u,messageType:c,chat:e,applicationPayloadVersion:a,backupDirective:m},i,r),n=t.participants;return n!=null&&n.length>0?o("WAResultOrError").makeResult({type:"user",messageTo:e,participants:n,phash:t.phash}):o("WAResultOrError").makeError("user")});function t(t){return e.apply(this,arguments)}return t})(),group:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"])));var n=yield o("WAEncGroupMsg").encryptGroupMsg(t,l,u,c,i,m,r);o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"])));var a=n.participants,d=n.encNode;return a==null&&d==null?o("WAResultOrError").makeError("group"):o("WAResultOrError").makeResult({type:"group",messageTo:t,participants:a,message:d,senderKeyDistributionInfo:n.senderKeyDistributionInfo,phash:n.phash})});function a(e){return t.apply(this,arguments)}return a})()})}function E(e,t,n,r){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){if(n.type!=="success")return!1;var a=n.phash;return a.type==="mismatch"?(r.addPoint("phash_mismatch"),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"])),a.local,a.server),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:t.type}),yield v(e.chat),r.addPoint("participant_recovery_finished"),!0):!1}),k.apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.senderKeyDistributionInfo!=null){var t=e.senderKeyDistributionInfo,n=t.group,r=t.senderKeyId,a=t.knowsSenderKey;yield o("WAMarkSenderKeyAsSentApi").markSenderKeyAsSent(n,r,a)}}),T.apply(this,arguments)}function D(e,t){var n=0;e.type==="chat"&&(n=e.recipients.reduce(function(e,t){return e+t.devicesInfo.length},0));var r=e.messageType.type==="text"&&e.messageType.isRevoked,o=r?"revoke":e.messageType.type;t.addPoint("start_encrypt",{string:{sentMessageType:o},int:{numDevices:n},bool:{isInvisibleMsg:e.messageType.type==="text"&&e.messageType.isInvisible===!0}})}function x(e,t,n){if(e.type!=="success"){e.type==="parsing_error"&&(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""])),t),n.addPoint("ack_parse_fail"));var r=e.errorCode,a=e.applicationError;a===_&&n.addPoint("reachability_error_code"),o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", applicationError: ",", chatType:",""])),r,a,t),r!=null&&n.addPoint("ack_success_error_"+r,{int:{applicationError:a}}),a===f&&n.addPoint("sender_blocked",{})}}l.sendMessageV2=g,l.sendMessage=y}),98);
__d("WASentBytesCacheApi",["MAWTransactionMode","WADbTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=o("WADbTransactor")).makeSignalTransactor({sentBytesCache:(s=o("MAWTransactionMode")).READWRITE},"deleteSentBytes",function(e){return function(t){return e.sentBytesCache.bulkDelete(t)}}),c=e.makeSignalTransactor({sentBytesCache:s.READONLY},"loadExpired",function(e){return function(t){return e.sentBytesCache.where("ts").belowOrEqual(t).toArray().then(function(e){return e.map(function(e){return e.waMsgId})})}}),d=e.makeSignalTransactor({sentBytesCache:s.READONLY},"loadSentBytes",function(e){return function(t){return e.sentBytesCache.bulkGet(t).then(function(e){return e.filter(Boolean)})}}),m=e.makeSignalTransactor({sentBytesCache:s.READWRITE},"saveSentBytes",function(e){return function(t){return e.sentBytesCache.put(t).then(function(){})}});l.deleteSentBytes=u,l.loadExpired=c,l.loadSentBytes=d,l.saveSentBytes=m}),98);
__d("WASentBytesCache",["WAGlobals","WAJids","WAMsg","WASentBytesCacheApi","WATagsLogger","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["SentBytesCache"]),c=720*60*60,d=(function(){function t(){var t=this;o("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){t.$1().catch(function(t){u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to prune sent bytes: ",""])),t)})})}var a=t.prototype;return a.loadSentBytes=function(t){return o("WASentBytesCacheApi").loadSentBytes(t)},a.getMsgsForRetry=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=Array.from(new Set(e.map(function(e){var t=e.deviceJid;return o("WAJids").extractUserJid(t)}))),n=new Map;try{n=yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var n=e.cryptoManager;return n.storage.bulkLoadIdentities(t)},{operationType:"retries_load_identities",flush:!1,afterInit:!0})}catch(e){var a=r("getErrorSafe")(e);u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""])),a.toString())}var i=yield this.loadSentBytes(e.map(function(e){var t=e.protocolMsgId;return o("WAMsg").craftWAMsgIdString({author:t.author,chat:t.chat,externalId:t.externalId})}));return e.map(function(e){var t,r=e.deviceJid,a=e.protocolMsgId,l=o("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId}),s=(t=n.get(o("WAJids").extractUserJid(r)))==null?void 0:t.get(r);if(s==null)return{type:"unauthorized"};var u=i.find(function(e){return e.waMsgId===l});return u==null?{type:"missing"}:o("WATimeUtils").happenedWithin(u.ts,c)?{frankingKey:u.frankingKey,frankingVersion:u.frankingVersion,messageBytes:u.messageBytes,backupDirective:u.backupDirective,messageType:u.messageType,protocolMsgId:u.protocolMsgId,retryCount:e.retryCount+1,type:"unacked"}:{type:"unauthorized"}})});function t(t){return e.apply(this,arguments)}return t})(),a.saveSentBytes=function(t){return o("WASentBytesCacheApi").saveSentBytes(t)},a.$1=function(){return o("WASentBytesCacheApi").loadExpired(o("WATimeUtils").pastUnixTime(c)).then(function(e){return o("WASentBytesCacheApi").deleteSentBytes(e)})},t})(),m=new d;function p(){return m}l.SentBytesCache=d,l.sentBytesCache=p}),98);
__d("WASmaxInAppdataPublishAckMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",r.value);if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"class","appdata");if(!i.success)return i;var l=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",l.value);if(!s.success)return s;var u=o("WASmaxParseUtils").attrIntRange(e,"t",0,void 0);return u.success?o("WAResultOrError").makeResult({class:i.value,t:u.value}):u}l.parseAckMixin=e}),98);
__d("WASmaxInAppdataPublishPeerResponseNegative",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"error");if(!r.success)return r;var a=o("WASmaxInAppdataPublishAckMixin").parseAckMixin(e,t);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({error:r.value},a.value)):a}l.parsePeerResponseNegative=e}),98);
__d("WASmaxInAppdataPublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"phash");return n.success?o("WAResultOrError").makeResult({phash:n.value}):n}l.parseDeviceListStaleMixin=e}),98);
__d("WASmaxInAppdataPublishPeerResponseSuccess",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxInAppdataPublishDeviceListStaleMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxInAppdataPublishAckMixin").parseAckMixin(e,t);if(!r.success)return r;var a=o("WASmaxInAppdataPublishDeviceListStaleMixin").parseDeviceListStaleMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({},r.value,{deviceListStaleMixin:a.success?a.value:null}))}l.parsePeerResponseSuccess=e}),98);
__d("WASmaxOutAppdataPublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.deviceIdentityElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("device-identity",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeviceIdentityMixin=s}),98);
__d("WASmaxOutAppdataPublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.testConfig,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("test",{config:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInternalTestMixin=s}),98);
__d("WASmaxOutAppdataPublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestIdElementValue,n=o("WASmaxJsx").smax("trace",null,o("WASmaxJsx").smax("request_id",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestIDMixin=s}),98);
__d("WASmaxOutAppdataPublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.edgeIdElementValue,n=o("WASmaxJsx").smax("edge_id",null,t);return n}function s(e){var t=e.deviceArgs,n=e.correlationIdType,r=e.idElementValue,a=o("WASmaxJsx").smax("correlation_id",{type:o("WAWap").CUSTOM_STRING(n)},o("WASmaxJsx").smax("id",null,r),o("WASmaxChildren").OPTIONAL_CHILD(u,t));return a}function u(e){var t=e.deviceId,n=o("WASmaxJsx").smax("device",{id:o("WAWap").INT(t)});return n}function c(t){var n=t.edgeIdArgs,r=t.correlationIdArgs,a=t.traceIdElementValue,i=o("WASmaxJsx").smax("trace",null,[o("WASmaxJsx").smax("trace_id",null,a),o("WASmaxChildren").OPTIONAL_CHILD(e,n)].concat(o("WASmaxChildren").REPEATED_CHILD(s,r,0,10)));return i}function d(e,t){var n=c(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeTraceIDEdgeId=e,l.makeTraceIDCorrelationId=s,l.makeTraceIDCorrelationIdDevice=u,l.mergeTraceIDMixin=d}),98);
__d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishRequestIDMixin","WASmaxOutAppdataPublishTraceIDMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.requestID)return o("WASmaxOutAppdataPublishRequestIDMixin").mergeRequestIDMixin(e,t.requestID);if(t.traceID)return o("WASmaxOutAppdataPublishTraceIDMixin").mergeTraceIDMixin(e,t.traceID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRequestOrTraceIDMixinGroup=e}),98);
__d("WASmaxOutAppdataPublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestOrTraceIDMixinGroupArgs,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(o("WASmaxJsx").smax("trace",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTraceContextMixin=s}),98);
__d("WASmaxOutAppdataPublishWithDeviceListCheckMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataDeviceListCheck,n=o("WASmaxJsx").smax("appdata",{device_list_check:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWithDeviceListCheckMixin=s}),98);
__d("WASmaxOutAppdataPublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishDeviceIdentityMixin","WASmaxOutAppdataPublishInternalTestMixin","WASmaxOutAppdataPublishTraceContextMixin","WASmaxOutAppdataPublishWithDeviceListCheckMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.deviceIdentityMixinArgs,r=e.withDeviceListCheckMixinArgs,a=e.internalTestMixinArgs,i=e.traceContextMixinArgs,l=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutAppdataPublishTraceContextMixin").mergeTraceContextMixin,t.optionalMerge(o("WASmaxOutAppdataPublishInternalTestMixin").mergeInternalTestMixin,t.optionalMerge(o("WASmaxOutAppdataPublishWithDeviceListCheckMixin").mergeWithDeviceListCheckMixin,t.optionalMerge(o("WASmaxOutAppdataPublishDeviceIdentityMixin").mergeDeviceIdentityMixin,o("WASmaxJsx").smax("appdata",null),n),r),a),i);return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBaseMixin=s}),98);
__d("WASmaxOutAppdataPublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encElementValue,n=o("WASmaxJsx").smax("enc",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncPayloadMixin=s}),98);
__d("WASmaxOutAppdataPublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncPayloadMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encType,n=o("WASmaxOutAppdataPublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxJsx").smax("enc",{type:o("WAWap").CUSTOM_STRING(t)}),e);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeIndividualMixin=s}),98);
__d("WASmaxOutAppdataPublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encV,n=o("WASmaxJsx").smax("enc",{v:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncVersionFutureproofMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encVersionFutureproofMixinArgs,r=e.encTypeIndividualMixinArgs,a=o("WASmaxJsx").smax("to",{jid:o("WAWap").DEVICE_JID(t)},o("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(o("WASmaxJsx").smax("enc",null),n),r));return a}function s(t){var n=t.toArgs,r=t.appdataTo,a=o("WASmaxJsx").smax("appdata",{to:o("WAWap").USER_JID(r)},o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,24)));return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makePeerPeerFanoutParticipantsTo=e,l.mergePeerPeerFanoutMixin=u}),98);
__d("WASmaxOutAppdataPublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encCount,n=o("WASmaxJsx").smax("enc",{count:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncRetryMixin=s}),98);
__d("WASmaxOutAppdataPublishRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataT,n=e.encRetryMixinArgs,r=o("WASmaxJsx").smax("appdata",{t:o("WAWap").INT(t)},o("WASmaxOutAppdataPublishEncRetryMixin").mergeEncRetryMixin(o("WASmaxJsx").smax("enc",null),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRetryMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerPeerSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WASmaxOutAppdataPublishRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataTo,n=e.retryMixinArgs,r=e.encVersionFutureproofMixinArgs,a=e.encTypeIndividualMixinArgs,i=o("WASmaxMixins").optionalMerge(o("WASmaxOutAppdataPublishRetryMixin").mergeRetryMixin,o("WASmaxJsx").smax("appdata",{to:o("WAWap").DEVICE_JID(t)},o("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(o("WASmaxJsx").smax("enc",null),r),a)),n);return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerPeerSingleMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerMsgTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishPeerPeerFanoutMixin","WASmaxOutAppdataPublishPeerPeerSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.peerPeerFanout)return o("WASmaxOutAppdataPublishPeerPeerFanoutMixin").mergePeerPeerFanoutMixin(e,t.peerPeerFanout);if(t.peerPeerSingle)return o("WASmaxOutAppdataPublishPeerPeerSingleMixin").mergePeerPeerSingleMixin(e,t.peerPeerSingle);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergePeerMsgTypes=e}),98);
__d("WASmaxOutAppdataPublishPeerRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAppdataPublishBaseMixin","WASmaxOutAppdataPublishPeerMsgTypes","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataId,n=e.appdataPushPriority,r=e.peerMsgTypesArgs,a=o("WASmaxOutAppdataPublishPeerMsgTypes").mergePeerMsgTypes(o("WASmaxOutAppdataPublishBaseMixin").mergeBaseMixin(o("WASmaxJsx").smax("appdata",{id:o("WAWap").STANZA_ID(t),category:"peer",push_priority:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)}),e),r);return a}l.makePeerRequest=e}),98);
__d("WASmaxAppdataPublishPeerRPC",["WAComms","WASmaxInAppdataPublishPeerResponseNegative","WASmaxInAppdataPublishPeerResponseSuccess","WASmaxOutAppdataPublishPeerRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutAppdataPublishPeerRequest").makePeerRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInAppdataPublishPeerResponseNegative").parsePeerResponseNegative(r,n);if(a.success)return{name:"PeerResponseNegative",value:a.value};var i=o("WASmaxInAppdataPublishPeerResponseSuccess").parsePeerResponseSuccess(r,n);if(i.success)return{name:"PeerResponseSuccess",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Peer",{Negative:a,Success:i}))}),s.apply(this,arguments)}l.sendPeerRPC=e}),98);
__d("isGroupInvitesEnabled",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("125")===!0}l.default=e}),98);