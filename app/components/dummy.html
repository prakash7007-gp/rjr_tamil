import { branchesData } from "../../data/branchesData";
import { notFound } from "next/navigation";
import Image from "next/image";
import { MapPin, Phone, User, Clock, ArrowLeft } from "lucide-react";
import Link from "next/link";

// Helper to find a branch by ID across all regions
const getBranchById = (id: string) => {
for (const region of branchesData) {
const branch = region.branches.find((b) => b.id === id);
if (branch) return { branch, regionName: region.name };
}
return null;
};

// Generate all possible branch paths at build time
export async function generateStaticParams() {


const params = [];
for (const region of branchesData) {
for (const branch of region.branches) {
params.push({ branchId: branch.id });
}
}
return params;
}

export async function generateMetadata({ params }: { params: Promise<{ branchId: string }> }) {
    const resolvedParams = await params;
    const data = getBranchById(resolvedParams.branchId);
    if (!data) return { title: "Branch Not Found" };

    const doctorName = data.branch.doctors?.[0]?.name || "Specialist";

    return {
    title: `${data.branch.city} Branch - RJR Herbal Hospitals`,
    description: `Visit our ${data.branch.city} branch in ${data.regionName}. Doctor: ${doctorName}. Ph:
    ${data.branch.phone}`,
    };
    }

    export default async function BranchDetailPage(props: { params: Promise<{ branchId: string }> }) {
        const params = await props.params;
        const data = getBranchById(params.branchId);

        if (!data) {
        notFound();
        }

        const { branch, regionName } = data;

        return (
        <main className="bg-gray-50 min-h-screen py-10 px-4">
            <div className="max-w-6xl mx-auto">
                {/* Breadcrumb / Back */}
                <div className="mb-6">
                    <Link href="/branches"
                        className="inline-flex items-center text-gray-600 hover:text-[#c22220] transition font-medium">
                    <ArrowLeft size={18} className="mr-2" /> Back to All Branches
                    </Link>
                </div>

                {/* HEADER SECTION */}
                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-10 mb-8">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <span
                                className="inline-block px-3 py-1 bg-red-50 text-[#c22220] rounded-full text-sm font-bold tracking-wide mb-3">
                                {regionName}
                            </span>
                            <h1 className="text-3xl md:text-5xl font-bold text-gray-900 mb-2">
                                {branch.city} Branch
                            </h1>
                            <p className="text-lg text-gray-600 flex items-center gap-2">
                                <MapPin size={20} className="text-[#c22220]" />
                                {branch.address}
                            </p>
                        </div>

                        <a href={`tel:${branch.phone}`}
                            className="bg-[#c22220] hover:bg-red-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                            <Phone size={20} />
                            Call Now
                        </a>
                    </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    {/* LEFT COLUMN - MAIN INFO & MAP */}
                    <div className="lg:col-span-2 space-y-8">

                        {/* MAP CARD */}
                        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                            <div className="p-4 border-b border-gray-100 bg-gray-50">
                                <h2 className="font-bold text-xl text-gray-800">Location Map</h2>
                            </div>
                            <div className="w-full h-[400px] relative bg-gray-200">
                                <iframe src={branch.mapUrl} width="100%" height="100%" style={{ border: 0 }}
                                    allowFullScreen loading="lazy" referrerPolicy="no-referrer-when-downgrade"
                                    className="absolute inset-0 w-full h-full"></iframe>
                            </div>
                        </div>

                        {/* FACILITIES / ABOUT (Placeholder) */}
                        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                            <h3 className="text-xl font-bold text-gray-900 mb-4">இந்த கிளை பற்றி</h3>
                            <p className="text-gray-600 leading-relaxed mb-6">
                                {branch.city} உள்ள எங்கள் RJR Herbal Hospital-க்கு உங்களை வரவேற்கிறோம். ஆஸ்துமா,
                                சொரியாசிஸ், ஆர்த்ரைட்டிஸ் உள்ளிட்ட பல்வேறு நோய்களுக்கு உலகத் தரமுடைய மூலிகை சிகிச்சைகளை
                                நாங்கள் வழங்குகிறோம். நவீன வசதிகளுடன் அமைந்த எங்கள் மருத்துவமனையில், உங்கள் உடல்
                                நலத்திற்காக அர்ப்பணிக்கப்பட்ட அனுபவமிக்க மருத்துவ நிபுணர்கள் பணியாற்றுகின்றனர்.
                            </p>

                            <h4 className="font-bold text-gray-800 mb-3">இங்கே கிடைக்கும் சிகிச்சைகள்</h4>
                            <ul className="grid grid-cols-1 md:grid-cols-2 gap-2 text-gray-600">
                                {["ஆஸ்துமா பராமரிப்பு",
                                "சொரியாசிஸ் சிகிச்சை",
                                "மூட்டு வலி நிவாரணம்",
                                "நீரிழிவு கட்டுப்பாடு",
                                "உயர் இரத்த அழுத்தம்",
                                "தோல் பராமரிப்பு",
                                "மூட்டு வலி",
                                "பொது உடல் நல பராமரிப்பு"].map((item, i) => (
                                <li key={i} className="flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-[#c22220]"></span>
                                    {item}
                                </li>
                                ))}
                            </ul>
                        </div>

                        {/* DUMMY REVIEWS */}
                        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                            <h3 className="text-xl font-bold text-gray-900 mb-6">Patient Reviews</h3>
                            <div className="space-y-6">
                                {[1, 2].map((i) => (
                                <div key={i} className="border-b last:border-0 pb-6 last:pb-0">
                                    <div className="flex items-center gap-1 text-yellow-500 mb-2">
                                        {"★".repeat(5)}
                                    </div>
                                    <p className="text-gray-600 italic mb-3">
                                        "Excellent treatment and very caring staff. The doctor at {branch.city} branch
                                        was very knowledgeable and helped me recover quickly."
                                    </p>
                                    <p className="text-sm font-bold text-gray-800">- Happy Patient</p>
                                </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* RIGHT COLUMN - DOCTOR & HOURS */}
                    <div className="space-y-8">
                        {/* DOCTOR PROFILE */}
                        {/* DOCTOR PROFILE - Show only if single doctor in sidebar */}
                        {branch.doctors && branch.doctors.length === 1 && (
                        <div className="space-y-6">
                            {branch.doctors.map((doctor, index) => (
                            <div key={index}
                                className="bg-[#c22220] rounded-2xl overflow-hidden shadow-lg border-2 border-[#c22220] h-[450px] flex flex-col">
                                {/* Image Section - 80% */}
                                <div className="relative h-[80%] bg-white">
                                    {doctor.image ? (
                                    <Image src={doctor.image} alt={doctor.name} fill
                                        className="object-cover object-top" />
                                    ) : (
                                    <div
                                        className="w-full h-full flex items-center justify-center bg-gray-200 text-gray-400">
                                        <User size={64} />
                                    </div>
                                    )}
                                </div>

                                {/* Info Section - 20% */}
                                <div
                                    className="h-[20%] flex flex-col items-center justify-center p-2 text-center bg-[#c22220]">
                                    <h3 className="text-yellow-400 font-bold text-xl md:text-2xl leading-tight mb-1">
                                        {doctor.name.replace(/^DR\./i, 'Dr.').replace(/^DR\s/i, 'Dr. ')}
                                    </h3>
                                    <p className="text-white text-sm md:text-base font-medium opacity-90">
                                        {doctor.role}
                                    </p>
                                </div>
                            </div>
                            ))}
                        </div>
                        )}

                        {/* TIMINGS */}
                        <div className="bg-[#c22220] text-white rounded-2xl shadow-lg p-6">
                            <div className="flex items-center gap-3 mb-6">
                                <Clock className="w-6 h-6 text-yellow-400" />
                                <h3 className="text-xl font-bold">Opening Hours</h3>
                            </div>

                            <div className="space-y-3 font-medium opacity-90">
                                <div className="flex justify-between border-b border-white/20 pb-2">
                                    <span>Monday - Saturday</span>
                                    <span>9:00 AM - 7:00 PM</span>
                                </div>
                                <div className="flex justify-between pb-2">
                                    <span>Sunday</span>
                                    <span>9:00 AM - 1:00 PM</span>
                                </div>
                            </div>

                            <div className="mt-6 pt-4 border-t border-white/20 text-center">
                                <p className="text-yellow-400 text-sm font-semibold">Emergency? Call us anytime.</p>
                                <p className="text-2xl font-bold mt-1">{branch.phone}</p>
                            </div>
                        </div>
                    </div>
                </div>

                {/* MULTI DOCTOR SECTION - COMPONENT */}
                {branch.doctors && branch.doctors.length > 1 && (
                <div className="mt-12 bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                    <div className="text-center mb-8">
                        <span
                            className="inline-block px-3 py-1 bg-red-50 text-[#c22220] rounded-full text-sm font-bold tracking-wide mb-3">
                            Our Team
                        </span>
                        <h2 className="text-3xl font-bold text-gray-900">Meet Our Specialists</h2>
                    </div>

                    <div className="flex flex-wrap justify-center gap-8">
                        {branch.doctors.map((doctor, index) => (
                        <div key={index}
                            className="w-full max-w-sm bg-[#c22220] rounded-2xl overflow-hidden shadow-lg border-2 border-[#c22220] h-[500px] flex flex-col transform hover:scale-[1.02] transition-transform duration-300">
                            {/* Image Section - 80% */}
                            <div className="relative h-[80%] bg-white group">
                                {doctor.image ? (
                                <Image src={doctor.image} alt={doctor.name} fill className="object-cover object-top" />
                                ) : (
                                <div
                                    className="w-full h-full flex items-center justify-center bg-gray-200 text-gray-400">
                                    <User size={80} />
                                </div>
                                )}
                            </div>

                            {/* Info Section - 20% */}
                            <div
                                className="h-[20%] flex flex-col items-center justify-center p-4 text-center bg-[#c22220]">
                                <h3 className="text-yellow-400 font-bold text-xl md:text-2xl leading-tight mb-2">
                                    {doctor.name.replace(/^DR\./i, 'Dr.').replace(/^DR\s/i, 'Dr. ')}
                                </h3>
                                <p className="text-white text-base font-medium opacity-90">
                                    {doctor.role}
                                </p>
                            </div>
                        </div>
                        ))}
                    </div>
                </div>
                )}
            </div>
        </main>
        );
        }